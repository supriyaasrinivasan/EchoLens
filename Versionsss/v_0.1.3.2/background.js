/*! For license information please see background.js.LICENSE.txt */
(()=>{var t={234:()=>{},490:()=>{},826:(t,e,n)=>{t=n.nmd(t);var r=void 0,i=function(e){return r||(r=new Promise(function(r,i){var a,o=void 0!==e?e:{},s=o.onAbort;o.onAbort=function(t){i(new Error(t)),s&&s(t)},o.postRun=o.postRun||[],o.postRun.push(function(){r(o)}),t=void 0,a||=void 0!==o?o:{};var u="object"==typeof window,c="undefined"!=typeof WorkerGlobalScope,l="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node&&"renderer"!=process.type;a.onRuntimeInitialized=function(){function t(t,e){switch(typeof e){case"boolean":K(t,e?1:0);break;case"number":H(t,e);break;case"string":V(t,e,-1,-1);break;case"object":if(null===e)W(t);else if(null!=e.length){var n=ge(e,ye);B(t,n,e.length,-1),Oe(n)}else J(t,"Wrong API use : tried to return a value of an unknown type ("+e+").",-1);break;default:W(t)}}function e(t,e){for(var n=[],r=0;r<t;r+=1){var i=X(e+4*r,"i32"),a=F(i);if(1===a||2===a)i=x(i);else if(3===a)i=G(i);else if(4===a){i=U(a=i),a=q(a);for(var o=new Uint8Array(i),s=0;s<i;s+=1)o[s]=_[a+s];i=o}else i=null;n.push(i)}return n}function n(t,e){this.Qa=t,this.db=e,this.Oa=1,this.lb=[]}function r(t,e){if(this.db=e,e=nt(t)+1,this.eb=ke(e),null===this.eb)throw Error("Unable to allocate memory for the SQL string");rt(t,T,this.eb,e),this.kb=this.eb,this.Za=this.pb=null}function i(t){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),null!=t){var e=this.filename,n="/",r=e;if(n&&(n="string"==typeof n?n:St(n),r=e?$(n+"/"+e):n),r=function(t,e=438){return xt(t,4095&e|32768,0)}(r,e=ft(!0,!0)),t){if("string"==typeof t){n=Array(t.length);for(var i=0,a=t.length;i<a;++i)n[i]=t.charCodeAt(i);t=n}Qt(r,146|e),ee(n=$t(r,577),t,0,t.length,0),Jt(n),Qt(r,e)}}this.handleError(u(this.filename,o)),this.db=X(o,"i32"),tt(this.db),this.fb={},this.Sa={}}var o=Re(4),s=a.cwrap,u=s("sqlite3_open","number",["string","number"]),c=s("sqlite3_close_v2","number",["number"]),l=s("sqlite3_exec","number",["number","string","number","number","number"]),f=s("sqlite3_changes","number",["number"]),h=s("sqlite3_prepare_v2","number",["number","string","number","number","number"]),p=s("sqlite3_sql","string",["number"]),m=s("sqlite3_normalized_sql","string",["number"]),d=s("sqlite3_prepare_v2","number",["number","number","number","number","number"]),b=s("sqlite3_bind_text","number",["number","number","number","number","number"]),v=s("sqlite3_bind_blob","number",["number","number","number","number","number"]),y=s("sqlite3_bind_double","number",["number","number","number"]),g=s("sqlite3_bind_int","number",["number","number","number"]),w=s("sqlite3_bind_parameter_index","number",["number","string"]),E=s("sqlite3_step","number",["number"]),S=s("sqlite3_errmsg","string",["number"]),k=s("sqlite3_column_count","number",["number"]),O=s("sqlite3_data_count","number",["number"]),A=s("sqlite3_column_double","number",["number","number"]),N=s("sqlite3_column_text","string",["number","number"]),I=s("sqlite3_column_blob","number",["number","number"]),R=s("sqlite3_column_bytes","number",["number","number"]),P=s("sqlite3_column_type","number",["number","number"]),L=s("sqlite3_column_name","string",["number","number"]),D=s("sqlite3_reset","number",["number"]),j=s("sqlite3_clear_bindings","number",["number"]),C=s("sqlite3_finalize","number",["number"]),M=s("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),F=s("sqlite3_value_type","number",["number"]),U=s("sqlite3_value_bytes","number",["number"]),G=s("sqlite3_value_text","string",["number"]),q=s("sqlite3_value_blob","number",["number"]),x=s("sqlite3_value_double","number",["number"]),H=s("sqlite3_result_double","",["number","number"]),W=s("sqlite3_result_null","",["number"]),V=s("sqlite3_result_text","",["number","string","number","number"]),B=s("sqlite3_result_blob","",["number","number","number","number"]),K=s("sqlite3_result_int","",["number","number"]),J=s("sqlite3_result_error","",["number","string","number"]),Z=s("sqlite3_aggregate_context","number",["number","number"]),tt=s("RegisterExtensionFunctions","number",["number"]),et=s("sqlite3_update_hook","number",["number","number","number"]);n.prototype.bind=function(t){if(!this.Qa)throw"Statement closed";return this.reset(),Array.isArray(t)?this.Cb(t):null==t||"object"!=typeof t||this.Db(t)},n.prototype.step=function(){if(!this.Qa)throw"Statement closed";this.Oa=1;var t=E(this.Qa);switch(t){case 100:return!0;case 101:return!1;default:throw this.db.handleError(t)}},n.prototype.wb=function(t){return null==t&&(t=this.Oa,this.Oa+=1),A(this.Qa,t)},n.prototype.Gb=function(t){if(null==t&&(t=this.Oa,this.Oa+=1),t=N(this.Qa,t),"function"!=typeof BigInt)throw Error("BigInt is not supported");return BigInt(t)},n.prototype.Hb=function(t){return null==t&&(t=this.Oa,this.Oa+=1),N(this.Qa,t)},n.prototype.getBlob=function(t){null==t&&(t=this.Oa,this.Oa+=1);var e=R(this.Qa,t);t=I(this.Qa,t);for(var n=new Uint8Array(e),r=0;r<e;r+=1)n[r]=_[t+r];return n},n.prototype.get=function(t,e){e=e||{},null!=t&&this.bind(t)&&this.step(),t=[];for(var n=O(this.Qa),r=0;r<n;r+=1)switch(P(this.Qa,r)){case 1:var i=e.useBigInt?this.Gb(r):this.wb(r);t.push(i);break;case 2:t.push(this.wb(r));break;case 3:t.push(this.Hb(r));break;case 4:t.push(this.getBlob(r));break;default:t.push(null)}return t},n.prototype.getColumnNames=function(){for(var t=[],e=k(this.Qa),n=0;n<e;n+=1)t.push(L(this.Qa,n));return t},n.prototype.getAsObject=function(t,e){t=this.get(t,e),e=this.getColumnNames();for(var n={},r=0;r<e.length;r+=1)n[e[r]]=t[r];return n},n.prototype.getSQL=function(){return p(this.Qa)},n.prototype.getNormalizedSQL=function(){return m(this.Qa)},n.prototype.run=function(t){return null!=t&&this.bind(t),this.step(),this.reset()},n.prototype.sb=function(t,e){null==e&&(e=this.Oa,this.Oa+=1),t=it(t);var n=ge(t,ye);this.lb.push(n),this.db.handleError(b(this.Qa,e,n,t.length-1,0))},n.prototype.Bb=function(t,e){null==e&&(e=this.Oa,this.Oa+=1);var n=ge(t,ye);this.lb.push(n),this.db.handleError(v(this.Qa,e,n,t.length,0))},n.prototype.rb=function(t,e){null==e&&(e=this.Oa,this.Oa+=1),this.db.handleError((t===(0|t)?g:y)(this.Qa,e,t))},n.prototype.Eb=function(t){null==t&&(t=this.Oa,this.Oa+=1),v(this.Qa,t,0,0,0)},n.prototype.tb=function(t,e){switch(null==e&&(e=this.Oa,this.Oa+=1),typeof t){case"string":return void this.sb(t,e);case"number":return void this.rb(t,e);case"bigint":return void this.sb(t.toString(),e);case"boolean":return void this.rb(t+0,e);case"object":if(null===t)return void this.Eb(e);if(null!=t.length)return void this.Bb(t,e)}throw"Wrong API use : tried to bind a value of an unknown type ("+t+")."},n.prototype.Db=function(t){var e=this;return Object.keys(t).forEach(function(n){var r=w(e.Qa,n);0!==r&&e.tb(t[n],r)}),!0},n.prototype.Cb=function(t){for(var e=0;e<t.length;e+=1)this.tb(t[e],e+1);return!0},n.prototype.reset=function(){return this.freemem(),0===j(this.Qa)&&0===D(this.Qa)},n.prototype.freemem=function(){for(var t;void 0!==(t=this.lb.pop());)Oe(t)},n.prototype.free=function(){this.freemem();var t=0===C(this.Qa);return delete this.db.fb[this.Qa],this.Qa=0,t},r.prototype.next=function(){if(null===this.eb)return{done:!0};if(null!==this.Za&&(this.Za.free(),this.Za=null),!this.db.db)throw this.mb(),Error("Database closed");var t=Pe(),e=Re(4);Y(o),Y(e);try{this.db.handleError(d(this.db.db,this.kb,-1,o,e)),this.kb=X(e,"i32");var r=X(o,"i32");return 0===r?(this.mb(),{done:!0}):(this.Za=new n(r,this.db),this.db.fb[r]=this.Za,{value:this.Za,done:!1})}catch(t){throw this.pb=Q(this.kb),this.mb(),t}finally{Ie(t)}},r.prototype.mb=function(){Oe(this.eb),this.eb=null},r.prototype.getRemainingSQL=function(){return null!==this.pb?this.pb:Q(this.kb)},"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator&&(r.prototype[Symbol.iterator]=function(){return this}),i.prototype.run=function(t,e){if(!this.db)throw"Database closed";if(e){t=this.prepare(t,e);try{t.step()}finally{t.free()}}else this.handleError(l(this.db,t,0,0,o));return this},i.prototype.exec=function(t,e,r){if(!this.db)throw"Database closed";var i=Pe(),a=null;try{var s=ve(t),u=Re(4);for(t=[];0!==X(s,"i8");){Y(o),Y(u),this.handleError(d(this.db,s,-1,o,u));var c=X(o,"i32");if(s=X(u,"i32"),0!==c){var l=null;for(a=new n(c,this),null!=e&&a.bind(e);a.step();)null===l&&(l={columns:a.getColumnNames(),values:[]},t.push(l)),l.values.push(a.get(null,r));a.free()}}return t}catch(t){throw a&&a.free(),t}finally{Ie(i)}},i.prototype.each=function(t,e,n,r,i){"function"==typeof e&&(r=n,n=e,e=void 0),t=this.prepare(t,e);try{for(;t.step();)n(t.getAsObject(null,i))}finally{t.free()}if("function"==typeof r)return r()},i.prototype.prepare=function(t,e){if(Y(o),this.handleError(h(this.db,t,-1,o,0)),0===(t=X(o,"i32")))throw"Nothing to prepare";var r=new n(t,this);return null!=e&&r.bind(e),this.fb[t]=r},i.prototype.iterateStatements=function(t){return new r(t,this)},i.prototype.export=function(){Object.values(this.fb).forEach(function(t){t.free()}),Object.values(this.Sa).forEach(Ee),this.Sa={},this.handleError(c(this.db));var t=function(t){var e,n="binary";if("utf8"!==n&&"binary"!==n)throw Error(`Invalid encoding type "${n}"`);var r=$t(t,r||0);t=Bt(t).size;var i=new Uint8Array(t);return te(r,i,0,t,0),"utf8"===n?e=z(i):"binary"===n&&(e=i),Jt(r),e}(this.filename);return this.handleError(u(this.filename,o)),this.db=X(o,"i32"),tt(this.db),t},i.prototype.close=function(){null!==this.db&&(Object.values(this.fb).forEach(function(t){t.free()}),Object.values(this.Sa).forEach(Ee),this.Sa={},this.Ya&&(Ee(this.Ya),this.Ya=void 0),this.handleError(c(this.db)),Yt("/"+this.filename),this.db=null)},i.prototype.handleError=function(t){if(0===t)return null;throw t=S(this.db),Error(t)},i.prototype.getRowsModified=function(){return f(this.db)},i.prototype.create_function=function(n,r){Object.prototype.hasOwnProperty.call(this.Sa,n)&&(Ee(this.Sa[n]),delete this.Sa[n]);var i=_e(function(n,i,a){i=e(i,a);try{var o=r.apply(null,i)}catch(t){return void J(n,t,-1)}t(n,o)},"viii");return this.Sa[n]=i,this.handleError(M(this.db,n,r.length,1,0,i,0,0,0)),this},i.prototype.create_aggregate=function(n,r){var i=r.init||function(){return null},a=r.finalize||function(t){return t},o=r.step;if(!o)throw"An aggregate function must have a step function in "+n;var s={};Object.hasOwnProperty.call(this.Sa,n)&&(Ee(this.Sa[n]),delete this.Sa[n]),r=n+"__finalize",Object.hasOwnProperty.call(this.Sa,r)&&(Ee(this.Sa[r]),delete this.Sa[r]);var u=_e(function(t,n,r){var a=Z(t,1);Object.hasOwnProperty.call(s,a)||(s[a]=i()),n=e(n,r),n=[s[a]].concat(n);try{s[a]=o.apply(null,n)}catch(e){delete s[a],J(t,e,-1)}},"viii"),c=_e(function(e){var n=Z(e,1);try{var r=a(s[n])}catch(t){return delete s[n],void J(e,t,-1)}t(e,r),delete s[n]},"vi");return this.Sa[n]=u,this.Sa[r]=c,this.handleError(M(this.db,n,o.length-1,1,0,0,u,c,0)),this},i.prototype.updateHook=function(t){this.Ya&&(et(this.db,0,0),Ee(this.Ya),this.Ya=void 0),t&&(this.Ya=_e(function(e,n,r,i,a){switch(n){case 18:e="insert";break;case 23:e="update";break;case 9:e="delete";break;default:throw"unknown operationCode in updateHook callback: "+n}if(r=r?z(T,r):"",i=i?z(T,i):"",a>Number.MAX_SAFE_INTEGER)throw"rowId too big to fit inside a Number";t(e,r,i,Number(a))},"viiiij"),et(this.db,this.Ya,0))},a.Database=i};var f,h,p={...a},m="./this.program",d=(t,e)=>{throw e},b="";if(l){var v=n(490);n(234),b="//",h=t=>(t=L(t)?new URL(t):t,v.readFileSync(t)),f=async t=>(t=L(t)?new URL(t):t,v.readFileSync(t,void 0)),!a.thisProgram&&1<process.argv.length&&(m=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),t.exports=a,d=(t,e)=>{throw process.exitCode=t,e}}else(u||c)&&(c?b=self.location.href:"undefined"!=typeof document&&document.currentScript&&(b=document.currentScript.src),b=b.startsWith("blob:")?"":b.slice(0,b.replace(/[?#].*/,"").lastIndexOf("/")+1),c&&(h=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),f=async t=>{if(L(t))return new Promise((e,n)=>{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?e(r.response):n(r.status)},r.onerror=n,r.send(null)});var e=await fetch(t,{credentials:"same-origin"});if(e.ok)return e.arrayBuffer();throw Error(e.status+" : "+e.url)});var y=a.print||console.log.bind(console),g=a.printErr||console.error.bind(console);Object.assign(a,p),p=null,a.thisProgram&&(m=a.thisProgram);var w,E,_,T,S,k,O,A,N,I,R=a.wasmBinary,P=!1,L=t=>t.startsWith("file://");function D(){var t=w.buffer;a.HEAP8=_=new Int8Array(t),a.HEAP16=S=new Int16Array(t),a.HEAPU8=T=new Uint8Array(t),a.HEAPU16=new Uint16Array(t),a.HEAP32=k=new Int32Array(t),a.HEAPU32=O=new Uint32Array(t),a.HEAPF32=A=new Float32Array(t),a.HEAPF64=I=new Float64Array(t),a.HEAP64=N=new BigInt64Array(t),a.HEAPU64=new BigUint64Array(t)}var j,C=0,M=null;function F(t){throw a.onAbort?.(t),g(t="Aborted("+t+")"),P=!0,new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info.")}async function U(t,e){try{var n=await async function(t){if(!R)try{var e=await f(t);return new Uint8Array(e)}catch{}if(t==j&&R)t=new Uint8Array(R);else{if(!h)throw"both async and sync fetching of the wasm failed";t=h(t)}return t}(t);return await WebAssembly.instantiate(n,e)}catch(t){g(`failed to asynchronously prepare wasm: ${t}`),F(t)}}class G{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var q=t=>{for(;0<t.length;)t.shift()(a)},x=[],H=[],W=()=>{var t=a.preRun.shift();H.unshift(t)};function X(t,e="i8"){switch(e.endsWith("*")&&(e="*"),e){case"i1":case"i8":return _[t];case"i16":return S[t>>1];case"i32":return k[t>>2];case"i64":return N[t>>3];case"float":return A[t>>2];case"double":return I[t>>3];case"*":return O[t>>2];default:F(`invalid type for getValue: ${e}`)}}var V=a.noExitRuntime||!0;function Y(t){var e="i32";switch(e.endsWith("*")&&(e="*"),e){case"i1":case"i8":_[t]=0;break;case"i16":S[t>>1]=0;break;case"i32":k[t>>2]=0;break;case"i64":N[t>>3]=BigInt(0);break;case"float":A[t>>2]=0;break;case"double":I[t>>3]=0;break;case"*":O[t>>2]=0;break;default:F(`invalid type for setValue: ${e}`)}}var B="undefined"!=typeof TextDecoder?new TextDecoder:void 0,z=(t,e=0,n=NaN)=>{var r=e+n;for(n=e;t[n]&&!(n>=r);)++n;if(16<n-e&&t.buffer&&B)return B.decode(t.subarray(e,n));for(r="";e<n;){var i=t[e++];if(128&i){var a=63&t[e++];if(192==(224&i))r+=String.fromCharCode((31&i)<<6|a);else{var o=63&t[e++];65536>(i=224==(240&i)?(15&i)<<12|a<<6|o:(7&i)<<18|a<<12|o<<6|63&t[e++])?r+=String.fromCharCode(i):(i-=65536,r+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else r+=String.fromCharCode(i)}return r},Q=(t,e)=>t?z(T,t,e):"",K=(t,e)=>{for(var n=0,r=t.length-1;0<=r;r--){var i=t[r];"."===i?t.splice(r,1):".."===i?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n;n--)t.unshift("..");return t},$=t=>{var e="/"===t.charAt(0),n="/"===t.slice(-1);return(t=K(t.split("/").filter(t=>!!t),!e).join("/"))||e||(t="."),t&&n&&(t+="/"),(e?"/":"")+t},J=t=>{var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(t).slice(1);return t=e[0],e=e[1],t||e?(e&&=e.slice(0,-1),t+e):"."},Z=t=>t&&t.match(/([^\/]+|\/)\/*$/)[1],tt=t=>{(tt=(()=>{if(l){var t=n(920);return e=>t.randomFillSync(e)}return t=>crypto.getRandomValues(t)})())(t)},et=[],nt=t=>{for(var e=0,n=0;n<t.length;++n){var r=t.charCodeAt(n);127>=r?e++:2047>=r?e+=2:55296<=r&&57343>=r?(e+=4,++n):e+=3}return e},rt=(t,e,n,r)=>{if(!(0<r))return 0;var i=n;r=n+r-1;for(var a=0;a<t.length;++a){var o=t.charCodeAt(a);if(55296<=o&&57343>=o)o=65536+((1023&o)<<10)|1023&t.charCodeAt(++a);if(127>=o){if(n>=r)break;e[n++]=o}else{if(2047>=o){if(n+1>=r)break;e[n++]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;e[n++]=224|o>>12}else{if(n+3>=r)break;e[n++]=240|o>>18,e[n++]=128|o>>12&63}e[n++]=128|o>>6&63}e[n++]=128|63&o}}return e[n]=0,n-i},it=(t,e)=>{var n=Array(nt(t)+1);return t=rt(t,n,0,n.length),e&&(n.length=t),n},at=[];function ot(t,e){at[t]={input:[],output:[],cb:e},Gt(t,st)}var st={open(t){var e=at[t.node.rdev];if(!e)throw new wt(43);t.tty=e,t.seekable=!1},close(t){t.tty.cb.fsync(t.tty)},fsync(t){t.tty.cb.fsync(t.tty)},read(t,e,n,r){if(!t.tty||!t.tty.cb.xb)throw new wt(60);for(var i=0,a=0;a<r;a++){try{var o=t.tty.cb.xb(t.tty)}catch(t){throw new wt(29)}if(void 0===o&&0===i)throw new wt(6);if(null==o)break;i++,e[n+a]=o}return i&&(t.node.atime=Date.now()),i},write(t,e,n,r){if(!t.tty||!t.tty.cb.qb)throw new wt(60);try{for(var i=0;i<r;i++)t.tty.cb.qb(t.tty,e[n+i])}catch(t){throw new wt(29)}return r&&(t.node.mtime=t.node.ctime=Date.now()),i}},ut={xb(){t:{if(!et.length){var t=null;if(l){var e=Buffer.alloc(256),n=0,r=process.stdin.fd;try{n=v.readSync(r,e,0,256)}catch(t){if(!t.toString().includes("EOF"))throw t;n=0}0<n&&(t=e.slice(0,n).toString("utf-8"))}else"undefined"!=typeof window&&"function"==typeof window.prompt&&(null!==(t=window.prompt("Input: "))&&(t+="\n"));if(!t){t=null;break t}et=it(t,!0)}t=et.shift()}return t},qb(t,e){null===e||10===e?(y(z(t.output)),t.output=[]):0!=e&&t.output.push(e)},fsync(t){0<t.output?.length&&(y(z(t.output)),t.output=[])},Tb:()=>({Ob:25856,Qb:5,Nb:191,Pb:35387,Mb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}),Ub:()=>0,Vb:()=>[24,80]},ct={qb(t,e){null===e||10===e?(g(z(t.output)),t.output=[]):0!=e&&t.output.push(e)},fsync(t){0<t.output?.length&&(g(z(t.output)),t.output=[])}},lt={Wa:null,Xa:()=>lt.createNode(null,"/",16895,0),createNode(t,e,n,r){if(24576==(61440&n)||4096==(61440&n))throw new wt(63);return lt.Wa||(lt.Wa={dir:{node:{Ta:lt.La.Ta,Ua:lt.La.Ua,lookup:lt.La.lookup,hb:lt.La.hb,rename:lt.La.rename,unlink:lt.La.unlink,rmdir:lt.La.rmdir,readdir:lt.La.readdir,symlink:lt.La.symlink},stream:{Va:lt.Ma.Va}},file:{node:{Ta:lt.La.Ta,Ua:lt.La.Ua},stream:{Va:lt.Ma.Va,read:lt.Ma.read,write:lt.Ma.write,ib:lt.Ma.ib,jb:lt.Ma.jb}},link:{node:{Ta:lt.La.Ta,Ua:lt.La.Ua,readlink:lt.La.readlink},stream:{}},ub:{node:{Ta:lt.La.Ta,Ua:lt.La.Ua},stream:Ut}}),It((n=Nt(t,e,n,r)).mode)?(n.La=lt.Wa.dir.node,n.Ma=lt.Wa.dir.stream,n.Na={}):32768==(61440&n.mode)?(n.La=lt.Wa.file.node,n.Ma=lt.Wa.file.stream,n.Ra=0,n.Na=null):40960==(61440&n.mode)?(n.La=lt.Wa.link.node,n.Ma=lt.Wa.link.stream):8192==(61440&n.mode)&&(n.La=lt.Wa.ub.node,n.Ma=lt.Wa.ub.stream),n.atime=n.mtime=n.ctime=Date.now(),t&&(t.Na[e]=n,t.atime=t.mtime=t.ctime=n.atime),n},Sb:t=>t.Na?t.Na.subarray?t.Na.subarray(0,t.Ra):new Uint8Array(t.Na):new Uint8Array(0),La:{Ta(t){var e={};return e.dev=8192==(61440&t.mode)?t.id:1,e.ino=t.id,e.mode=t.mode,e.nlink=1,e.uid=0,e.gid=0,e.rdev=t.rdev,It(t.mode)?e.size=4096:32768==(61440&t.mode)?e.size=t.Ra:40960==(61440&t.mode)?e.size=t.link.length:e.size=0,e.atime=new Date(t.atime),e.mtime=new Date(t.mtime),e.ctime=new Date(t.ctime),e.blksize=4096,e.blocks=Math.ceil(e.size/e.blksize),e},Ua(t,e){for(var n of["mode","atime","mtime","ctime"])null!=e[n]&&(t[n]=e[n]);void 0!==e.size&&(e=e.size,t.Ra!=e&&(0==e?(t.Na=null,t.Ra=0):(n=t.Na,t.Na=new Uint8Array(e),n&&t.Na.set(n.subarray(0,Math.min(e,t.Ra))),t.Ra=e)))},lookup(){throw lt.vb},hb:(t,e,n,r)=>lt.createNode(t,e,n,r),rename(t,e,n){try{var r=At(e,n)}catch(t){}if(r){if(It(t.mode))for(var i in r.Na)throw new wt(55);Ot(r)}delete t.parent.Na[t.name],e.Na[n]=t,t.name=n,e.ctime=e.mtime=t.parent.ctime=t.parent.mtime=Date.now()},unlink(t,e){delete t.Na[e],t.ctime=t.mtime=Date.now()},rmdir(t,e){var n,r=At(t,e);for(n in r.Na)throw new wt(55);delete t.Na[e],t.ctime=t.mtime=Date.now()},readdir:t=>[".","..",...Object.keys(t.Na)],symlink:(t,e,n)=>((t=lt.createNode(t,e,41471,0)).link=n,t),readlink(t){if(40960!=(61440&t.mode))throw new wt(28);return t.link}},Ma:{read(t,e,n,r,i){var a=t.node.Na;if(i>=t.node.Ra)return 0;if(8<(t=Math.min(t.node.Ra-i,r))&&a.subarray)e.set(a.subarray(i,i+t),n);else for(r=0;r<t;r++)e[n+r]=a[i+r];return t},write(t,e,n,r,i,a){if(e.buffer===_.buffer&&(a=!1),!r)return 0;if((t=t.node).mtime=t.ctime=Date.now(),e.subarray&&(!t.Na||t.Na.subarray)){if(a)return t.Na=e.subarray(n,n+r),t.Ra=r;if(0===t.Ra&&0===i)return t.Na=e.slice(n,n+r),t.Ra=r;if(i+r<=t.Ra)return t.Na.set(e.subarray(n,n+r),i),r}a=i+r;var o=t.Na?t.Na.length:0;if(o>=a||(a=Math.max(a,o*(1048576>o?2:1.125)>>>0),0!=o&&(a=Math.max(a,256)),o=t.Na,t.Na=new Uint8Array(a),0<t.Ra&&t.Na.set(o.subarray(0,t.Ra),0)),t.Na.subarray&&e.subarray)t.Na.set(e.subarray(n,n+r),i);else for(a=0;a<r;a++)t.Na[i+a]=e[n+a];return t.Ra=Math.max(t.Ra,i+r),r},Va(t,e,n){if(1===n?e+=t.position:2===n&&32768==(61440&t.node.mode)&&(e+=t.node.Ra),0>e)throw new wt(28);return e},ib(t,e,n,r,i){if(32768!=(61440&t.node.mode))throw new wt(43);if(t=t.node.Na,2&i||!t||t.buffer!==_.buffer){i=!0,r=65536*Math.ceil(e/65536);var a=Ae(65536,r);if(a&&T.fill(0,a,a+r),!(r=a))throw new wt(48);t&&((0<n||n+e<t.length)&&(t=t.subarray?t.subarray(n,n+e):Array.prototype.slice.call(t,n,n+e)),_.set(t,r))}else i=!1,r=t.byteOffset;return{Kb:r,Ab:i}},jb:(t,e,n,r)=>(lt.Ma.write(t,e,0,r,n,!1),0)}},ft=(t,e)=>{var n=0;return t&&(n|=365),e&&(n|=146),n},ht=null,pt={},mt=[],dt=1,bt=null,vt=!1,yt=!0,gt={},wt=class{name="ErrnoError";constructor(t){this.Pa=t}},Et=class{gb={};node=null;get flags(){return this.gb.flags}set flags(t){this.gb.flags=t}get position(){return this.gb.position}set position(t){this.gb.position=t}},_t=class{La={};Ma={};ab=null;constructor(t,e,n,r){t||=this,this.parent=t,this.Xa=t.Xa,this.id=dt++,this.name=e,this.mode=n,this.rdev=r,this.atime=this.mtime=this.ctime=Date.now()}get read(){return!(365&~this.mode)}set read(t){t?this.mode|=365:this.mode&=-366}get write(){return!(146&~this.mode)}set write(t){t?this.mode|=146:this.mode&=-147}};function Tt(t,e={}){if(!t)throw new wt(44);e.nb??(e.nb=!0),"/"===t.charAt(0)||(t="//"+t);var n=0;t:for(;40>n;n++){t=t.split("/").filter(t=>!!t);for(var r=ht,i="/",a=0;a<t.length;a++){var o=a===t.length-1;if(o&&e.parent)break;if("."!==t[a])if(".."===t[a])i=J(i),r=r.parent;else{i=$(i+"/"+t[a]);try{r=At(r,t[a])}catch(t){if(44===t?.Pa&&o&&e.Jb)return{path:i};throw t}if(!r.ab||o&&!e.nb||(r=r.ab.root),40960==(61440&r.mode)&&(!o||e.$a)){if(!r.La.readlink)throw new wt(52);"/"===(r=r.La.readlink(r)).charAt(0)||(r=J(i)+"/"+r),t=r+"/"+t.slice(a+1).join("/");continue t}}}return{path:i,node:r}}throw new wt(32)}function St(t){for(var e;;){if(t===t.parent)return t=t.Xa.zb,e?"/"!==t[t.length-1]?`${t}/${e}`:t+e:t;e=e?`${t.name}/${e}`:t.name,t=t.parent}}function kt(t,e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r)|0;return(t+n>>>0)%bt.length}function Ot(t){var e=kt(t.parent.id,t.name);if(bt[e]===t)bt[e]=t.bb;else for(e=bt[e];e;){if(e.bb===t){e.bb=t.bb;break}e=e.bb}}function At(t,e){var n=It(t.mode)?(n=Pt(t,"x"))?n:t.La.lookup?0:2:54;if(n)throw new wt(n);for(n=bt[kt(t.id,e)];n;n=n.bb){var r=n.name;if(n.parent.id===t.id&&r===e)return n}return t.La.lookup(t,e)}function Nt(t,e,n,r){return e=kt((t=new _t(t,e,n,r)).parent.id,t.name),t.bb=bt[e],bt[e]=t}function It(t){return 16384==(61440&t)}function Rt(t){var e=["r","w","rw"][3&t];return 512&t&&(e+="w"),e}function Pt(t,e){return yt?0:!e.includes("r")||292&t.mode?e.includes("w")&&!(146&t.mode)||e.includes("x")&&!(73&t.mode)?2:0:2}function Lt(t,e){if(!It(t.mode))return 54;try{return At(t,e),20}catch(t){}return Pt(t,"wx")}function Dt(t,e,n){try{var r=At(t,e)}catch(t){return t.Pa}if(t=Pt(t,"wx"))return t;if(n){if(!It(r.mode))return 54;if(r===r.parent||"/"===St(r))return 10}else if(It(r.mode))return 31;return 0}function jt(t){if(!t)throw new wt(63);return t}function Ct(t){if(!(t=mt[t]))throw new wt(8);return t}function Mt(t,e=-1){if(t=Object.assign(new Et,t),-1==e)t:{for(e=0;4096>=e;e++)if(!mt[e])break t;throw new wt(33)}return t.fd=e,mt[e]=t}function Ft(t,e,n){var r=t?.Ma.Ua;t=r?t:e,r??=e.La.Ua,jt(r),r(t,n)}var Ut={open(t){t.Ma=pt[t.node.rdev].Ma,t.Ma.open?.(t)},Va(){throw new wt(70)}};function Gt(t,e){pt[t]={Ma:e}}function qt(t,e){var n="/"===e;if(n&&ht)throw new wt(10);if(!n&&e){var r=Tt(e,{nb:!1});if(e=r.path,(r=r.node).ab)throw new wt(10);if(!It(r.mode))throw new wt(54)}e={type:t,Wb:{},zb:e,Ib:[]},(t=t.Xa(e)).Xa=e,e.root=t,n?ht=t:r&&(r.ab=e,r.Xa&&r.Xa.Ib.push(e))}function xt(t,e,n){var r=Tt(t,{parent:!0}).node;if(!(t=Z(t)))throw new wt(28);if("."===t||".."===t)throw new wt(20);var i=Lt(r,t);if(i)throw new wt(i);if(!r.La.hb)throw new wt(63);return r.La.hb(r,t,e,n)}function Ht(t,e=511){return xt(t,1023&e|16384,0)}function Wt(t,e,n){void 0===n&&(n=e,e=438),xt(t,8192|e,n)}function Xt(t,e){if(!((...t)=>{for(var e="",n=!1,r=t.length-1;-1<=r&&!n;r--){if("string"!=typeof(n=0<=r?t[r]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,n="/"===n.charAt(0)}return(n?"/":"")+(e=K(e.split("/").filter(t=>!!t),!n).join("/"))||"."})(t))throw new wt(44);var n=Tt(e,{parent:!0}).node;if(!n)throw new wt(44);var r=Lt(n,e=Z(e));if(r)throw new wt(r);if(!n.La.symlink)throw new wt(63);n.La.symlink(n,e,t)}function Vt(t){var e=Tt(t,{parent:!0}).node,n=At(e,t=Z(t)),r=Dt(e,t,!0);if(r)throw new wt(r);if(!e.La.rmdir)throw new wt(63);if(n.ab)throw new wt(10);e.La.rmdir(e,t),Ot(n)}function Yt(t){var e=Tt(t,{parent:!0}).node;if(!e)throw new wt(44);var n=At(e,t=Z(t)),r=Dt(e,t,!1);if(r)throw new wt(r);if(!e.La.unlink)throw new wt(63);if(n.ab)throw new wt(10);e.La.unlink(e,t),Ot(n)}function Bt(t,e){return jt((t=Tt(t,{$a:!e}).node).La.Ta)(t)}function zt(t,e,n,r){Ft(t,e,{mode:4095&n|-4096&e.mode,ctime:Date.now(),Fb:r})}function Qt(t,e){zt(null,t="string"==typeof t?Tt(t,{$a:!0}).node:t,e)}function Kt(t,e,n){if(It(e.mode))throw new wt(31);if(32768!=(61440&e.mode))throw new wt(28);var r=Pt(e,"w");if(r)throw new wt(r);Ft(t,e,{size:n,timestamp:Date.now()})}function $t(t,e,n=438){if(""===t)throw new wt(44);if("string"==typeof e){var r={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[e];if(void 0===r)throw Error(`Unknown file open mode: ${e}`);e=r}if(n=64&e?4095&n|32768:0,"object"==typeof t)r=t;else{var i=t.endsWith("/");r=(t=Tt(t,{$a:!(131072&e),Jb:!0})).node,t=t.path}var o=!1;if(64&e)if(r){if(128&e)throw new wt(20)}else{if(i)throw new wt(31);r=xt(t,511|n,0),o=!0}if(!r)throw new wt(44);if(8192==(61440&r.mode)&&(e&=-513),65536&e&&!It(r.mode))throw new wt(54);if(!o&&(i=r?40960==(61440&r.mode)?32:It(r.mode)&&("r"!==Rt(e)||576&e)?31:Pt(r,Rt(e)):44))throw new wt(i);return 512&e&&!o&&Kt(null,i="string"==typeof(i=r)?Tt(i,{$a:!0}).node:i,0),e&=-131713,(i=Mt({node:r,path:St(r),flags:e,seekable:!0,position:0,Ma:r.Ma,Lb:[],error:!1})).Ma.open&&i.Ma.open(i),o&&Qt(r,511&n),!a.logReadFiles||1&e||t in gt||(gt[t]=1),i}function Jt(t){if(null===t.fd)throw new wt(8);t.ob&&(t.ob=null);try{t.Ma.close&&t.Ma.close(t)}catch(t){throw t}finally{mt[t.fd]=null}t.fd=null}function Zt(t,e,n){if(null===t.fd)throw new wt(8);if(!t.seekable||!t.Ma.Va)throw new wt(70);if(0!=n&&1!=n&&2!=n)throw new wt(28);t.position=t.Ma.Va(t,e,n),t.Lb=[]}function te(t,e,n,r,i){if(0>r||0>i)throw new wt(28);if(null===t.fd)throw new wt(8);if(1==(2097155&t.flags))throw new wt(8);if(It(t.node.mode))throw new wt(31);if(!t.Ma.read)throw new wt(28);var a=void 0!==i;if(a){if(!t.seekable)throw new wt(70)}else i=t.position;return e=t.Ma.read(t,e,n,r,i),a||(t.position+=e),e}function ee(t,e,n,r,i){if(0>r||0>i)throw new wt(28);if(null===t.fd)throw new wt(8);if(!(2097155&t.flags))throw new wt(8);if(It(t.node.mode))throw new wt(31);if(!t.Ma.write)throw new wt(28);t.seekable&&1024&t.flags&&Zt(t,0,2);var a=void 0!==i;if(a){if(!t.seekable)throw new wt(70)}else i=t.position;return e=t.Ma.write(t,e,n,r,i,void 0),a||(t.position+=e),e}function ne(t,e,n){t=$("/dev/"+t);var r=ft(!!e,!!n);ne.yb??(ne.yb=64);var i=ne.yb++<<8;Gt(i,{open(t){t.seekable=!1},close(){n?.buffer?.length&&n(10)},read(t,n,r,i){for(var a=0,o=0;o<i;o++){try{var s=e()}catch(t){throw new wt(29)}if(void 0===s&&0===a)throw new wt(6);if(null==s)break;a++,n[r+o]=s}return a&&(t.node.atime=Date.now()),a},write(t,e,r,i){for(var a=0;a<i;a++)try{n(e[r+a])}catch(t){throw new wt(29)}return i&&(t.node.mtime=t.node.ctime=Date.now()),a}}),Wt(t,r,i)}function re(t,e,n){if("/"===e.charAt(0))return e;if(t=-100===t?"/":Ct(t).path,0==e.length){if(!n)throw new wt(44);return t}return t+"/"+e}function ie(t,e){k[t>>2]=e.dev,k[t+4>>2]=e.mode,O[t+8>>2]=e.nlink,k[t+12>>2]=e.uid,k[t+16>>2]=e.gid,k[t+20>>2]=e.rdev,N[t+24>>3]=BigInt(e.size),k[t+32>>2]=4096,k[t+36>>2]=e.blocks;var n=e.atime.getTime(),r=e.mtime.getTime(),i=e.ctime.getTime();return N[t+40>>3]=BigInt(Math.floor(n/1e3)),O[t+48>>2]=n%1e3*1e6,N[t+56>>3]=BigInt(Math.floor(r/1e3)),O[t+64>>2]=r%1e3*1e6,N[t+72>>3]=BigInt(Math.floor(i/1e3)),O[t+80>>2]=i%1e3*1e6,N[t+88>>3]=BigInt(e.ino),0}var ae,oe,se,ue=void 0,ce=()=>{var t=k[+ue>>2];return ue+=4,t},le=0,fe=[0,31,60,91,121,152,182,213,244,274,305,335],he=[0,31,59,90,120,151,181,212,243,273,304,334],pe={},me=t=>{E=t,V||0<le||(a.onExit?.(t),P=!0),d(t,new G(t))},de={},be=()=>{if(!ae){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:m||"./this.program"};for(t in de)void 0===de[t]?delete e[t]:e[t]=de[t];var n=[];for(t in e)n.push(`${t}=${e[t]}`);ae=n}return ae},ve=t=>{var e=nt(t)+1,n=Re(e);return rt(t,T,n,e),n},ye=0,ge=(t,e)=>(e=1==e?Re(t.length):ke(t.length),t.subarray||t.slice||(t=new Uint8Array(t)),T.set(t,e),e),we=[],Ee=t=>{oe.delete(se.get(t)),se.set(t,null),we.push(t)},_e=(t,e)=>{if(!oe){oe=new WeakMap;var n=se.length;if(oe)for(var r=0;r<0+n;r++){var i=se.get(r);i&&oe.set(i,r)}}if(n=oe.get(t)||0)return n;if(we.length)n=we.pop();else{try{se.grow(1)}catch(t){if(!(t instanceof RangeError))throw t;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}n=se.length-1}try{se.set(n,t)}catch(u){if(!(u instanceof TypeError))throw u;if("function"==typeof WebAssembly.Function){var a=WebAssembly.Function;r={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},i={parameters:[],results:"v"==e[0]?[]:[r[e[0]]]};for(var o=1;o<e.length;++o)i.parameters.push(r[e[o]]);e=new a(i,t)}else{r=[1],i=e.slice(0,1),e=e.slice(1),o={i:127,p:127,j:126,f:125,d:124,e:111},r.push(96);var s=e.length;for(a of(128>s?r.push(s):r.push(s%128|128,s>>7),e))r.push(o[a]);"v"==i?r.push(0):r.push(1,o[i]),e=[0,97,115,109,1,0,0,0,1],128>(a=r.length)?e.push(a):e.push(a%128|128,a>>7),e.push(...r),e.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),e=new WebAssembly.Module(new Uint8Array(e)),e=new WebAssembly.Instance(e,{e:{f:t}}).exports.f}se.set(n,e)}return oe.set(t,n),n};bt=Array(4096),qt(lt,"/"),Ht("/tmp"),Ht("/home"),Ht("/home/web_user"),function(){Ht("/dev"),Gt(259,{read:()=>0,write:(t,e,n,r)=>r,Va:()=>0}),Wt("/dev/null",259),ot(1280,ut),ot(1536,ct),Wt("/dev/tty",1280),Wt("/dev/tty1",1536);var t=new Uint8Array(1024),e=0,n=()=>(0===e&&(tt(t),e=t.byteLength),t[--e]);ne("random",n),ne("urandom",n),Ht("/dev/shm"),Ht("/dev/shm/tmp")}(),function(){Ht("/proc");var t=Ht("/proc/self");Ht("/proc/self/fd"),qt({Xa(){var e=Nt(t,"fd",16895,73);return e.Ma={Va:lt.Ma.Va},e.La={lookup(t,e){var n=Ct(t=+e);return(t={parent:null,Xa:{zb:"fake"},La:{readlink:()=>n.path},id:t+1}).parent=t},readdir:()=>Array.from(mt.entries()).filter(([,t])=>t).map(([t])=>t.toString())},e}},"/proc/self/fd")}(),lt.vb=new wt(44),lt.vb.stack="<generic error, no stack>";var Te,Se={a:(t,e,n,r)=>F(`Assertion failed: ${t?z(T,t):""}, at: `+[e?e?z(T,e):"":"unknown filename",n,r?r?z(T,r):"":"unknown function"]),i:function(t,e){try{return Qt(t=t?z(T,t):"",e),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},L:function(t,e,n){try{if(e=re(t,e=e?z(T,e):""),-8&n)return-28;var r=Tt(e,{$a:!0}).node;return r?(t="",4&n&&(t+="r"),2&n&&(t+="w"),1&n&&(t+="x"),t&&Pt(r,t)?-2:0):-44}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},j:function(t,e){try{var n=Ct(t);return zt(n,n.node,e,!1),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},h:function(t){try{var e=Ct(t);return Ft(e,e.node,{timestamp:Date.now(),Fb:!1}),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},b:function(t,e,n){ue=n;try{var r=Ct(t);switch(e){case 0:var i=ce();if(0>i)break;for(;mt[i];)i++;return function(t,e=-1){return t=Mt(t,e),t.Ma?.Rb?.(t),t}(r,i).fd;case 1:case 2:case 13:case 14:return 0;case 3:return r.flags;case 4:return i=ce(),r.flags|=i,0;case 12:return i=ce(),S[i+0>>1]=2,0}return-28}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},g:function(t,e){try{var n=Ct(t),r=n.node,i=n.Ma.Ta;return t=i?n:r,i??=r.La.Ta,jt(i),ie(e,i(t))}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},H:function(t,e){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e);try{if(isNaN(e))return 61;var n=Ct(t);if(0>e||!(2097155&n.flags))throw new wt(28);return Kt(n,n.node,e),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},G:function(t,e){try{if(0===e)return-28;var n=nt("/")+1;return e<n?-68:(rt("/",T,t,e),n)}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},K:function(t,e){try{return ie(e,Bt(t=t?z(T,t):"",!0))}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},C:function(t,e,n){try{return Ht(e=re(t,e=e?z(T,e):""),n),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},J:function(t,e,n,r){try{e=e?z(T,e):"";var i=256&r;return e=re(t,e,4096&r),ie(n,i?Bt(e,!0):Bt(e))}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},x:function(t,e,n,r){ue=r;try{return $t(e=re(t,e=e?z(T,e):""),n,r?ce():0).fd}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},v:function(t,e,n,r){try{if(e=re(t,e=e?z(T,e):""),0>=r)return-28;var i=Tt(e).node;if(!i)throw new wt(44);if(!i.La.readlink)throw new wt(28);var a=i.La.readlink(i),o=Math.min(r,nt(a)),s=_[n+o];return rt(a,T,n,r+1),_[n+o]=s,o}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},u:function(t){try{return Vt(t=t?z(T,t):""),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},f:function(t,e){try{return ie(e,Bt(t=t?z(T,t):""))}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},r:function(t,e,n){try{return e=re(t,e=e?z(T,e):""),0===n?Yt(e):512===n?Vt(e):F("Invalid flags passed to unlinkat"),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},q:function(t,e,n){try{e=re(t,e=e?z(T,e):"",!0);var r,i,a=Date.now();if(n){var o=O[n>>2]+4294967296*k[n+4>>2],s=k[n+8>>2];r=1073741823==s?a:1073741822==s?null:1e3*o+s/1e6,o=O[(n+=16)>>2]+4294967296*k[n+4>>2],i=1073741823==(s=k[n+8>>2])?a:1073741822==s?null:1e3*o+s/1e6}else i=r=a;if(null!==(i??r)){t=r;var u=Tt(e,{$a:!0}).node;jt(u.La.Ua)(u,{atime:t,mtime:i})}return 0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},m:()=>F(""),l:()=>{V=!1,le=0},A:function(t,e){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t),t=new Date(1e3*t),k[e>>2]=t.getSeconds(),k[e+4>>2]=t.getMinutes(),k[e+8>>2]=t.getHours(),k[e+12>>2]=t.getDate(),k[e+16>>2]=t.getMonth(),k[e+20>>2]=t.getFullYear()-1900,k[e+24>>2]=t.getDay();var n=t.getFullYear();k[e+28>>2]=(0!=n%4||0==n%100&&0!=n%400?he:fe)[t.getMonth()]+t.getDate()-1|0,k[e+36>>2]=-60*t.getTimezoneOffset(),n=new Date(t.getFullYear(),6,1).getTimezoneOffset();var r=new Date(t.getFullYear(),0,1).getTimezoneOffset();k[e+32>>2]=0|(n!=r&&t.getTimezoneOffset()==Math.min(r,n))},y:function(t,e,n,r,i,a,o){i=-9007199254740992>i||9007199254740992<i?NaN:Number(i);try{if(isNaN(i))return 61;var s=Ct(r);if(2&e&&!(2&n)&&2!=(2097155&s.flags))throw new wt(2);if(1==(2097155&s.flags))throw new wt(2);if(!s.Ma.ib)throw new wt(43);if(!t)throw new wt(28);var u=s.Ma.ib(s,t,i,e,n),c=u.Kb;return k[a>>2]=u.Ab,O[o>>2]=c,0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},z:function(t,e,n,r,i,a){a=-9007199254740992>a||9007199254740992<a?NaN:Number(a);try{var o=Ct(i);if(2&n){if(n=a,32768!=(61440&o.node.mode))throw new wt(43);if(!(2&r)){var s=T.slice(t,t+e);o.Ma.jb&&o.Ma.jb(o,s,n,e,r)}}}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},n:(t,e)=>{if(pe[t]&&(clearTimeout(pe[t].id),delete pe[t]),!e)return 0;var n=setTimeout(()=>{delete pe[t],(t=>{if(!P)try{if(t(),!(V||0<le))try{E=t=E,me(t)}catch(t){t instanceof G||"unwind"==t||d(1,t)}}catch(t){t instanceof G||"unwind"==t||d(1,t)}})(()=>Ne(t,performance.now()))},e);return pe[t]={id:n,Xb:e},0},B:(t,e,n,r)=>{var i=(new Date).getFullYear(),a=new Date(i,0,1).getTimezoneOffset();i=new Date(i,6,1).getTimezoneOffset(),O[t>>2]=60*Math.max(a,i),k[e>>2]=Number(a!=i),t=(e=t=>{var e=Math.abs(t);return`UTC${0<=t?"-":"+"}${String(Math.floor(e/60)).padStart(2,"0")}${String(e%60).padStart(2,"0")}`})(a),e=e(i),i<a?(rt(t,T,n,17),rt(e,T,r,17)):(rt(t,T,r,17),rt(e,T,n,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:t=>{var e=T.length;if(2147483648<(t>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=e*(1+.2/n);r=Math.min(r,t+100663296);t:{r=(Math.min(2147483648,65536*Math.ceil(Math.max(t,r)/65536))-w.buffer.byteLength+65535)/65536|0;try{w.grow(r),D();var i=1;break t}catch(t){}i=void 0}if(i)return!0}return!1},E:(t,e)=>{var n=0;return be().forEach((r,i)=>{var a=e+n;for(i=O[t+4*i>>2]=a,a=0;a<r.length;++a)_[i++]=r.charCodeAt(a);_[i]=0,n+=r.length+1}),0},F:(t,e)=>{var n=be();O[t>>2]=n.length;var r=0;return n.forEach(t=>r+=t.length+1),O[e>>2]=r,0},e:function(t){try{return Jt(Ct(t)),0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},p:function(t,e){try{var n=Ct(t);return _[e]=n.tty?2:It(n.mode)?3:40960==(61440&n.mode)?7:4,S[e+2>>1]=0,N[e+8>>3]=BigInt(0),N[e+16>>3]=BigInt(0),0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},w:function(t,e,n,r){try{t:{var i=Ct(t);t=e;for(var a,o=e=0;o<n;o++){var s=O[t>>2],u=O[t+4>>2];t+=8;var c=te(i,_,s,u,a);if(0>c){var l=-1;break t}if(e+=c,c<u)break;void 0!==a&&(a+=c)}l=e}return O[r>>2]=l,0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},D:function(t,e,n,r){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e);try{if(isNaN(e))return 61;var i=Ct(t);return Zt(i,e,n),N[r>>3]=BigInt(i.position),i.ob&&0===e&&0===n&&(i.ob=null),0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},I:function(t){try{var e=Ct(t);return e.Ma?.fsync?e.Ma.fsync(e):0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},t:function(t,e,n,r){try{t:{var i=Ct(t);t=e;for(var a,o=e=0;o<n;o++){var s=O[t>>2],u=O[t+4>>2];t+=8;var c=ee(i,_,s,u,a);if(0>c){var l=-1;break t}if(e+=c,c<u)break;void 0!==a&&(a+=c)}l=e}return O[r>>2]=l,0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},k:me};!async function(){function t(t){return Te=t.exports,w=Te.M,D(),se=Te.O,C--,a.monitorRunDependencies?.(C),0==C&&M&&(t=M,M=null,t()),Te}C++,a.monitorRunDependencies?.(C);var e={a:Se};a.instantiateWasm?new Promise(n=>{a.instantiateWasm(e,(e,r)=>{t(e),n(e.exports)})}):(j??=a.locateFile?a.locateFile("sql-wasm.wasm",b):b+"sql-wasm.wasm",t((await async function(t){var e=j;if(!R&&"function"==typeof WebAssembly.instantiateStreaming&&!L(e)&&!l)try{var n=fetch(e,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(n,t)}catch(t){g(`wasm streaming compile failed: ${t}`),g("falling back to ArrayBuffer instantiation")}return U(e,t)}(e)).instance))}(),a._sqlite3_free=t=>(a._sqlite3_free=Te.P)(t),a._sqlite3_value_text=t=>(a._sqlite3_value_text=Te.Q)(t),a._sqlite3_prepare_v2=(t,e,n,r,i)=>(a._sqlite3_prepare_v2=Te.R)(t,e,n,r,i),a._sqlite3_step=t=>(a._sqlite3_step=Te.S)(t),a._sqlite3_reset=t=>(a._sqlite3_reset=Te.T)(t),a._sqlite3_exec=(t,e,n,r,i)=>(a._sqlite3_exec=Te.U)(t,e,n,r,i),a._sqlite3_finalize=t=>(a._sqlite3_finalize=Te.V)(t),a._sqlite3_column_name=(t,e)=>(a._sqlite3_column_name=Te.W)(t,e),a._sqlite3_column_text=(t,e)=>(a._sqlite3_column_text=Te.X)(t,e),a._sqlite3_column_type=(t,e)=>(a._sqlite3_column_type=Te.Y)(t,e),a._sqlite3_errmsg=t=>(a._sqlite3_errmsg=Te.Z)(t),a._sqlite3_clear_bindings=t=>(a._sqlite3_clear_bindings=Te._)(t),a._sqlite3_value_blob=t=>(a._sqlite3_value_blob=Te.$)(t),a._sqlite3_value_bytes=t=>(a._sqlite3_value_bytes=Te.aa)(t),a._sqlite3_value_double=t=>(a._sqlite3_value_double=Te.ba)(t),a._sqlite3_value_int=t=>(a._sqlite3_value_int=Te.ca)(t),a._sqlite3_value_type=t=>(a._sqlite3_value_type=Te.da)(t),a._sqlite3_result_blob=(t,e,n,r)=>(a._sqlite3_result_blob=Te.ea)(t,e,n,r),a._sqlite3_result_double=(t,e)=>(a._sqlite3_result_double=Te.fa)(t,e),a._sqlite3_result_error=(t,e,n)=>(a._sqlite3_result_error=Te.ga)(t,e,n),a._sqlite3_result_int=(t,e)=>(a._sqlite3_result_int=Te.ha)(t,e),a._sqlite3_result_int64=(t,e)=>(a._sqlite3_result_int64=Te.ia)(t,e),a._sqlite3_result_null=t=>(a._sqlite3_result_null=Te.ja)(t),a._sqlite3_result_text=(t,e,n,r)=>(a._sqlite3_result_text=Te.ka)(t,e,n,r),a._sqlite3_aggregate_context=(t,e)=>(a._sqlite3_aggregate_context=Te.la)(t,e),a._sqlite3_column_count=t=>(a._sqlite3_column_count=Te.ma)(t),a._sqlite3_data_count=t=>(a._sqlite3_data_count=Te.na)(t),a._sqlite3_column_blob=(t,e)=>(a._sqlite3_column_blob=Te.oa)(t,e),a._sqlite3_column_bytes=(t,e)=>(a._sqlite3_column_bytes=Te.pa)(t,e),a._sqlite3_column_double=(t,e)=>(a._sqlite3_column_double=Te.qa)(t,e),a._sqlite3_bind_blob=(t,e,n,r,i)=>(a._sqlite3_bind_blob=Te.ra)(t,e,n,r,i),a._sqlite3_bind_double=(t,e,n)=>(a._sqlite3_bind_double=Te.sa)(t,e,n),a._sqlite3_bind_int=(t,e,n)=>(a._sqlite3_bind_int=Te.ta)(t,e,n),a._sqlite3_bind_text=(t,e,n,r,i)=>(a._sqlite3_bind_text=Te.ua)(t,e,n,r,i),a._sqlite3_bind_parameter_index=(t,e)=>(a._sqlite3_bind_parameter_index=Te.va)(t,e),a._sqlite3_sql=t=>(a._sqlite3_sql=Te.wa)(t),a._sqlite3_normalized_sql=t=>(a._sqlite3_normalized_sql=Te.xa)(t),a._sqlite3_changes=t=>(a._sqlite3_changes=Te.ya)(t),a._sqlite3_close_v2=t=>(a._sqlite3_close_v2=Te.za)(t),a._sqlite3_create_function_v2=(t,e,n,r,i,o,s,u,c)=>(a._sqlite3_create_function_v2=Te.Aa)(t,e,n,r,i,o,s,u,c),a._sqlite3_update_hook=(t,e,n)=>(a._sqlite3_update_hook=Te.Ba)(t,e,n),a._sqlite3_open=(t,e)=>(a._sqlite3_open=Te.Ca)(t,e);var ke=a._malloc=t=>(ke=a._malloc=Te.Da)(t),Oe=a._free=t=>(Oe=a._free=Te.Ea)(t);a._RegisterExtensionFunctions=t=>(a._RegisterExtensionFunctions=Te.Fa)(t);var Ae=(t,e)=>(Ae=Te.Ga)(t,e),Ne=(t,e)=>(Ne=Te.Ha)(t,e),Ie=t=>(Ie=Te.Ia)(t),Re=t=>(Re=Te.Ja)(t),Pe=()=>(Pe=Te.Ka)();if(a.stackSave=()=>Pe(),a.stackRestore=t=>Ie(t),a.stackAlloc=t=>Re(t),a.cwrap=(t,e,n,r)=>{var i=!n||n.every(t=>"number"===t||"boolean"===t);return"string"!==e&&i&&!r?a["_"+t]:(...r)=>((t,e,n,r)=>{var i={string:t=>{var e=0;return null!=t&&0!==t&&(e=ve(t)),e},array:t=>{var e=Re(t.length);return _.set(t,e),e}};t=a["_"+t];var o,s=[],u=0;if(r)for(var c=0;c<r.length;c++){var l=i[n[c]];l?(0===u&&(u=Pe()),s[c]=l(r[c])):s[c]=r[c]}return n=t(...s),o=n,0!==u&&Ie(u),"string"===e?o?z(T,o):"":"boolean"===e?!!o:o})(t,e,n,r)},a.addFunction=_e,a.removeFunction=Ee,a.UTF8ToString=Q,a.ALLOC_NORMAL=ye,a.allocate=ge,a.allocateUTF8OnStack=ve,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();return function t(){function e(){if(a.calledRun=!0,!P){var t,e;if(!a.noFSInit&&!vt)vt=!0,n??=a.stdin,t??=a.stdout,e??=a.stderr,n?ne("stdin",n):Xt("/dev/tty","/dev/stdin"),t?ne("stdout",null,t):Xt("/dev/tty","/dev/stdout"),e?ne("stderr",null,e):Xt("/dev/tty1","/dev/stderr"),$t("/dev/stdin",0),$t("/dev/stdout",1),$t("/dev/stderr",1);if(Te.N(),yt=!1,a.onRuntimeInitialized?.(),a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;){var n=a.postRun.shift();x.unshift(n)}q(x)}}if(0<C)M=t;else{if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)W();q(H),0<C?M=t:a.setStatus?(a.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>a.setStatus(""),1),e()},1)):e()}}(),o}))};t.exports=i,t.exports.default=i},920:()=>{}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var a=e[r]={id:r,loaded:!1,exports:{}};return t[r](a,a.exports,n),a.loaded=!0,a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{"use strict";var t=n(826),e=n.n(t);function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||u(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(t,e)||u(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function s(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=u(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function u(t,e){if(t){if("string"==typeof t)return c(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function l(t,e,n){return(e=b(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function f(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return h(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return a=e,s=0,u=t,h.n=n,o}};function p(n,r){for(s=n,u=r,e=0;!f&&c&&!i&&e<l.length;e++){var i,a=l[e],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=t):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(e=s<2?t:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),e=a[i]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,s<2&&(s=0)}else 1===s&&(e=a.return)&&e.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=t}else if((e=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(e){a=t,s=1,u=e}finally{c=1}}return{value:e,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(h(e={},r,function(){return this}),e),p=c.prototype=s.prototype=Object.create(l);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,h(t,i,"GeneratorFunction")),t.prototype=Object.create(p),t}return u.prototype=c,h(p,"constructor",c),h(c,"constructor",u),u.displayName="GeneratorFunction",h(c,i,"GeneratorFunction"),h(p),h(p,i,"Generator"),h(p,r,function(){return this}),h(p,"toString",function(){return"[object Generator]"}),(f=function(){return{w:a,m}})()}function h(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}h=function(t,e,n,r){function a(e,n){h(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},h(t,e,n,r)}function p(t,e,n,r,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function m(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(t){p(a,r,i,o,s,"next",t)}function s(t){p(a,r,i,o,s,"throw",t)}o(void 0)})}}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,b(r.key),r)}}function b(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==r(e)?e:e+""}var v=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.db=null,this.SQL=null,this.dbName="echolens.db",this.isInitialized=!1},n=[{key:"init",value:(U=m(f().m(function t(){var n,r,i;return f().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.isInitialized){t.n=1;break}return t.a(2);case 1:return t.p=1,t.n=2,e()({locateFile:function(t){return chrome.runtime.getURL(t)}});case 2:return this.SQL=t.v,t.n=3,chrome.storage.local.get([this.dbName]);case 3:if(!(n=t.v)[this.dbName]){t.n=4;break}r=new Uint8Array(n[this.dbName]),this.db=new this.SQL.Database(r),console.log("✅ Loaded existing database"),t.n=6;break;case 4:return this.db=new this.SQL.Database,t.n=5,this.createTables();case 5:console.log("✅ Created new database");case 6:this.isInitialized=!0,t.n=8;break;case 7:throw t.p=7,i=t.v,console.error("❌ Database initialization error:",i),i;case 8:return t.a(2)}},t,this,[[1,7]])})),function(){return U.apply(this,arguments)})},{key:"createTables",value:(F=m(f().m(function t(){return f().w(function(t){for(;;)switch(t.n){case 0:return this.db.run("\n      -- Visits table\n      CREATE TABLE IF NOT EXISTS visits (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        url TEXT NOT NULL UNIQUE,\n        url_hash TEXT NOT NULL,\n        title TEXT,\n        first_visit INTEGER NOT NULL,\n        last_visit INTEGER NOT NULL,\n        visit_count INTEGER DEFAULT 0,\n        total_time_spent INTEGER DEFAULT 0,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Sessions table\n      CREATE TABLE IF NOT EXISTS sessions (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        visit_id INTEGER NOT NULL,\n        timestamp INTEGER NOT NULL,\n        time_spent INTEGER DEFAULT 0,\n        scroll_depth REAL DEFAULT 0,\n        interactions INTEGER DEFAULT 0,\n        highlight_count INTEGER DEFAULT 0,\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE\n      );\n\n      -- Highlights table\n      CREATE TABLE IF NOT EXISTS highlights (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        visit_id INTEGER NOT NULL,\n        text TEXT NOT NULL,\n        timestamp INTEGER NOT NULL,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE\n      );\n\n      -- AI Insights table\n      CREATE TABLE IF NOT EXISTS insights (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        visit_id INTEGER NOT NULL UNIQUE,\n        summary TEXT,\n        topics TEXT,\n        timestamp INTEGER NOT NULL,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE\n      );\n\n      -- Tags table\n      CREATE TABLE IF NOT EXISTS tags (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT NOT NULL UNIQUE\n      );\n\n      -- Visit Tags junction table\n      CREATE TABLE IF NOT EXISTS visit_tags (\n        visit_id INTEGER NOT NULL,\n        tag_id INTEGER NOT NULL,\n        PRIMARY KEY (visit_id, tag_id),\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE,\n        FOREIGN KEY (tag_id) REFERENCES tags (id) ON DELETE CASCADE\n      );\n\n      -- Personality Snapshots table (for PersonaSync)\n      CREATE TABLE IF NOT EXISTS personality_snapshots (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        week_start INTEGER NOT NULL,\n        week_end INTEGER NOT NULL,\n        tone TEXT,\n        top_topics TEXT,\n        reading_habits TEXT,\n        emotional_themes TEXT,\n        summary TEXT,\n        total_time_spent INTEGER DEFAULT 0,\n        total_visits INTEGER DEFAULT 0,\n        total_highlights INTEGER DEFAULT 0,\n        dominant_interests TEXT,\n        quote_of_week TEXT,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Interest Evolution table\n      CREATE TABLE IF NOT EXISTS interest_evolution (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        topic TEXT NOT NULL,\n        period TEXT NOT NULL,\n        count INTEGER DEFAULT 0,\n        total_time INTEGER DEFAULT 0,\n        trend_score REAL DEFAULT 0,\n        status TEXT,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Mood Tracking table\n      CREATE TABLE IF NOT EXISTS mood_tracking (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        timestamp INTEGER NOT NULL,\n        sentiment TEXT,\n        sentiment_score REAL DEFAULT 0,\n        emotions TEXT,\n        tone TEXT,\n        url TEXT,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Goals table\n      CREATE TABLE IF NOT EXISTS goals (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        title TEXT NOT NULL,\n        description TEXT,\n        keywords TEXT,\n        priority TEXT DEFAULT 'medium',\n        target_hours REAL DEFAULT 0,\n        actual_hours REAL DEFAULT 0,\n        is_active INTEGER DEFAULT 1,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),\n        last_nudge INTEGER,\n        nudge_count INTEGER DEFAULT 0\n      );\n\n      -- Indexes for better performance\n      CREATE INDEX IF NOT EXISTS idx_visits_url_hash ON visits(url_hash);\n      CREATE INDEX IF NOT EXISTS idx_visits_last_visit ON visits(last_visit);\n      CREATE INDEX IF NOT EXISTS idx_sessions_visit_id ON sessions(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_highlights_visit_id ON highlights(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_insights_visit_id ON insights(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_visit_tags_visit_id ON visit_tags(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_visit_tags_tag_id ON visit_tags(tag_id);\n      CREATE INDEX IF NOT EXISTS idx_personality_snapshots_week ON personality_snapshots(week_start);\n      CREATE INDEX IF NOT EXISTS idx_interest_evolution_period ON interest_evolution(period);\n      CREATE INDEX IF NOT EXISTS idx_mood_tracking_timestamp ON mood_tracking(timestamp);\n    "),t.n=1,this.saveDatabase();case 1:return t.a(2)}},t,this)})),function(){return F.apply(this,arguments)})},{key:"saveDatabase",value:(M=m(f().m(function t(){var e,n;return f().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.db){t.n=1;break}return t.a(2);case 1:return t.p=1,e=this.db.export(),t.n=2,chrome.storage.local.set(l({},this.dbName,Array.from(e)));case 2:t.n=4;break;case 3:t.p=3,n=t.v,console.error("❌ Error saving database:",n);case 4:return t.a(2)}},t,this,[[1,3]])})),function(){return M.apply(this,arguments)})},{key:"hashURL",value:function(t){return t.replace(/[^a-zA-Z0-9]/g,"_").substring(0,100)}},{key:"getOrCreateVisit",value:(C=m(f().m(function t(e,n){var r,i,a,o,s;return f().w(function(t){for(;;)if(0===t.n)return r=this.hashURL(e),(i=this.db.prepare("SELECT * FROM visits WHERE url_hash = ?")).bind([r]),a=null,i.step()&&(a=i.getAsObject()),i.free(),a||(o=Date.now(),this.db.run("INSERT INTO visits (url, url_hash, title, first_visit, last_visit, visit_count) VALUES (?, ?, ?, ?, ?, ?)",[e,r,n,o,o,0]),(s=this.db.prepare("SELECT * FROM visits WHERE url_hash = ?")).bind([r]),s.step()&&(a=s.getAsObject()),s.free()),t.a(2,a)},t,this)})),function(t,e){return C.apply(this,arguments)})},{key:"updateVisit",value:(j=m(f().m(function t(e){var n,r,i,a,o,s,u,c;return f().w(function(t){for(;;)switch(t.n){case 0:return n=e.url,r=e.title,i=e.timeSpent,a=e.scrollDepth,o=e.interactions,s=e.highlights,t.n=1,this.getOrCreateVisit(n,r);case 1:return u=t.v,c=Date.now(),this.db.run("UPDATE visits \n       SET last_visit = ?, \n           visit_count = visit_count + 1, \n           total_time_spent = total_time_spent + ?,\n           title = ?\n       WHERE id = ?",[c,i||0,r,u.id]),this.db.run("INSERT INTO sessions (visit_id, timestamp, time_spent, scroll_depth, interactions, highlight_count)\n       VALUES (?, ?, ?, ?, ?, ?)",[u.id,c,i||0,a||0,o||0,(null==s?void 0:s.length)||0]),this.db.run("DELETE FROM sessions \n       WHERE visit_id = ? \n       AND id NOT IN (\n         SELECT id FROM sessions \n         WHERE visit_id = ? \n         ORDER BY timestamp DESC \n         LIMIT 50\n       )",[u.id,u.id]),t.n=2,this.saveDatabase();case 2:return t.a(2,u)}},t,this)})),function(t){return j.apply(this,arguments)})},{key:"getVisitHistory",value:(D=m(f().m(function t(e){var n,r,i,a,o;return f().w(function(t){for(;;)switch(t.n){case 0:if(n=this.hashURL(e),(r=this.db.prepare("\n      SELECT v.*, \n             (SELECT COUNT(*) FROM sessions WHERE visit_id = v.id) as session_count\n      FROM visits v\n      WHERE v.url_hash = ?\n    ")).bind([n]),i=null,r.step()&&(i=r.getAsObject()),r.free(),i){t.n=1;break}return t.a(2,null);case 1:for((a=this.db.prepare("\n      SELECT * FROM sessions \n      WHERE visit_id = ? \n      ORDER BY timestamp DESC \n      LIMIT 50\n    ")).bind([i.id]),o=[];a.step();)o.push(a.getAsObject());return a.free(),i.sessions=o,t.a(2,i)}},t,this)})),function(t){return D.apply(this,arguments)})},{key:"saveHighlight",value:(L=m(f().m(function t(e){var n,r,i,a,o;return f().w(function(t){for(;;)switch(t.n){case 0:return n=e.text,r=e.url,i=e.title,a=e.timestamp,t.n=1,this.getOrCreateVisit(r,i);case 1:return o=t.v,this.db.run("INSERT INTO highlights (visit_id, text, timestamp) VALUES (?, ?, ?)",[o.id,n,a||Date.now()]),this.db.run("DELETE FROM highlights \n       WHERE visit_id = ? \n       AND id NOT IN (\n         SELECT id FROM highlights \n         WHERE visit_id = ? \n         ORDER BY timestamp DESC \n         LIMIT 100\n       )",[o.id,o.id]),t.n=2,this.saveDatabase();case 2:return t.a(2)}},t,this)})),function(t){return L.apply(this,arguments)})},{key:"getHighlights",value:(P=m(f().m(function t(e){var n,r,i;return f().w(function(t){for(;;)if(0===t.n){for(n=this.hashURL(e),(r=this.db.prepare("\n      SELECT h.* \n      FROM highlights h\n      JOIN visits v ON h.visit_id = v.id\n      WHERE v.url_hash = ?\n      ORDER BY h.timestamp DESC\n      LIMIT 100\n    ")).bind([n]),i=[];r.step();)i.push(r.getAsObject());return r.free(),t.a(2,i)}},t,this)})),function(t){return P.apply(this,arguments)})},{key:"saveAIInsights",value:(R=m(f().m(function t(e,n){var r,i,a,o,u,c;return f().w(function(t){for(;;)switch(t.p=t.n){case 0:return this.hashURL(e),t.n=1,this.getOrCreateVisit(e,"");case 1:if(r=t.v,JSON.stringify(n.tags||[]),i=JSON.stringify(n.topics||[]),this.db.run("INSERT INTO insights (visit_id, summary, topics, timestamp)\n       VALUES (?, ?, ?, ?)\n       ON CONFLICT(visit_id) DO UPDATE SET\n         summary = excluded.summary,\n         topics = excluded.topics,\n         timestamp = excluded.timestamp",[r.id,n.summary||"",i,n.timestamp||Date.now()]),!(n.tags&&n.tags.length>0)){t.n=8;break}a=s(n.tags),t.p=2,a.s();case 3:if((o=a.n()).done){t.n=5;break}return u=o.value,t.n=4,this.addTag(e,u);case 4:t.n=3;break;case 5:t.n=7;break;case 6:t.p=6,c=t.v,a.e(c);case 7:return t.p=7,a.f(),t.f(7);case 8:return t.n=9,this.saveDatabase();case 9:return t.a(2)}},t,this,[[2,6,7,8]])})),function(t,e){return R.apply(this,arguments)})},{key:"getAIInsights",value:(I=m(f().m(function t(e){var n,r,i;return f().w(function(t){for(;;)switch(t.n){case 0:if(n=this.hashURL(e),(r=this.db.prepare("\n      SELECT i.* \n      FROM insights i\n      JOIN visits v ON i.visit_id = v.id\n      WHERE v.url_hash = ?\n    ")).bind([n]),i=null,r.step()&&(i=r.getAsObject()).topics&&(i.topics=JSON.parse(i.topics)),r.free(),!i){t.n=2;break}return t.n=1,this.getTags(e);case 1:i.tags=t.v;case 2:return t.a(2,i)}},t,this)})),function(t){return I.apply(this,arguments)})},{key:"addTag",value:(N=m(f().m(function t(e,n){var r,i,a,o;return f().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.getOrCreateVisit(e,"");case 1:r=t.v,i=null,(a=this.db.prepare("SELECT id FROM tags WHERE name = ?")).bind([n]),a.step()&&(i=a.getAsObject().id),a.free(),i||(this.db.run("INSERT INTO tags (name) VALUES (?)",[n]),(o=this.db.prepare("SELECT id FROM tags WHERE name = ?")).bind([n]),o.step()&&(i=o.getAsObject().id),o.free());try{this.db.run("INSERT OR IGNORE INTO visit_tags (visit_id, tag_id) VALUES (?, ?)",[r.id,i])}catch(t){}return t.n=2,this.saveDatabase();case 2:return t.a(2)}},t,this)})),function(t,e){return N.apply(this,arguments)})},{key:"getTags",value:(A=m(f().m(function t(e){var n,r,i;return f().w(function(t){for(;;)if(0===t.n){for(n=this.hashURL(e),(r=this.db.prepare("\n      SELECT t.name \n      FROM tags t\n      JOIN visit_tags vt ON t.id = vt.tag_id\n      JOIN visits v ON vt.visit_id = v.id\n      WHERE v.url_hash = ?\n    ")).bind([n]),i=[];r.step();)i.push(r.getAsObject().name);return r.free(),t.a(2,i)}},t,this)})),function(t){return A.apply(this,arguments)})},{key:"getMemories",value:(O=m(f().m(function t(){var e,n,r,i,a,o,s,u,c,l,h,p,m=arguments;return f().w(function(t){for(;;)switch(t.n){case 0:n="\n      SELECT v.*\n      FROM visits v\n      WHERE 1=1\n    ",r=[],(e=m.length>0&&void 0!==m[0]?m[0]:{}).minVisits&&(n+=" AND v.visit_count >= ?",r.push(e.minVisits)),e.minTimeSpent&&(n+=" AND v.total_time_spent >= ?",r.push(e.minTimeSpent)),e.dateFrom&&(n+=" AND v.last_visit >= ?",r.push(e.dateFrom)),e.tag&&(n+=" AND v.id IN (\n        SELECT vt.visit_id FROM visit_tags vt\n        JOIN tags t ON vt.tag_id = t.id\n        WHERE t.name = ?\n      )",r.push(e.tag)),n+=" ORDER BY v.last_visit DESC",(i=this.db.prepare(n)).bind(r),a=[];case 1:if(!i.step()){t.n=5;break}return o=i.getAsObject(),(s=this.db.prepare("SELECT COUNT(*) as count FROM highlights WHERE visit_id = ?")).bind([o.id]),s.step()&&s.getAsObject().count,s.free(),t.n=2,this.getTags(o.url);case 2:return u=t.v,t.n=3,this.getAIInsights(o.url);case 3:for(c=t.v,(l=this.db.prepare("\n        SELECT * FROM sessions \n        WHERE visit_id = ? \n        ORDER BY timestamp DESC \n        LIMIT 10\n      ")).bind([o.id]),h=[];l.step();)h.push(l.getAsObject());return l.free(),t.n=4,this.getHighlights(o.url);case 4:p=t.v,a.push({url:o.url,title:o.title,visits:o.visit_count,lastVisit:o.last_visit,firstVisit:o.first_visit,totalTimeSpent:o.total_time_spent,highlights:p,insights:c,tags:u,sessions:h}),t.n=1;break;case 5:return i.free(),t.a(2,a)}},t,this)})),function(){return O.apply(this,arguments)})},{key:"getStats",value:(k=m(f().m(function t(){var e,n,r;return f().w(function(t){for(;;)if(0===t.n)return e={totalVisits:0,totalTimeSpent:0,totalHighlights:0,totalSessions:0,thisWeekVisits:0,averageTimePerVisit:0},(n=this.db.prepare("SELECT COUNT(*) as count FROM visits")).step()&&(e.totalVisits=n.getAsObject().count),n.free(),(n=this.db.prepare("SELECT SUM(total_time_spent) as total FROM visits")).step()&&(e.totalTimeSpent=n.getAsObject().total||0),n.free(),(n=this.db.prepare("SELECT COUNT(*) as count FROM highlights")).step()&&(e.totalHighlights=n.getAsObject().count),n.free(),(n=this.db.prepare("SELECT SUM(visit_count) as total FROM visits")).step()&&(e.totalSessions=n.getAsObject().total||0),n.free(),r=Date.now()-6048e5,(n=this.db.prepare("SELECT COUNT(*) as count FROM visits WHERE last_visit >= ?")).bind([r]),n.step()&&(e.thisWeekVisits=n.getAsObject().count),n.free(),e.totalSessions>0&&(e.averageTimePerVisit=Math.floor(e.totalTimeSpent/e.totalSessions)),t.a(2,e)},t,this)})),function(){return k.apply(this,arguments)})},{key:"exportData",value:(S=m(f().m(function t(){var e;return f().w(function(t){for(;;)if(0===t.n)return e=this.db.export(),t.a(2,{database:Array.from(e),exportDate:Date.now(),version:"2.0"})},t,this)})),function(){return S.apply(this,arguments)})},{key:"importData",value:(T=m(f().m(function t(e){var n,r;return f().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,"2.0"!==e.version||!e.database){t.n=2;break}return n=new Uint8Array(e.database),this.db=new this.SQL.Database(n),t.n=1,this.saveDatabase();case 1:t.n=3;break;case 2:if(!e.visits){t.n=3;break}return t.n=3,this.migrateFromChromeStorage(e);case 3:t.n=5;break;case 4:throw t.p=4,r=t.v,console.error("Import error:",r),r;case 5:return t.a(2)}},t,this,[[0,4]])})),function(t){return T.apply(this,arguments)})},{key:"migrateFromChromeStorage",value:(_=m(f().m(function t(e){var n,r,i,a,u,c,l,h,p,m,d,b,v,y,g,w,E,_,T,S,k,O,A,N,I,R,P,L;return f().w(function(t){for(;;)switch(t.p=t.n){case 0:if(console.log("🔄 Migrating from chrome.storage..."),!e.visits){t.n=3;break}S=o(e.visits);case 1:if((k=S()).done){t.n=3;break}return n=k.value,r=e.visits[n],t.n=2,this.getOrCreateVisit(r.url,r.title);case 2:if(i=t.v,this.db.run("UPDATE visits \n           SET first_visit = ?, last_visit = ?, visit_count = ?, total_time_spent = ?\n           WHERE id = ?",[r.firstVisit,r.lastVisit,r.visits,r.totalTimeSpent,i.id]),r.sessions){a=s(r.sessions);try{for(a.s();!(u=a.n()).done;)c=u.value,this.db.run("INSERT INTO sessions (visit_id, timestamp, time_spent, scroll_depth, interactions, highlight_count)\n               VALUES (?, ?, ?, ?, ?, ?)",[i.id,c.timestamp,c.timeSpent||0,c.scrollDepth||0,c.interactions||0,c.highlightCount||0])}catch(t){a.e(t)}finally{a.f()}}t.n=1;break;case 3:if(!e.highlights){t.n=6;break}O=o(e.highlights);case 4:if((A=O()).done){t.n=6;break}return l=A.value,h=e.highlights[l],t.n=5,this.getOrCreateVisit(h.url,h.title);case 5:if(p=t.v,h.items){m=s(h.items);try{for(m.s();!(d=m.n()).done;)b=d.value,this.db.run("INSERT INTO highlights (visit_id, text, timestamp) VALUES (?, ?, ?)",[p.id,b.text,b.timestamp])}catch(t){m.e(t)}finally{m.f()}}t.n=4;break;case 6:if(!e.insights){t.n=9;break}N=o(e.insights);case 7:if((I=N()).done){t.n=9;break}return v=I.value,y=e.insights[v],t.n=8,this.saveAIInsights(y.url,y);case 8:t.n=7;break;case 9:if(!e.tags){t.n=18;break}R=o(e.tags);case 10:if((P=R()).done){t.n=18;break}if(g=P.value,!(w=e.tags[g]).tags){t.n=17;break}E=s(w.tags),t.p=11,E.s();case 12:if((_=E.n()).done){t.n=14;break}return T=_.value,t.n=13,this.addTag(w.url,T);case 13:t.n=12;break;case 14:t.n=16;break;case 15:t.p=15,L=t.v,E.e(L);case 16:return t.p=16,E.f(),t.f(16);case 17:t.n=10;break;case 18:return t.n=19,this.saveDatabase();case 19:console.log("✅ Migration complete");case 20:return t.a(2)}},t,this,[[11,15,16,17]])})),function(t){return _.apply(this,arguments)})},{key:"cleanup",value:(E=m(f().m(function t(){var e;return f().w(function(t){for(;;)switch(t.n){case 0:return e=Date.now()-31536e6,this.db.run("DELETE FROM sessions WHERE timestamp < ?",[e]),this.db.run("\n      DELETE FROM tags \n      WHERE id NOT IN (SELECT DISTINCT tag_id FROM visit_tags)\n    "),t.n=1,this.saveDatabase();case 1:return t.a(2)}},t,this)})),function(){return E.apply(this,arguments)})},{key:"savePersonalitySnapshot",value:(w=m(f().m(function t(e){return f().w(function(t){for(;;)switch(t.n){case 0:return this.db.run("INSERT INTO personality_snapshots (\n        week_start, week_end, tone, top_topics, reading_habits, \n        emotional_themes, summary, total_time_spent, total_visits, \n        total_highlights, dominant_interests, quote_of_week\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",[e.weekStart,e.weekEnd,e.tone,JSON.stringify(e.topTopics),e.readingHabits,JSON.stringify(e.emotionalThemes),e.summary,e.totalTimeSpent,e.totalVisits,e.totalHighlights,JSON.stringify(e.dominantInterests),e.quoteOfWeek||""]),t.n=1,this.saveDatabase();case 1:return t.a(2)}},t,this)})),function(t){return w.apply(this,arguments)})},{key:"getPersonalitySnapshots",value:(g=m(f().m(function t(){var e,n,r,i,a=arguments;return f().w(function(t){for(;;)if(0===t.n){for(e=a.length>0&&void 0!==a[0]?a[0]:10,(n=this.db.prepare("\n      SELECT * FROM personality_snapshots \n      ORDER BY week_start DESC \n      LIMIT ?\n    ")).bind([e]),r=[];n.step();)i=n.getAsObject(),r.push({id:i.id,weekStart:i.week_start,weekEnd:i.week_end,tone:i.tone,topTopics:JSON.parse(i.top_topics||"[]"),readingHabits:i.reading_habits,emotionalThemes:JSON.parse(i.emotional_themes||"[]"),summary:i.summary,totalTimeSpent:i.total_time_spent,totalVisits:i.total_visits,totalHighlights:i.total_highlights,dominantInterests:JSON.parse(i.dominant_interests||"[]"),quoteOfWeek:i.quote_of_week,createdAt:i.created_at});return n.free(),t.a(2,r)}},t,this)})),function(){return g.apply(this,arguments)})},{key:"saveInterestEvolution",value:(y=m(f().m(function t(e){var n,r,i;return f().w(function(t){for(;;)switch(t.n){case 0:n=s(e);try{for(n.s();!(r=n.n()).done;)i=r.value,this.db.run("INSERT INTO interest_evolution (\n          topic, period, count, total_time, trend_score, status\n        ) VALUES (?, ?, ?, ?, ?, ?)",[i.topic,i.period,i.count,i.totalTime||0,i.trendScore||0,i.status||"steady"])}catch(t){n.e(t)}finally{n.f()}return t.n=1,this.saveDatabase();case 1:return t.a(2)}},t,this)})),function(t){return y.apply(this,arguments)})},{key:"getInterestEvolution",value:(v=m(f().m(function t(){var e,n,r;return f().w(function(t){for(;;)if(0===t.n){for(e=this.db.prepare("\n      SELECT * FROM interest_evolution \n      ORDER BY period DESC, count DESC\n    "),n=[];e.step();)r=e.getAsObject(),n.push({id:r.id,topic:r.topic,period:r.period,count:r.count,totalTime:r.total_time,trendScore:r.trend_score,status:r.status,createdAt:r.created_at});return e.free(),t.a(2,n)}},t,this)})),function(){return v.apply(this,arguments)})},{key:"saveMoodData",value:(b=m(f().m(function t(e){return f().w(function(t){for(;;)switch(t.n){case 0:return this.db.run("INSERT INTO mood_tracking (\n        timestamp, sentiment, sentiment_score, emotions, tone, url\n      ) VALUES (?, ?, ?, ?, ?, ?)",[e.timestamp,e.sentiment,e.sentimentScore||0,JSON.stringify(e.emotions||[]),e.tone||"",e.url||""]),t.n=1,this.saveDatabase();case 1:return t.a(2)}},t,this)})),function(t){return b.apply(this,arguments)})},{key:"getMoodHistory",value:(p=m(f().m(function t(){var e,n,r,i,a,o=arguments;return f().w(function(t){for(;;)if(0===t.n){for(e=o.length>0&&void 0!==o[0]?o[0]:30,n=Date.now()-24*e*60*60*1e3,(r=this.db.prepare("\n      SELECT * FROM mood_tracking \n      WHERE timestamp >= ?\n      ORDER BY timestamp DESC\n    ")).bind([n]),i=[];r.step();)a=r.getAsObject(),i.push({id:a.id,timestamp:a.timestamp,sentiment:a.sentiment,sentimentScore:a.sentiment_score,emotions:JSON.parse(a.emotions||"[]"),tone:a.tone,url:a.url,createdAt:a.created_at});return r.free(),t.a(2,i)}},t,this)})),function(){return p.apply(this,arguments)})},{key:"getWeeklyMoodSummary",value:(h=m(f().m(function t(){var e,n,r,i,o,s,u,c,l;return f().w(function(t){for(;;)if(0===t.n){for(e=Date.now()-6048e5,(n=this.db.prepare("\n      SELECT sentiment, COUNT(*) as count, AVG(sentiment_score) as avg_score\n      FROM mood_tracking \n      WHERE timestamp >= ?\n      GROUP BY sentiment\n    ")).bind([e]),r={positive:0,negative:0,neutral:0,averageScore:0,dominantMood:"neutral"},i=0,o=0;n.step();)s=n.getAsObject(),u=s.sentiment||"neutral",c=s.count||0,l=s.avg_score||0,r[u]=c,i+=c,o+=l*c;return n.free(),i>0&&(r.averageScore=o/i,r.dominantMood=Object.entries(r).filter(function(t){var e=a(t,1)[0];return["positive","negative","neutral"].includes(e)}).sort(function(t,e){return e[1]-t[1]})[0][0]),t.a(2,r)}},t,this)})),function(){return h.apply(this,arguments)})},{key:"getWeeklyData",value:(c=m(f().m(function t(){var e,n,r,a,o,s,u,c,l,h,p,m;return f().w(function(t){for(;;)if(0===t.n){for(e=Date.now()-6048e5,n=Date.now(),(r=this.db.prepare("\n      SELECT * FROM visits \n      WHERE last_visit >= ? AND last_visit < ?\n      ORDER BY last_visit DESC\n    ")).bind([e,n]),a=[];r.step();)a.push(r.getAsObject());for(r.free(),(o=this.db.prepare("\n      SELECT h.* FROM highlights h\n      JOIN visits v ON h.visit_id = v.id\n      WHERE h.timestamp >= ? AND h.timestamp < ?\n    ")).bind([e,n]),s=[];o.step();)s.push(o.getAsObject());for(o.free(),(u=this.db.prepare("\n      SELECT i.topics FROM insights i\n      JOIN visits v ON i.visit_id = v.id\n      WHERE v.last_visit >= ? AND v.last_visit < ?\n    ")).bind([e,n]),c=[];u.step();)(l=u.getAsObject()).topics&&(h=JSON.parse(l.topics),c.push.apply(c,i(h)));return u.free(),(p=this.db.prepare("\n      SELECT SUM(total_time_spent) as total FROM visits\n      WHERE last_visit >= ? AND last_visit < ?\n    ")).bind([e,n]),m=0,p.step()&&(m=p.getAsObject().total||0),p.free(),t.a(2,{weekStart:e,weekEnd:n,visits:a,highlights:s,topics:c,timeSpent:m})}},t,this)})),function(){return c.apply(this,arguments)})},{key:"close",value:(u=m(f().m(function t(){return f().w(function(t){for(;;)switch(t.n){case 0:if(!this.db){t.n=2;break}return t.n=1,this.saveDatabase();case 1:this.db.close(),this.db=null,this.isInitialized=!1;case 2:return t.a(2)}},t,this)})),function(){return u.apply(this,arguments)})}],n&&d(t.prototype,n),r&&d(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r,u,c,h,p,b,v,y,g,w,E,_,T,S,k,O,A,N,I,R,P,L,D,j,C,M,F,U}();function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function g(t){return function(t){if(Array.isArray(t))return _(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||E(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(t,e)||E(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(t,e){if(t){if("string"==typeof t)return _(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(t,e):void 0}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function T(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return S(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return a=e,s=0,u=t,h.n=n,o}};function p(n,r){for(s=n,u=r,e=0;!f&&c&&!i&&e<l.length;e++){var i,a=l[e],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=t):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(e=s<2?t:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),e=a[i]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,s<2&&(s=0)}else 1===s&&(e=a.return)&&e.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=t}else if((e=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(e){a=t,s=1,u=e}finally{c=1}}return{value:e,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(S(e={},r,function(){return this}),e),f=c.prototype=s.prototype=Object.create(l);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,S(t,i,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=c,S(f,"constructor",c),S(c,"constructor",u),u.displayName="GeneratorFunction",S(c,i,"GeneratorFunction"),S(f),S(f,i,"Generator"),S(f,r,function(){return this}),S(f,"toString",function(){return"[object Generator]"}),(T=function(){return{w:a,m:h}})()}function S(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}S=function(t,e,n,r){function a(e,n){S(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},S(t,e,n,r)}function k(t,e,n,r,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function O(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(t){k(a,r,i,o,s,"next",t)}function s(t){k(a,r,i,o,s,"throw",t)}o(void 0)})}}function A(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,N(r.key),r)}}function N(t){var e=function(t,e){if("object"!=y(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==y(e)?e:e+""}var I=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ai=e},e=[{key:"generateWeeklySnapshot",value:(s=O(T().m(function t(e){var n,r,i,a,o;return T().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n=e.visits,r=e.highlights,e.topics,i=e.timeSpent,t.p=1,this.ai.apiKey){t.n=2;break}return t.a(2,this.generateFallbackSnapshot(e));case 2:return t.n=3,this.ai.generatePersonalityReport(e);case 3:return a=t.v,t.a(2,{timestamp:Date.now(),weekStart:e.weekStart,weekEnd:e.weekEnd,tone:a.tone,topTopics:a.topTopics,readingHabits:a.readingHabits,emotionalThemes:a.emotionalThemes,summary:a.summary,totalTimeSpent:i,totalVisits:n.length,totalHighlights:r.length,dominantInterests:a.dominantInterests});case 4:return t.p=4,o=t.v,console.error("Snapshot generation error:",o),t.a(2,this.generateFallbackSnapshot(e))}},t,this,[[1,4]])})),function(t){return s.apply(this,arguments)})},{key:"analyzeTone",value:(o=O(T().m(function t(e){var n,r,i;return T().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.ai.apiKey){t.n=1;break}return t.a(2,this.generateFallbackTone(e));case 1:return t.p=1,t.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:'Analyze the tone of the reading content. Return 2-3 descriptive words like "analytical, reflective, optimistic" or "critical, curious, thoughtful".'},{role:"user",content:e.substring(0,2e3)}],max_tokens:20,temperature:.5})});case 2:return n=t.v,t.n=3,n.json();case 3:return r=t.v,t.a(2,r.choices[0].message.content.trim());case 4:return t.p=4,i=t.v,console.error("Tone analysis error:",i),t.a(2,this.generateFallbackTone(e))}},t,this,[[1,4]])})),function(t){return o.apply(this,arguments)})},{key:"detectEmotionalThemes",value:(a=O(T().m(function t(e){var n,r,i;return T().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.ai.apiKey){t.n=1;break}return t.a(2,this.generateFallbackEmotions(e));case 1:return t.p=1,t.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:'Identify the emotional themes in this content. Return 2-4 emotions like "curiosity, nostalgia, hope" or "anxiety, determination, wonder".'},{role:"user",content:e.substring(0,2e3)}],max_tokens:30,temperature:.6})});case 2:return n=t.v,t.n=3,n.json();case 3:return r=t.v,t.a(2,r.choices[0].message.content.trim().split(",").map(function(t){return t.trim()}));case 4:return t.p=4,i=t.v,console.error("Emotional theme detection error:",i),t.a(2,this.generateFallbackEmotions(e))}},t,this,[[1,4]])})),function(t){return a.apply(this,arguments)})},{key:"generateWeeklyQuote",value:(i=O(T().m(function t(e){var n,r,i;return T().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.ai.apiKey){t.n=1;break}return t.a(2,this.getFallbackQuote());case 1:return t.p=1,t.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"Generate an inspiring quote that matches the user's weekly vibe. Keep it under 100 characters, thoughtful and motivating."},{role:"user",content:"This week's vibe: ".concat(e.tone,". Topics: ").concat(e.topTopics.join(", "),". Emotional themes: ").concat(e.emotionalThemes.join(", "),".")}],max_tokens:60,temperature:.8})});case 2:return n=t.v,t.n=3,n.json();case 3:return r=t.v,t.a(2,r.choices[0].message.content.trim().replace(/^["']|["']$/g,""));case 4:return t.p=4,i=t.v,console.error("Quote generation error:",i),t.a(2,this.getFallbackQuote())}},t,this,[[1,4]])})),function(t){return i.apply(this,arguments)})},{key:"analyzeSentiment",value:(r=O(T().m(function t(e){var n,r,i,a;return T().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.ai.apiKey){t.n=1;break}return t.a(2,this.generateFallbackSentiment(e));case 1:return t.p=1,t.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:'Analyze the sentiment. Return ONLY one word: "positive", "negative", or "neutral".'},{role:"user",content:e.substring(0,1e3)}],max_tokens:5,temperature:.3})});case 2:return n=t.v,t.n=3,n.json();case 3:return r=t.v,i=r.choices[0].message.content.trim().toLowerCase(),t.a(2,{sentiment:i,score:"positive"===i?.7:"negative"===i?-.7:0});case 4:return t.p=4,a=t.v,console.error("Sentiment analysis error:",a),t.a(2,this.generateFallbackSentiment(e))}},t,this,[[1,4]])})),function(t){return r.apply(this,arguments)})},{key:"generateFallbackSnapshot",value:function(t){var e=t.visits,n=t.topics,r={};n.forEach(function(t){r[t]=(r[t]||0)+1});var i=Object.entries(r).sort(function(t,e){return e[1]-t[1]}).slice(0,5).map(function(t){return w(t,1)[0]});return{timestamp:Date.now(),weekStart:t.weekStart,weekEnd:t.weekEnd,tone:"curious, engaged",topTopics:i,readingHabits:"Regular browsing",emotionalThemes:["curiosity","interest"],summary:"This week, you explored ".concat(i.slice(0,3).join(", "),". Your tone: curious and engaged."),totalTimeSpent:t.timeSpent,totalVisits:e.length,totalHighlights:t.highlights.length,dominantInterests:i.slice(0,3)}}},{key:"generateFallbackTone",value:function(t){for(var e=t.toLowerCase(),n={},r=0,i=Object.entries({analytical:["data","analysis","study","research","evidence"],creative:["design","art","creative","innovation","imagine"],technical:["code","software","development","programming","system"],curious:["why","how","what","learn","understand"],optimistic:["success","growth","opportunity","future","potential"]});r<i.length;r++){var a=w(i[r],2),o=a[0],s=a[1];n[o]=s.filter(function(t){return e.includes(t)}).length}var u=Object.entries(n).sort(function(t,e){return e[1]-t[1]}).slice(0,2).map(function(t){return w(t,1)[0]});return u.length>0?u.join(", "):"curious, thoughtful"}},{key:"generateFallbackEmotions",value:function(t){return["curiosity","interest","focus"]}},{key:"generateFallbackSentiment",value:function(t){var e=["good","great","amazing","love","excellent","happy","success"],n=["bad","terrible","hate","problem","issue","difficult","fail"],r=t.toLowerCase().split(/\s+/),i=r.filter(function(t){return e.includes(t)}).length,a=r.filter(function(t){return n.includes(t)}).length;return i>a?{sentiment:"positive",score:.5}:a>i?{sentiment:"negative",score:-.5}:{sentiment:"neutral",score:0}}},{key:"getFallbackQuote",value:function(){var t=["Your curiosity is your compass.","Every search shapes who you're becoming.","Your digital journey reflects your growth.","Learning is a continuous adventure.","Your interests tell your story."];return t[Math.floor(Math.random()*t.length)]}},{key:"calculateInterestEvolution",value:function(t){var e={};return t.forEach(function(t){var n,r=new Date(t.timestamp).toISOString().slice(0,7);e[r]||(e[r]={topics:[],count:0}),t.topics&&((n=e[r].topics).push.apply(n,g(t.topics)),e[r].count++)}),Object.entries(e).map(function(t){var e=w(t,2),n=e[0],r=e[1],i={};return r.topics.forEach(function(t){i[t]=(i[t]||0)+1}),{period:n,topTopics:Object.entries(i).sort(function(t,e){return e[1]-t[1]}).slice(0,5).map(function(t){var e=w(t,2);return{topic:e[0],count:e[1]}}),totalVisits:r.count}})}},{key:"detectTrendingInterests",value:function(t,e){var n={};t.topics.forEach(function(t){n[t]=(n[t]||0)+1});var r={};e.forEach(function(t){var e;null===(e=t.topics)||void 0===e||e.forEach(function(t){r[t]=(r[t]||0)+1})});for(var i=[],a=0,o=Object.entries(n);a<o.length;a++){var s=w(o[a],2),u=s[0],c=s[1],l=(r[u]||0)/Math.max(e.length,1),f=c-l;f>0&&i.push({topic:u,currentCount:c,previousAvg:l,trendScore:f,status:f>2?"rising":"steady"})}return i.sort(function(t,e){return e.trendScore-t.trendScore}).slice(0,10)}}],e&&A(t.prototype,e),n&&A(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,i,a,o,s}();function R(t){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R(t)}function P(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(t,e)||M(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?L(Object(n),!0).forEach(function(e){j(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function j(t,e,n){return(e=W(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function C(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=M(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function M(t,e){if(t){if("string"==typeof t)return F(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(t,e):void 0}}function F(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function U(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return G(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return a=e,s=0,u=t,h.n=n,o}};function p(n,r){for(s=n,u=r,e=0;!f&&c&&!i&&e<l.length;e++){var i,a=l[e],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=t):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(e=s<2?t:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),e=a[i]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,s<2&&(s=0)}else 1===s&&(e=a.return)&&e.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=t}else if((e=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(e){a=t,s=1,u=e}finally{c=1}}return{value:e,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(G(e={},r,function(){return this}),e),f=c.prototype=s.prototype=Object.create(l);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,G(t,i,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=c,G(f,"constructor",c),G(c,"constructor",u),u.displayName="GeneratorFunction",G(c,i,"GeneratorFunction"),G(f),G(f,i,"Generator"),G(f,r,function(){return this}),G(f,"toString",function(){return"[object Generator]"}),(U=function(){return{w:a,m:h}})()}function G(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}G=function(t,e,n,r){function a(e,n){G(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},G(t,e,n,r)}function q(t,e,n,r,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function x(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(t){q(a,r,i,o,s,"next",t)}function s(t){q(a,r,i,o,s,"throw",t)}o(void 0)})}}function H(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,W(r.key),r)}}function W(t){var e=function(t,e){if("object"!=R(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=R(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==R(e)?e:e+""}var X=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ai=e,this.db=n,this.activeGoals=[],this.sessionTracking=new Map,this.loadGoals()},e=[{key:"loadGoals",value:(f=x(U().m(function t(){var e=this;return U().w(function(t){for(;;)switch(t.n){case 0:chrome.storage.local.get(["user_goals"],function(t){e.activeGoals=t.user_goals||[]});case 1:return t.a(2)}},t)})),function(){return f.apply(this,arguments)})},{key:"saveGoals",value:(l=x(U().m(function t(){return U().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.storage.local.set({user_goals:this.activeGoals});case 1:return t.a(2)}},t,this)})),function(){return l.apply(this,arguments)})},{key:"addGoal",value:(c=x(U().m(function t(e){var n;return U().w(function(t){for(;;)switch(t.n){case 0:return n={id:Date.now(),title:e.title,description:e.description,keywords:e.keywords||[],priority:e.priority||"medium",createdAt:Date.now(),targetHours:e.targetHours||0,actualHours:0,lastNudge:null,nudgeCount:0,isActive:!0},this.activeGoals.push(n),t.n=1,this.saveGoals();case 1:return t.a(2,n)}},t,this)})),function(t){return c.apply(this,arguments)})},{key:"updateGoalProgress",value:(u=x(U().m(function t(e,n){var r;return U().w(function(t){for(;;)switch(t.n){case 0:if(!(r=this.activeGoals.find(function(t){return t.id===e}))){t.n=1;break}return r.actualHours+=n/3600,t.n=1,this.saveGoals();case 1:return t.a(2)}},t,this)})),function(t,e){return u.apply(this,arguments)})},{key:"checkAlignment",value:(s=x(U().m(function t(e,n,r,i){var a,o,s,u,c,l,f;return U().w(function(t){for(;;)switch(t.p=t.n){case 0:if(0!==this.activeGoals.length){t.n=1;break}return t.a(2,null);case 1:a=(n+" "+r).toLowerCase(),o=[],s=C(this.activeGoals),t.p=2,s.s();case 3:if((u=s.n()).done){t.n=6;break}if((c=u.value).isActive){t.n=4;break}return t.a(3,5);case 4:if(!this.isContentAlignedWithGoal(a,c)){t.n=5;break}return o.push(c),t.n=5,this.updateGoalProgress(c.id,i);case 5:t.n=3;break;case 6:t.n=8;break;case 7:t.p=7,f=t.v,s.e(f);case 8:return t.p=8,s.f(),t.f(8);case 9:if(l="".concat(Date.now(),"_").concat(e),this.sessionTracking.set(l,{url:e,title:n,aligned:o.length>0,goals:o.map(function(t){return t.id}),timeSpent:i}),!(0===o.length&&i>300)){t.n=10;break}return t.a(2,this.generateNudge(n,i));case 10:return t.a(2,{aligned:!0,goals:o,message:o.length>0?"Great! This aligns with your goal: ".concat(o[0].title):null})}},t,this,[[2,7,8,9]])})),function(t,e,n,r){return s.apply(this,arguments)})},{key:"isContentAlignedWithGoal",value:function(t,e){return 0!==e.keywords.length&&e.keywords.filter(function(e){return t.includes(e.toLowerCase())}).length>0}},{key:"generateNudge",value:function(t,e){var n=this.activeGoals.filter(function(t){return t.isActive}).sort(function(t,e){var n={high:3,medium:2,low:1};return(n[e.priority]||0)-(n[t.priority]||0)}).slice(0,3);if(0===n.length)return null;var r=n[0],i=Math.floor(e/60);if(r.lastNudge&&Date.now()-r.lastNudge<36e5)return null;r.lastNudge=Date.now(),r.nudgeCount++,this.saveGoals();var a=[{title:"Mindful Moment 🧘",message:"You've spent ".concat(i,' minutes here. Still working on "').concat(r.title,'"?'),tone:"gentle"},{title:"Goal Check-In 🎯",message:'Remember your goal: "'.concat(r.title,'". Want to refocus?'),tone:"encouraging"},{title:"Progress Update 📊",message:'Goal: "'.concat(r.title,'" — ').concat(r.actualHours.toFixed(1),"h / ").concat(r.targetHours,"h. Keep it up!"),tone:"motivating"},{title:"Gentle Reminder 💡",message:"".concat(i,' minutes here. Just checking: is this aligned with "').concat(r.title,'"?'),tone:"curious"}];return D(D({},a[r.nudgeCount%a.length]),{},{goal:r,timeSpent:i,showNudge:!0})}},{key:"getGoalProgress",value:function(){return this.activeGoals.map(function(t){return{id:t.id,title:t.title,progress:t.targetHours>0?(t.actualHours/t.targetHours*100).toFixed(1):0,actualHours:t.actualHours.toFixed(1),targetHours:t.targetHours,isOnTrack:t.actualHours>=.7*t.targetHours,priority:t.priority,isActive:t.isActive}})}},{key:"toggleGoal",value:(o=x(U().m(function t(e){var n;return U().w(function(t){for(;;)switch(t.n){case 0:if(!(n=this.activeGoals.find(function(t){return t.id===e}))){t.n=1;break}return n.isActive=!n.isActive,t.n=1,this.saveGoals();case 1:return t.a(2)}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"deleteGoal",value:(a=x(U().m(function t(e){return U().w(function(t){for(;;)switch(t.n){case 0:return this.activeGoals=this.activeGoals.filter(function(t){return t.id!==e}),t.n=1,this.saveGoals();case 1:return t.a(2)}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"getWeeklyInsights",value:(i=x(U().m(function t(){var e,n,r,i,a,o,s,u,c;return U().w(function(t){for(;;)if(0===t.n){e=Date.now()-6048e5,n=0,r=0,i=C(this.sessionTracking.entries());try{for(i.s();!(a=i.n()).done;)o=P(a.value,2),s=o[0],u=o[1],parseInt(s.split("_")[0])>e&&(r+=u.timeSpent,u.aligned&&(n+=u.timeSpent))}catch(t){i.e(t)}finally{i.f()}return c=r>0?(n/r*100).toFixed(1):0,t.a(2,{alignmentRate:parseFloat(c),totalAlignedHours:(n/3600).toFixed(1),totalHours:(r/3600).toFixed(1),activeGoals:this.activeGoals.filter(function(t){return t.isActive}).length,mostProgressedGoal:this.getMostProgressedGoal()})}},t,this)})),function(){return i.apply(this,arguments)})},{key:"getMostProgressedGoal",value:function(){var t=Date.now()-6048e5;return this.activeGoals.filter(function(e){return e.isActive&&e.createdAt<t}).map(function(t){return{title:t.title,weeklyProgress:t.actualHours}}).sort(function(t,e){return e.weeklyProgress-t.weeklyProgress})[0]||null}},{key:"suggestGoals",value:(r=x(U().m(function t(e,n){var r,i,a,o=this;return U().w(function(t){for(;;)if(0===t.n)return r={},e.forEach(function(t){r[t]=(r[t]||0)+1}),i=Object.entries(r).sort(function(t,e){return e[1]-t[1]}).slice(0,5).map(function(t){return P(t,1)[0]}),a=i.filter(function(t){return!o.activeGoals.some(function(e){return e.keywords.some(function(e){return e.toLowerCase().includes(t.toLowerCase())})})}).map(function(t){return{title:"Learn more about ".concat(t),description:"You've been exploring ".concat(t," recently. Set a goal to dive deeper!"),keywords:[t],priority:"medium",suggestedTargetHours:10}}),t.a(2,a.slice(0,3))},t)})),function(t,e){return r.apply(this,arguments)})}],e&&H(t.prototype,e),n&&H(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,i,a,o,s,u,c,l,f}();function V(t){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V(t)}function Y(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return B(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function z(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return Q(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return a=e,s=0,u=t,h.n=n,o}};function p(n,r){for(s=n,u=r,e=0;!f&&c&&!i&&e<l.length;e++){var i,a=l[e],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=t):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(e=s<2?t:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),e=a[i]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,s<2&&(s=0)}else 1===s&&(e=a.return)&&e.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=t}else if((e=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(e){a=t,s=1,u=e}finally{c=1}}return{value:e,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(Q(e={},r,function(){return this}),e),f=c.prototype=s.prototype=Object.create(l);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Q(t,i,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=c,Q(f,"constructor",c),Q(c,"constructor",u),u.displayName="GeneratorFunction",Q(c,i,"GeneratorFunction"),Q(f),Q(f,i,"Generator"),Q(f,r,function(){return this}),Q(f,"toString",function(){return"[object Generator]"}),(z=function(){return{w:a,m:h}})()}function Q(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}Q=function(t,e,n,r){function a(e,n){Q(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},Q(t,e,n,r)}function K(t,e,n,r,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function $(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(t){K(a,r,i,o,s,"next",t)}function s(t){K(a,r,i,o,s,"throw",t)}o(void 0)})}}function J(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Z(r.key),r)}}function Z(t){var e=function(t,e){if("object"!=V(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=V(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==V(e)?e:e+""}var tt=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ai=e,this.db=n,this.twinProfile=null,this.loadProfile()},e=[{key:"loadProfile",value:(s=$(z().m(function t(){var e=this;return z().w(function(t){for(;;)switch(t.n){case 0:chrome.storage.local.get(["digital_twin_profile"],function(t){e.twinProfile=t.digital_twin_profile||e.createEmptyProfile()});case 1:return t.a(2)}},t)})),function(){return s.apply(this,arguments)})},{key:"saveProfile",value:(o=$(z().m(function t(){return z().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.storage.local.set({digital_twin_profile:this.twinProfile});case 1:return t.a(2)}},t,this)})),function(){return o.apply(this,arguments)})},{key:"createEmptyProfile",value:function(){return{createdAt:Date.now(),lastUpdated:Date.now(),interestHistory:[],toneHistory:[],topicPreferences:{},emotionalPatterns:{},browsingPatterns:{peakHours:[],averageSessionDuration:0,favoriteCategories:[]},personalityTraits:[],thoughtPatterns:[],learningStyle:null,totalDataPoints:0}}},{key:"updateTwin",value:(a=$(z().m(function t(e){var n,r,i,a,o,s,u,c=this;return z().w(function(t){for(;;)switch(t.n){case 0:return n=e.topics,r=e.tone,i=e.emotions,a=e.timestamp,o=e.timeSpent,s=e.category,this.twinProfile||(this.twinProfile=this.createEmptyProfile()),n&&n.forEach(function(t){c.twinProfile.topicPreferences[t]||(c.twinProfile.topicPreferences[t]={count:0,totalTime:0,firstSeen:a,lastSeen:a}),c.twinProfile.topicPreferences[t].count++,c.twinProfile.topicPreferences[t].totalTime+=o||0,c.twinProfile.topicPreferences[t].lastSeen=a}),r&&(this.twinProfile.toneHistory.push({tone:r,timestamp:a}),this.twinProfile.toneHistory.length>100&&(this.twinProfile.toneHistory=this.twinProfile.toneHistory.slice(-100))),i&&i.forEach(function(t){c.twinProfile.emotionalPatterns[t]||(c.twinProfile.emotionalPatterns[t]=0),c.twinProfile.emotionalPatterns[t]++}),u=new Date(a).getHours(),this.twinProfile.browsingPatterns.peakHours[u]||(this.twinProfile.browsingPatterns.peakHours[u]=0),this.twinProfile.browsingPatterns.peakHours[u]++,s&&(this.twinProfile.browsingPatterns.favoriteCategories.includes(s)||this.twinProfile.browsingPatterns.favoriteCategories.push(s)),this.twinProfile.totalDataPoints++,this.twinProfile.lastUpdated=a,t.n=1,this.saveProfile();case 1:return t.a(2)}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"askTwin",value:(i=$(z().m(function t(e){var n,r,i,a;return z().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.ai.apiKey){t.n=1;break}return t.a(2,this.generateFallbackResponse(e));case 1:return t.p=1,n=this.buildTwinContext(),t.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You are the user's digital twin - a reflection of their browsing personality and interests. \n              \nYour role is to answer questions about the user's past interests, behaviors, and patterns based on the data below.\n\nUSER PROFILE:\n".concat(n,'\n\nRespond as if you ARE the user, using "I" and reflecting their personality. Be insightful, honest, and helpful.')},{role:"user",content:e}],max_tokens:200,temperature:.7})});case 2:return r=t.v,t.n=3,r.json();case 3:return i=t.v,t.a(2,{answer:i.choices[0].message.content.trim(),confidence:this.calculateConfidence(),timestamp:Date.now()});case 4:return t.p=4,a=t.v,console.error("Digital twin error:",a),t.a(2,this.generateFallbackResponse(e))}},t,this,[[1,4]])})),function(t){return i.apply(this,arguments)})},{key:"buildTwinContext",value:function(){var t=Object.entries(this.twinProfile.topicPreferences).sort(function(t,e){return e[1].count-t[1].count}).slice(0,10).map(function(t){var e=Y(t,2),n=e[0],r=e[1];return"".concat(n," (").concat(r.count," times)")}),e=this.twinProfile.toneHistory.slice(-10).map(function(t){return t.tone}).join(", "),n=Object.entries(this.twinProfile.emotionalPatterns).sort(function(t,e){return e[1]-t[1]}).slice(0,5).map(function(t){var e=Y(t,2),n=e[0],r=e[1];return"".concat(n," (").concat(r,")")}),r=this.twinProfile.browsingPatterns.peakHours.reduce(function(t,e,n){return e>(t.count||0)?{hour:n,count:e}:t},{});return"\nTop Interests: ".concat(t.join(", "),"\nRecent Tone: ").concat(e||"curious, thoughtful","\nEmotional Patterns: ").concat(n.join(", "),"\nMost Active Hour: ").concat(r.hour||"N/A",":00\nFavorite Categories: ").concat(this.twinProfile.browsingPatterns.favoriteCategories.join(", "),"\nTotal Data Points: ").concat(this.twinProfile.totalDataPoints,"\nProfile Age: ").concat(Math.floor((Date.now()-this.twinProfile.createdAt)/864e5)," days\n    ").trim()}},{key:"calculateConfidence",value:function(){return this.twinProfile.totalDataPoints<10?"low":this.twinProfile.totalDataPoints<50?"medium":this.twinProfile.totalDataPoints<200?"high":"very high"}},{key:"generateFallbackResponse",value:function(t){var e=t.toLowerCase();if(e.includes("topic")||e.includes("interest")){var n=Object.entries(this.twinProfile.topicPreferences).sort(function(t,e){return e[1].count-t[1].count}).slice(0,3).map(function(t){return Y(t,1)[0]});return{answer:"Based on your browsing, you've been most interested in: ".concat(n.join(", ")),confidence:"medium",timestamp:Date.now()}}if(e.includes("avoid")||e.includes("less")){var r=Object.entries(this.twinProfile.topicPreferences).sort(function(t,e){return t[1].count-e[1].count}).slice(0,3).map(function(t){return Y(t,1)[0]});return{answer:"You seem to have explored these less: ".concat(r.join(", ")),confidence:"medium",timestamp:Date.now()}}if(e.includes("year ago")||e.includes("last year")){var i=Object.entries(this.twinProfile.topicPreferences).filter(function(t){var e=Y(t,2);return e[0],e[1].lastSeen<Date.now()-15552e6}).slice(0,3).map(function(t){return Y(t,1)[0]});return{answer:i.length>0?"Looking back, you were interested in: ".concat(i.join(", ")):"I don't have enough historical data to answer that yet.",confidence:"low",timestamp:Date.now()}}return{answer:"I'm still learning about you. Keep browsing and I'll have better insights soon!",confidence:"low",timestamp:Date.now()}}},{key:"getTwinSummary",value:function(){var t=Object.entries(this.twinProfile.topicPreferences).sort(function(t,e){return e[1].count-t[1].count}).slice(0,5).map(function(t){var e=Y(t,2),n=e[0],r=e[1];return{topic:n,count:r.count,totalTime:r.totalTime,recency:Date.now()-r.lastSeen}}),e=Object.entries(this.twinProfile.emotionalPatterns).sort(function(t,e){return e[1]-t[1]}).slice(0,3).map(function(t){return Y(t,1)[0]}),n=this.twinProfile.browsingPatterns.peakHours.map(function(t,e){return{hour:e,count:t}}).filter(function(t){return t.count>0}).sort(function(t,e){return e.count-t.count}).slice(0,3);return{maturityLevel:this.calculateConfidence(),topInterests:t,dominantEmotions:e,peakBrowsingHours:n,totalDataPoints:this.twinProfile.totalDataPoints,profileAge:Math.floor((Date.now()-this.twinProfile.createdAt)/864e5),lastUpdated:this.twinProfile.lastUpdated}}},{key:"compareWithPast",value:(r=$(z().m(function t(){var e,n,r,i,a,o,s,u=arguments;return z().w(function(t){for(;;)if(0===t.n)return e=u.length>0&&void 0!==u[0]?u[0]:30,n=Date.now()-24*e*60*60*1e3,r=Object.entries(this.twinProfile.topicPreferences).filter(function(t){var e=Y(t,2),r=(e[0],e[1]);return r.lastSeen<n&&r.firstSeen<n}).sort(function(t,e){return e[1].count-t[1].count}).slice(0,5).map(function(t){return Y(t,1)[0]}),i=Object.entries(this.twinProfile.topicPreferences).filter(function(t){var e=Y(t,2);return e[0],e[1].lastSeen>=n}).sort(function(t,e){return e[1].count-t[1].count}).slice(0,5).map(function(t){return Y(t,1)[0]}),a=i.filter(function(t){return!r.includes(t)}),o=r.filter(function(t){return!i.includes(t)}),s=i.filter(function(t){return r.includes(t)}),t.a(2,{past:r,current:i,new:a,faded:o,continuing:s,periodDays:e})},t,this)})),function(){return r.apply(this,arguments)})},{key:"predictFutureInterests",value:function(){return{likelyNextInterests:Object.entries(this.twinProfile.topicPreferences).filter(function(t){var e=Y(t,2);return e[0],e[1].lastSeen>Date.now()-12096e5}).sort(function(t,e){return e[1].count-t[1].count}).slice(0,5).map(function(t){return Y(t,1)[0]}),reasoning:"Based on your recent browsing patterns and interest evolution"}}}],e&&J(t.prototype,e),n&&J(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,i,a,o,s}();function et(t){return et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},et(t)}function nt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return rt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?rt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function it(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return at(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return a=e,s=0,u=t,h.n=n,o}};function p(n,r){for(s=n,u=r,e=0;!f&&c&&!i&&e<l.length;e++){var i,a=l[e],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=t):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(e=s<2?t:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),e=a[i]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,s<2&&(s=0)}else 1===s&&(e=a.return)&&e.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=t}else if((e=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(e){a=t,s=1,u=e}finally{c=1}}return{value:e,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(at(e={},r,function(){return this}),e),f=c.prototype=s.prototype=Object.create(l);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,at(t,i,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=c,at(f,"constructor",c),at(c,"constructor",u),u.displayName="GeneratorFunction",at(c,i,"GeneratorFunction"),at(f),at(f,i,"Generator"),at(f,r,function(){return this}),at(f,"toString",function(){return"[object Generator]"}),(it=function(){return{w:a,m:h}})()}function at(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}at=function(t,e,n,r){function a(e,n){at(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},at(t,e,n,r)}function ot(t,e,n,r,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function st(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(t){ot(a,r,i,o,s,"next",t)}function s(t){ot(a,r,i,o,s,"throw",t)}o(void 0)})}}function ut(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ct(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ft(r.key),r)}}function lt(t,e,n){return e&&ct(t.prototype,e),n&&ct(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function ft(t){var e=function(t,e){if("object"!=et(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=et(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==et(e)?e:e+""}var ht=function(){return lt(function t(){ut(this,t),this.apiKey=null,this.provider="openai",this.loadConfig()},[{key:"loadConfig",value:(o=st(it().m(function t(){var e=this;return it().w(function(t){for(;;)switch(t.n){case 0:chrome.storage.local.get(["ai_api_key","ai_provider"],function(t){e.apiKey=t.ai_api_key||null,e.provider=t.ai_provider||"openai"});case 1:return t.a(2)}},t)})),function(){return o.apply(this,arguments)})},{key:"generateSummary",value:(a=st(it().m(function t(e){var n;return it().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.apiKey){t.n=1;break}return console.warn("No AI API key configured"),t.a(2,this.generateFallbackSummary(e));case 1:if(t.p=1,"openai"!==this.provider){t.n=3;break}return t.n=2,this.openAISummary(e);case 2:case 4:return t.a(2,t.v);case 3:if("anthropic"!==this.provider){t.n=5;break}return t.n=4,this.anthropicSummary(e);case 5:t.n=7;break;case 6:return t.p=6,n=t.v,console.error("AI summary error:",n),t.a(2,this.generateFallbackSummary(e));case 7:return t.a(2)}},t,this,[[1,6]])})),function(t){return a.apply(this,arguments)})},{key:"openAISummary",value:(i=st(it().m(function t(e){var n,r;return it().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a concise summarizer. Create a 1-2 sentence summary of the following content that captures the main topic and purpose."},{role:"user",content:e.substring(0,3e3)}],max_tokens:100,temperature:.5})});case 1:return n=t.v,t.n=2,n.json();case 2:return r=t.v,t.a(2,r.choices[0].message.content.trim())}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"predictTags",value:(r=st(it().m(function t(e,n){var r;return it().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.apiKey){t.n=1;break}return t.a(2,this.generateFallbackTags(e,n));case 1:if(t.p=1,"openai"!==this.provider){t.n=3;break}return t.n=2,this.openAITags(e,n);case 2:return t.a(2,t.v);case 3:t.n=5;break;case 4:return t.p=4,r=t.v,console.error("AI tagging error:",r),t.a(2,this.generateFallbackTags(e,n));case 5:return t.a(2)}},t,this,[[1,4]])})),function(t,e){return r.apply(this,arguments)})},{key:"openAITags",value:(n=st(it().m(function t(e,n){var r,i,a;return it().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"Generate 3-5 relevant tags for this content. Return only the tags separated by commas, like: learning, ai, research"},{role:"user",content:"Title: ".concat(n,"\n\nContent: ").concat(e.substring(0,2e3))}],max_tokens:50,temperature:.7})});case 1:return r=t.v,t.n=2,r.json();case 2:return i=t.v,a=i.choices[0].message.content.trim().split(",").map(function(t){return t.trim()}),t.a(2,a.slice(0,5))}},t,this)})),function(t,e){return n.apply(this,arguments)})},{key:"extractTopics",value:(e=st(it().m(function t(e){var n;return it().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.apiKey){t.n=1;break}return t.a(2,this.generateFallbackTopics(e));case 1:if(t.p=1,"openai"!==this.provider){t.n=3;break}return t.n=2,this.openAITopics(e);case 2:return t.a(2,t.v);case 3:t.n=5;break;case 4:return t.p=4,n=t.v,console.error("AI topic extraction error:",n),t.a(2,this.generateFallbackTopics(e));case 5:return t.a(2)}},t,this,[[1,4]])})),function(t){return e.apply(this,arguments)})},{key:"openAITopics",value:(t=st(it().m(function t(e){var n,r;return it().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"Extract 3-5 key topics or concepts from this content. Return only the topics separated by commas."},{role:"user",content:e.substring(0,2e3)}],max_tokens:60,temperature:.5})});case 1:return n=t.v,t.n=2,n.json();case 2:return r=t.v,t.a(2,r.choices[0].message.content.trim().split(",").map(function(t){return t.trim()}))}},t,this)})),function(e){return t.apply(this,arguments)})},{key:"generateFallbackSummary",value:function(t){return t.split(/[.!?]+/).filter(function(t){return t.trim().length>20}).slice(0,2).join(". ").substring(0,200)+"..."}},{key:"generateFallbackTags",value:function(t,e){var n=(e+" "+t).toLowerCase(),r=["the","a","an","and","or","but","in","on","at","to","for","of","with","by","from","is","was","are","were","been","be","have","has","had","do","does","did","will","would","could","should","may","might","can","this","that","these","those"],i=n.split(/\W+/).filter(function(t){return t.length>3&&!r.includes(t)&&!/^\d+$/.test(t)}),a={};return i.forEach(function(t){return a[t]=(a[t]||0)+1}),Object.entries(a).sort(function(t,e){return e[1]-t[1]}).slice(0,5).map(function(t){return nt(t,1)[0]})}},{key:"generateFallbackTopics",value:function(t){return this.generateFallbackTags(t,"")}}]);var t,e,n,r,i,a,o}();new(function(){return lt(function t(){ut(this,t),this.db=new v,this.ai=new ht,this.personalityEngine=null,this.goalAlignment=null,this.digitalTwin=null,this.activeSessions=new Map,this.init()},[{key:"init",value:(y=st(it().m(function t(){var e=this;return it().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.init();case 1:this.personalityEngine=new I(this.ai),this.goalAlignment=new X(this.ai,this.db),this.digitalTwin=new tt(this.ai,this.db),chrome.runtime.onMessage.addListener(function(t,n,r){return e.handleMessage(t,n,r),!0}),chrome.tabs.onUpdated.addListener(function(t,n,r){"complete"===n.status&&e.handleTabLoad(t,r)}),chrome.tabs.onRemoved.addListener(function(t){e.handleTabClose(t)}),chrome.alarms.create("cleanup",{periodInMinutes:60}),chrome.alarms.create("weeklySnapshot",{periodInMinutes:10080}),chrome.alarms.create("moodTracking",{periodInMinutes:30}),chrome.alarms.onAlarm.addListener(function(t){"cleanup"===t.name?e.performCleanup():"weeklySnapshot"===t.name?e.generateWeeklySnapshot():"moodTracking"===t.name&&e.updateMoodTracking()}),console.log("✨ SupriAI Background Service Worker initialized");case 2:return t.a(2)}},t,this)})),function(){return y.apply(this,arguments)})},{key:"handleMessage",value:(b=st(it().m(function t(e,n,r){var i,a,o,s,u,c,l,f,h,p,m,d,b,v,y,g,w,E,_;return it().w(function(t){for(;;)switch(t.p=t.n){case 0:i=e.type,a=e.data,o=e.url,t.p=1,E=i,t.n="CONTEXT_UPDATE"===E?2:"SAVE_HIGHLIGHT"===E?4:"GET_PREVIOUS_CONTEXT"===E?6:"PAGE_UNLOAD"===E?8:"GET_MEMORIES"===E?10:"SEARCH_MEMORIES"===E?12:"ADD_TAG"===E?14:"GET_STATS"===E?16:"EXPORT_DATA"===E?18:"IMPORT_DATA"===E?20:"GET_PERSONALITY_SNAPSHOTS"===E?22:"GET_INTEREST_EVOLUTION"===E?24:"GET_MOOD_SUMMARY"===E?26:"ADD_GOAL"===E?28:"GET_GOALS"===E?30:"TOGGLE_GOAL"===E?31:"DELETE_GOAL"===E?33:"GET_GOAL_INSIGHTS"===E?35:"ASK_TWIN"===E?37:"GET_TWIN_SUMMARY"===E?39:"COMPARE_INTERESTS"===E?40:42;break;case 2:return t.n=3,this.handleContextUpdate(a,n.tab);case 3:return r({success:!0}),t.a(3,43);case 4:return t.n=5,this.saveHighlight(a);case 5:return r({success:!0}),t.a(3,43);case 6:return t.n=7,this.getPreviousContext(o);case 7:return s=t.v,r({context:s}),t.a(3,43);case 8:return t.n=9,this.handlePageUnload(a,n.tab);case 9:return r({success:!0}),t.a(3,43);case 10:return t.n=11,this.getMemories(a);case 11:return u=t.v,r({memories:u}),t.a(3,43);case 12:return t.n=13,this.searchMemories(a.query);case 13:return c=t.v,r({results:c}),t.a(3,43);case 14:return t.n=15,this.addTag(a.url,a.tag);case 15:return r({success:!0}),t.a(3,43);case 16:return t.n=17,this.getStats();case 17:return l=t.v,r({stats:l}),t.a(3,43);case 18:return t.n=19,this.exportData();case 19:return f=t.v,r({data:f}),t.a(3,43);case 20:return t.n=21,this.importData(a);case 21:return r({success:!0}),t.a(3,43);case 22:return t.n=23,this.db.getPersonalitySnapshots(null==a?void 0:a.limit);case 23:return h=t.v,r({snapshots:h}),t.a(3,43);case 24:return t.n=25,this.db.getInterestEvolution();case 25:return p=t.v,r({evolution:p}),t.a(3,43);case 26:return t.n=27,this.db.getWeeklyMoodSummary();case 27:return m=t.v,r({moodSummary:m}),t.a(3,43);case 28:return t.n=29,this.goalAlignment.addGoal(a);case 29:return d=t.v,r({goal:d}),t.a(3,43);case 30:return b=this.goalAlignment.getGoalProgress(),r({goals:b}),t.a(3,43);case 31:return t.n=32,this.goalAlignment.toggleGoal(a.goalId);case 32:return r({success:!0}),t.a(3,43);case 33:return t.n=34,this.goalAlignment.deleteGoal(a.goalId);case 34:return r({success:!0}),t.a(3,43);case 35:return t.n=36,this.goalAlignment.getWeeklyInsights();case 36:return v=t.v,r({insights:v}),t.a(3,43);case 37:return t.n=38,this.digitalTwin.askTwin(a.question);case 38:return y=t.v,r({response:y}),t.a(3,43);case 39:return g=this.digitalTwin.getTwinSummary(),r({summary:g}),t.a(3,43);case 40:return t.n=41,this.digitalTwin.compareWithPast((null==a?void 0:a.days)||30);case 41:return w=t.v,r({comparison:w}),t.a(3,43);case 42:r({error:"Unknown message type"});case 43:t.n=45;break;case 44:t.p=44,_=t.v,console.error("Error handling message:",_),r({error:_.message});case 45:return t.a(2)}},t,this,[[1,44]])})),function(t,e,n){return b.apply(this,arguments)})},{key:"handleContextUpdate",value:(d=st(it().m(function t(e,n){var r,i,a,o;return it().w(function(t){for(;;)switch(t.n){case 0:if(r=e.url,i=e.title,e.content,!((a=e.timeSpent)<10)){t.n=1;break}return t.a(2);case 1:if((o=this.activeSessions.get(n.id))||(o={url:r,title:i,startTime:Date.now(),tabId:n.id},this.activeSessions.set(n.id,o)),o.lastUpdate=Date.now(),o.context=e,!(a>30)||o.aiProcessed){t.n=2;break}return o.aiProcessed=!0,t.n=2,this.processWithAI(e);case 2:return t.n=3,this.db.updateVisit(e);case 3:return t.a(2)}},t,this)})),function(t,e){return d.apply(this,arguments)})},{key:"processWithAI",value:(m=st(it().m(function t(e){var n,r,i,a,o,s,u,c;return it().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.ai.generateSummary(e.content);case 1:return n=t.v,t.n=2,this.ai.predictTags(e.content,e.title);case 2:return r=t.v,t.n=3,this.ai.extractTopics(e.content);case 3:return i=t.v,t.n=4,this.personalityEngine.analyzeTone(e.content);case 4:return a=t.v,t.n=5,this.personalityEngine.detectEmotionalThemes(e.content);case 5:return o=t.v,t.n=6,this.personalityEngine.analyzeSentiment(e.content);case 6:return s=t.v,t.n=7,this.db.saveAIInsights(e.url,{summary:n,tags:r,topics:i,timestamp:Date.now()});case 7:return t.n=8,this.db.saveMoodData({timestamp:Date.now(),sentiment:s.sentiment,sentimentScore:s.score,emotions:o,tone:a,url:e.url});case 8:return t.n=9,this.digitalTwin.updateTwin({topics:i,tone:a,emotions:o,timestamp:Date.now(),timeSpent:e.timeSpent,category:this.categorizeContent(i)});case 9:return t.n=10,this.goalAlignment.checkAlignment(e.url,e.title,e.content,e.timeSpent);case 10:null!=(u=t.v)&&u.showNudge&&chrome.tabs.query({active:!0,currentWindow:!0},function(t){t[0]&&chrome.tabs.sendMessage(t[0].id,{type:"SHOW_NUDGE",nudge:u})}),console.log("✨ AI processing complete for:",e.url),t.n=12;break;case 11:t.p=11,c=t.v,console.error("AI processing error:",c);case 12:return t.a(2)}},t,this,[[0,11]])})),function(t){return m.apply(this,arguments)})},{key:"categorizeContent",value:function(t){for(var e,n=function(){var e=nt(i[r],2),n=e[0],a=e[1];if(t.some(function(t){return a.some(function(e){return t.toLowerCase().includes(e)})}))return{v:n}},r=0,i=Object.entries({tech:["programming","code","software","development","ai","tech"],learning:["learn","education","tutorial","course","study"],design:["design","ui","ux","creative","art"],business:["business","startup","marketing","finance"],entertainment:["gaming","movies","music","entertainment"],news:["news","current","events","politics"],personal:["health","wellness","lifestyle","personal"]});r<i.length;r++)if(e=n())return e.v;return"other"}},{key:"generateWeeklySnapshot",value:(p=st(it().m(function t(){var e,n,r,i,a,o,s,u;return it().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,console.log("📸 Generating weekly personality snapshot..."),t.n=1,this.db.getWeeklyData();case 1:return e=t.v,t.n=2,this.personalityEngine.generateWeeklySnapshot(e);case 2:return n=t.v,t.n=3,this.personalityEngine.generateWeeklyQuote(n);case 3:return r=t.v,n.quoteOfWeek=r,t.n=4,this.db.savePersonalitySnapshot(n);case 4:return t.n=5,this.db.getPersonalitySnapshots(10);case 5:return i=t.v,a=this.personalityEngine.detectTrendingInterests({topics:e.topics},i.map(function(t){return{topics:t.topTopics}})),o=(new Date).toISOString().slice(0,7),s=a.map(function(t){return{topic:t.topic,period:o,count:t.currentCount,totalTime:0,trendScore:t.trendScore,status:t.status}}),t.n=6,this.db.saveInterestEvolution(s);case 6:console.log("✅ Weekly snapshot generated successfully"),t.n=8;break;case 7:t.p=7,u=t.v,console.error("Weekly snapshot error:",u);case 8:return t.a(2)}},t,this,[[0,7]])})),function(){return p.apply(this,arguments)})},{key:"updateMoodTracking",value:(h=st(it().m(function t(){return it().w(function(t){for(;;)switch(t.n){case 0:console.log("💭 Mood tracking update");case 1:return t.a(2)}},t)})),function(){return h.apply(this,arguments)})},{key:"handleTabLoad",value:(f=st(it().m(function t(e,n){var r;return it().w(function(t){for(;;)switch(t.n){case 0:if(n.url&&!n.url.startsWith("chrome://")){t.n=1;break}return t.a(2);case 1:return t.n=2,this.db.getVisitHistory(n.url);case 2:(r=t.v)&&r.visit_count>0&&console.log("🔮 Returning user to: ".concat(n.url," (").concat(r.visit_count," previous visits)"));case 3:return t.a(2)}},t,this)})),function(t,e){return f.apply(this,arguments)})},{key:"handleTabClose",value:(l=st(it().m(function t(e){var n;return it().w(function(t){for(;;)switch(t.n){case 0:if(!(n=this.activeSessions.get(e))||!n.context){t.n=2;break}return t.n=1,this.db.updateVisit(n.context);case 1:this.activeSessions.delete(e);case 2:return t.a(2)}},t,this)})),function(t){return l.apply(this,arguments)})},{key:"handlePageUnload",value:(c=st(it().m(function t(e,n){return it().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.updateVisit(e);case 1:this.activeSessions.delete(n.id);case 2:return t.a(2)}},t,this)})),function(t,e){return c.apply(this,arguments)})},{key:"saveHighlight",value:(u=st(it().m(function t(e){return it().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.saveHighlight(e);case 1:return t.a(2)}},t,this)})),function(t){return u.apply(this,arguments)})},{key:"getPreviousContext",value:(s=st(it().m(function t(e){var n,r,i;return it().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.getVisitHistory(e);case 1:return n=t.v,t.n=2,this.db.getHighlights(e);case 2:return r=t.v,t.n=3,this.db.getAIInsights(e);case 3:if(i=t.v,n){t.n=4;break}return t.a(2,null);case 4:return t.a(2,{visits:n.visit_count||0,lastVisit:n.last_visit,totalTimeSpent:n.total_time_spent||0,highlights:r.slice(0,5),tags:(null==i?void 0:i.tags)||[],summary:null==i?void 0:i.summary})}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"getMemories",value:(o=st(it().m(function t(){var e,n=arguments;return it().w(function(t){for(;;)switch(t.n){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:{},t.n=1,this.db.getMemories(e);case 1:return t.a(2,t.v)}},t,this)})),function(){return o.apply(this,arguments)})},{key:"searchMemories",value:(a=st(it().m(function t(e){var n,r;return it().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.getMemories();case 1:return n=t.v,r=n.filter(function(t){var n=t.highlights.map(function(t){return t.text||""}).join(" ");return"".concat(t.title," ").concat(n).toLowerCase().includes(e.toLowerCase())}),t.a(2,r.sort(function(t,n){var r=t.title.toLowerCase().split(e.toLowerCase()).length;return n.title.toLowerCase().split(e.toLowerCase()).length-r}))}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"addTag",value:(i=st(it().m(function t(e,n){return it().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.addTag(e,n);case 1:return t.a(2)}},t,this)})),function(t,e){return i.apply(this,arguments)})},{key:"getStats",value:(r=st(it().m(function t(){return it().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.getStats();case 1:return t.a(2,t.v)}},t,this)})),function(){return r.apply(this,arguments)})},{key:"exportData",value:(n=st(it().m(function t(){return it().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.exportData();case 1:return t.a(2,t.v)}},t,this)})),function(){return n.apply(this,arguments)})},{key:"importData",value:(e=st(it().m(function t(e){return it().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.importData(e);case 1:return t.a(2,t.v)}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"performCleanup",value:(t=st(it().m(function t(){return it().w(function(t){for(;;)switch(t.n){case 0:return console.log("🧹 Performing cleanup..."),t.n=1,this.db.cleanup();case 1:return t.a(2)}},t,this)})),function(){return t.apply(this,arguments)})}]);var t,e,n,r,i,a,o,s,u,c,l,f,h,p,m,d,b,y}())})()})();