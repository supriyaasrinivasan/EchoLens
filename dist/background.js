/*! For license information please see background.js.LICENSE.txt */
(()=>{var t={234:()=>{},490:()=>{},826:(t,e,n)=>{t=n.nmd(t);var r=void 0,i=function(e){return r||(r=new Promise(function(r,i){var a,o=void 0!==e?e:{},s=o.onAbort;o.onAbort=function(t){i(new Error(t)),s&&s(t)},o.postRun=o.postRun||[],o.postRun.push(function(){r(o)}),t=void 0,a||=void 0!==o?o:{};var u="object"==typeof window,c="undefined"!=typeof WorkerGlobalScope,l="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node&&"renderer"!=process.type;a.onRuntimeInitialized=function(){function t(t,e){switch(typeof e){case"boolean":Q(t,e?1:0);break;case"number":H(t,e);break;case"string":Y(t,e,-1,-1);break;case"object":if(null===e)W(t);else if(null!=e.length){var n=ge(e,ye);z(t,n,e.length,-1),Oe(n)}else $(t,"Wrong API use : tried to return a value of an unknown type ("+e+").",-1);break;default:W(t)}}function e(t,e){for(var n=[],r=0;r<t;r+=1){var i=X(e+4*r,"i32"),a=M(i);if(1===a||2===a)i=q(i);else if(3===a)i=G(i);else if(4===a){i=U(a=i),a=x(a);for(var o=new Uint8Array(i),s=0;s<i;s+=1)o[s]=T[a+s];i=o}else i=null;n.push(i)}return n}function n(t,e){this.Qa=t,this.db=e,this.Oa=1,this.lb=[]}function r(t,e){if(this.db=e,e=nt(t)+1,this.eb=Se(e),null===this.eb)throw Error("Unable to allocate memory for the SQL string");rt(t,_,this.eb,e),this.kb=this.eb,this.Za=this.pb=null}function i(t){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),null!=t){var e=this.filename,n="/",r=e;if(n&&(n="string"==typeof n?n:kt(n),r=e?J(n+"/"+e):n),r=function(t,e=438){return qt(t,4095&e|32768,0)}(r,e=ft(!0,!0)),t){if("string"==typeof t){n=Array(t.length);for(var i=0,a=t.length;i<a;++i)n[i]=t.charCodeAt(i);t=n}Kt(r,146|e),ee(n=Jt(r,577),t,0,t.length,0),$t(n),Kt(r,e)}}this.handleError(u(this.filename,o)),this.db=X(o,"i32"),tt(this.db),this.fb={},this.Sa={}}var o=Re(4),s=a.cwrap,u=s("sqlite3_open","number",["string","number"]),c=s("sqlite3_close_v2","number",["number"]),l=s("sqlite3_exec","number",["number","string","number","number","number"]),f=s("sqlite3_changes","number",["number"]),h=s("sqlite3_prepare_v2","number",["number","string","number","number","number"]),p=s("sqlite3_sql","string",["number"]),m=s("sqlite3_normalized_sql","string",["number"]),d=s("sqlite3_prepare_v2","number",["number","number","number","number","number"]),v=s("sqlite3_bind_text","number",["number","number","number","number","number"]),b=s("sqlite3_bind_blob","number",["number","number","number","number","number"]),y=s("sqlite3_bind_double","number",["number","number","number"]),g=s("sqlite3_bind_int","number",["number","number","number"]),w=s("sqlite3_bind_parameter_index","number",["number","string"]),E=s("sqlite3_step","number",["number"]),k=s("sqlite3_errmsg","string",["number"]),S=s("sqlite3_column_count","number",["number"]),O=s("sqlite3_data_count","number",["number"]),N=s("sqlite3_column_double","number",["number","number"]),A=s("sqlite3_column_text","string",["number","number"]),I=s("sqlite3_column_blob","number",["number","number"]),R=s("sqlite3_column_bytes","number",["number","number"]),L=s("sqlite3_column_type","number",["number","number"]),P=s("sqlite3_column_name","string",["number","number"]),D=s("sqlite3_reset","number",["number"]),j=s("sqlite3_clear_bindings","number",["number"]),C=s("sqlite3_finalize","number",["number"]),F=s("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),M=s("sqlite3_value_type","number",["number"]),U=s("sqlite3_value_bytes","number",["number"]),G=s("sqlite3_value_text","string",["number"]),x=s("sqlite3_value_blob","number",["number"]),q=s("sqlite3_value_double","number",["number"]),H=s("sqlite3_result_double","",["number","number"]),W=s("sqlite3_result_null","",["number"]),Y=s("sqlite3_result_text","",["number","string","number","number"]),z=s("sqlite3_result_blob","",["number","number","number","number"]),Q=s("sqlite3_result_int","",["number","number"]),$=s("sqlite3_result_error","",["number","string","number"]),Z=s("sqlite3_aggregate_context","number",["number","number"]),tt=s("RegisterExtensionFunctions","number",["number"]),et=s("sqlite3_update_hook","number",["number","number","number"]);n.prototype.bind=function(t){if(!this.Qa)throw"Statement closed";return this.reset(),Array.isArray(t)?this.Cb(t):null==t||"object"!=typeof t||this.Db(t)},n.prototype.step=function(){if(!this.Qa)throw"Statement closed";this.Oa=1;var t=E(this.Qa);switch(t){case 100:return!0;case 101:return!1;default:throw this.db.handleError(t)}},n.prototype.wb=function(t){return null==t&&(t=this.Oa,this.Oa+=1),N(this.Qa,t)},n.prototype.Gb=function(t){if(null==t&&(t=this.Oa,this.Oa+=1),t=A(this.Qa,t),"function"!=typeof BigInt)throw Error("BigInt is not supported");return BigInt(t)},n.prototype.Hb=function(t){return null==t&&(t=this.Oa,this.Oa+=1),A(this.Qa,t)},n.prototype.getBlob=function(t){null==t&&(t=this.Oa,this.Oa+=1);var e=R(this.Qa,t);t=I(this.Qa,t);for(var n=new Uint8Array(e),r=0;r<e;r+=1)n[r]=T[t+r];return n},n.prototype.get=function(t,e){e=e||{},null!=t&&this.bind(t)&&this.step(),t=[];for(var n=O(this.Qa),r=0;r<n;r+=1)switch(L(this.Qa,r)){case 1:var i=e.useBigInt?this.Gb(r):this.wb(r);t.push(i);break;case 2:t.push(this.wb(r));break;case 3:t.push(this.Hb(r));break;case 4:t.push(this.getBlob(r));break;default:t.push(null)}return t},n.prototype.getColumnNames=function(){for(var t=[],e=S(this.Qa),n=0;n<e;n+=1)t.push(P(this.Qa,n));return t},n.prototype.getAsObject=function(t,e){t=this.get(t,e),e=this.getColumnNames();for(var n={},r=0;r<e.length;r+=1)n[e[r]]=t[r];return n},n.prototype.getSQL=function(){return p(this.Qa)},n.prototype.getNormalizedSQL=function(){return m(this.Qa)},n.prototype.run=function(t){return null!=t&&this.bind(t),this.step(),this.reset()},n.prototype.sb=function(t,e){null==e&&(e=this.Oa,this.Oa+=1),t=it(t);var n=ge(t,ye);this.lb.push(n),this.db.handleError(v(this.Qa,e,n,t.length-1,0))},n.prototype.Bb=function(t,e){null==e&&(e=this.Oa,this.Oa+=1);var n=ge(t,ye);this.lb.push(n),this.db.handleError(b(this.Qa,e,n,t.length,0))},n.prototype.rb=function(t,e){null==e&&(e=this.Oa,this.Oa+=1),this.db.handleError((t===(0|t)?g:y)(this.Qa,e,t))},n.prototype.Eb=function(t){null==t&&(t=this.Oa,this.Oa+=1),b(this.Qa,t,0,0,0)},n.prototype.tb=function(t,e){switch(null==e&&(e=this.Oa,this.Oa+=1),typeof t){case"string":return void this.sb(t,e);case"number":return void this.rb(t,e);case"bigint":return void this.sb(t.toString(),e);case"boolean":return void this.rb(t+0,e);case"object":if(null===t)return void this.Eb(e);if(null!=t.length)return void this.Bb(t,e)}throw"Wrong API use : tried to bind a value of an unknown type ("+t+")."},n.prototype.Db=function(t){var e=this;return Object.keys(t).forEach(function(n){var r=w(e.Qa,n);0!==r&&e.tb(t[n],r)}),!0},n.prototype.Cb=function(t){for(var e=0;e<t.length;e+=1)this.tb(t[e],e+1);return!0},n.prototype.reset=function(){return this.freemem(),0===j(this.Qa)&&0===D(this.Qa)},n.prototype.freemem=function(){for(var t;void 0!==(t=this.lb.pop());)Oe(t)},n.prototype.free=function(){this.freemem();var t=0===C(this.Qa);return delete this.db.fb[this.Qa],this.Qa=0,t},r.prototype.next=function(){if(null===this.eb)return{done:!0};if(null!==this.Za&&(this.Za.free(),this.Za=null),!this.db.db)throw this.mb(),Error("Database closed");var t=Le(),e=Re(4);B(o),B(e);try{this.db.handleError(d(this.db.db,this.kb,-1,o,e)),this.kb=X(e,"i32");var r=X(o,"i32");return 0===r?(this.mb(),{done:!0}):(this.Za=new n(r,this.db),this.db.fb[r]=this.Za,{value:this.Za,done:!1})}catch(t){throw this.pb=K(this.kb),this.mb(),t}finally{Ie(t)}},r.prototype.mb=function(){Oe(this.eb),this.eb=null},r.prototype.getRemainingSQL=function(){return null!==this.pb?this.pb:K(this.kb)},"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator&&(r.prototype[Symbol.iterator]=function(){return this}),i.prototype.run=function(t,e){if(!this.db)throw"Database closed";if(e){t=this.prepare(t,e);try{t.step()}finally{t.free()}}else this.handleError(l(this.db,t,0,0,o));return this},i.prototype.exec=function(t,e,r){if(!this.db)throw"Database closed";var i=Le(),a=null;try{var s=be(t),u=Re(4);for(t=[];0!==X(s,"i8");){B(o),B(u),this.handleError(d(this.db,s,-1,o,u));var c=X(o,"i32");if(s=X(u,"i32"),0!==c){var l=null;for(a=new n(c,this),null!=e&&a.bind(e);a.step();)null===l&&(l={columns:a.getColumnNames(),values:[]},t.push(l)),l.values.push(a.get(null,r));a.free()}}return t}catch(t){throw a&&a.free(),t}finally{Ie(i)}},i.prototype.each=function(t,e,n,r,i){"function"==typeof e&&(r=n,n=e,e=void 0),t=this.prepare(t,e);try{for(;t.step();)n(t.getAsObject(null,i))}finally{t.free()}if("function"==typeof r)return r()},i.prototype.prepare=function(t,e){if(B(o),this.handleError(h(this.db,t,-1,o,0)),0===(t=X(o,"i32")))throw"Nothing to prepare";var r=new n(t,this);return null!=e&&r.bind(e),this.fb[t]=r},i.prototype.iterateStatements=function(t){return new r(t,this)},i.prototype.export=function(){Object.values(this.fb).forEach(function(t){t.free()}),Object.values(this.Sa).forEach(Ee),this.Sa={},this.handleError(c(this.db));var t=function(t){var e,n="binary";if("utf8"!==n&&"binary"!==n)throw Error(`Invalid encoding type "${n}"`);var r=Jt(t,r||0);t=zt(t).size;var i=new Uint8Array(t);return te(r,i,0,t,0),"utf8"===n?e=V(i):"binary"===n&&(e=i),$t(r),e}(this.filename);return this.handleError(u(this.filename,o)),this.db=X(o,"i32"),tt(this.db),t},i.prototype.close=function(){null!==this.db&&(Object.values(this.fb).forEach(function(t){t.free()}),Object.values(this.Sa).forEach(Ee),this.Sa={},this.Ya&&(Ee(this.Ya),this.Ya=void 0),this.handleError(c(this.db)),Bt("/"+this.filename),this.db=null)},i.prototype.handleError=function(t){if(0===t)return null;throw t=k(this.db),Error(t)},i.prototype.getRowsModified=function(){return f(this.db)},i.prototype.create_function=function(n,r){Object.prototype.hasOwnProperty.call(this.Sa,n)&&(Ee(this.Sa[n]),delete this.Sa[n]);var i=Te(function(n,i,a){i=e(i,a);try{var o=r.apply(null,i)}catch(t){return void $(n,t,-1)}t(n,o)},"viii");return this.Sa[n]=i,this.handleError(F(this.db,n,r.length,1,0,i,0,0,0)),this},i.prototype.create_aggregate=function(n,r){var i=r.init||function(){return null},a=r.finalize||function(t){return t},o=r.step;if(!o)throw"An aggregate function must have a step function in "+n;var s={};Object.hasOwnProperty.call(this.Sa,n)&&(Ee(this.Sa[n]),delete this.Sa[n]),r=n+"__finalize",Object.hasOwnProperty.call(this.Sa,r)&&(Ee(this.Sa[r]),delete this.Sa[r]);var u=Te(function(t,n,r){var a=Z(t,1);Object.hasOwnProperty.call(s,a)||(s[a]=i()),n=e(n,r),n=[s[a]].concat(n);try{s[a]=o.apply(null,n)}catch(e){delete s[a],$(t,e,-1)}},"viii"),c=Te(function(e){var n=Z(e,1);try{var r=a(s[n])}catch(t){return delete s[n],void $(e,t,-1)}t(e,r),delete s[n]},"vi");return this.Sa[n]=u,this.Sa[r]=c,this.handleError(F(this.db,n,o.length-1,1,0,0,u,c,0)),this},i.prototype.updateHook=function(t){this.Ya&&(et(this.db,0,0),Ee(this.Ya),this.Ya=void 0),t&&(this.Ya=Te(function(e,n,r,i,a){switch(n){case 18:e="insert";break;case 23:e="update";break;case 9:e="delete";break;default:throw"unknown operationCode in updateHook callback: "+n}if(r=r?V(_,r):"",i=i?V(_,i):"",a>Number.MAX_SAFE_INTEGER)throw"rowId too big to fit inside a Number";t(e,r,i,Number(a))},"viiiij"),et(this.db,this.Ya,0))},a.Database=i};var f,h,p={...a},m="./this.program",d=(t,e)=>{throw e},v="";if(l){var b=n(490);n(234),v="//",h=t=>(t=P(t)?new URL(t):t,b.readFileSync(t)),f=async t=>(t=P(t)?new URL(t):t,b.readFileSync(t,void 0)),!a.thisProgram&&1<process.argv.length&&(m=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),t.exports=a,d=(t,e)=>{throw process.exitCode=t,e}}else(u||c)&&(c?v=self.location.href:"undefined"!=typeof document&&document.currentScript&&(v=document.currentScript.src),v=v.startsWith("blob:")?"":v.slice(0,v.replace(/[?#].*/,"").lastIndexOf("/")+1),c&&(h=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),f=async t=>{if(P(t))return new Promise((e,n)=>{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?e(r.response):n(r.status)},r.onerror=n,r.send(null)});var e=await fetch(t,{credentials:"same-origin"});if(e.ok)return e.arrayBuffer();throw Error(e.status+" : "+e.url)});var y=a.print||console.log.bind(console),g=a.printErr||console.error.bind(console);Object.assign(a,p),p=null,a.thisProgram&&(m=a.thisProgram);var w,E,T,_,k,S,O,N,A,I,R=a.wasmBinary,L=!1,P=t=>t.startsWith("file://");function D(){var t=w.buffer;a.HEAP8=T=new Int8Array(t),a.HEAP16=k=new Int16Array(t),a.HEAPU8=_=new Uint8Array(t),a.HEAPU16=new Uint16Array(t),a.HEAP32=S=new Int32Array(t),a.HEAPU32=O=new Uint32Array(t),a.HEAPF32=N=new Float32Array(t),a.HEAPF64=I=new Float64Array(t),a.HEAP64=A=new BigInt64Array(t),a.HEAPU64=new BigUint64Array(t)}var j,C=0,F=null;function M(t){throw a.onAbort?.(t),g(t="Aborted("+t+")"),L=!0,new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info.")}async function U(t,e){try{var n=await async function(t){if(!R)try{var e=await f(t);return new Uint8Array(e)}catch{}if(t==j&&R)t=new Uint8Array(R);else{if(!h)throw"both async and sync fetching of the wasm failed";t=h(t)}return t}(t);return await WebAssembly.instantiate(n,e)}catch(t){g(`failed to asynchronously prepare wasm: ${t}`),M(t)}}class G{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var x=t=>{for(;0<t.length;)t.shift()(a)},q=[],H=[],W=()=>{var t=a.preRun.shift();H.unshift(t)};function X(t,e="i8"){switch(e.endsWith("*")&&(e="*"),e){case"i1":case"i8":return T[t];case"i16":return k[t>>1];case"i32":return S[t>>2];case"i64":return A[t>>3];case"float":return N[t>>2];case"double":return I[t>>3];case"*":return O[t>>2];default:M(`invalid type for getValue: ${e}`)}}var Y=a.noExitRuntime||!0;function B(t){var e="i32";switch(e.endsWith("*")&&(e="*"),e){case"i1":case"i8":T[t]=0;break;case"i16":k[t>>1]=0;break;case"i32":S[t>>2]=0;break;case"i64":A[t>>3]=BigInt(0);break;case"float":N[t>>2]=0;break;case"double":I[t>>3]=0;break;case"*":O[t>>2]=0;break;default:M(`invalid type for setValue: ${e}`)}}var z="undefined"!=typeof TextDecoder?new TextDecoder:void 0,V=(t,e=0,n=NaN)=>{var r=e+n;for(n=e;t[n]&&!(n>=r);)++n;if(16<n-e&&t.buffer&&z)return z.decode(t.subarray(e,n));for(r="";e<n;){var i=t[e++];if(128&i){var a=63&t[e++];if(192==(224&i))r+=String.fromCharCode((31&i)<<6|a);else{var o=63&t[e++];65536>(i=224==(240&i)?(15&i)<<12|a<<6|o:(7&i)<<18|a<<12|o<<6|63&t[e++])?r+=String.fromCharCode(i):(i-=65536,r+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else r+=String.fromCharCode(i)}return r},K=(t,e)=>t?V(_,t,e):"",Q=(t,e)=>{for(var n=0,r=t.length-1;0<=r;r--){var i=t[r];"."===i?t.splice(r,1):".."===i?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n;n--)t.unshift("..");return t},J=t=>{var e="/"===t.charAt(0),n="/"===t.slice(-1);return(t=Q(t.split("/").filter(t=>!!t),!e).join("/"))||e||(t="."),t&&n&&(t+="/"),(e?"/":"")+t},$=t=>{var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(t).slice(1);return t=e[0],e=e[1],t||e?(e&&=e.slice(0,-1),t+e):"."},Z=t=>t&&t.match(/([^\/]+|\/)\/*$/)[1],tt=t=>{(tt=(()=>{if(l){var t=n(920);return e=>t.randomFillSync(e)}return t=>crypto.getRandomValues(t)})())(t)},et=[],nt=t=>{for(var e=0,n=0;n<t.length;++n){var r=t.charCodeAt(n);127>=r?e++:2047>=r?e+=2:55296<=r&&57343>=r?(e+=4,++n):e+=3}return e},rt=(t,e,n,r)=>{if(!(0<r))return 0;var i=n;r=n+r-1;for(var a=0;a<t.length;++a){var o=t.charCodeAt(a);if(55296<=o&&57343>=o)o=65536+((1023&o)<<10)|1023&t.charCodeAt(++a);if(127>=o){if(n>=r)break;e[n++]=o}else{if(2047>=o){if(n+1>=r)break;e[n++]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;e[n++]=224|o>>12}else{if(n+3>=r)break;e[n++]=240|o>>18,e[n++]=128|o>>12&63}e[n++]=128|o>>6&63}e[n++]=128|63&o}}return e[n]=0,n-i},it=(t,e)=>{var n=Array(nt(t)+1);return t=rt(t,n,0,n.length),e&&(n.length=t),n},at=[];function ot(t,e){at[t]={input:[],output:[],cb:e},Gt(t,st)}var st={open(t){var e=at[t.node.rdev];if(!e)throw new wt(43);t.tty=e,t.seekable=!1},close(t){t.tty.cb.fsync(t.tty)},fsync(t){t.tty.cb.fsync(t.tty)},read(t,e,n,r){if(!t.tty||!t.tty.cb.xb)throw new wt(60);for(var i=0,a=0;a<r;a++){try{var o=t.tty.cb.xb(t.tty)}catch(t){throw new wt(29)}if(void 0===o&&0===i)throw new wt(6);if(null==o)break;i++,e[n+a]=o}return i&&(t.node.atime=Date.now()),i},write(t,e,n,r){if(!t.tty||!t.tty.cb.qb)throw new wt(60);try{for(var i=0;i<r;i++)t.tty.cb.qb(t.tty,e[n+i])}catch(t){throw new wt(29)}return r&&(t.node.mtime=t.node.ctime=Date.now()),i}},ut={xb(){t:{if(!et.length){var t=null;if(l){var e=Buffer.alloc(256),n=0,r=process.stdin.fd;try{n=b.readSync(r,e,0,256)}catch(t){if(!t.toString().includes("EOF"))throw t;n=0}0<n&&(t=e.slice(0,n).toString("utf-8"))}else"undefined"!=typeof window&&"function"==typeof window.prompt&&(null!==(t=window.prompt("Input: "))&&(t+="\n"));if(!t){t=null;break t}et=it(t,!0)}t=et.shift()}return t},qb(t,e){null===e||10===e?(y(V(t.output)),t.output=[]):0!=e&&t.output.push(e)},fsync(t){0<t.output?.length&&(y(V(t.output)),t.output=[])},Tb:()=>({Ob:25856,Qb:5,Nb:191,Pb:35387,Mb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}),Ub:()=>0,Vb:()=>[24,80]},ct={qb(t,e){null===e||10===e?(g(V(t.output)),t.output=[]):0!=e&&t.output.push(e)},fsync(t){0<t.output?.length&&(g(V(t.output)),t.output=[])}},lt={Wa:null,Xa:()=>lt.createNode(null,"/",16895,0),createNode(t,e,n,r){if(24576==(61440&n)||4096==(61440&n))throw new wt(63);return lt.Wa||(lt.Wa={dir:{node:{Ta:lt.La.Ta,Ua:lt.La.Ua,lookup:lt.La.lookup,hb:lt.La.hb,rename:lt.La.rename,unlink:lt.La.unlink,rmdir:lt.La.rmdir,readdir:lt.La.readdir,symlink:lt.La.symlink},stream:{Va:lt.Ma.Va}},file:{node:{Ta:lt.La.Ta,Ua:lt.La.Ua},stream:{Va:lt.Ma.Va,read:lt.Ma.read,write:lt.Ma.write,ib:lt.Ma.ib,jb:lt.Ma.jb}},link:{node:{Ta:lt.La.Ta,Ua:lt.La.Ua,readlink:lt.La.readlink},stream:{}},ub:{node:{Ta:lt.La.Ta,Ua:lt.La.Ua},stream:Ut}}),It((n=At(t,e,n,r)).mode)?(n.La=lt.Wa.dir.node,n.Ma=lt.Wa.dir.stream,n.Na={}):32768==(61440&n.mode)?(n.La=lt.Wa.file.node,n.Ma=lt.Wa.file.stream,n.Ra=0,n.Na=null):40960==(61440&n.mode)?(n.La=lt.Wa.link.node,n.Ma=lt.Wa.link.stream):8192==(61440&n.mode)&&(n.La=lt.Wa.ub.node,n.Ma=lt.Wa.ub.stream),n.atime=n.mtime=n.ctime=Date.now(),t&&(t.Na[e]=n,t.atime=t.mtime=t.ctime=n.atime),n},Sb:t=>t.Na?t.Na.subarray?t.Na.subarray(0,t.Ra):new Uint8Array(t.Na):new Uint8Array(0),La:{Ta(t){var e={};return e.dev=8192==(61440&t.mode)?t.id:1,e.ino=t.id,e.mode=t.mode,e.nlink=1,e.uid=0,e.gid=0,e.rdev=t.rdev,It(t.mode)?e.size=4096:32768==(61440&t.mode)?e.size=t.Ra:40960==(61440&t.mode)?e.size=t.link.length:e.size=0,e.atime=new Date(t.atime),e.mtime=new Date(t.mtime),e.ctime=new Date(t.ctime),e.blksize=4096,e.blocks=Math.ceil(e.size/e.blksize),e},Ua(t,e){for(var n of["mode","atime","mtime","ctime"])null!=e[n]&&(t[n]=e[n]);void 0!==e.size&&(e=e.size,t.Ra!=e&&(0==e?(t.Na=null,t.Ra=0):(n=t.Na,t.Na=new Uint8Array(e),n&&t.Na.set(n.subarray(0,Math.min(e,t.Ra))),t.Ra=e)))},lookup(){throw lt.vb},hb:(t,e,n,r)=>lt.createNode(t,e,n,r),rename(t,e,n){try{var r=Nt(e,n)}catch(t){}if(r){if(It(t.mode))for(var i in r.Na)throw new wt(55);Ot(r)}delete t.parent.Na[t.name],e.Na[n]=t,t.name=n,e.ctime=e.mtime=t.parent.ctime=t.parent.mtime=Date.now()},unlink(t,e){delete t.Na[e],t.ctime=t.mtime=Date.now()},rmdir(t,e){var n,r=Nt(t,e);for(n in r.Na)throw new wt(55);delete t.Na[e],t.ctime=t.mtime=Date.now()},readdir:t=>[".","..",...Object.keys(t.Na)],symlink:(t,e,n)=>((t=lt.createNode(t,e,41471,0)).link=n,t),readlink(t){if(40960!=(61440&t.mode))throw new wt(28);return t.link}},Ma:{read(t,e,n,r,i){var a=t.node.Na;if(i>=t.node.Ra)return 0;if(8<(t=Math.min(t.node.Ra-i,r))&&a.subarray)e.set(a.subarray(i,i+t),n);else for(r=0;r<t;r++)e[n+r]=a[i+r];return t},write(t,e,n,r,i,a){if(e.buffer===T.buffer&&(a=!1),!r)return 0;if((t=t.node).mtime=t.ctime=Date.now(),e.subarray&&(!t.Na||t.Na.subarray)){if(a)return t.Na=e.subarray(n,n+r),t.Ra=r;if(0===t.Ra&&0===i)return t.Na=e.slice(n,n+r),t.Ra=r;if(i+r<=t.Ra)return t.Na.set(e.subarray(n,n+r),i),r}a=i+r;var o=t.Na?t.Na.length:0;if(o>=a||(a=Math.max(a,o*(1048576>o?2:1.125)>>>0),0!=o&&(a=Math.max(a,256)),o=t.Na,t.Na=new Uint8Array(a),0<t.Ra&&t.Na.set(o.subarray(0,t.Ra),0)),t.Na.subarray&&e.subarray)t.Na.set(e.subarray(n,n+r),i);else for(a=0;a<r;a++)t.Na[i+a]=e[n+a];return t.Ra=Math.max(t.Ra,i+r),r},Va(t,e,n){if(1===n?e+=t.position:2===n&&32768==(61440&t.node.mode)&&(e+=t.node.Ra),0>e)throw new wt(28);return e},ib(t,e,n,r,i){if(32768!=(61440&t.node.mode))throw new wt(43);if(t=t.node.Na,2&i||!t||t.buffer!==T.buffer){i=!0,r=65536*Math.ceil(e/65536);var a=Ne(65536,r);if(a&&_.fill(0,a,a+r),!(r=a))throw new wt(48);t&&((0<n||n+e<t.length)&&(t=t.subarray?t.subarray(n,n+e):Array.prototype.slice.call(t,n,n+e)),T.set(t,r))}else i=!1,r=t.byteOffset;return{Kb:r,Ab:i}},jb:(t,e,n,r)=>(lt.Ma.write(t,e,0,r,n,!1),0)}},ft=(t,e)=>{var n=0;return t&&(n|=365),e&&(n|=146),n},ht=null,pt={},mt=[],dt=1,vt=null,bt=!1,yt=!0,gt={},wt=class{name="ErrnoError";constructor(t){this.Pa=t}},Et=class{gb={};node=null;get flags(){return this.gb.flags}set flags(t){this.gb.flags=t}get position(){return this.gb.position}set position(t){this.gb.position=t}},Tt=class{La={};Ma={};ab=null;constructor(t,e,n,r){t||=this,this.parent=t,this.Xa=t.Xa,this.id=dt++,this.name=e,this.mode=n,this.rdev=r,this.atime=this.mtime=this.ctime=Date.now()}get read(){return!(365&~this.mode)}set read(t){t?this.mode|=365:this.mode&=-366}get write(){return!(146&~this.mode)}set write(t){t?this.mode|=146:this.mode&=-147}};function _t(t,e={}){if(!t)throw new wt(44);e.nb??(e.nb=!0),"/"===t.charAt(0)||(t="//"+t);var n=0;t:for(;40>n;n++){t=t.split("/").filter(t=>!!t);for(var r=ht,i="/",a=0;a<t.length;a++){var o=a===t.length-1;if(o&&e.parent)break;if("."!==t[a])if(".."===t[a])i=$(i),r=r.parent;else{i=J(i+"/"+t[a]);try{r=Nt(r,t[a])}catch(t){if(44===t?.Pa&&o&&e.Jb)return{path:i};throw t}if(!r.ab||o&&!e.nb||(r=r.ab.root),40960==(61440&r.mode)&&(!o||e.$a)){if(!r.La.readlink)throw new wt(52);"/"===(r=r.La.readlink(r)).charAt(0)||(r=$(i)+"/"+r),t=r+"/"+t.slice(a+1).join("/");continue t}}}return{path:i,node:r}}throw new wt(32)}function kt(t){for(var e;;){if(t===t.parent)return t=t.Xa.zb,e?"/"!==t[t.length-1]?`${t}/${e}`:t+e:t;e=e?`${t.name}/${e}`:t.name,t=t.parent}}function St(t,e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r)|0;return(t+n>>>0)%vt.length}function Ot(t){var e=St(t.parent.id,t.name);if(vt[e]===t)vt[e]=t.bb;else for(e=vt[e];e;){if(e.bb===t){e.bb=t.bb;break}e=e.bb}}function Nt(t,e){var n=It(t.mode)?(n=Lt(t,"x"))?n:t.La.lookup?0:2:54;if(n)throw new wt(n);for(n=vt[St(t.id,e)];n;n=n.bb){var r=n.name;if(n.parent.id===t.id&&r===e)return n}return t.La.lookup(t,e)}function At(t,e,n,r){return e=St((t=new Tt(t,e,n,r)).parent.id,t.name),t.bb=vt[e],vt[e]=t}function It(t){return 16384==(61440&t)}function Rt(t){var e=["r","w","rw"][3&t];return 512&t&&(e+="w"),e}function Lt(t,e){return yt?0:!e.includes("r")||292&t.mode?e.includes("w")&&!(146&t.mode)||e.includes("x")&&!(73&t.mode)?2:0:2}function Pt(t,e){if(!It(t.mode))return 54;try{return Nt(t,e),20}catch(t){}return Lt(t,"wx")}function Dt(t,e,n){try{var r=Nt(t,e)}catch(t){return t.Pa}if(t=Lt(t,"wx"))return t;if(n){if(!It(r.mode))return 54;if(r===r.parent||"/"===kt(r))return 10}else if(It(r.mode))return 31;return 0}function jt(t){if(!t)throw new wt(63);return t}function Ct(t){if(!(t=mt[t]))throw new wt(8);return t}function Ft(t,e=-1){if(t=Object.assign(new Et,t),-1==e)t:{for(e=0;4096>=e;e++)if(!mt[e])break t;throw new wt(33)}return t.fd=e,mt[e]=t}function Mt(t,e,n){var r=t?.Ma.Ua;t=r?t:e,r??=e.La.Ua,jt(r),r(t,n)}var Ut={open(t){t.Ma=pt[t.node.rdev].Ma,t.Ma.open?.(t)},Va(){throw new wt(70)}};function Gt(t,e){pt[t]={Ma:e}}function xt(t,e){var n="/"===e;if(n&&ht)throw new wt(10);if(!n&&e){var r=_t(e,{nb:!1});if(e=r.path,(r=r.node).ab)throw new wt(10);if(!It(r.mode))throw new wt(54)}e={type:t,Wb:{},zb:e,Ib:[]},(t=t.Xa(e)).Xa=e,e.root=t,n?ht=t:r&&(r.ab=e,r.Xa&&r.Xa.Ib.push(e))}function qt(t,e,n){var r=_t(t,{parent:!0}).node;if(!(t=Z(t)))throw new wt(28);if("."===t||".."===t)throw new wt(20);var i=Pt(r,t);if(i)throw new wt(i);if(!r.La.hb)throw new wt(63);return r.La.hb(r,t,e,n)}function Ht(t,e=511){return qt(t,1023&e|16384,0)}function Wt(t,e,n){void 0===n&&(n=e,e=438),qt(t,8192|e,n)}function Xt(t,e){if(!((...t)=>{for(var e="",n=!1,r=t.length-1;-1<=r&&!n;r--){if("string"!=typeof(n=0<=r?t[r]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,n="/"===n.charAt(0)}return(n?"/":"")+(e=Q(e.split("/").filter(t=>!!t),!n).join("/"))||"."})(t))throw new wt(44);var n=_t(e,{parent:!0}).node;if(!n)throw new wt(44);var r=Pt(n,e=Z(e));if(r)throw new wt(r);if(!n.La.symlink)throw new wt(63);n.La.symlink(n,e,t)}function Yt(t){var e=_t(t,{parent:!0}).node,n=Nt(e,t=Z(t)),r=Dt(e,t,!0);if(r)throw new wt(r);if(!e.La.rmdir)throw new wt(63);if(n.ab)throw new wt(10);e.La.rmdir(e,t),Ot(n)}function Bt(t){var e=_t(t,{parent:!0}).node;if(!e)throw new wt(44);var n=Nt(e,t=Z(t)),r=Dt(e,t,!1);if(r)throw new wt(r);if(!e.La.unlink)throw new wt(63);if(n.ab)throw new wt(10);e.La.unlink(e,t),Ot(n)}function zt(t,e){return jt((t=_t(t,{$a:!e}).node).La.Ta)(t)}function Vt(t,e,n,r){Mt(t,e,{mode:4095&n|-4096&e.mode,ctime:Date.now(),Fb:r})}function Kt(t,e){Vt(null,t="string"==typeof t?_t(t,{$a:!0}).node:t,e)}function Qt(t,e,n){if(It(e.mode))throw new wt(31);if(32768!=(61440&e.mode))throw new wt(28);var r=Lt(e,"w");if(r)throw new wt(r);Mt(t,e,{size:n,timestamp:Date.now()})}function Jt(t,e,n=438){if(""===t)throw new wt(44);if("string"==typeof e){var r={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[e];if(void 0===r)throw Error(`Unknown file open mode: ${e}`);e=r}if(n=64&e?4095&n|32768:0,"object"==typeof t)r=t;else{var i=t.endsWith("/");r=(t=_t(t,{$a:!(131072&e),Jb:!0})).node,t=t.path}var o=!1;if(64&e)if(r){if(128&e)throw new wt(20)}else{if(i)throw new wt(31);r=qt(t,511|n,0),o=!0}if(!r)throw new wt(44);if(8192==(61440&r.mode)&&(e&=-513),65536&e&&!It(r.mode))throw new wt(54);if(!o&&(i=r?40960==(61440&r.mode)?32:It(r.mode)&&("r"!==Rt(e)||576&e)?31:Lt(r,Rt(e)):44))throw new wt(i);return 512&e&&!o&&Qt(null,i="string"==typeof(i=r)?_t(i,{$a:!0}).node:i,0),e&=-131713,(i=Ft({node:r,path:kt(r),flags:e,seekable:!0,position:0,Ma:r.Ma,Lb:[],error:!1})).Ma.open&&i.Ma.open(i),o&&Kt(r,511&n),!a.logReadFiles||1&e||t in gt||(gt[t]=1),i}function $t(t){if(null===t.fd)throw new wt(8);t.ob&&(t.ob=null);try{t.Ma.close&&t.Ma.close(t)}catch(t){throw t}finally{mt[t.fd]=null}t.fd=null}function Zt(t,e,n){if(null===t.fd)throw new wt(8);if(!t.seekable||!t.Ma.Va)throw new wt(70);if(0!=n&&1!=n&&2!=n)throw new wt(28);t.position=t.Ma.Va(t,e,n),t.Lb=[]}function te(t,e,n,r,i){if(0>r||0>i)throw new wt(28);if(null===t.fd)throw new wt(8);if(1==(2097155&t.flags))throw new wt(8);if(It(t.node.mode))throw new wt(31);if(!t.Ma.read)throw new wt(28);var a=void 0!==i;if(a){if(!t.seekable)throw new wt(70)}else i=t.position;return e=t.Ma.read(t,e,n,r,i),a||(t.position+=e),e}function ee(t,e,n,r,i){if(0>r||0>i)throw new wt(28);if(null===t.fd)throw new wt(8);if(!(2097155&t.flags))throw new wt(8);if(It(t.node.mode))throw new wt(31);if(!t.Ma.write)throw new wt(28);t.seekable&&1024&t.flags&&Zt(t,0,2);var a=void 0!==i;if(a){if(!t.seekable)throw new wt(70)}else i=t.position;return e=t.Ma.write(t,e,n,r,i,void 0),a||(t.position+=e),e}function ne(t,e,n){t=J("/dev/"+t);var r=ft(!!e,!!n);ne.yb??(ne.yb=64);var i=ne.yb++<<8;Gt(i,{open(t){t.seekable=!1},close(){n?.buffer?.length&&n(10)},read(t,n,r,i){for(var a=0,o=0;o<i;o++){try{var s=e()}catch(t){throw new wt(29)}if(void 0===s&&0===a)throw new wt(6);if(null==s)break;a++,n[r+o]=s}return a&&(t.node.atime=Date.now()),a},write(t,e,r,i){for(var a=0;a<i;a++)try{n(e[r+a])}catch(t){throw new wt(29)}return i&&(t.node.mtime=t.node.ctime=Date.now()),a}}),Wt(t,r,i)}function re(t,e,n){if("/"===e.charAt(0))return e;if(t=-100===t?"/":Ct(t).path,0==e.length){if(!n)throw new wt(44);return t}return t+"/"+e}function ie(t,e){S[t>>2]=e.dev,S[t+4>>2]=e.mode,O[t+8>>2]=e.nlink,S[t+12>>2]=e.uid,S[t+16>>2]=e.gid,S[t+20>>2]=e.rdev,A[t+24>>3]=BigInt(e.size),S[t+32>>2]=4096,S[t+36>>2]=e.blocks;var n=e.atime.getTime(),r=e.mtime.getTime(),i=e.ctime.getTime();return A[t+40>>3]=BigInt(Math.floor(n/1e3)),O[t+48>>2]=n%1e3*1e6,A[t+56>>3]=BigInt(Math.floor(r/1e3)),O[t+64>>2]=r%1e3*1e6,A[t+72>>3]=BigInt(Math.floor(i/1e3)),O[t+80>>2]=i%1e3*1e6,A[t+88>>3]=BigInt(e.ino),0}var ae,oe,se,ue=void 0,ce=()=>{var t=S[+ue>>2];return ue+=4,t},le=0,fe=[0,31,60,91,121,152,182,213,244,274,305,335],he=[0,31,59,90,120,151,181,212,243,273,304,334],pe={},me=t=>{E=t,Y||0<le||(a.onExit?.(t),L=!0),d(t,new G(t))},de={},ve=()=>{if(!ae){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:m||"./this.program"};for(t in de)void 0===de[t]?delete e[t]:e[t]=de[t];var n=[];for(t in e)n.push(`${t}=${e[t]}`);ae=n}return ae},be=t=>{var e=nt(t)+1,n=Re(e);return rt(t,_,n,e),n},ye=0,ge=(t,e)=>(e=1==e?Re(t.length):Se(t.length),t.subarray||t.slice||(t=new Uint8Array(t)),_.set(t,e),e),we=[],Ee=t=>{oe.delete(se.get(t)),se.set(t,null),we.push(t)},Te=(t,e)=>{if(!oe){oe=new WeakMap;var n=se.length;if(oe)for(var r=0;r<0+n;r++){var i=se.get(r);i&&oe.set(i,r)}}if(n=oe.get(t)||0)return n;if(we.length)n=we.pop();else{try{se.grow(1)}catch(t){if(!(t instanceof RangeError))throw t;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}n=se.length-1}try{se.set(n,t)}catch(u){if(!(u instanceof TypeError))throw u;if("function"==typeof WebAssembly.Function){var a=WebAssembly.Function;r={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},i={parameters:[],results:"v"==e[0]?[]:[r[e[0]]]};for(var o=1;o<e.length;++o)i.parameters.push(r[e[o]]);e=new a(i,t)}else{r=[1],i=e.slice(0,1),e=e.slice(1),o={i:127,p:127,j:126,f:125,d:124,e:111},r.push(96);var s=e.length;for(a of(128>s?r.push(s):r.push(s%128|128,s>>7),e))r.push(o[a]);"v"==i?r.push(0):r.push(1,o[i]),e=[0,97,115,109,1,0,0,0,1],128>(a=r.length)?e.push(a):e.push(a%128|128,a>>7),e.push(...r),e.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),e=new WebAssembly.Module(new Uint8Array(e)),e=new WebAssembly.Instance(e,{e:{f:t}}).exports.f}se.set(n,e)}return oe.set(t,n),n};vt=Array(4096),xt(lt,"/"),Ht("/tmp"),Ht("/home"),Ht("/home/web_user"),function(){Ht("/dev"),Gt(259,{read:()=>0,write:(t,e,n,r)=>r,Va:()=>0}),Wt("/dev/null",259),ot(1280,ut),ot(1536,ct),Wt("/dev/tty",1280),Wt("/dev/tty1",1536);var t=new Uint8Array(1024),e=0,n=()=>(0===e&&(tt(t),e=t.byteLength),t[--e]);ne("random",n),ne("urandom",n),Ht("/dev/shm"),Ht("/dev/shm/tmp")}(),function(){Ht("/proc");var t=Ht("/proc/self");Ht("/proc/self/fd"),xt({Xa(){var e=At(t,"fd",16895,73);return e.Ma={Va:lt.Ma.Va},e.La={lookup(t,e){var n=Ct(t=+e);return(t={parent:null,Xa:{zb:"fake"},La:{readlink:()=>n.path},id:t+1}).parent=t},readdir:()=>Array.from(mt.entries()).filter(([,t])=>t).map(([t])=>t.toString())},e}},"/proc/self/fd")}(),lt.vb=new wt(44),lt.vb.stack="<generic error, no stack>";var _e,ke={a:(t,e,n,r)=>M(`Assertion failed: ${t?V(_,t):""}, at: `+[e?e?V(_,e):"":"unknown filename",n,r?r?V(_,r):"":"unknown function"]),i:function(t,e){try{return Kt(t=t?V(_,t):"",e),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},L:function(t,e,n){try{if(e=re(t,e=e?V(_,e):""),-8&n)return-28;var r=_t(e,{$a:!0}).node;return r?(t="",4&n&&(t+="r"),2&n&&(t+="w"),1&n&&(t+="x"),t&&Lt(r,t)?-2:0):-44}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},j:function(t,e){try{var n=Ct(t);return Vt(n,n.node,e,!1),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},h:function(t){try{var e=Ct(t);return Mt(e,e.node,{timestamp:Date.now(),Fb:!1}),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},b:function(t,e,n){ue=n;try{var r=Ct(t);switch(e){case 0:var i=ce();if(0>i)break;for(;mt[i];)i++;return function(t,e=-1){return t=Ft(t,e),t.Ma?.Rb?.(t),t}(r,i).fd;case 1:case 2:case 13:case 14:return 0;case 3:return r.flags;case 4:return i=ce(),r.flags|=i,0;case 12:return i=ce(),k[i+0>>1]=2,0}return-28}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},g:function(t,e){try{var n=Ct(t),r=n.node,i=n.Ma.Ta;return t=i?n:r,i??=r.La.Ta,jt(i),ie(e,i(t))}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},H:function(t,e){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e);try{if(isNaN(e))return 61;var n=Ct(t);if(0>e||!(2097155&n.flags))throw new wt(28);return Qt(n,n.node,e),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},G:function(t,e){try{if(0===e)return-28;var n=nt("/")+1;return e<n?-68:(rt("/",_,t,e),n)}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},K:function(t,e){try{return ie(e,zt(t=t?V(_,t):"",!0))}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},C:function(t,e,n){try{return Ht(e=re(t,e=e?V(_,e):""),n),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},J:function(t,e,n,r){try{e=e?V(_,e):"";var i=256&r;return e=re(t,e,4096&r),ie(n,i?zt(e,!0):zt(e))}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},x:function(t,e,n,r){ue=r;try{return Jt(e=re(t,e=e?V(_,e):""),n,r?ce():0).fd}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},v:function(t,e,n,r){try{if(e=re(t,e=e?V(_,e):""),0>=r)return-28;var i=_t(e).node;if(!i)throw new wt(44);if(!i.La.readlink)throw new wt(28);var a=i.La.readlink(i),o=Math.min(r,nt(a)),s=T[n+o];return rt(a,_,n,r+1),T[n+o]=s,o}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},u:function(t){try{return Yt(t=t?V(_,t):""),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},f:function(t,e){try{return ie(e,zt(t=t?V(_,t):""))}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},r:function(t,e,n){try{return e=re(t,e=e?V(_,e):""),0===n?Bt(e):512===n?Yt(e):M("Invalid flags passed to unlinkat"),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},q:function(t,e,n){try{e=re(t,e=e?V(_,e):"",!0);var r,i,a=Date.now();if(n){var o=O[n>>2]+4294967296*S[n+4>>2],s=S[n+8>>2];r=1073741823==s?a:1073741822==s?null:1e3*o+s/1e6,o=O[(n+=16)>>2]+4294967296*S[n+4>>2],i=1073741823==(s=S[n+8>>2])?a:1073741822==s?null:1e3*o+s/1e6}else i=r=a;if(null!==(i??r)){t=r;var u=_t(e,{$a:!0}).node;jt(u.La.Ua)(u,{atime:t,mtime:i})}return 0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},m:()=>M(""),l:()=>{Y=!1,le=0},A:function(t,e){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t),t=new Date(1e3*t),S[e>>2]=t.getSeconds(),S[e+4>>2]=t.getMinutes(),S[e+8>>2]=t.getHours(),S[e+12>>2]=t.getDate(),S[e+16>>2]=t.getMonth(),S[e+20>>2]=t.getFullYear()-1900,S[e+24>>2]=t.getDay();var n=t.getFullYear();S[e+28>>2]=(0!=n%4||0==n%100&&0!=n%400?he:fe)[t.getMonth()]+t.getDate()-1|0,S[e+36>>2]=-60*t.getTimezoneOffset(),n=new Date(t.getFullYear(),6,1).getTimezoneOffset();var r=new Date(t.getFullYear(),0,1).getTimezoneOffset();S[e+32>>2]=0|(n!=r&&t.getTimezoneOffset()==Math.min(r,n))},y:function(t,e,n,r,i,a,o){i=-9007199254740992>i||9007199254740992<i?NaN:Number(i);try{if(isNaN(i))return 61;var s=Ct(r);if(2&e&&!(2&n)&&2!=(2097155&s.flags))throw new wt(2);if(1==(2097155&s.flags))throw new wt(2);if(!s.Ma.ib)throw new wt(43);if(!t)throw new wt(28);var u=s.Ma.ib(s,t,i,e,n),c=u.Kb;return S[a>>2]=u.Ab,O[o>>2]=c,0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},z:function(t,e,n,r,i,a){a=-9007199254740992>a||9007199254740992<a?NaN:Number(a);try{var o=Ct(i);if(2&n){if(n=a,32768!=(61440&o.node.mode))throw new wt(43);if(!(2&r)){var s=_.slice(t,t+e);o.Ma.jb&&o.Ma.jb(o,s,n,e,r)}}}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},n:(t,e)=>{if(pe[t]&&(clearTimeout(pe[t].id),delete pe[t]),!e)return 0;var n=setTimeout(()=>{delete pe[t],(t=>{if(!L)try{if(t(),!(Y||0<le))try{E=t=E,me(t)}catch(t){t instanceof G||"unwind"==t||d(1,t)}}catch(t){t instanceof G||"unwind"==t||d(1,t)}})(()=>Ae(t,performance.now()))},e);return pe[t]={id:n,Xb:e},0},B:(t,e,n,r)=>{var i=(new Date).getFullYear(),a=new Date(i,0,1).getTimezoneOffset();i=new Date(i,6,1).getTimezoneOffset(),O[t>>2]=60*Math.max(a,i),S[e>>2]=Number(a!=i),t=(e=t=>{var e=Math.abs(t);return`UTC${0<=t?"-":"+"}${String(Math.floor(e/60)).padStart(2,"0")}${String(e%60).padStart(2,"0")}`})(a),e=e(i),i<a?(rt(t,_,n,17),rt(e,_,r,17)):(rt(t,_,r,17),rt(e,_,n,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:t=>{var e=_.length;if(2147483648<(t>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=e*(1+.2/n);r=Math.min(r,t+100663296);t:{r=(Math.min(2147483648,65536*Math.ceil(Math.max(t,r)/65536))-w.buffer.byteLength+65535)/65536|0;try{w.grow(r),D();var i=1;break t}catch(t){}i=void 0}if(i)return!0}return!1},E:(t,e)=>{var n=0;return ve().forEach((r,i)=>{var a=e+n;for(i=O[t+4*i>>2]=a,a=0;a<r.length;++a)T[i++]=r.charCodeAt(a);T[i]=0,n+=r.length+1}),0},F:(t,e)=>{var n=ve();O[t>>2]=n.length;var r=0;return n.forEach(t=>r+=t.length+1),O[e>>2]=r,0},e:function(t){try{return $t(Ct(t)),0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},p:function(t,e){try{var n=Ct(t);return T[e]=n.tty?2:It(n.mode)?3:40960==(61440&n.mode)?7:4,k[e+2>>1]=0,A[e+8>>3]=BigInt(0),A[e+16>>3]=BigInt(0),0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},w:function(t,e,n,r){try{t:{var i=Ct(t);t=e;for(var a,o=e=0;o<n;o++){var s=O[t>>2],u=O[t+4>>2];t+=8;var c=te(i,T,s,u,a);if(0>c){var l=-1;break t}if(e+=c,c<u)break;void 0!==a&&(a+=c)}l=e}return O[r>>2]=l,0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},D:function(t,e,n,r){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e);try{if(isNaN(e))return 61;var i=Ct(t);return Zt(i,e,n),A[r>>3]=BigInt(i.position),i.ob&&0===e&&0===n&&(i.ob=null),0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},I:function(t){try{var e=Ct(t);return e.Ma?.fsync?e.Ma.fsync(e):0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},t:function(t,e,n,r){try{t:{var i=Ct(t);t=e;for(var a,o=e=0;o<n;o++){var s=O[t>>2],u=O[t+4>>2];t+=8;var c=ee(i,T,s,u,a);if(0>c){var l=-1;break t}if(e+=c,c<u)break;void 0!==a&&(a+=c)}l=e}return O[r>>2]=l,0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},k:me};!async function(){function t(t){return _e=t.exports,w=_e.M,D(),se=_e.O,C--,a.monitorRunDependencies?.(C),0==C&&F&&(t=F,F=null,t()),_e}C++,a.monitorRunDependencies?.(C);var e={a:ke};a.instantiateWasm?new Promise(n=>{a.instantiateWasm(e,(e,r)=>{t(e),n(e.exports)})}):(j??=a.locateFile?a.locateFile("sql-wasm.wasm",v):v+"sql-wasm.wasm",t((await async function(t){var e=j;if(!R&&"function"==typeof WebAssembly.instantiateStreaming&&!P(e)&&!l)try{var n=fetch(e,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(n,t)}catch(t){g(`wasm streaming compile failed: ${t}`),g("falling back to ArrayBuffer instantiation")}return U(e,t)}(e)).instance))}(),a._sqlite3_free=t=>(a._sqlite3_free=_e.P)(t),a._sqlite3_value_text=t=>(a._sqlite3_value_text=_e.Q)(t),a._sqlite3_prepare_v2=(t,e,n,r,i)=>(a._sqlite3_prepare_v2=_e.R)(t,e,n,r,i),a._sqlite3_step=t=>(a._sqlite3_step=_e.S)(t),a._sqlite3_reset=t=>(a._sqlite3_reset=_e.T)(t),a._sqlite3_exec=(t,e,n,r,i)=>(a._sqlite3_exec=_e.U)(t,e,n,r,i),a._sqlite3_finalize=t=>(a._sqlite3_finalize=_e.V)(t),a._sqlite3_column_name=(t,e)=>(a._sqlite3_column_name=_e.W)(t,e),a._sqlite3_column_text=(t,e)=>(a._sqlite3_column_text=_e.X)(t,e),a._sqlite3_column_type=(t,e)=>(a._sqlite3_column_type=_e.Y)(t,e),a._sqlite3_errmsg=t=>(a._sqlite3_errmsg=_e.Z)(t),a._sqlite3_clear_bindings=t=>(a._sqlite3_clear_bindings=_e._)(t),a._sqlite3_value_blob=t=>(a._sqlite3_value_blob=_e.$)(t),a._sqlite3_value_bytes=t=>(a._sqlite3_value_bytes=_e.aa)(t),a._sqlite3_value_double=t=>(a._sqlite3_value_double=_e.ba)(t),a._sqlite3_value_int=t=>(a._sqlite3_value_int=_e.ca)(t),a._sqlite3_value_type=t=>(a._sqlite3_value_type=_e.da)(t),a._sqlite3_result_blob=(t,e,n,r)=>(a._sqlite3_result_blob=_e.ea)(t,e,n,r),a._sqlite3_result_double=(t,e)=>(a._sqlite3_result_double=_e.fa)(t,e),a._sqlite3_result_error=(t,e,n)=>(a._sqlite3_result_error=_e.ga)(t,e,n),a._sqlite3_result_int=(t,e)=>(a._sqlite3_result_int=_e.ha)(t,e),a._sqlite3_result_int64=(t,e)=>(a._sqlite3_result_int64=_e.ia)(t,e),a._sqlite3_result_null=t=>(a._sqlite3_result_null=_e.ja)(t),a._sqlite3_result_text=(t,e,n,r)=>(a._sqlite3_result_text=_e.ka)(t,e,n,r),a._sqlite3_aggregate_context=(t,e)=>(a._sqlite3_aggregate_context=_e.la)(t,e),a._sqlite3_column_count=t=>(a._sqlite3_column_count=_e.ma)(t),a._sqlite3_data_count=t=>(a._sqlite3_data_count=_e.na)(t),a._sqlite3_column_blob=(t,e)=>(a._sqlite3_column_blob=_e.oa)(t,e),a._sqlite3_column_bytes=(t,e)=>(a._sqlite3_column_bytes=_e.pa)(t,e),a._sqlite3_column_double=(t,e)=>(a._sqlite3_column_double=_e.qa)(t,e),a._sqlite3_bind_blob=(t,e,n,r,i)=>(a._sqlite3_bind_blob=_e.ra)(t,e,n,r,i),a._sqlite3_bind_double=(t,e,n)=>(a._sqlite3_bind_double=_e.sa)(t,e,n),a._sqlite3_bind_int=(t,e,n)=>(a._sqlite3_bind_int=_e.ta)(t,e,n),a._sqlite3_bind_text=(t,e,n,r,i)=>(a._sqlite3_bind_text=_e.ua)(t,e,n,r,i),a._sqlite3_bind_parameter_index=(t,e)=>(a._sqlite3_bind_parameter_index=_e.va)(t,e),a._sqlite3_sql=t=>(a._sqlite3_sql=_e.wa)(t),a._sqlite3_normalized_sql=t=>(a._sqlite3_normalized_sql=_e.xa)(t),a._sqlite3_changes=t=>(a._sqlite3_changes=_e.ya)(t),a._sqlite3_close_v2=t=>(a._sqlite3_close_v2=_e.za)(t),a._sqlite3_create_function_v2=(t,e,n,r,i,o,s,u,c)=>(a._sqlite3_create_function_v2=_e.Aa)(t,e,n,r,i,o,s,u,c),a._sqlite3_update_hook=(t,e,n)=>(a._sqlite3_update_hook=_e.Ba)(t,e,n),a._sqlite3_open=(t,e)=>(a._sqlite3_open=_e.Ca)(t,e);var Se=a._malloc=t=>(Se=a._malloc=_e.Da)(t),Oe=a._free=t=>(Oe=a._free=_e.Ea)(t);a._RegisterExtensionFunctions=t=>(a._RegisterExtensionFunctions=_e.Fa)(t);var Ne=(t,e)=>(Ne=_e.Ga)(t,e),Ae=(t,e)=>(Ae=_e.Ha)(t,e),Ie=t=>(Ie=_e.Ia)(t),Re=t=>(Re=_e.Ja)(t),Le=()=>(Le=_e.Ka)();if(a.stackSave=()=>Le(),a.stackRestore=t=>Ie(t),a.stackAlloc=t=>Re(t),a.cwrap=(t,e,n,r)=>{var i=!n||n.every(t=>"number"===t||"boolean"===t);return"string"!==e&&i&&!r?a["_"+t]:(...r)=>((t,e,n,r)=>{var i={string:t=>{var e=0;return null!=t&&0!==t&&(e=be(t)),e},array:t=>{var e=Re(t.length);return T.set(t,e),e}};t=a["_"+t];var o,s=[],u=0;if(r)for(var c=0;c<r.length;c++){var l=i[n[c]];l?(0===u&&(u=Le()),s[c]=l(r[c])):s[c]=r[c]}return n=t(...s),o=n,0!==u&&Ie(u),"string"===e?o?V(_,o):"":"boolean"===e?!!o:o})(t,e,n,r)},a.addFunction=Te,a.removeFunction=Ee,a.UTF8ToString=K,a.ALLOC_NORMAL=ye,a.allocate=ge,a.allocateUTF8OnStack=be,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();return function t(){function e(){if(a.calledRun=!0,!L){var t,e;if(!a.noFSInit&&!bt)bt=!0,n??=a.stdin,t??=a.stdout,e??=a.stderr,n?ne("stdin",n):Xt("/dev/tty","/dev/stdin"),t?ne("stdout",null,t):Xt("/dev/tty","/dev/stdout"),e?ne("stderr",null,e):Xt("/dev/tty1","/dev/stderr"),Jt("/dev/stdin",0),Jt("/dev/stdout",1),Jt("/dev/stderr",1);if(_e.N(),yt=!1,a.onRuntimeInitialized?.(),a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;){var n=a.postRun.shift();q.unshift(n)}x(q)}}if(0<C)F=t;else{if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)W();x(H),0<C?F=t:a.setStatus?(a.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>a.setStatus(""),1),e()},1)):e()}}(),o}))};t.exports=i,t.exports.default=i},920:()=>{}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var a=e[r]={id:r,loaded:!1,exports:{}};return t[r](a,a.exports,n),a.loaded=!0,a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{"use strict";var t=n(826),e=n.n(t);function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||u(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(t,e)||u(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t){var e=Object(t),n=[];for(var r in e)n.unshift(r);return function t(){for(;n.length;)if((r=n.pop())in e)return t.value=r,t.done=!1,t;return t.done=!0,t}}function s(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=u(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function u(t,e){if(t){if("string"==typeof t)return c(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function l(t,e,n){return(e=v(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function f(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return h(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return a=e,s=0,u=t,h.n=n,o}};function p(n,r){for(s=n,u=r,e=0;!f&&c&&!i&&e<l.length;e++){var i,a=l[e],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=t):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(e=s<2?t:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),e=a[i]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,s<2&&(s=0)}else 1===s&&(e=a.return)&&e.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=t}else if((e=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(e){a=t,s=1,u=e}finally{c=1}}return{value:e,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(h(e={},r,function(){return this}),e),p=c.prototype=s.prototype=Object.create(l);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,h(t,i,"GeneratorFunction")),t.prototype=Object.create(p),t}return u.prototype=c,h(p,"constructor",c),h(c,"constructor",u),u.displayName="GeneratorFunction",h(c,i,"GeneratorFunction"),h(p),h(p,i,"Generator"),h(p,r,function(){return this}),h(p,"toString",function(){return"[object Generator]"}),(f=function(){return{w:a,m}})()}function h(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}h=function(t,e,n,r){function a(e,n){h(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},h(t,e,n,r)}function p(t,e,n,r,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function m(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(t){p(a,r,i,o,s,"next",t)}function s(t){p(a,r,i,o,s,"throw",t)}o(void 0)})}}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,v(r.key),r)}}function v(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==r(e)?e:e+""}var b=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.db=null,this.SQL=null,this.dbName="echolens.db",this.isInitialized=!1},n=[{key:"init",value:(U=m(f().m(function t(){var n,r,i;return f().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.isInitialized){t.n=1;break}return t.a(2);case 1:return t.p=1,t.n=2,e()({locateFile:function(t){return chrome.runtime.getURL(t)}});case 2:return this.SQL=t.v,t.n=3,chrome.storage.local.get([this.dbName]);case 3:if(!(n=t.v)[this.dbName]){t.n=4;break}r=new Uint8Array(n[this.dbName]),this.db=new this.SQL.Database(r),console.log("✅ Loaded existing database"),t.n=6;break;case 4:return this.db=new this.SQL.Database,t.n=5,this.createTables();case 5:console.log("✅ Created new database");case 6:this.isInitialized=!0,t.n=8;break;case 7:throw t.p=7,i=t.v,console.error("❌ Database initialization error:",i),i;case 8:return t.a(2)}},t,this,[[1,7]])})),function(){return U.apply(this,arguments)})},{key:"createTables",value:(M=m(f().m(function t(){return f().w(function(t){for(;;)switch(t.n){case 0:return this.db.run("\n      -- Visits table\n      CREATE TABLE IF NOT EXISTS visits (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        url TEXT NOT NULL UNIQUE,\n        url_hash TEXT NOT NULL,\n        title TEXT,\n        first_visit INTEGER NOT NULL,\n        last_visit INTEGER NOT NULL,\n        visit_count INTEGER DEFAULT 0,\n        total_time_spent INTEGER DEFAULT 0,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Sessions table\n      CREATE TABLE IF NOT EXISTS sessions (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        visit_id INTEGER NOT NULL,\n        timestamp INTEGER NOT NULL,\n        time_spent INTEGER DEFAULT 0,\n        scroll_depth REAL DEFAULT 0,\n        interactions INTEGER DEFAULT 0,\n        highlight_count INTEGER DEFAULT 0,\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE\n      );\n\n      -- Highlights table\n      CREATE TABLE IF NOT EXISTS highlights (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        visit_id INTEGER NOT NULL,\n        text TEXT NOT NULL,\n        timestamp INTEGER NOT NULL,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE\n      );\n\n      -- AI Insights table\n      CREATE TABLE IF NOT EXISTS insights (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        visit_id INTEGER NOT NULL UNIQUE,\n        summary TEXT,\n        topics TEXT,\n        timestamp INTEGER NOT NULL,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE\n      );\n\n      -- Tags table\n      CREATE TABLE IF NOT EXISTS tags (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT NOT NULL UNIQUE\n      );\n\n      -- Visit Tags junction table\n      CREATE TABLE IF NOT EXISTS visit_tags (\n        visit_id INTEGER NOT NULL,\n        tag_id INTEGER NOT NULL,\n        PRIMARY KEY (visit_id, tag_id),\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE,\n        FOREIGN KEY (tag_id) REFERENCES tags (id) ON DELETE CASCADE\n      );\n\n      -- Personality Snapshots table (for PersonaSync)\n      CREATE TABLE IF NOT EXISTS personality_snapshots (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        week_start INTEGER NOT NULL,\n        week_end INTEGER NOT NULL,\n        tone TEXT,\n        top_topics TEXT,\n        reading_habits TEXT,\n        emotional_themes TEXT,\n        summary TEXT,\n        total_time_spent INTEGER DEFAULT 0,\n        total_visits INTEGER DEFAULT 0,\n        total_highlights INTEGER DEFAULT 0,\n        dominant_interests TEXT,\n        quote_of_week TEXT,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Interest Evolution table\n      CREATE TABLE IF NOT EXISTS interest_evolution (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        topic TEXT NOT NULL,\n        period TEXT NOT NULL,\n        count INTEGER DEFAULT 0,\n        total_time INTEGER DEFAULT 0,\n        trend_score REAL DEFAULT 0,\n        status TEXT,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Mood Tracking table\n      CREATE TABLE IF NOT EXISTS mood_tracking (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        timestamp INTEGER NOT NULL,\n        sentiment TEXT,\n        sentiment_score REAL DEFAULT 0,\n        emotions TEXT,\n        tone TEXT,\n        url TEXT,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Goals table\n      CREATE TABLE IF NOT EXISTS goals (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        title TEXT NOT NULL,\n        description TEXT,\n        keywords TEXT,\n        priority TEXT DEFAULT 'medium',\n        target_hours REAL DEFAULT 0,\n        actual_hours REAL DEFAULT 0,\n        is_active INTEGER DEFAULT 1,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),\n        last_nudge INTEGER,\n        nudge_count INTEGER DEFAULT 0\n      );\n\n      -- Skills tracking\n      CREATE TABLE IF NOT EXISTS skill_activities (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        url TEXT NOT NULL,\n        skill TEXT NOT NULL,\n        confidence REAL DEFAULT 0,\n        keywords TEXT,\n        time_spent INTEGER DEFAULT 0,\n        timestamp INTEGER NOT NULL,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Achievements\n      CREATE TABLE IF NOT EXISTS achievements (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        achievement_id TEXT NOT NULL UNIQUE,\n        name TEXT NOT NULL,\n        icon TEXT,\n        points INTEGER DEFAULT 0,\n        unlocked_at INTEGER NOT NULL\n      );\n\n      -- Streaks\n      CREATE TABLE IF NOT EXISTS streaks (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        current_streak INTEGER DEFAULT 0,\n        longest_streak INTEGER DEFAULT 0,\n        last_active_date INTEGER NOT NULL,\n        updated_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Focus sessions\n      CREATE TABLE IF NOT EXISTS focus_sessions (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        start_time INTEGER NOT NULL,\n        end_time INTEGER NOT NULL,\n        duration INTEGER NOT NULL,\n        completed BOOLEAN DEFAULT 0,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Reflection prompts and responses\n      CREATE TABLE IF NOT EXISTS reflection_prompts (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        prompt TEXT NOT NULL,\n        timestamp INTEGER NOT NULL,\n        context TEXT\n      );\n\n      CREATE TABLE IF NOT EXISTS reflection_responses (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        prompt_id INTEGER NOT NULL,\n        response TEXT NOT NULL,\n        timestamp INTEGER NOT NULL,\n        FOREIGN KEY (prompt_id) REFERENCES reflection_prompts (id)\n      );\n\n      -- Weekly challenges\n      CREATE TABLE IF NOT EXISTS weekly_challenges (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        challenge_id TEXT NOT NULL,\n        week_start INTEGER NOT NULL,\n        progress INTEGER DEFAULT 0,\n        target INTEGER NOT NULL,\n        completed BOOLEAN DEFAULT 0\n      );\n\n      -- Feature usage tracking\n      CREATE TABLE IF NOT EXISTS feature_usage (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        feature_name TEXT NOT NULL,\n        usage_count INTEGER DEFAULT 0,\n        last_used INTEGER NOT NULL\n      );\n\n      -- Twin interactions\n      CREATE TABLE IF NOT EXISTS twin_interactions (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        question TEXT NOT NULL,\n        answer TEXT NOT NULL,\n        confidence TEXT,\n        timestamp INTEGER NOT NULL\n      );\n\n      -- Indexes for better performance\n      CREATE INDEX IF NOT EXISTS idx_visits_url_hash ON visits(url_hash);\n      CREATE INDEX IF NOT EXISTS idx_visits_last_visit ON visits(last_visit);\n      CREATE INDEX IF NOT EXISTS idx_sessions_visit_id ON sessions(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_highlights_visit_id ON highlights(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_insights_visit_id ON insights(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_visit_tags_visit_id ON visit_tags(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_visit_tags_tag_id ON visit_tags(tag_id);\n      CREATE INDEX IF NOT EXISTS idx_personality_snapshots_week ON personality_snapshots(week_start);\n      CREATE INDEX IF NOT EXISTS idx_interest_evolution_period ON interest_evolution(period);\n      CREATE INDEX IF NOT EXISTS idx_mood_tracking_timestamp ON mood_tracking(timestamp);\n    "),t.n=1,this.saveDatabase();case 1:return t.a(2)}},t,this)})),function(){return M.apply(this,arguments)})},{key:"saveDatabase",value:(F=m(f().m(function t(){var e,n;return f().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.db){t.n=1;break}return t.a(2);case 1:return t.p=1,e=this.db.export(),t.n=2,chrome.storage.local.set(l({},this.dbName,Array.from(e)));case 2:t.n=4;break;case 3:t.p=3,n=t.v,console.error("❌ Error saving database:",n);case 4:return t.a(2)}},t,this,[[1,3]])})),function(){return F.apply(this,arguments)})},{key:"hashURL",value:function(t){return t.replace(/[^a-zA-Z0-9]/g,"_").substring(0,100)}},{key:"getOrCreateVisit",value:(C=m(f().m(function t(e,n){var r,i,a,o,s;return f().w(function(t){for(;;)if(0===t.n)return r=this.hashURL(e),(i=this.db.prepare("SELECT * FROM visits WHERE url_hash = ?")).bind([r]),a=null,i.step()&&(a=i.getAsObject()),i.free(),a||(o=Date.now(),this.db.run("INSERT INTO visits (url, url_hash, title, first_visit, last_visit, visit_count) VALUES (?, ?, ?, ?, ?, ?)",[e,r,n,o,o,0]),(s=this.db.prepare("SELECT * FROM visits WHERE url_hash = ?")).bind([r]),s.step()&&(a=s.getAsObject()),s.free()),t.a(2,a)},t,this)})),function(t,e){return C.apply(this,arguments)})},{key:"updateVisit",value:(j=m(f().m(function t(e){var n,r,i,a,o,s,u,c;return f().w(function(t){for(;;)switch(t.n){case 0:return n=e.url,r=e.title,i=e.timeSpent,a=e.scrollDepth,o=e.interactions,s=e.highlights,t.n=1,this.getOrCreateVisit(n,r);case 1:return u=t.v,c=Date.now(),this.db.run("UPDATE visits \n       SET last_visit = ?, \n           visit_count = visit_count + 1, \n           total_time_spent = total_time_spent + ?,\n           title = ?\n       WHERE id = ?",[c,i||0,r,u.id]),this.db.run("INSERT INTO sessions (visit_id, timestamp, time_spent, scroll_depth, interactions, highlight_count)\n       VALUES (?, ?, ?, ?, ?, ?)",[u.id,c,i||0,a||0,o||0,(null==s?void 0:s.length)||0]),this.db.run("DELETE FROM sessions \n       WHERE visit_id = ? \n       AND id NOT IN (\n         SELECT id FROM sessions \n         WHERE visit_id = ? \n         ORDER BY timestamp DESC \n         LIMIT 50\n       )",[u.id,u.id]),t.n=2,this.saveDatabase();case 2:return t.a(2,u)}},t,this)})),function(t){return j.apply(this,arguments)})},{key:"getVisitHistory",value:(D=m(f().m(function t(e){var n,r,i,a,o;return f().w(function(t){for(;;)switch(t.n){case 0:if(n=this.hashURL(e),(r=this.db.prepare("\n      SELECT v.*, \n             (SELECT COUNT(*) FROM sessions WHERE visit_id = v.id) as session_count\n      FROM visits v\n      WHERE v.url_hash = ?\n    ")).bind([n]),i=null,r.step()&&(i=r.getAsObject()),r.free(),i){t.n=1;break}return t.a(2,null);case 1:for((a=this.db.prepare("\n      SELECT * FROM sessions \n      WHERE visit_id = ? \n      ORDER BY timestamp DESC \n      LIMIT 50\n    ")).bind([i.id]),o=[];a.step();)o.push(a.getAsObject());return a.free(),i.sessions=o,t.a(2,i)}},t,this)})),function(t){return D.apply(this,arguments)})},{key:"saveHighlight",value:(P=m(f().m(function t(e){var n,r,i,a,o;return f().w(function(t){for(;;)switch(t.n){case 0:return n=e.text,r=e.url,i=e.title,a=e.timestamp,t.n=1,this.getOrCreateVisit(r,i);case 1:return o=t.v,this.db.run("INSERT INTO highlights (visit_id, text, timestamp) VALUES (?, ?, ?)",[o.id,n,a||Date.now()]),this.db.run("DELETE FROM highlights \n       WHERE visit_id = ? \n       AND id NOT IN (\n         SELECT id FROM highlights \n         WHERE visit_id = ? \n         ORDER BY timestamp DESC \n         LIMIT 100\n       )",[o.id,o.id]),t.n=2,this.saveDatabase();case 2:return t.a(2)}},t,this)})),function(t){return P.apply(this,arguments)})},{key:"getHighlights",value:(L=m(f().m(function t(e){var n,r,i;return f().w(function(t){for(;;)if(0===t.n){for(n=this.hashURL(e),(r=this.db.prepare("\n      SELECT h.* \n      FROM highlights h\n      JOIN visits v ON h.visit_id = v.id\n      WHERE v.url_hash = ?\n      ORDER BY h.timestamp DESC\n      LIMIT 100\n    ")).bind([n]),i=[];r.step();)i.push(r.getAsObject());return r.free(),t.a(2,i)}},t,this)})),function(t){return L.apply(this,arguments)})},{key:"saveAIInsights",value:(R=m(f().m(function t(e,n){var r,i,a,o,u,c;return f().w(function(t){for(;;)switch(t.p=t.n){case 0:return this.hashURL(e),t.n=1,this.getOrCreateVisit(e,"");case 1:if(r=t.v,JSON.stringify(n.tags||[]),i=JSON.stringify(n.topics||[]),this.db.run("INSERT INTO insights (visit_id, summary, topics, timestamp)\n       VALUES (?, ?, ?, ?)\n       ON CONFLICT(visit_id) DO UPDATE SET\n         summary = excluded.summary,\n         topics = excluded.topics,\n         timestamp = excluded.timestamp",[r.id,n.summary||"",i,n.timestamp||Date.now()]),!(n.tags&&n.tags.length>0)){t.n=8;break}a=s(n.tags),t.p=2,a.s();case 3:if((o=a.n()).done){t.n=5;break}return u=o.value,t.n=4,this.addTag(e,u);case 4:t.n=3;break;case 5:t.n=7;break;case 6:t.p=6,c=t.v,a.e(c);case 7:return t.p=7,a.f(),t.f(7);case 8:return t.n=9,this.saveDatabase();case 9:return t.a(2)}},t,this,[[2,6,7,8]])})),function(t,e){return R.apply(this,arguments)})},{key:"getAIInsights",value:(I=m(f().m(function t(e){var n,r,i;return f().w(function(t){for(;;)switch(t.n){case 0:if(n=this.hashURL(e),(r=this.db.prepare("\n      SELECT i.* \n      FROM insights i\n      JOIN visits v ON i.visit_id = v.id\n      WHERE v.url_hash = ?\n    ")).bind([n]),i=null,r.step()&&(i=r.getAsObject()).topics&&(i.topics=JSON.parse(i.topics)),r.free(),!i){t.n=2;break}return t.n=1,this.getTags(e);case 1:i.tags=t.v;case 2:return t.a(2,i)}},t,this)})),function(t){return I.apply(this,arguments)})},{key:"addTag",value:(A=m(f().m(function t(e,n){var r,i,a,o;return f().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.getOrCreateVisit(e,"");case 1:r=t.v,i=null,(a=this.db.prepare("SELECT id FROM tags WHERE name = ?")).bind([n]),a.step()&&(i=a.getAsObject().id),a.free(),i||(this.db.run("INSERT INTO tags (name) VALUES (?)",[n]),(o=this.db.prepare("SELECT id FROM tags WHERE name = ?")).bind([n]),o.step()&&(i=o.getAsObject().id),o.free());try{this.db.run("INSERT OR IGNORE INTO visit_tags (visit_id, tag_id) VALUES (?, ?)",[r.id,i])}catch(t){}return t.n=2,this.saveDatabase();case 2:return t.a(2)}},t,this)})),function(t,e){return A.apply(this,arguments)})},{key:"getTags",value:(N=m(f().m(function t(e){var n,r,i;return f().w(function(t){for(;;)if(0===t.n){for(n=this.hashURL(e),(r=this.db.prepare("\n      SELECT t.name \n      FROM tags t\n      JOIN visit_tags vt ON t.id = vt.tag_id\n      JOIN visits v ON vt.visit_id = v.id\n      WHERE v.url_hash = ?\n    ")).bind([n]),i=[];r.step();)i.push(r.getAsObject().name);return r.free(),t.a(2,i)}},t,this)})),function(t){return N.apply(this,arguments)})},{key:"getMemories",value:(O=m(f().m(function t(){var e,n,r,i,a,o,s,u,c,l,h,p,m=arguments;return f().w(function(t){for(;;)switch(t.n){case 0:n="\n      SELECT v.*\n      FROM visits v\n      WHERE 1=1\n    ",r=[],(e=m.length>0&&void 0!==m[0]?m[0]:{}).minVisits&&(n+=" AND v.visit_count >= ?",r.push(e.minVisits)),e.minTimeSpent&&(n+=" AND v.total_time_spent >= ?",r.push(e.minTimeSpent)),e.dateFrom&&(n+=" AND v.last_visit >= ?",r.push(e.dateFrom)),e.tag&&(n+=" AND v.id IN (\n        SELECT vt.visit_id FROM visit_tags vt\n        JOIN tags t ON vt.tag_id = t.id\n        WHERE t.name = ?\n      )",r.push(e.tag)),n+=" ORDER BY v.last_visit DESC",(i=this.db.prepare(n)).bind(r),a=[];case 1:if(!i.step()){t.n=5;break}return o=i.getAsObject(),(s=this.db.prepare("SELECT COUNT(*) as count FROM highlights WHERE visit_id = ?")).bind([o.id]),s.step()&&s.getAsObject().count,s.free(),t.n=2,this.getTags(o.url);case 2:return u=t.v,t.n=3,this.getAIInsights(o.url);case 3:for(c=t.v,(l=this.db.prepare("\n        SELECT * FROM sessions \n        WHERE visit_id = ? \n        ORDER BY timestamp DESC \n        LIMIT 10\n      ")).bind([o.id]),h=[];l.step();)h.push(l.getAsObject());return l.free(),t.n=4,this.getHighlights(o.url);case 4:p=t.v,a.push({url:o.url,title:o.title,visits:o.visit_count,lastVisit:o.last_visit,firstVisit:o.first_visit,totalTimeSpent:o.total_time_spent,highlights:p,insights:c,tags:u,sessions:h}),t.n=1;break;case 5:return i.free(),t.a(2,a)}},t,this)})),function(){return O.apply(this,arguments)})},{key:"getStats",value:(S=m(f().m(function t(){var e,n,r;return f().w(function(t){for(;;)if(0===t.n)return e={totalVisits:0,totalTimeSpent:0,totalHighlights:0,totalSessions:0,thisWeekVisits:0,averageTimePerVisit:0},(n=this.db.prepare("SELECT COUNT(*) as count FROM visits")).step()&&(e.totalVisits=n.getAsObject().count),n.free(),(n=this.db.prepare("SELECT SUM(total_time_spent) as total FROM visits")).step()&&(e.totalTimeSpent=n.getAsObject().total||0),n.free(),(n=this.db.prepare("SELECT COUNT(*) as count FROM highlights")).step()&&(e.totalHighlights=n.getAsObject().count),n.free(),(n=this.db.prepare("SELECT SUM(visit_count) as total FROM visits")).step()&&(e.totalSessions=n.getAsObject().total||0),n.free(),r=Date.now()-6048e5,(n=this.db.prepare("SELECT COUNT(*) as count FROM visits WHERE last_visit >= ?")).bind([r]),n.step()&&(e.thisWeekVisits=n.getAsObject().count),n.free(),e.totalSessions>0&&(e.averageTimePerVisit=Math.floor(e.totalTimeSpent/e.totalSessions)),t.a(2,e)},t,this)})),function(){return S.apply(this,arguments)})},{key:"exportData",value:(k=m(f().m(function t(){var e;return f().w(function(t){for(;;)if(0===t.n)return e=this.db.export(),t.a(2,{database:Array.from(e),exportDate:Date.now(),version:"2.0"})},t,this)})),function(){return k.apply(this,arguments)})},{key:"importData",value:(_=m(f().m(function t(e){var n,r;return f().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,"2.0"!==e.version||!e.database){t.n=2;break}return n=new Uint8Array(e.database),this.db=new this.SQL.Database(n),t.n=1,this.saveDatabase();case 1:t.n=3;break;case 2:if(!e.visits){t.n=3;break}return t.n=3,this.migrateFromChromeStorage(e);case 3:t.n=5;break;case 4:throw t.p=4,r=t.v,console.error("Import error:",r),r;case 5:return t.a(2)}},t,this,[[0,4]])})),function(t){return _.apply(this,arguments)})},{key:"migrateFromChromeStorage",value:(T=m(f().m(function t(e){var n,r,i,a,u,c,l,h,p,m,d,v,b,y,g,w,E,T,_,k,S,O,N,A,I,R,L,P;return f().w(function(t){for(;;)switch(t.p=t.n){case 0:if(console.log("🔄 Migrating from chrome.storage..."),!e.visits){t.n=3;break}k=o(e.visits);case 1:if((S=k()).done){t.n=3;break}return n=S.value,r=e.visits[n],t.n=2,this.getOrCreateVisit(r.url,r.title);case 2:if(i=t.v,this.db.run("UPDATE visits \n           SET first_visit = ?, last_visit = ?, visit_count = ?, total_time_spent = ?\n           WHERE id = ?",[r.firstVisit,r.lastVisit,r.visits,r.totalTimeSpent,i.id]),r.sessions){a=s(r.sessions);try{for(a.s();!(u=a.n()).done;)c=u.value,this.db.run("INSERT INTO sessions (visit_id, timestamp, time_spent, scroll_depth, interactions, highlight_count)\n               VALUES (?, ?, ?, ?, ?, ?)",[i.id,c.timestamp,c.timeSpent||0,c.scrollDepth||0,c.interactions||0,c.highlightCount||0])}catch(t){a.e(t)}finally{a.f()}}t.n=1;break;case 3:if(!e.highlights){t.n=6;break}O=o(e.highlights);case 4:if((N=O()).done){t.n=6;break}return l=N.value,h=e.highlights[l],t.n=5,this.getOrCreateVisit(h.url,h.title);case 5:if(p=t.v,h.items){m=s(h.items);try{for(m.s();!(d=m.n()).done;)v=d.value,this.db.run("INSERT INTO highlights (visit_id, text, timestamp) VALUES (?, ?, ?)",[p.id,v.text,v.timestamp])}catch(t){m.e(t)}finally{m.f()}}t.n=4;break;case 6:if(!e.insights){t.n=9;break}A=o(e.insights);case 7:if((I=A()).done){t.n=9;break}return b=I.value,y=e.insights[b],t.n=8,this.saveAIInsights(y.url,y);case 8:t.n=7;break;case 9:if(!e.tags){t.n=18;break}R=o(e.tags);case 10:if((L=R()).done){t.n=18;break}if(g=L.value,!(w=e.tags[g]).tags){t.n=17;break}E=s(w.tags),t.p=11,E.s();case 12:if((T=E.n()).done){t.n=14;break}return _=T.value,t.n=13,this.addTag(w.url,_);case 13:t.n=12;break;case 14:t.n=16;break;case 15:t.p=15,P=t.v,E.e(P);case 16:return t.p=16,E.f(),t.f(16);case 17:t.n=10;break;case 18:return t.n=19,this.saveDatabase();case 19:console.log("✅ Migration complete");case 20:return t.a(2)}},t,this,[[11,15,16,17]])})),function(t){return T.apply(this,arguments)})},{key:"cleanup",value:(E=m(f().m(function t(){var e;return f().w(function(t){for(;;)switch(t.n){case 0:return e=Date.now()-31536e6,this.db.run("DELETE FROM sessions WHERE timestamp < ?",[e]),this.db.run("\n      DELETE FROM tags \n      WHERE id NOT IN (SELECT DISTINCT tag_id FROM visit_tags)\n    "),t.n=1,this.saveDatabase();case 1:return t.a(2)}},t,this)})),function(){return E.apply(this,arguments)})},{key:"savePersonalitySnapshot",value:(w=m(f().m(function t(e){return f().w(function(t){for(;;)switch(t.n){case 0:return this.db.run("INSERT INTO personality_snapshots (\n        week_start, week_end, tone, top_topics, reading_habits, \n        emotional_themes, summary, total_time_spent, total_visits, \n        total_highlights, dominant_interests, quote_of_week\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",[e.weekStart,e.weekEnd,e.tone,JSON.stringify(e.topTopics),e.readingHabits,JSON.stringify(e.emotionalThemes),e.summary,e.totalTimeSpent,e.totalVisits,e.totalHighlights,JSON.stringify(e.dominantInterests),e.quoteOfWeek||""]),t.n=1,this.saveDatabase();case 1:return t.a(2)}},t,this)})),function(t){return w.apply(this,arguments)})},{key:"getPersonalitySnapshots",value:(g=m(f().m(function t(){var e,n,r,i,a=arguments;return f().w(function(t){for(;;)if(0===t.n){for(e=a.length>0&&void 0!==a[0]?a[0]:10,(n=this.db.prepare("\n      SELECT * FROM personality_snapshots \n      ORDER BY week_start DESC \n      LIMIT ?\n    ")).bind([e]),r=[];n.step();)i=n.getAsObject(),r.push({id:i.id,weekStart:i.week_start,weekEnd:i.week_end,tone:i.tone,topTopics:JSON.parse(i.top_topics||"[]"),readingHabits:i.reading_habits,emotionalThemes:JSON.parse(i.emotional_themes||"[]"),summary:i.summary,totalTimeSpent:i.total_time_spent,totalVisits:i.total_visits,totalHighlights:i.total_highlights,dominantInterests:JSON.parse(i.dominant_interests||"[]"),quoteOfWeek:i.quote_of_week,createdAt:i.created_at});return n.free(),t.a(2,r)}},t,this)})),function(){return g.apply(this,arguments)})},{key:"saveInterestEvolution",value:(y=m(f().m(function t(e){var n,r,i;return f().w(function(t){for(;;)switch(t.n){case 0:n=s(e);try{for(n.s();!(r=n.n()).done;)i=r.value,this.db.run("INSERT INTO interest_evolution (\n          topic, period, count, total_time, trend_score, status\n        ) VALUES (?, ?, ?, ?, ?, ?)",[i.topic,i.period,i.count,i.totalTime||0,i.trendScore||0,i.status||"steady"])}catch(t){n.e(t)}finally{n.f()}return t.n=1,this.saveDatabase();case 1:return t.a(2)}},t,this)})),function(t){return y.apply(this,arguments)})},{key:"getInterestEvolution",value:(b=m(f().m(function t(){var e,n,r;return f().w(function(t){for(;;)if(0===t.n){for(e=this.db.prepare("\n      SELECT * FROM interest_evolution \n      ORDER BY period DESC, count DESC\n    "),n=[];e.step();)r=e.getAsObject(),n.push({id:r.id,topic:r.topic,period:r.period,count:r.count,totalTime:r.total_time,trendScore:r.trend_score,status:r.status,createdAt:r.created_at});return e.free(),t.a(2,n)}},t,this)})),function(){return b.apply(this,arguments)})},{key:"saveMoodData",value:(v=m(f().m(function t(e){return f().w(function(t){for(;;)switch(t.n){case 0:return this.db.run("INSERT INTO mood_tracking (\n        timestamp, sentiment, sentiment_score, emotions, tone, url\n      ) VALUES (?, ?, ?, ?, ?, ?)",[e.timestamp,e.sentiment,e.sentimentScore||0,JSON.stringify(e.emotions||[]),e.tone||"",e.url||""]),t.n=1,this.saveDatabase();case 1:return t.a(2)}},t,this)})),function(t){return v.apply(this,arguments)})},{key:"getMoodHistory",value:(p=m(f().m(function t(){var e,n,r,i,a,o=arguments;return f().w(function(t){for(;;)if(0===t.n){for(e=o.length>0&&void 0!==o[0]?o[0]:30,n=Date.now()-24*e*60*60*1e3,(r=this.db.prepare("\n      SELECT * FROM mood_tracking \n      WHERE timestamp >= ?\n      ORDER BY timestamp DESC\n    ")).bind([n]),i=[];r.step();)a=r.getAsObject(),i.push({id:a.id,timestamp:a.timestamp,sentiment:a.sentiment,sentimentScore:a.sentiment_score,emotions:JSON.parse(a.emotions||"[]"),tone:a.tone,url:a.url,createdAt:a.created_at});return r.free(),t.a(2,i)}},t,this)})),function(){return p.apply(this,arguments)})},{key:"getWeeklyMoodSummary",value:(h=m(f().m(function t(){var e,n,r,i,o,s,u,c,l;return f().w(function(t){for(;;)if(0===t.n){for(e=Date.now()-6048e5,(n=this.db.prepare("\n      SELECT sentiment, COUNT(*) as count, AVG(sentiment_score) as avg_score\n      FROM mood_tracking \n      WHERE timestamp >= ?\n      GROUP BY sentiment\n    ")).bind([e]),r={positive:0,negative:0,neutral:0,averageScore:0,dominantMood:"neutral"},i=0,o=0;n.step();)s=n.getAsObject(),u=s.sentiment||"neutral",c=s.count||0,l=s.avg_score||0,r[u]=c,i+=c,o+=l*c;return n.free(),i>0&&(r.averageScore=o/i,r.dominantMood=Object.entries(r).filter(function(t){var e=a(t,1)[0];return["positive","negative","neutral"].includes(e)}).sort(function(t,e){return e[1]-t[1]})[0][0]),t.a(2,r)}},t,this)})),function(){return h.apply(this,arguments)})},{key:"getWeeklyData",value:(c=m(f().m(function t(){var e,n,r,a,o,s,u,c,l,h,p,m;return f().w(function(t){for(;;)if(0===t.n){for(e=Date.now()-6048e5,n=Date.now(),(r=this.db.prepare("\n      SELECT * FROM visits \n      WHERE last_visit >= ? AND last_visit < ?\n      ORDER BY last_visit DESC\n    ")).bind([e,n]),a=[];r.step();)a.push(r.getAsObject());for(r.free(),(o=this.db.prepare("\n      SELECT h.* FROM highlights h\n      JOIN visits v ON h.visit_id = v.id\n      WHERE h.timestamp >= ? AND h.timestamp < ?\n    ")).bind([e,n]),s=[];o.step();)s.push(o.getAsObject());for(o.free(),(u=this.db.prepare("\n      SELECT i.topics FROM insights i\n      JOIN visits v ON i.visit_id = v.id\n      WHERE v.last_visit >= ? AND v.last_visit < ?\n    ")).bind([e,n]),c=[];u.step();)(l=u.getAsObject()).topics&&(h=JSON.parse(l.topics),c.push.apply(c,i(h)));return u.free(),(p=this.db.prepare("\n      SELECT SUM(total_time_spent) as total FROM visits\n      WHERE last_visit >= ? AND last_visit < ?\n    ")).bind([e,n]),m=0,p.step()&&(m=p.getAsObject().total||0),p.free(),t.a(2,{weekStart:e,weekEnd:n,visits:a,highlights:s,topics:c,timeSpent:m})}},t,this)})),function(){return c.apply(this,arguments)})},{key:"close",value:(u=m(f().m(function t(){return f().w(function(t){for(;;)switch(t.n){case 0:if(!this.db){t.n=2;break}return t.n=1,this.saveDatabase();case 1:this.db.close(),this.db=null,this.isInitialized=!1;case 2:return t.a(2)}},t,this)})),function(){return u.apply(this,arguments)})}],n&&d(t.prototype,n),r&&d(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r,u,c,h,p,v,b,y,g,w,E,T,_,k,S,O,N,A,I,R,L,P,D,j,C,F,M,U}();function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function g(t){return function(t){if(Array.isArray(t))return T(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||E(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(t,e)||E(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(t,e){if(t){if("string"==typeof t)return T(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(t,e):void 0}}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function _(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return k(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return a=e,s=0,u=t,h.n=n,o}};function p(n,r){for(s=n,u=r,e=0;!f&&c&&!i&&e<l.length;e++){var i,a=l[e],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=t):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(e=s<2?t:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),e=a[i]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,s<2&&(s=0)}else 1===s&&(e=a.return)&&e.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=t}else if((e=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(e){a=t,s=1,u=e}finally{c=1}}return{value:e,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(k(e={},r,function(){return this}),e),f=c.prototype=s.prototype=Object.create(l);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,k(t,i,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=c,k(f,"constructor",c),k(c,"constructor",u),u.displayName="GeneratorFunction",k(c,i,"GeneratorFunction"),k(f),k(f,i,"Generator"),k(f,r,function(){return this}),k(f,"toString",function(){return"[object Generator]"}),(_=function(){return{w:a,m:h}})()}function k(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}k=function(t,e,n,r){function a(e,n){k(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},k(t,e,n,r)}function S(t,e,n,r,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function O(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(t){S(a,r,i,o,s,"next",t)}function s(t){S(a,r,i,o,s,"throw",t)}o(void 0)})}}function N(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,A(r.key),r)}}function A(t){var e=function(t,e){if("object"!=y(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==y(e)?e:e+""}var I=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ai=e},e=[{key:"generateWeeklySnapshot",value:(s=O(_().m(function t(e){var n,r,i,a,o;return _().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n=e.visits,r=e.highlights,e.topics,i=e.timeSpent,t.p=1,this.ai.apiKey){t.n=2;break}return t.a(2,this.generateFallbackSnapshot(e));case 2:return t.n=3,this.ai.generatePersonalityReport(e);case 3:return a=t.v,t.a(2,{timestamp:Date.now(),weekStart:e.weekStart,weekEnd:e.weekEnd,tone:a.tone,topTopics:a.topTopics,readingHabits:a.readingHabits,emotionalThemes:a.emotionalThemes,summary:a.summary,totalTimeSpent:i,totalVisits:n.length,totalHighlights:r.length,dominantInterests:a.dominantInterests});case 4:return t.p=4,o=t.v,console.error("Snapshot generation error:",o),t.a(2,this.generateFallbackSnapshot(e))}},t,this,[[1,4]])})),function(t){return s.apply(this,arguments)})},{key:"analyzeTone",value:(o=O(_().m(function t(e){var n,r,i;return _().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.ai.apiKey){t.n=1;break}return t.a(2,this.generateFallbackTone(e));case 1:return t.p=1,t.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:'Analyze the tone of the reading content. Return 2-3 descriptive words like "analytical, reflective, optimistic" or "critical, curious, thoughtful".'},{role:"user",content:e.substring(0,2e3)}],max_tokens:20,temperature:.5})});case 2:return n=t.v,t.n=3,n.json();case 3:return r=t.v,t.a(2,r.choices[0].message.content.trim());case 4:return t.p=4,i=t.v,console.error("Tone analysis error:",i),t.a(2,this.generateFallbackTone(e))}},t,this,[[1,4]])})),function(t){return o.apply(this,arguments)})},{key:"detectEmotionalThemes",value:(a=O(_().m(function t(e){var n,r,i;return _().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.ai.apiKey){t.n=1;break}return t.a(2,this.generateFallbackEmotions(e));case 1:return t.p=1,t.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:'Identify the emotional themes in this content. Return 2-4 emotions like "curiosity, nostalgia, hope" or "anxiety, determination, wonder".'},{role:"user",content:e.substring(0,2e3)}],max_tokens:30,temperature:.6})});case 2:return n=t.v,t.n=3,n.json();case 3:return r=t.v,t.a(2,r.choices[0].message.content.trim().split(",").map(function(t){return t.trim()}));case 4:return t.p=4,i=t.v,console.error("Emotional theme detection error:",i),t.a(2,this.generateFallbackEmotions(e))}},t,this,[[1,4]])})),function(t){return a.apply(this,arguments)})},{key:"generateWeeklyQuote",value:(i=O(_().m(function t(e){var n,r,i;return _().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.ai.apiKey){t.n=1;break}return t.a(2,this.getFallbackQuote());case 1:return t.p=1,t.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"Generate an inspiring quote that matches the user's weekly vibe. Keep it under 100 characters, thoughtful and motivating."},{role:"user",content:"This week's vibe: ".concat(e.tone,". Topics: ").concat(e.topTopics.join(", "),". Emotional themes: ").concat(e.emotionalThemes.join(", "),".")}],max_tokens:60,temperature:.8})});case 2:return n=t.v,t.n=3,n.json();case 3:return r=t.v,t.a(2,r.choices[0].message.content.trim().replace(/^["']|["']$/g,""));case 4:return t.p=4,i=t.v,console.error("Quote generation error:",i),t.a(2,this.getFallbackQuote())}},t,this,[[1,4]])})),function(t){return i.apply(this,arguments)})},{key:"analyzeSentiment",value:(r=O(_().m(function t(e){var n,r,i,a;return _().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.ai.apiKey){t.n=1;break}return t.a(2,this.generateFallbackSentiment(e));case 1:return t.p=1,t.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:'Analyze the sentiment. Return ONLY one word: "positive", "negative", or "neutral".'},{role:"user",content:e.substring(0,1e3)}],max_tokens:5,temperature:.3})});case 2:return n=t.v,t.n=3,n.json();case 3:return r=t.v,i=r.choices[0].message.content.trim().toLowerCase(),t.a(2,{sentiment:i,score:"positive"===i?.7:"negative"===i?-.7:0});case 4:return t.p=4,a=t.v,console.error("Sentiment analysis error:",a),t.a(2,this.generateFallbackSentiment(e))}},t,this,[[1,4]])})),function(t){return r.apply(this,arguments)})},{key:"generateFallbackSnapshot",value:function(t){var e=t.visits,n=t.topics,r={};n.forEach(function(t){r[t]=(r[t]||0)+1});var i=Object.entries(r).sort(function(t,e){return e[1]-t[1]}).slice(0,5).map(function(t){return w(t,1)[0]});return{timestamp:Date.now(),weekStart:t.weekStart,weekEnd:t.weekEnd,tone:"curious, engaged",topTopics:i,readingHabits:"Regular browsing",emotionalThemes:["curiosity","interest"],summary:"This week, you explored ".concat(i.slice(0,3).join(", "),". Your tone: curious and engaged."),totalTimeSpent:t.timeSpent,totalVisits:e.length,totalHighlights:t.highlights.length,dominantInterests:i.slice(0,3)}}},{key:"generateFallbackTone",value:function(t){for(var e=t.toLowerCase(),n={},r=0,i=Object.entries({analytical:["data","analysis","study","research","evidence"],creative:["design","art","creative","innovation","imagine"],technical:["code","software","development","programming","system"],curious:["why","how","what","learn","understand"],optimistic:["success","growth","opportunity","future","potential"]});r<i.length;r++){var a=w(i[r],2),o=a[0],s=a[1];n[o]=s.filter(function(t){return e.includes(t)}).length}var u=Object.entries(n).sort(function(t,e){return e[1]-t[1]}).slice(0,2).map(function(t){return w(t,1)[0]});return u.length>0?u.join(", "):"curious, thoughtful"}},{key:"generateFallbackEmotions",value:function(t){return["curiosity","interest","focus"]}},{key:"generateFallbackSentiment",value:function(t){var e=["good","great","amazing","love","excellent","happy","success"],n=["bad","terrible","hate","problem","issue","difficult","fail"],r=t.toLowerCase().split(/\s+/),i=r.filter(function(t){return e.includes(t)}).length,a=r.filter(function(t){return n.includes(t)}).length;return i>a?{sentiment:"positive",score:.5}:a>i?{sentiment:"negative",score:-.5}:{sentiment:"neutral",score:0}}},{key:"getFallbackQuote",value:function(){var t=["Your curiosity is your compass.","Every search shapes who you're becoming.","Your digital journey reflects your growth.","Learning is a continuous adventure.","Your interests tell your story."];return t[Math.floor(Math.random()*t.length)]}},{key:"calculateInterestEvolution",value:function(t){var e={};return t.forEach(function(t){var n,r=new Date(t.timestamp).toISOString().slice(0,7);e[r]||(e[r]={topics:[],count:0}),t.topics&&((n=e[r].topics).push.apply(n,g(t.topics)),e[r].count++)}),Object.entries(e).map(function(t){var e=w(t,2),n=e[0],r=e[1],i={};return r.topics.forEach(function(t){i[t]=(i[t]||0)+1}),{period:n,topTopics:Object.entries(i).sort(function(t,e){return e[1]-t[1]}).slice(0,5).map(function(t){var e=w(t,2);return{topic:e[0],count:e[1]}}),totalVisits:r.count}})}},{key:"detectTrendingInterests",value:function(t,e){var n={};t.topics.forEach(function(t){n[t]=(n[t]||0)+1});var r={};e.forEach(function(t){var e;null===(e=t.topics)||void 0===e||e.forEach(function(t){r[t]=(r[t]||0)+1})});for(var i=[],a=0,o=Object.entries(n);a<o.length;a++){var s=w(o[a],2),u=s[0],c=s[1],l=(r[u]||0)/Math.max(e.length,1),f=c-l;f>0&&i.push({topic:u,currentCount:c,previousAvg:l,trendScore:f,status:f>2?"rising":"steady"})}return i.sort(function(t,e){return e.trendScore-t.trendScore}).slice(0,10)}}],e&&N(t.prototype,e),n&&N(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,i,a,o,s}();function R(t){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R(t)}function L(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(t,e)||D(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=D(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function D(t,e){if(t){if("string"==typeof t)return j(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(t,e):void 0}}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function C(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function F(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?C(Object(n),!0).forEach(function(e){M(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function M(t,e,n){return(e=W(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function U(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return G(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return a=e,s=0,u=t,h.n=n,o}};function p(n,r){for(s=n,u=r,e=0;!f&&c&&!i&&e<l.length;e++){var i,a=l[e],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=t):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(e=s<2?t:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),e=a[i]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,s<2&&(s=0)}else 1===s&&(e=a.return)&&e.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=t}else if((e=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(e){a=t,s=1,u=e}finally{c=1}}return{value:e,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(G(e={},r,function(){return this}),e),f=c.prototype=s.prototype=Object.create(l);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,G(t,i,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=c,G(f,"constructor",c),G(c,"constructor",u),u.displayName="GeneratorFunction",G(c,i,"GeneratorFunction"),G(f),G(f,i,"Generator"),G(f,r,function(){return this}),G(f,"toString",function(){return"[object Generator]"}),(U=function(){return{w:a,m:h}})()}function G(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}G=function(t,e,n,r){function a(e,n){G(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},G(t,e,n,r)}function x(t,e,n,r,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function q(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(t){x(a,r,i,o,s,"next",t)}function s(t){x(a,r,i,o,s,"throw",t)}o(void 0)})}}function H(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,W(r.key),r)}}function W(t){var e=function(t,e){if("object"!=R(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=R(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==R(e)?e:e+""}var X=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ai=e,this.db=n,this.activeGoals=[],this.sessionTracking=new Map,this.loadGoals()},e=[{key:"loadGoals",value:(h=q(U().m(function t(){var e=this;return U().w(function(t){for(;;)switch(t.n){case 0:chrome.storage.local.get(["user_goals"],function(t){e.activeGoals=t.user_goals||[]});case 1:return t.a(2)}},t)})),function(){return h.apply(this,arguments)})},{key:"saveGoals",value:(f=q(U().m(function t(){return U().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.storage.local.set({user_goals:this.activeGoals});case 1:return t.a(2)}},t,this)})),function(){return f.apply(this,arguments)})},{key:"addGoal",value:(l=q(U().m(function t(e){var n;return U().w(function(t){for(;;)switch(t.n){case 0:return n={id:Date.now(),title:e.title,description:e.description,keywords:e.keywords||[],priority:e.priority||"medium",createdAt:Date.now(),targetHours:e.targetHours||0,actualHours:0,lastNudge:null,nudgeCount:0,isActive:!0},this.activeGoals.push(n),t.n=1,this.saveGoals();case 1:return t.a(2,n)}},t,this)})),function(t){return l.apply(this,arguments)})},{key:"updateGoal",value:(c=q(U().m(function t(e){var n;return U().w(function(t){for(;;)switch(t.n){case 0:if(-1===(n=this.activeGoals.findIndex(function(t){return t.id===e.id}))){t.n=2;break}return this.activeGoals[n]=F(F({},this.activeGoals[n]),{},{title:e.title,description:e.description,keywords:e.keywords||[],priority:e.priority,targetHours:e.targetHours}),t.n=1,this.saveGoals();case 1:return t.a(2,!0);case 2:return t.a(2,!1)}},t,this)})),function(t){return c.apply(this,arguments)})},{key:"updateGoalProgress",value:(u=q(U().m(function t(e,n){var r;return U().w(function(t){for(;;)switch(t.n){case 0:if(!(r=this.activeGoals.find(function(t){return t.id===e}))){t.n=1;break}return r.actualHours+=n/3600,t.n=1,this.saveGoals();case 1:return t.a(2)}},t,this)})),function(t,e){return u.apply(this,arguments)})},{key:"checkAlignment",value:(s=q(U().m(function t(e,n,r,i){var a,o,s,u,c,l,f;return U().w(function(t){for(;;)switch(t.p=t.n){case 0:if(0!==this.activeGoals.length){t.n=1;break}return t.a(2,null);case 1:a=(n+" "+r).toLowerCase(),o=[],s=P(this.activeGoals),t.p=2,s.s();case 3:if((u=s.n()).done){t.n=6;break}if((c=u.value).isActive){t.n=4;break}return t.a(3,5);case 4:if(!this.isContentAlignedWithGoal(a,c)){t.n=5;break}return o.push(c),t.n=5,this.updateGoalProgress(c.id,i);case 5:t.n=3;break;case 6:t.n=8;break;case 7:t.p=7,f=t.v,s.e(f);case 8:return t.p=8,s.f(),t.f(8);case 9:if(l="".concat(Date.now(),"_").concat(e),this.sessionTracking.set(l,{url:e,title:n,aligned:o.length>0,goals:o.map(function(t){return t.id}),timeSpent:i}),!(0===o.length&&i>300)){t.n=10;break}return t.a(2,this.generateNudge(n,i));case 10:return t.a(2,{aligned:!0,goals:o,message:o.length>0?"Great! This aligns with your goal: ".concat(o[0].title):null})}},t,this,[[2,7,8,9]])})),function(t,e,n,r){return s.apply(this,arguments)})},{key:"isContentAlignedWithGoal",value:function(t,e){return 0!==e.keywords.length&&e.keywords.filter(function(e){return t.includes(e.toLowerCase())}).length>0}},{key:"generateNudge",value:function(t,e){var n=this.activeGoals.filter(function(t){return t.isActive}).sort(function(t,e){var n={high:3,medium:2,low:1};return(n[e.priority]||0)-(n[t.priority]||0)}).slice(0,3);if(0===n.length)return null;var r=n[0],i=Math.floor(e/60);if(r.lastNudge&&Date.now()-r.lastNudge<36e5)return null;r.lastNudge=Date.now(),r.nudgeCount++,this.saveGoals();var a=[{title:"Mindful Moment 🧘",message:"You've spent ".concat(i,' minutes here. Still working on "').concat(r.title,'"?'),tone:"gentle"},{title:"Goal Check-In 🎯",message:'Remember your goal: "'.concat(r.title,'". Want to refocus?'),tone:"encouraging"},{title:"Progress Update 📊",message:'Goal: "'.concat(r.title,'" — ').concat(r.actualHours.toFixed(1),"h / ").concat(r.targetHours,"h. Keep it up!"),tone:"motivating"},{title:"Gentle Reminder 💡",message:"".concat(i,' minutes here. Just checking: is this aligned with "').concat(r.title,'"?'),tone:"curious"}];return F(F({},a[r.nudgeCount%a.length]),{},{goal:r,timeSpent:i,showNudge:!0})}},{key:"getGoalProgress",value:function(){return this.activeGoals.map(function(t){return{id:t.id,title:t.title,progress:t.targetHours>0?(t.actualHours/t.targetHours*100).toFixed(1):0,actualHours:t.actualHours.toFixed(1),targetHours:t.targetHours,isOnTrack:t.actualHours>=.7*t.targetHours,priority:t.priority,isActive:t.isActive}})}},{key:"toggleGoal",value:(o=q(U().m(function t(e){var n;return U().w(function(t){for(;;)switch(t.n){case 0:if(!(n=this.activeGoals.find(function(t){return t.id===e}))){t.n=1;break}return n.isActive=!n.isActive,t.n=1,this.saveGoals();case 1:return t.a(2)}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"deleteGoal",value:(a=q(U().m(function t(e){return U().w(function(t){for(;;)switch(t.n){case 0:return this.activeGoals=this.activeGoals.filter(function(t){return t.id!==e}),t.n=1,this.saveGoals();case 1:return t.a(2)}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"getWeeklyInsights",value:(i=q(U().m(function t(){var e,n,r,i,a,o,s,u,c;return U().w(function(t){for(;;)if(0===t.n){e=Date.now()-6048e5,n=0,r=0,i=P(this.sessionTracking.entries());try{for(i.s();!(a=i.n()).done;)o=L(a.value,2),s=o[0],u=o[1],parseInt(s.split("_")[0])>e&&(r+=u.timeSpent,u.aligned&&(n+=u.timeSpent))}catch(t){i.e(t)}finally{i.f()}return c=r>0?(n/r*100).toFixed(1):0,t.a(2,{alignmentRate:parseFloat(c),totalAlignedHours:(n/3600).toFixed(1),totalHours:(r/3600).toFixed(1),activeGoals:this.activeGoals.filter(function(t){return t.isActive}).length,mostProgressedGoal:this.getMostProgressedGoal()})}},t,this)})),function(){return i.apply(this,arguments)})},{key:"getMostProgressedGoal",value:function(){var t=Date.now()-6048e5;return this.activeGoals.filter(function(e){return e.isActive&&e.createdAt<t}).map(function(t){return{title:t.title,weeklyProgress:t.actualHours}}).sort(function(t,e){return e.weeklyProgress-t.weeklyProgress})[0]||null}},{key:"suggestGoals",value:(r=q(U().m(function t(e,n){var r,i,a,o=this;return U().w(function(t){for(;;)if(0===t.n)return r={},e.forEach(function(t){r[t]=(r[t]||0)+1}),i=Object.entries(r).sort(function(t,e){return e[1]-t[1]}).slice(0,5).map(function(t){return L(t,1)[0]}),a=i.filter(function(t){return!o.activeGoals.some(function(e){return e.keywords.some(function(e){return e.toLowerCase().includes(t.toLowerCase())})})}).map(function(t){return{title:"Learn more about ".concat(t),description:"You've been exploring ".concat(t," recently. Set a goal to dive deeper!"),keywords:[t],priority:"medium",suggestedTargetHours:10}}),t.a(2,a.slice(0,3))},t)})),function(t,e){return r.apply(this,arguments)})}],e&&H(t.prototype,e),n&&H(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,i,a,o,s,u,c,l,f,h}();function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function B(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=V(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function z(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(t,e)||V(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(t,e){if(t){if("string"==typeof t)return K(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?K(t,e):void 0}}function K(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Q(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return J(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return a=e,s=0,u=t,h.n=n,o}};function p(n,r){for(s=n,u=r,e=0;!f&&c&&!i&&e<l.length;e++){var i,a=l[e],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=t):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(e=s<2?t:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),e=a[i]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,s<2&&(s=0)}else 1===s&&(e=a.return)&&e.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=t}else if((e=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(e){a=t,s=1,u=e}finally{c=1}}return{value:e,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(J(e={},r,function(){return this}),e),f=c.prototype=s.prototype=Object.create(l);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,J(t,i,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=c,J(f,"constructor",c),J(c,"constructor",u),u.displayName="GeneratorFunction",J(c,i,"GeneratorFunction"),J(f),J(f,i,"Generator"),J(f,r,function(){return this}),J(f,"toString",function(){return"[object Generator]"}),(Q=function(){return{w:a,m:h}})()}function J(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}J=function(t,e,n,r){function a(e,n){J(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},J(t,e,n,r)}function $(t,e,n,r,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function Z(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(t){$(a,r,i,o,s,"next",t)}function s(t){$(a,r,i,o,s,"throw",t)}o(void 0)})}}function tt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,et(r.key),r)}}function et(t){var e=function(t,e){if("object"!=Y(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=Y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Y(e)?e:e+""}var nt=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ai=e,this.db=n,this.twinProfile=null,this.loadProfile()},e=[{key:"loadProfile",value:(l=Z(Q().m(function t(){var e=this;return Q().w(function(t){for(;;)switch(t.n){case 0:chrome.storage.local.get(["digital_twin_profile"],function(t){e.twinProfile=t.digital_twin_profile||e.createEmptyProfile()});case 1:return t.a(2)}},t)})),function(){return l.apply(this,arguments)})},{key:"saveProfile",value:(c=Z(Q().m(function t(){return Q().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.storage.local.set({digital_twin_profile:this.twinProfile});case 1:return t.a(2)}},t,this)})),function(){return c.apply(this,arguments)})},{key:"createEmptyProfile",value:function(){return{createdAt:Date.now(),lastUpdated:Date.now(),interestHistory:[],toneHistory:[],topicPreferences:{},emotionalPatterns:{},browsingPatterns:{peakHours:[],averageSessionDuration:0,favoriteCategories:[]},personalityTraits:[],thoughtPatterns:[],learningStyle:null,totalDataPoints:0}}},{key:"updateTwin",value:(u=Z(Q().m(function t(e){var n,r,i,a,o,s,u,c=this;return Q().w(function(t){for(;;)switch(t.n){case 0:return n=e.topics,r=e.tone,i=e.emotions,a=e.timestamp,o=e.timeSpent,s=e.category,this.twinProfile||(this.twinProfile=this.createEmptyProfile()),n&&n.forEach(function(t){c.twinProfile.topicPreferences[t]||(c.twinProfile.topicPreferences[t]={count:0,totalTime:0,firstSeen:a,lastSeen:a}),c.twinProfile.topicPreferences[t].count++,c.twinProfile.topicPreferences[t].totalTime+=o||0,c.twinProfile.topicPreferences[t].lastSeen=a}),r&&(this.twinProfile.toneHistory.push({tone:r,timestamp:a}),this.twinProfile.toneHistory.length>100&&(this.twinProfile.toneHistory=this.twinProfile.toneHistory.slice(-100))),i&&i.forEach(function(t){c.twinProfile.emotionalPatterns[t]||(c.twinProfile.emotionalPatterns[t]=0),c.twinProfile.emotionalPatterns[t]++}),u=new Date(a).getHours(),this.twinProfile.browsingPatterns.peakHours[u]||(this.twinProfile.browsingPatterns.peakHours[u]=0),this.twinProfile.browsingPatterns.peakHours[u]++,s&&(this.twinProfile.browsingPatterns.favoriteCategories.includes(s)||this.twinProfile.browsingPatterns.favoriteCategories.push(s)),this.twinProfile.totalDataPoints++,this.twinProfile.lastUpdated=a,t.n=1,this.saveProfile();case 1:return t.a(2)}},t,this)})),function(t){return u.apply(this,arguments)})},{key:"askTwin",value:(s=Z(Q().m(function t(e){var n,r,i,a;return Q().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.ai.apiKey){t.n=1;break}return t.a(2,this.generateFallbackResponse(e));case 1:return t.p=1,n=this.buildTwinContext(),t.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You are the user's digital twin - a reflection of their browsing personality and interests. \n              \nYour role is to answer questions about the user's past interests, behaviors, and patterns based on the data below.\n\nUSER PROFILE:\n".concat(n,'\n\nRespond as if you ARE the user, using "I" and reflecting their personality. Be insightful, honest, and helpful.')},{role:"user",content:e}],max_tokens:200,temperature:.7})});case 2:return r=t.v,t.n=3,r.json();case 3:return i=t.v,t.a(2,{answer:i.choices[0].message.content.trim(),confidence:this.calculateConfidence(),timestamp:Date.now()});case 4:return t.p=4,a=t.v,console.error("Digital twin error:",a),t.a(2,this.generateFallbackResponse(e))}},t,this,[[1,4]])})),function(t){return s.apply(this,arguments)})},{key:"buildTwinContext",value:function(){var t=Object.entries(this.twinProfile.topicPreferences).sort(function(t,e){return e[1].count-t[1].count}).slice(0,10).map(function(t){var e=z(t,2),n=e[0],r=e[1];return"".concat(n," (").concat(r.count," times)")}),e=this.twinProfile.toneHistory.slice(-10).map(function(t){return t.tone}).join(", "),n=Object.entries(this.twinProfile.emotionalPatterns).sort(function(t,e){return e[1]-t[1]}).slice(0,5).map(function(t){var e=z(t,2),n=e[0],r=e[1];return"".concat(n," (").concat(r,")")}),r=this.twinProfile.browsingPatterns.peakHours.reduce(function(t,e,n){return e>(t.count||0)?{hour:n,count:e}:t},{});return"\nTop Interests: ".concat(t.join(", "),"\nRecent Tone: ").concat(e||"curious, thoughtful","\nEmotional Patterns: ").concat(n.join(", "),"\nMost Active Hour: ").concat(r.hour||"N/A",":00\nFavorite Categories: ").concat(this.twinProfile.browsingPatterns.favoriteCategories.join(", "),"\nTotal Data Points: ").concat(this.twinProfile.totalDataPoints,"\nProfile Age: ").concat(Math.floor((Date.now()-this.twinProfile.createdAt)/864e5)," days\n    ").trim()}},{key:"calculateConfidence",value:function(){return this.twinProfile.totalDataPoints<10?"low":this.twinProfile.totalDataPoints<50?"medium":this.twinProfile.totalDataPoints<200?"high":"very high"}},{key:"generateFallbackResponse",value:function(t){var e=t.toLowerCase();if(e.includes("topic")||e.includes("interest")){var n=Object.entries(this.twinProfile.topicPreferences).sort(function(t,e){return e[1].count-t[1].count}).slice(0,3).map(function(t){return z(t,1)[0]});return{answer:"Based on your browsing, you've been most interested in: ".concat(n.join(", ")),confidence:"medium",timestamp:Date.now()}}if(e.includes("avoid")||e.includes("less")){var r=Object.entries(this.twinProfile.topicPreferences).sort(function(t,e){return t[1].count-e[1].count}).slice(0,3).map(function(t){return z(t,1)[0]});return{answer:"You seem to have explored these less: ".concat(r.join(", ")),confidence:"medium",timestamp:Date.now()}}if(e.includes("year ago")||e.includes("last year")){var i=Object.entries(this.twinProfile.topicPreferences).filter(function(t){var e=z(t,2);return e[0],e[1].lastSeen<Date.now()-15552e6}).slice(0,3).map(function(t){return z(t,1)[0]});return{answer:i.length>0?"Looking back, you were interested in: ".concat(i.join(", ")):"I don't have enough historical data to answer that yet.",confidence:"low",timestamp:Date.now()}}return{answer:"I'm still learning about you. Keep browsing and I'll have better insights soon!",confidence:"low",timestamp:Date.now()}}},{key:"getTwinSummary",value:function(){var t=Object.entries(this.twinProfile.topicPreferences).sort(function(t,e){return e[1].count-t[1].count}).slice(0,5).map(function(t){var e=z(t,2),n=e[0],r=e[1];return{topic:n,count:r.count,totalTime:r.totalTime,recency:Date.now()-r.lastSeen}}),e=Object.entries(this.twinProfile.emotionalPatterns).sort(function(t,e){return e[1]-t[1]}).slice(0,3).map(function(t){return z(t,1)[0]}),n=this.twinProfile.browsingPatterns.peakHours.map(function(t,e){return{hour:e,count:t}}).filter(function(t){return t.count>0}).sort(function(t,e){return e.count-t.count}).slice(0,3);return{maturityLevel:this.calculateConfidence(),topInterests:t,dominantEmotions:e,peakBrowsingHours:n,totalDataPoints:this.twinProfile.totalDataPoints,profileAge:Math.floor((Date.now()-this.twinProfile.createdAt)/864e5),lastUpdated:this.twinProfile.lastUpdated}}},{key:"compareWithPast",value:(o=Z(Q().m(function t(){var e,n,r,i,a,o,s,u=arguments;return Q().w(function(t){for(;;)if(0===t.n)return e=u.length>0&&void 0!==u[0]?u[0]:30,n=Date.now()-24*e*60*60*1e3,r=Object.entries(this.twinProfile.topicPreferences).filter(function(t){var e=z(t,2),r=(e[0],e[1]);return r.lastSeen<n&&r.firstSeen<n}).sort(function(t,e){return e[1].count-t[1].count}).slice(0,5).map(function(t){return z(t,1)[0]}),i=Object.entries(this.twinProfile.topicPreferences).filter(function(t){var e=z(t,2);return e[0],e[1].lastSeen>=n}).sort(function(t,e){return e[1].count-t[1].count}).slice(0,5).map(function(t){return z(t,1)[0]}),a=i.filter(function(t){return!r.includes(t)}),o=r.filter(function(t){return!i.includes(t)}),s=i.filter(function(t){return r.includes(t)}),t.a(2,{past:r,current:i,new:a,faded:o,continuing:s,periodDays:e})},t,this)})),function(){return o.apply(this,arguments)})},{key:"predictFutureInterests",value:function(){return{likelyNextInterests:Object.entries(this.twinProfile.topicPreferences).filter(function(t){var e=z(t,2);return e[0],e[1].lastSeen>Date.now()-12096e5}).sort(function(t,e){return e[1].count-t[1].count}).slice(0,5).map(function(t){return z(t,1)[0]}),reasoning:"Based on your recent browsing patterns and interest evolution"}}},{key:"predictInterestMapping",value:(a=Z(Q().m(function t(){var e,n,r,i,a,o,s,u,c,l;return Q().w(function(t){for(;;)if(0===t.n){e=Object.entries(this.twinProfile.topicPreferences).sort(function(t,e){return e[1].lastSeen-t[1].lastSeen}).slice(0,10),n=[],r=B(e);try{for(r.s();!(i=r.n()).done;)a=z(i.value,2),o=a[0],s=a[1],u=(Date.now()-s.firstSeen)/864e5,c=s.count/Math.max(u,1),l=c>.5&&Date.now()-s.lastSeen<12096e5,n.push({topic:o,currentLevel:this.calculateTopicLevel(s),growthRate:c,likelyContinuation:l?"high":"medium",recommendedAction:this.getRecommendedAction(s,c),relatedTopics:this.findRelatedTopics(o)})}catch(t){r.e(t)}finally{r.f()}return t.a(2,{predictions:n,suggestedNewTopics:this.suggestNewTopics(),timestamp:Date.now()})}},t,this)})),function(){return a.apply(this,arguments)})},{key:"calculateTopicLevel",value:function(t){var e=t.totalTime/36e5;return e<2?"beginner":e<10?"intermediate":e<50?"advanced":"expert"}},{key:"getRecommendedAction",value:function(t,e){return(Date.now()-t.lastSeen)/864e5>30?"This topic has faded. Consider revisiting or moving on.":e>1?"You're deeply engaged! Consider taking a course or building a project.":e>.3?"Steady exploration. Keep the momentum going!":"Light exploration. Dive deeper if interested."}},{key:"findRelatedTopics",value:function(t){for(var e=t.toLowerCase(),n=0,r=Object.entries({programming:["web development","software engineering","coding"],ai:["machine learning","data science","neural networks"],design:["ui/ux","creative","visual arts"],business:["startup","entrepreneurship","management"],marketing:["social media","content creation","seo"]});n<r.length;n++){var i=z(r[n],2),a=i[0],o=i[1];if(e.includes(a))return o}return[]}},{key:"suggestNewTopics",value:function(){var t=Object.keys(this.twinProfile.topicPreferences),e=[];return t.some(function(t){return t.includes("programming")})&&e.push({topic:"AI/ML",reason:"Natural extension of your programming interests",confidence:.8}),t.some(function(t){return t.includes("design")})&&e.push({topic:"Frontend Development",reason:"Combine design with code",confidence:.7}),e}},{key:"futureSelfSimulation",value:(i=Z(Q().m(function t(e){var n,r,i,a,o,s,u,c=arguments;return Q().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:6,this.ai.apiKey){t.n=1;break}return t.a(2,this.generateFutureSelfFallback(e,n));case 1:return t.p=1,r=this.buildTwinContext(),t.n=2,this.predictInterestMapping();case 2:return i=t.v,a="Based on this user profile and their interest trends, \n      simulate what they might think about this question ".concat(n," months from now:\n      \n      USER PROFILE: ").concat(r,"\n      \n      CURRENT TRENDS: ").concat(JSON.stringify(i.predictions.slice(0,3)),"\n      \n      QUESTION: ").concat(e,"\n      \n      Consider:\n      1. How their interests might evolve\n      2. What skills they might acquire\n      3. How their perspective might mature\n      4. What new connections they might make\n      \n      Respond as their future self would."),t.n=3,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You are simulating a user's future self based on their current interests and trends."},{role:"user",content:a}],max_tokens:250,temperature:.8})});case 3:return o=t.v,t.n=4,o.json();case 4:return s=t.v,t.a(2,{answer:s.choices[0].message.content.trim(),confidence:"medium",monthsAhead:n,timestamp:Date.now(),disclaimer:"This is a simulation based on your current patterns. Your actual future self may think differently!"});case 5:return t.p=5,u=t.v,console.error("Future self simulation error:",u),t.a(2,this.generateFutureSelfFallback(e,n))}},t,this,[[1,5]])})),function(t){return i.apply(this,arguments)})},{key:"generateFutureSelfFallback",value:function(t,e){var n=Object.entries(this.twinProfile.topicPreferences).sort(function(t,e){return e[1].totalTime-t[1].totalTime}).slice(0,3).map(function(t){return z(t,1)[0]});return{answer:"In ".concat(e," months, after spending more time with ").concat(n.join(", "),", I'll likely have a deeper perspective on this. My current exploration suggests I'm heading towards mastery in these areas."),confidence:"low",monthsAhead:e,timestamp:Date.now(),disclaimer:"This is a basic prediction. Enable AI features for more accurate future self simulation."}}},{key:"conversationalTwin",value:(r=Z(Q().m(function t(e){var n,r,i,a;return Q().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.ai.apiKey){t.n=1;break}return t.a(2,this.generateConversationalFallback(e));case 1:return t.p=1,n=this.buildTwinContext(),t.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You are this user's digital twin. You know them based on:\n              \n".concat(n,"\n\nHave a natural conversation. Be helpful, insightful, and reflect their personality.\nOffer summaries, advice, creative prompts, or answer questions about their patterns.")},{role:"user",content:e}],max_tokens:300,temperature:.7})});case 2:return r=t.v,t.n=3,r.json();case 3:return i=t.v,t.n=4,this.db.saveTwinInteraction(e,i.choices[0].message.content.trim(),this.calculateConfidence());case 4:return t.a(2,{response:i.choices[0].message.content.trim(),confidence:this.calculateConfidence(),timestamp:Date.now()});case 5:return t.p=5,a=t.v,console.error("Conversational twin error:",a),t.a(2,this.generateConversationalFallback(e))}},t,this,[[1,5]])})),function(t){return r.apply(this,arguments)})},{key:"generateConversationalFallback",value:function(t){var e=t.toLowerCase();if(e.includes("summary")||e.includes("what have i")){var n=Object.entries(this.twinProfile.topicPreferences).sort(function(t,e){return e[1].count-t[1].count}).slice(0,5).map(function(t){return z(t,1)[0]});return{response:"Based on your browsing, you've been most engaged with: ".concat(n.join(", "),". You have ").concat(this.twinProfile.totalDataPoints," data points collected."),confidence:"medium",timestamp:Date.now()}}if(e.includes("advice")||e.includes("should"))return{response:"Based on your patterns, I suggest focusing on one topic deeply rather than spreading too thin. Your most consistent interest could become a valuable skill!",confidence:"low",timestamp:Date.now()};if(e.includes("creative")||e.includes("idea")){var r=Object.keys(this.twinProfile.topicPreferences).slice(0,2);return{response:"Creative prompt: What if you combined ".concat(r[0]," with ").concat(r[1],"? Sometimes the best innovations come from unexpected combinations!"),confidence:"medium",timestamp:Date.now()}}return{response:"I'm your digital twin, still learning about you! Keep browsing and I'll have better insights. You can ask me for summaries, advice, or creative prompts.",confidence:"low",timestamp:Date.now()}}}],e&&tt(t.prototype,e),n&&tt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,i,a,o,s,u,c,l}();function rt(t){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rt(t)}function it(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function at(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?it(Object(n),!0).forEach(function(e){ot(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):it(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function ot(t,e,n){return(e=vt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function st(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=ft(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ut(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return ct(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return a=e,s=0,u=t,h.n=n,o}};function p(n,r){for(s=n,u=r,e=0;!f&&c&&!i&&e<l.length;e++){var i,a=l[e],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=t):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(e=s<2?t:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),e=a[i]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,s<2&&(s=0)}else 1===s&&(e=a.return)&&e.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=t}else if((e=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(e){a=t,s=1,u=e}finally{c=1}}return{value:e,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(ct(e={},r,function(){return this}),e),f=c.prototype=s.prototype=Object.create(l);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,ct(t,i,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=c,ct(f,"constructor",c),ct(c,"constructor",u),u.displayName="GeneratorFunction",ct(c,i,"GeneratorFunction"),ct(f),ct(f,i,"Generator"),ct(f,r,function(){return this}),ct(f,"toString",function(){return"[object Generator]"}),(ut=function(){return{w:a,m:h}})()}function ct(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}ct=function(t,e,n,r){function a(e,n){ct(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},ct(t,e,n,r)}function lt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(t,e)||ft(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ft(t,e){if(t){if("string"==typeof t)return ht(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ht(t,e):void 0}}function ht(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function pt(t,e,n,r,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function mt(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(t){pt(a,r,i,o,s,"next",t)}function s(t){pt(a,r,i,o,s,"throw",t)}o(void 0)})}}function dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,vt(r.key),r)}}function vt(t){var e=function(t,e){if("object"!=rt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=rt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==rt(e)?e:e+""}var bt=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ai=e,this.db=n,this.skillDatabase=this.initializeSkillDatabase()},e=[{key:"initializeSkillDatabase",value:function(){return{programming:{keywords:["code","programming","developer","software","javascript","python","react","node","api","git","typescript","html","css","java","c++","rust"],courses:[{title:"freeCodeCamp",url:"https://www.freecodecamp.org",type:"free"},{title:"The Odin Project",url:"https://www.theodinproject.com",type:"free"},{title:"Codecademy",url:"https://www.codecademy.com",type:"freemium"},{title:"Frontend Masters",url:"https://frontendmasters.com",type:"paid"}],relatedSkills:["design","ai","data-science"]},design:{keywords:["design","ui","ux","figma","sketch","adobe","creative","typography","color","layout","prototype"],courses:[{title:"Refactoring UI",url:"https://refactoringui.com",type:"paid"},{title:"Daily UI Challenge",url:"https://www.dailyui.co",type:"free"},{title:"Design Course",url:"https://designcourse.com",type:"free"}],relatedSkills:["programming","marketing"]},ai:{keywords:["ai","machine learning","neural network","deep learning","nlp","chatgpt","llm","artificial intelligence","tensorflow","pytorch"],courses:[{title:"Fast.ai",url:"https://www.fast.ai",type:"free"},{title:"DeepLearning.AI",url:"https://www.deeplearning.ai",type:"free"},{title:"Coursera ML Specialization",url:"https://www.coursera.org/specializations/machine-learning-introduction",type:"freemium"}],relatedSkills:["programming","data-science","math"]},"data-science":{keywords:["data science","analytics","visualization","statistics","pandas","numpy","tableau","sql","data analysis"],courses:[{title:"Kaggle Learn",url:"https://www.kaggle.com/learn",type:"free"},{title:"DataCamp",url:"https://www.datacamp.com",type:"freemium"}],relatedSkills:["ai","programming","business"]},marketing:{keywords:["marketing","seo","social media","content","copywriting","branding","advertising","analytics"],courses:[{title:"HubSpot Academy",url:"https://academy.hubspot.com",type:"free"},{title:"Google Digital Garage",url:"https://learndigital.withgoogle.com",type:"free"}],relatedSkills:["design","business","writing"]},business:{keywords:["business","startup","entrepreneurship","management","strategy","finance","investment","saas"],courses:[{title:"Y Combinator Startup School",url:"https://www.startupschool.org",type:"free"},{title:"Indie Hackers",url:"https://www.indiehackers.com",type:"free"}],relatedSkills:["marketing","finance"]},writing:{keywords:["writing","blog","content","copywriting","journalism","author","editor","storytelling"],courses:[{title:"Purdue OWL",url:"https://owl.purdue.edu",type:"free"},{title:"Copyblogger",url:"https://copyblogger.com",type:"free"}],relatedSkills:["marketing","communication"]},productivity:{keywords:["productivity","time management","notion","obsidian","gtd","workflow","organization"],courses:[{title:"Getting Things Done",url:"https://gettingthingsdone.com",type:"paid"},{title:"Notion Template Gallery",url:"https://www.notion.so/templates",type:"free"}],relatedSkills:["personal-development"]},"personal-development":{keywords:["self improvement","mindfulness","meditation","habits","psychology","mental health","wellness"],courses:[{title:"Headspace",url:"https://www.headspace.com",type:"paid"},{title:"James Clear (Atomic Habits)",url:"https://jamesclear.com",type:"free"}],relatedSkills:["productivity","health"]}}}},{key:"detectSkills",value:(u=mt(ut().m(function t(e,n,r,i){var a,o,s,u,c,l,f,h;return ut().w(function(t){for(;;)switch(t.n){case 0:for(a=[],o="".concat(n," ").concat(e," ").concat(i.join(" ")).toLowerCase(),s=0,u=Object.entries(this.skillDatabase);s<u.length;s++)c=lt(u[s],2),l=c[0],f=c[1],(h=f.keywords.filter(function(t){return o.includes(t.toLowerCase())})).length>0&&a.push({skill:l,confidence:Math.min(h.length/f.keywords.length,1),matchedKeywords:h,timestamp:Date.now()});if(!(a.length>0)){t.n=1;break}return t.n=1,this.saveSkillActivity(r,a);case 1:return t.a(2,a)}},t,this)})),function(t,e,n,r){return u.apply(this,arguments)})},{key:"saveSkillActivity",value:(s=mt(ut().m(function t(e,n){var r,i,a,o;return ut().w(function(t){for(;;)switch(t.p=t.n){case 0:r=st(n),t.p=1,r.s();case 2:if((i=r.n()).done){t.n=4;break}return a=i.value,t.n=3,this.db.saveSkillActivity({url:e,skill:a.skill,confidence:a.confidence,keywords:a.matchedKeywords.join(","),timestamp:Date.now()});case 3:t.n=2;break;case 4:t.n=6;break;case 5:t.p=5,o=t.v,r.e(o);case 6:return t.p=6,r.f(),t.f(6);case 7:return t.a(2)}},t,this,[[1,5,6,7]])})),function(t,e){return s.apply(this,arguments)})},{key:"getSkillProgress",value:(o=mt(ut().m(function t(){var e,n,r,i=this;return ut().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.getSkillStats();case 1:return e=t.v,n=e.map(function(t){var e;return{skill:t.skill,totalXP:i.calculateXP(t),activityCount:t.visit_count||0,totalTime:t.total_time||0,lastActivity:t.last_seen,firstSeen:t.first_seen,level:i.calculateSkillLevel(t),trend:i.calculateTrend(t),relatedSkills:(null===(e=i.skillDatabase[t.skill])||void 0===e?void 0:e.relatedSkills)||[]}}),t.n=2,this.generateRecommendations(e);case 2:return r=t.v,t.a(2,{success:!0,skills:n,recommendations:r,totalSkillsExplored:e.length})}},t,this)})),function(){return o.apply(this,arguments)})},{key:"calculateXP",value:function(t){var e=t.visit_count,n=void 0===e?0:e,r=t.total_time,i=(void 0===r?0:r)/36e5;return Math.floor(5*n+10*i)}},{key:"calculateSkillLevel",value:function(t){t.visit_count;var e=t.total_time/36e5;return e<1?{level:"Curious",value:1}:e<5?{level:"Exploring",value:2}:e<20?{level:"Learning",value:3}:e<50?{level:"Practicing",value:4}:e<100?{level:"Skilled",value:5}:{level:"Expert",value:6}}},{key:"calculateTrend",value:function(t){var e=t.last_seen,n=(Date.now()-e)/864e5;return n<7?"📈 Growing":n<30?"➡️ Stable":"📉 Fading"}},{key:"generateRecommendations",value:(a=mt(ut().m(function t(e){var n,r,i,a,o,s,u,c,l;return ut().w(function(t){for(;;)switch(t.p=t.n){case 0:n=[],r=e.sort(function(t,e){return e.last_seen-t.last_seen}).slice(0,5),i=st(r),t.p=1,i.s();case 2:if((a=i.n()).done){t.n=5;break}if(o=a.value,s=this.skillDatabase[o.skill]){t.n=3;break}return t.a(3,4);case 3:this.calculateSkillLevel(o),u=this.calculateXP(o),c=this.getLevelForXP(u),n.push({skill:o.skill,currentLevel:c.name,resources:s.courses.map(function(t){return{title:t.title,url:t.url,platform:t.type,type:t.type}}),suggestedNext:s.relatedSkills,reason:this.generateRecommendationReason(o,c)});case 4:t.n=2;break;case 5:t.n=7;break;case 6:t.p=6,l=t.v,i.e(l);case 7:return t.p=7,i.f(),t.f(7);case 8:return t.a(2,n)}},t,this,[[1,6,7,8]])})),function(t){return a.apply(this,arguments)})},{key:"getLevelForXP",value:function(t){return t>=1e3?{level:5,name:"Expert",color:"#8b5cf6"}:t>=500?{level:4,name:"Advanced",color:"#6366f1"}:t>=200?{level:3,name:"Intermediate",color:"#3b82f6"}:t>=50?{level:2,name:"Learner",color:"#10b981"}:{level:1,name:"Beginner",color:"#6b7280"}}},{key:"generateRecommendationReason",value:function(t,e){var n=(Date.now()-t.last_seen)/864e5;return e.value<=2?"You're just getting started with ".concat(t.skill,". Here are some beginner-friendly resources."):n>30?"You haven't explored ".concat(t.skill," in ").concat(Math.floor(n)," days. Refresh your knowledge with these resources."):e.value>=4?"You're skilled in ".concat(t.skill,"! Consider these advanced resources or explore related topics."):"You're actively learning ".concat(t.skill,". Keep building your skills with these resources.")}},{key:"getWeeklySkillSummary",value:(i=mt(ut().m(function t(){var e,n,r,i;return ut().w(function(t){for(;;)switch(t.n){case 0:return e=Date.now()-6048e5,t.n=1,this.db.getSkillActivitiesSince(e);case 1:return n=t.v,r={},n.forEach(function(t){r[t.skill]||(r[t.skill]={count:0,time:0}),r[t.skill].count++,r[t.skill].time+=t.time_spent||0}),i=Object.entries(r).sort(function(t,e){return e[1].time-t[1].time})[0],t.a(2,{totalSkillsExplored:Object.keys(r).length,topSkill:i?{name:i[0],count:i[1].count,time:i[1].time}:null,allSkills:Object.entries(r).map(function(t){var e=lt(t,2);return at({skill:e[0]},e[1])})})}},t,this)})),function(){return i.apply(this,arguments)})},{key:"generateLearningPath",value:(r=mt(ut().m(function t(e){var n,r,i;return ut().w(function(t){for(;;)switch(t.n){case 0:if(n=this.skillDatabase[e]){t.n=1;break}return t.a(2,{error:"Skill not found"});case 1:return t.n=2,this.db.getSkillByName(e);case 2:return r=t.v,i=r?this.calculateSkillLevel(r):{level:"Beginner",value:0},t.a(2,{skill:e,currentLevel:i.level,recommendedCourses:n.courses,relatedSkills:n.relatedSkills,milestones:[{hours:1,title:"First Steps",description:"Get familiar with basic concepts"},{hours:5,title:"Foundation",description:"Build core understanding"},{hours:20,title:"Competence",description:"Apply knowledge to real projects"},{hours:50,title:"Proficiency",description:"Master advanced techniques"},{hours:100,title:"Expertise",description:"Teach and create original work"}],currentProgress:r?{hours:(r.total_time/36e5).toFixed(1),visits:r.visit_count}:{hours:0,visits:0}})}},t,this)})),function(t){return r.apply(this,arguments)})}],e&&dt(t.prototype,e),n&&dt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,i,a,o,s,u}();function yt(t){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yt(t)}function gt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return wt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Et(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return Tt(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return a=e,s=0,u=t,h.n=n,o}};function p(n,r){for(s=n,u=r,e=0;!f&&c&&!i&&e<l.length;e++){var i,a=l[e],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=t):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(e=s<2?t:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),e=a[i]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,s<2&&(s=0)}else 1===s&&(e=a.return)&&e.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=t}else if((e=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(e){a=t,s=1,u=e}finally{c=1}}return{value:e,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}e=Object.getPrototypeOf;var l=[][r]?e(e([][r]())):(Tt(e={},r,function(){return this}),e),f=c.prototype=s.prototype=Object.create(l);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Tt(t,i,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=c,Tt(f,"constructor",c),Tt(c,"constructor",u),u.displayName="GeneratorFunction",Tt(c,i,"GeneratorFunction"),Tt(f),Tt(f,i,"Generator"),Tt(f,r,function(){return this}),Tt(f,"toString",function(){return"[object Generator]"}),(Et=function(){return{w:a,m:h}})()}function Tt(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}Tt=function(t,e,n,r){function a(e,n){Tt(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},Tt(t,e,n,r)}function _t(t,e,n,r,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function kt(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(t){_t(a,r,i,o,s,"next",t)}function s(t){_t(a,r,i,o,s,"throw",t)}o(void 0)})}}function St(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ot(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,At(r.key),r)}}function Nt(t,e,n){return e&&Ot(t.prototype,e),n&&Ot(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function At(t){var e=function(t,e){if("object"!=yt(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=yt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==yt(e)?e:e+""}var It=function(){return Nt(function t(){St(this,t),this.apiKey=null,this.provider="openai",this.loadConfig()},[{key:"loadConfig",value:(o=kt(Et().m(function t(){var e=this;return Et().w(function(t){for(;;)switch(t.n){case 0:chrome.storage.local.get(["ai_api_key","ai_provider"],function(t){e.apiKey=t.ai_api_key||null,e.provider=t.ai_provider||"openai"});case 1:return t.a(2)}},t)})),function(){return o.apply(this,arguments)})},{key:"generateSummary",value:(a=kt(Et().m(function t(e){var n;return Et().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.apiKey){t.n=1;break}return console.warn("No AI API key configured"),t.a(2,this.generateFallbackSummary(e));case 1:if(t.p=1,"openai"!==this.provider){t.n=3;break}return t.n=2,this.openAISummary(e);case 2:case 4:return t.a(2,t.v);case 3:if("anthropic"!==this.provider){t.n=5;break}return t.n=4,this.anthropicSummary(e);case 5:t.n=7;break;case 6:return t.p=6,n=t.v,console.error("AI summary error:",n),t.a(2,this.generateFallbackSummary(e));case 7:return t.a(2)}},t,this,[[1,6]])})),function(t){return a.apply(this,arguments)})},{key:"openAISummary",value:(i=kt(Et().m(function t(e){var n,r;return Et().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a concise summarizer. Create a 1-2 sentence summary of the following content that captures the main topic and purpose."},{role:"user",content:e.substring(0,3e3)}],max_tokens:100,temperature:.5})});case 1:return n=t.v,t.n=2,n.json();case 2:return r=t.v,t.a(2,r.choices[0].message.content.trim())}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"predictTags",value:(r=kt(Et().m(function t(e,n){var r;return Et().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.apiKey){t.n=1;break}return t.a(2,this.generateFallbackTags(e,n));case 1:if(t.p=1,"openai"!==this.provider){t.n=3;break}return t.n=2,this.openAITags(e,n);case 2:return t.a(2,t.v);case 3:t.n=5;break;case 4:return t.p=4,r=t.v,console.error("AI tagging error:",r),t.a(2,this.generateFallbackTags(e,n));case 5:return t.a(2)}},t,this,[[1,4]])})),function(t,e){return r.apply(this,arguments)})},{key:"openAITags",value:(n=kt(Et().m(function t(e,n){var r,i,a;return Et().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"Generate 3-5 relevant tags for this content. Return only the tags separated by commas, like: learning, ai, research"},{role:"user",content:"Title: ".concat(n,"\n\nContent: ").concat(e.substring(0,2e3))}],max_tokens:50,temperature:.7})});case 1:return r=t.v,t.n=2,r.json();case 2:return i=t.v,a=i.choices[0].message.content.trim().split(",").map(function(t){return t.trim()}),t.a(2,a.slice(0,5))}},t,this)})),function(t,e){return n.apply(this,arguments)})},{key:"extractTopics",value:(e=kt(Et().m(function t(e){var n;return Et().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.apiKey){t.n=1;break}return t.a(2,this.generateFallbackTopics(e));case 1:if(t.p=1,"openai"!==this.provider){t.n=3;break}return t.n=2,this.openAITopics(e);case 2:return t.a(2,t.v);case 3:t.n=5;break;case 4:return t.p=4,n=t.v,console.error("AI topic extraction error:",n),t.a(2,this.generateFallbackTopics(e));case 5:return t.a(2)}},t,this,[[1,4]])})),function(t){return e.apply(this,arguments)})},{key:"openAITopics",value:(t=kt(Et().m(function t(e){var n,r;return Et().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"Extract 3-5 key topics or concepts from this content. Return only the topics separated by commas."},{role:"user",content:e.substring(0,2e3)}],max_tokens:60,temperature:.5})});case 1:return n=t.v,t.n=2,n.json();case 2:return r=t.v,t.a(2,r.choices[0].message.content.trim().split(",").map(function(t){return t.trim()}))}},t,this)})),function(e){return t.apply(this,arguments)})},{key:"generateFallbackSummary",value:function(t){return t.split(/[.!?]+/).filter(function(t){return t.trim().length>20}).slice(0,2).join(". ").substring(0,200)+"..."}},{key:"generateFallbackTags",value:function(t,e){var n=(e+" "+t).toLowerCase(),r=["the","a","an","and","or","but","in","on","at","to","for","of","with","by","from","is","was","are","were","been","be","have","has","had","do","does","did","will","would","could","should","may","might","can","this","that","these","those"],i=n.split(/\W+/).filter(function(t){return t.length>3&&!r.includes(t)&&!/^\d+$/.test(t)}),a={};return i.forEach(function(t){return a[t]=(a[t]||0)+1}),Object.entries(a).sort(function(t,e){return e[1]-t[1]}).slice(0,5).map(function(t){return gt(t,1)[0]})}},{key:"generateFallbackTopics",value:function(t){return this.generateFallbackTags(t,"")}}]);var t,e,n,r,i,a,o}();new(function(){return Nt(function t(){St(this,t),this.db=new b,this.ai=new It,this.personalityEngine=null,this.goalAlignment=null,this.digitalTwin=null,this.skillTracker=null,this.activeSessions=new Map,this.init()},[{key:"init",value:(y=kt(Et().m(function t(){var e=this;return Et().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.init();case 1:this.personalityEngine=new I(this.ai),this.goalAlignment=new X(this.ai,this.db),this.digitalTwin=new nt(this.ai,this.db),this.skillTracker=new bt(this.ai,this.db),chrome.runtime.onMessage.addListener(function(t,n,r){return e.handleMessage(t,n,r),!0}),chrome.tabs.onUpdated.addListener(function(t,n,r){"complete"===n.status&&e.handleTabLoad(t,r)}),chrome.tabs.onRemoved.addListener(function(t){e.handleTabClose(t)}),chrome.alarms.create("cleanup",{periodInMinutes:60}),chrome.alarms.create("weeklySnapshot",{periodInMinutes:10080}),chrome.alarms.create("moodTracking",{periodInMinutes:30}),chrome.alarms.onAlarm.addListener(function(t){"cleanup"===t.name?e.performCleanup():"weeklySnapshot"===t.name?e.generateWeeklySnapshot():"moodTracking"===t.name&&e.updateMoodTracking()}),console.log("✨ SupriAI Background Service Worker initialized");case 2:return t.a(2)}},t,this)})),function(){return y.apply(this,arguments)})},{key:"handleMessage",value:(v=kt(Et().m(function t(e,n,r){var i,a,o,s,u,c,l,f,h,p,m,d,v,b,y,g,w,E,T,_,k;return Et().w(function(t){for(;;)switch(t.p=t.n){case 0:i=e.type,a=e.data,o=e.url,t.p=1,_=i,t.n="CONTEXT_UPDATE"===_?2:"SAVE_HIGHLIGHT"===_?4:"GET_PREVIOUS_CONTEXT"===_?6:"PAGE_UNLOAD"===_?8:"GET_MEMORIES"===_?10:"SEARCH_MEMORIES"===_?12:"ADD_TAG"===_?14:"GET_STATS"===_?16:"EXPORT_DATA"===_?18:"IMPORT_DATA"===_?20:"GET_PERSONALITY_SNAPSHOTS"===_?22:"GET_INTEREST_EVOLUTION"===_?24:"GET_MOOD_SUMMARY"===_?26:"ADD_GOAL"===_?28:"UPDATE_GOAL"===_?30:"GET_GOALS"===_?32:"TOGGLE_GOAL"===_?33:"DELETE_GOAL"===_?35:"GET_GOAL_INSIGHTS"===_?37:"ASK_TWIN"===_?39:"GET_TWIN_SUMMARY"===_?41:"COMPARE_INTERESTS"===_?42:"GET_SKILL_PROGRESS"===_?44:"GET_LEARNING_PATHS"===_?46:"ADD_CUSTOM_SKILL"===_?48:50;break;case 2:return t.n=3,this.handleContextUpdate(a,n.tab);case 3:return r({success:!0}),t.a(3,51);case 4:return t.n=5,this.saveHighlight(a);case 5:return r({success:!0}),t.a(3,51);case 6:return t.n=7,this.getPreviousContext(o);case 7:return s=t.v,r({context:s}),t.a(3,51);case 8:return t.n=9,this.handlePageUnload(a,n.tab);case 9:return r({success:!0}),t.a(3,51);case 10:return t.n=11,this.getMemories(a);case 11:return u=t.v,r({memories:u}),t.a(3,51);case 12:return t.n=13,this.searchMemories(a.query);case 13:return c=t.v,r({results:c}),t.a(3,51);case 14:return t.n=15,this.addTag(a.url,a.tag);case 15:return r({success:!0}),t.a(3,51);case 16:return t.n=17,this.getStats();case 17:return l=t.v,r({stats:l}),t.a(3,51);case 18:return t.n=19,this.exportData();case 19:return f=t.v,r({data:f}),t.a(3,51);case 20:return t.n=21,this.importData(a);case 21:return r({success:!0}),t.a(3,51);case 22:return t.n=23,this.db.getPersonalitySnapshots(null==a?void 0:a.limit);case 23:return h=t.v,r({snapshots:h}),t.a(3,51);case 24:return t.n=25,this.db.getInterestEvolution();case 25:return p=t.v,r({evolution:p}),t.a(3,51);case 26:return t.n=27,this.db.getWeeklyMoodSummary();case 27:return m=t.v,r({moodSummary:m}),t.a(3,51);case 28:return t.n=29,this.goalAlignment.addGoal(a);case 29:return d=t.v,r({goal:d}),t.a(3,51);case 30:return t.n=31,this.goalAlignment.updateGoal(a);case 31:return r({success:!0}),t.a(3,51);case 32:return v=this.goalAlignment.getGoalProgress(),r({goals:v}),t.a(3,51);case 33:return t.n=34,this.goalAlignment.toggleGoal(a.goalId);case 34:return r({success:!0}),t.a(3,51);case 35:return t.n=36,this.goalAlignment.deleteGoal(a.goalId);case 36:return r({success:!0}),t.a(3,51);case 37:return t.n=38,this.goalAlignment.getWeeklyInsights();case 38:return b=t.v,r({insights:b}),t.a(3,51);case 39:return t.n=40,this.digitalTwin.askTwin(a.question);case 40:return y=t.v,r({response:y}),t.a(3,51);case 41:return g=this.digitalTwin.getTwinSummary(),r({summary:g}),t.a(3,51);case 42:return t.n=43,this.digitalTwin.compareWithPast((null==a?void 0:a.days)||30);case 43:return w=t.v,r({comparison:w}),t.a(3,51);case 44:return t.n=45,this.skillTracker.getSkillProgress();case 45:return E=t.v,r(E),t.a(3,51);case 46:return t.n=47,this.skillTracker.getSkillProgress();case 47:return T=t.v,r({success:!0,paths:T.recommendations||[]}),t.a(3,51);case 48:return t.n=49,this.db.saveSkillActivity({url:"manual",skill:a.skill||e.skill,confidence:1,keywords:"",timestamp:Date.now()});case 49:return r({success:!0}),t.a(3,51);case 50:r({error:"Unknown message type"});case 51:t.n=53;break;case 52:t.p=52,k=t.v,console.error("Error handling message:",k),r({error:k.message});case 53:return t.a(2)}},t,this,[[1,52]])})),function(t,e,n){return v.apply(this,arguments)})},{key:"handleContextUpdate",value:(d=kt(Et().m(function t(e,n){var r,i,a,o;return Et().w(function(t){for(;;)switch(t.n){case 0:if(r=e.url,i=e.title,e.content,!((a=e.timeSpent)<10)){t.n=1;break}return t.a(2);case 1:if((o=this.activeSessions.get(n.id))||(o={url:r,title:i,startTime:Date.now(),tabId:n.id},this.activeSessions.set(n.id,o)),o.lastUpdate=Date.now(),o.context=e,!(a>30)||o.aiProcessed){t.n=2;break}return o.aiProcessed=!0,t.n=2,this.processWithAI(e);case 2:return t.n=3,this.db.updateVisit(e);case 3:return t.a(2)}},t,this)})),function(t,e){return d.apply(this,arguments)})},{key:"processWithAI",value:(m=kt(Et().m(function t(e){var n,r,i,a,o,s,u,c;return Et().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.ai.generateSummary(e.content);case 1:return n=t.v,t.n=2,this.ai.predictTags(e.content,e.title);case 2:return r=t.v,t.n=3,this.ai.extractTopics(e.content);case 3:return i=t.v,t.n=4,this.personalityEngine.analyzeTone(e.content);case 4:return a=t.v,t.n=5,this.personalityEngine.detectEmotionalThemes(e.content);case 5:return o=t.v,t.n=6,this.personalityEngine.analyzeSentiment(e.content);case 6:return s=t.v,t.n=7,this.skillTracker.detectSkills(e.content,e.title,e.url,i);case 7:return t.n=8,this.db.saveAIInsights(e.url,{summary:n,tags:r,topics:i,timestamp:Date.now()});case 8:return t.n=9,this.db.saveMoodData({timestamp:Date.now(),sentiment:s.sentiment,sentimentScore:s.score,emotions:o,tone:a,url:e.url});case 9:return t.n=10,this.digitalTwin.updateTwin({topics:i,tone:a,emotions:o,timestamp:Date.now(),timeSpent:e.timeSpent,category:this.categorizeContent(i)});case 10:return t.n=11,this.goalAlignment.checkAlignment(e.url,e.title,e.content,e.timeSpent);case 11:null!=(u=t.v)&&u.showNudge&&chrome.tabs.query({active:!0,currentWindow:!0},function(t){t[0]&&chrome.tabs.sendMessage(t[0].id,{type:"SHOW_NUDGE",nudge:u})}),console.log("✨ AI processing complete for:",e.url),t.n=13;break;case 12:t.p=12,c=t.v,console.error("AI processing error:",c);case 13:return t.a(2)}},t,this,[[0,12]])})),function(t){return m.apply(this,arguments)})},{key:"categorizeContent",value:function(t){for(var e,n=function(){var e=gt(i[r],2),n=e[0],a=e[1];if(t.some(function(t){return a.some(function(e){return t.toLowerCase().includes(e)})}))return{v:n}},r=0,i=Object.entries({tech:["programming","code","software","development","ai","tech"],learning:["learn","education","tutorial","course","study"],design:["design","ui","ux","creative","art"],business:["business","startup","marketing","finance"],entertainment:["gaming","movies","music","entertainment"],news:["news","current","events","politics"],personal:["health","wellness","lifestyle","personal"]});r<i.length;r++)if(e=n())return e.v;return"other"}},{key:"generateWeeklySnapshot",value:(p=kt(Et().m(function t(){var e,n,r,i,a,o,s,u;return Et().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,console.log("📸 Generating weekly personality snapshot..."),t.n=1,this.db.getWeeklyData();case 1:return e=t.v,t.n=2,this.personalityEngine.generateWeeklySnapshot(e);case 2:return n=t.v,t.n=3,this.personalityEngine.generateWeeklyQuote(n);case 3:return r=t.v,n.quoteOfWeek=r,t.n=4,this.db.savePersonalitySnapshot(n);case 4:return t.n=5,this.db.getPersonalitySnapshots(10);case 5:return i=t.v,a=this.personalityEngine.detectTrendingInterests({topics:e.topics},i.map(function(t){return{topics:t.topTopics}})),o=(new Date).toISOString().slice(0,7),s=a.map(function(t){return{topic:t.topic,period:o,count:t.currentCount,totalTime:0,trendScore:t.trendScore,status:t.status}}),t.n=6,this.db.saveInterestEvolution(s);case 6:console.log("✅ Weekly snapshot generated successfully"),t.n=8;break;case 7:t.p=7,u=t.v,console.error("Weekly snapshot error:",u);case 8:return t.a(2)}},t,this,[[0,7]])})),function(){return p.apply(this,arguments)})},{key:"updateMoodTracking",value:(h=kt(Et().m(function t(){return Et().w(function(t){for(;;)switch(t.n){case 0:console.log("💭 Mood tracking update");case 1:return t.a(2)}},t)})),function(){return h.apply(this,arguments)})},{key:"handleTabLoad",value:(f=kt(Et().m(function t(e,n){var r;return Et().w(function(t){for(;;)switch(t.n){case 0:if(n.url&&!n.url.startsWith("chrome://")){t.n=1;break}return t.a(2);case 1:return t.n=2,this.db.getVisitHistory(n.url);case 2:(r=t.v)&&r.visit_count>0&&console.log("🔮 Returning user to: ".concat(n.url," (").concat(r.visit_count," previous visits)"));case 3:return t.a(2)}},t,this)})),function(t,e){return f.apply(this,arguments)})},{key:"handleTabClose",value:(l=kt(Et().m(function t(e){var n;return Et().w(function(t){for(;;)switch(t.n){case 0:if(!(n=this.activeSessions.get(e))||!n.context){t.n=2;break}return t.n=1,this.db.updateVisit(n.context);case 1:this.activeSessions.delete(e);case 2:return t.a(2)}},t,this)})),function(t){return l.apply(this,arguments)})},{key:"handlePageUnload",value:(c=kt(Et().m(function t(e,n){return Et().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.updateVisit(e);case 1:this.activeSessions.delete(n.id);case 2:return t.a(2)}},t,this)})),function(t,e){return c.apply(this,arguments)})},{key:"saveHighlight",value:(u=kt(Et().m(function t(e){return Et().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.saveHighlight(e);case 1:return t.a(2)}},t,this)})),function(t){return u.apply(this,arguments)})},{key:"getPreviousContext",value:(s=kt(Et().m(function t(e){var n,r,i;return Et().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.getVisitHistory(e);case 1:return n=t.v,t.n=2,this.db.getHighlights(e);case 2:return r=t.v,t.n=3,this.db.getAIInsights(e);case 3:if(i=t.v,n){t.n=4;break}return t.a(2,null);case 4:return t.a(2,{visits:n.visit_count||0,lastVisit:n.last_visit,totalTimeSpent:n.total_time_spent||0,highlights:r.slice(0,5),tags:(null==i?void 0:i.tags)||[],summary:null==i?void 0:i.summary})}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"getMemories",value:(o=kt(Et().m(function t(){var e,n=arguments;return Et().w(function(t){for(;;)switch(t.n){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:{},t.n=1,this.db.getMemories(e);case 1:return t.a(2,t.v)}},t,this)})),function(){return o.apply(this,arguments)})},{key:"searchMemories",value:(a=kt(Et().m(function t(e){var n,r;return Et().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.getMemories();case 1:return n=t.v,r=n.filter(function(t){var n=t.highlights.map(function(t){return t.text||""}).join(" ");return"".concat(t.title," ").concat(n).toLowerCase().includes(e.toLowerCase())}),t.a(2,r.sort(function(t,n){var r=t.title.toLowerCase().split(e.toLowerCase()).length;return n.title.toLowerCase().split(e.toLowerCase()).length-r}))}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"addTag",value:(i=kt(Et().m(function t(e,n){return Et().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.addTag(e,n);case 1:return t.a(2)}},t,this)})),function(t,e){return i.apply(this,arguments)})},{key:"getStats",value:(r=kt(Et().m(function t(){return Et().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.getStats();case 1:return t.a(2,t.v)}},t,this)})),function(){return r.apply(this,arguments)})},{key:"exportData",value:(n=kt(Et().m(function t(){return Et().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.exportData();case 1:return t.a(2,t.v)}},t,this)})),function(){return n.apply(this,arguments)})},{key:"importData",value:(e=kt(Et().m(function t(e){return Et().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.importData(e);case 1:return t.a(2,t.v)}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"performCleanup",value:(t=kt(Et().m(function t(){return Et().w(function(t){for(;;)switch(t.n){case 0:return console.log("🧹 Performing cleanup..."),t.n=1,this.db.cleanup();case 1:return t.a(2)}},t,this)})),function(){return t.apply(this,arguments)})}]);var t,e,n,r,i,a,o,s,u,c,l,f,h,p,m,d,v,y}())})()})();