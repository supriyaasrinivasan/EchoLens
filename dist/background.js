/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/background/background.js":
/*!**************************************!*\
  !*** ./src/background/background.js ***!
  \**************************************/
/***/ (() => {

eval("{function _slicedToArray(r, e) { return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if (\"string\" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(r) { if (Array.isArray(r)) return r; }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = \"function\" == typeof Symbol ? Symbol : {}, n = r.iterator || \"@@iterator\", o = r.toStringTag || \"@@toStringTag\"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, \"_invoke\", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError(\"Generator is already running\"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = \"next\"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i[\"return\"]) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, \"constructor\", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", _regeneratorDefine2(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, \"Generator\"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, \"toString\", function () { return \"[object Generator]\"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }\nfunction _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, \"\", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2)); }, _regeneratorDefine2(e, r, n, t); }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nfunction _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\"); }\nfunction _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }\nfunction _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", { writable: !1 }), e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\n// EchoLens Background Service Worker\n// Handles data storage, AI processing, and cross-extension communication\n// Storage Manager Class\nvar StorageManager = /*#__PURE__*/function () {\n  function StorageManager() {\n    _classCallCheck(this, StorageManager);\n    this.KEYS = {\n      VISITS: 'echolens_visits',\n      HIGHLIGHTS: 'echolens_highlights',\n      INSIGHTS: 'echolens_insights',\n      TAGS: 'echolens_tags',\n      SETTINGS: 'echolens_settings'\n    };\n  }\n  return _createClass(StorageManager, [{\n    key: \"get\",\n    value: function () {\n      var _get = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(key) {\n        return _regenerator().w(function (_context) {\n          while (1) switch (_context.n) {\n            case 0:\n              return _context.a(2, new Promise(function (resolve) {\n                chrome.storage.local.get([key], function (result) {\n                  resolve(result[key] || null);\n                });\n              }));\n          }\n        }, _callee);\n      }));\n      function get(_x) {\n        return _get.apply(this, arguments);\n      }\n      return get;\n    }()\n  }, {\n    key: \"set\",\n    value: function () {\n      var _set = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2(key, value) {\n        return _regenerator().w(function (_context2) {\n          while (1) switch (_context2.n) {\n            case 0:\n              return _context2.a(2, new Promise(function (resolve) {\n                chrome.storage.local.set(_defineProperty({}, key, value), function () {\n                  resolve();\n                });\n              }));\n          }\n        }, _callee2);\n      }));\n      function set(_x2, _x3) {\n        return _set.apply(this, arguments);\n      }\n      return set;\n    }()\n  }, {\n    key: \"updateVisit\",\n    value: function () {\n      var _updateVisit = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3(context) {\n        var url, title, content, timeSpent, scrollDepth, interactions, highlights, visits, urlKey, _t;\n        return _regenerator().w(function (_context3) {\n          while (1) switch (_context3.n) {\n            case 0:\n              url = context.url, title = context.title, content = context.content, timeSpent = context.timeSpent, scrollDepth = context.scrollDepth, interactions = context.interactions, highlights = context.highlights;\n              _context3.n = 1;\n              return this.get(this.KEYS.VISITS);\n            case 1:\n              _t = _context3.v;\n              if (_t) {\n                _context3.n = 2;\n                break;\n              }\n              _t = {};\n            case 2:\n              visits = _t;\n              urlKey = this.hashURL(url);\n              if (!visits[urlKey]) {\n                visits[urlKey] = {\n                  url: url,\n                  title: title,\n                  firstVisit: Date.now(),\n                  visits: 0,\n                  totalTimeSpent: 0,\n                  sessions: []\n                };\n              }\n              visits[urlKey].visits += 1;\n              visits[urlKey].totalTimeSpent += timeSpent;\n              visits[urlKey].lastVisit = Date.now();\n              visits[urlKey].title = title;\n              visits[urlKey].sessions.push({\n                timestamp: Date.now(),\n                timeSpent: timeSpent,\n                scrollDepth: scrollDepth,\n                interactions: interactions,\n                highlightCount: (highlights === null || highlights === void 0 ? void 0 : highlights.length) || 0\n              });\n              if (visits[urlKey].sessions.length > 50) {\n                visits[urlKey].sessions = visits[urlKey].sessions.slice(-50);\n              }\n              _context3.n = 3;\n              return this.set(this.KEYS.VISITS, visits);\n            case 3:\n              return _context3.a(2);\n          }\n        }, _callee3, this);\n      }));\n      function updateVisit(_x4) {\n        return _updateVisit.apply(this, arguments);\n      }\n      return updateVisit;\n    }()\n  }, {\n    key: \"getVisitHistory\",\n    value: function () {\n      var _getVisitHistory = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4(url) {\n        var visits, urlKey, _t2;\n        return _regenerator().w(function (_context4) {\n          while (1) switch (_context4.n) {\n            case 0:\n              _context4.n = 1;\n              return this.get(this.KEYS.VISITS);\n            case 1:\n              _t2 = _context4.v;\n              if (_t2) {\n                _context4.n = 2;\n                break;\n              }\n              _t2 = {};\n            case 2:\n              visits = _t2;\n              urlKey = this.hashURL(url);\n              return _context4.a(2, visits[urlKey] || null);\n          }\n        }, _callee4, this);\n      }));\n      function getVisitHistory(_x5) {\n        return _getVisitHistory.apply(this, arguments);\n      }\n      return getVisitHistory;\n    }()\n  }, {\n    key: \"saveHighlight\",\n    value: function () {\n      var _saveHighlight = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5(data) {\n        var text, url, title, timestamp, highlights, urlKey, _t3;\n        return _regenerator().w(function (_context5) {\n          while (1) switch (_context5.n) {\n            case 0:\n              text = data.text, url = data.url, title = data.title, timestamp = data.timestamp;\n              _context5.n = 1;\n              return this.get(this.KEYS.HIGHLIGHTS);\n            case 1:\n              _t3 = _context5.v;\n              if (_t3) {\n                _context5.n = 2;\n                break;\n              }\n              _t3 = {};\n            case 2:\n              highlights = _t3;\n              urlKey = this.hashURL(url);\n              if (!highlights[urlKey]) {\n                highlights[urlKey] = {\n                  url: url,\n                  title: title,\n                  items: []\n                };\n              }\n              highlights[urlKey].items.push({\n                text: text,\n                timestamp: timestamp\n              });\n              if (highlights[urlKey].items.length > 100) {\n                highlights[urlKey].items = highlights[urlKey].items.slice(-100);\n              }\n              _context5.n = 3;\n              return this.set(this.KEYS.HIGHLIGHTS, highlights);\n            case 3:\n              return _context5.a(2);\n          }\n        }, _callee5, this);\n      }));\n      function saveHighlight(_x6) {\n        return _saveHighlight.apply(this, arguments);\n      }\n      return saveHighlight;\n    }()\n  }, {\n    key: \"getHighlights\",\n    value: function () {\n      var _getHighlights = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6(url) {\n        var _highlights$urlKey;\n        var highlights, urlKey, _t4;\n        return _regenerator().w(function (_context6) {\n          while (1) switch (_context6.n) {\n            case 0:\n              _context6.n = 1;\n              return this.get(this.KEYS.HIGHLIGHTS);\n            case 1:\n              _t4 = _context6.v;\n              if (_t4) {\n                _context6.n = 2;\n                break;\n              }\n              _t4 = {};\n            case 2:\n              highlights = _t4;\n              urlKey = this.hashURL(url);\n              return _context6.a(2, ((_highlights$urlKey = highlights[urlKey]) === null || _highlights$urlKey === void 0 ? void 0 : _highlights$urlKey.items) || []);\n          }\n        }, _callee6, this);\n      }));\n      function getHighlights(_x7) {\n        return _getHighlights.apply(this, arguments);\n      }\n      return getHighlights;\n    }()\n  }, {\n    key: \"saveAIInsights\",\n    value: function () {\n      var _saveAIInsights = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7(url, insights) {\n        var allInsights, urlKey, _t5;\n        return _regenerator().w(function (_context7) {\n          while (1) switch (_context7.n) {\n            case 0:\n              _context7.n = 1;\n              return this.get(this.KEYS.INSIGHTS);\n            case 1:\n              _t5 = _context7.v;\n              if (_t5) {\n                _context7.n = 2;\n                break;\n              }\n              _t5 = {};\n            case 2:\n              allInsights = _t5;\n              urlKey = this.hashURL(url);\n              allInsights[urlKey] = _objectSpread({\n                url: url\n              }, insights);\n              _context7.n = 3;\n              return this.set(this.KEYS.INSIGHTS, allInsights);\n            case 3:\n              return _context7.a(2);\n          }\n        }, _callee7, this);\n      }));\n      function saveAIInsights(_x8, _x9) {\n        return _saveAIInsights.apply(this, arguments);\n      }\n      return saveAIInsights;\n    }()\n  }, {\n    key: \"getAIInsights\",\n    value: function () {\n      var _getAIInsights = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee8(url) {\n        var insights, urlKey, _t6;\n        return _regenerator().w(function (_context8) {\n          while (1) switch (_context8.n) {\n            case 0:\n              _context8.n = 1;\n              return this.get(this.KEYS.INSIGHTS);\n            case 1:\n              _t6 = _context8.v;\n              if (_t6) {\n                _context8.n = 2;\n                break;\n              }\n              _t6 = {};\n            case 2:\n              insights = _t6;\n              urlKey = this.hashURL(url);\n              return _context8.a(2, insights[urlKey] || null);\n          }\n        }, _callee8, this);\n      }));\n      function getAIInsights(_x0) {\n        return _getAIInsights.apply(this, arguments);\n      }\n      return getAIInsights;\n    }()\n  }, {\n    key: \"addTag\",\n    value: function () {\n      var _addTag = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee9(url, tag) {\n        var tags, urlKey, _t7;\n        return _regenerator().w(function (_context9) {\n          while (1) switch (_context9.n) {\n            case 0:\n              _context9.n = 1;\n              return this.get(this.KEYS.TAGS);\n            case 1:\n              _t7 = _context9.v;\n              if (_t7) {\n                _context9.n = 2;\n                break;\n              }\n              _t7 = {};\n            case 2:\n              tags = _t7;\n              urlKey = this.hashURL(url);\n              if (!tags[urlKey]) {\n                tags[urlKey] = {\n                  url: url,\n                  tags: []\n                };\n              }\n              if (!tags[urlKey].tags.includes(tag)) {\n                tags[urlKey].tags.push(tag);\n              }\n              _context9.n = 3;\n              return this.set(this.KEYS.TAGS, tags);\n            case 3:\n              return _context9.a(2);\n          }\n        }, _callee9, this);\n      }));\n      function addTag(_x1, _x10) {\n        return _addTag.apply(this, arguments);\n      }\n      return addTag;\n    }()\n  }, {\n    key: \"getMemories\",\n    value: function () {\n      var _getMemories = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee0() {\n        var filters,\n          visits,\n          highlights,\n          insights,\n          tags,\n          memories,\n          filtered,\n          _args0 = arguments,\n          _t8,\n          _t9,\n          _t0,\n          _t1;\n        return _regenerator().w(function (_context0) {\n          while (1) switch (_context0.n) {\n            case 0:\n              filters = _args0.length > 0 && _args0[0] !== undefined ? _args0[0] : {};\n              _context0.n = 1;\n              return this.get(this.KEYS.VISITS);\n            case 1:\n              _t8 = _context0.v;\n              if (_t8) {\n                _context0.n = 2;\n                break;\n              }\n              _t8 = {};\n            case 2:\n              visits = _t8;\n              _context0.n = 3;\n              return this.get(this.KEYS.HIGHLIGHTS);\n            case 3:\n              _t9 = _context0.v;\n              if (_t9) {\n                _context0.n = 4;\n                break;\n              }\n              _t9 = {};\n            case 4:\n              highlights = _t9;\n              _context0.n = 5;\n              return this.get(this.KEYS.INSIGHTS);\n            case 5:\n              _t0 = _context0.v;\n              if (_t0) {\n                _context0.n = 6;\n                break;\n              }\n              _t0 = {};\n            case 6:\n              insights = _t0;\n              _context0.n = 7;\n              return this.get(this.KEYS.TAGS);\n            case 7:\n              _t1 = _context0.v;\n              if (_t1) {\n                _context0.n = 8;\n                break;\n              }\n              _t1 = {};\n            case 8:\n              tags = _t1;\n              memories = Object.keys(visits).map(function (urlKey) {\n                var _highlights$urlKey2, _tags$urlKey;\n                var visit = visits[urlKey];\n                return {\n                  url: visit.url,\n                  title: visit.title,\n                  visits: visit.visits,\n                  lastVisit: visit.lastVisit,\n                  firstVisit: visit.firstVisit,\n                  totalTimeSpent: visit.totalTimeSpent,\n                  highlights: ((_highlights$urlKey2 = highlights[urlKey]) === null || _highlights$urlKey2 === void 0 ? void 0 : _highlights$urlKey2.items) || [],\n                  insights: insights[urlKey] || null,\n                  tags: ((_tags$urlKey = tags[urlKey]) === null || _tags$urlKey === void 0 ? void 0 : _tags$urlKey.tags) || [],\n                  sessions: visit.sessions\n                };\n              });\n              filtered = memories;\n              if (filters.minVisits) {\n                filtered = filtered.filter(function (m) {\n                  return m.visits >= filters.minVisits;\n                });\n              }\n              if (filters.minTimeSpent) {\n                filtered = filtered.filter(function (m) {\n                  return m.totalTimeSpent >= filters.minTimeSpent;\n                });\n              }\n              if (filters.tag) {\n                filtered = filtered.filter(function (m) {\n                  return m.tags.includes(filters.tag);\n                });\n              }\n              if (filters.dateFrom) {\n                filtered = filtered.filter(function (m) {\n                  return m.lastVisit >= filters.dateFrom;\n                });\n              }\n              filtered.sort(function (a, b) {\n                return b.lastVisit - a.lastVisit;\n              });\n              return _context0.a(2, filtered);\n          }\n        }, _callee0, this);\n      }));\n      function getMemories() {\n        return _getMemories.apply(this, arguments);\n      }\n      return getMemories;\n    }()\n  }, {\n    key: \"getAllMemories\",\n    value: function () {\n      var _getAllMemories = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee1() {\n        return _regenerator().w(function (_context1) {\n          while (1) switch (_context1.n) {\n            case 0:\n              _context1.n = 1;\n              return this.getMemories();\n            case 1:\n              return _context1.a(2, _context1.v);\n          }\n        }, _callee1, this);\n      }));\n      function getAllMemories() {\n        return _getAllMemories.apply(this, arguments);\n      }\n      return getAllMemories;\n    }()\n  }, {\n    key: \"getStats\",\n    value: function () {\n      var _getStats = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee10() {\n        var visits, highlights, totalVisits, totalTimeSpent, totalHighlights, totalSessions, oneWeekAgo, thisWeekVisits, _t10, _t11;\n        return _regenerator().w(function (_context10) {\n          while (1) switch (_context10.n) {\n            case 0:\n              _context10.n = 1;\n              return this.get(this.KEYS.VISITS);\n            case 1:\n              _t10 = _context10.v;\n              if (_t10) {\n                _context10.n = 2;\n                break;\n              }\n              _t10 = {};\n            case 2:\n              visits = _t10;\n              _context10.n = 3;\n              return this.get(this.KEYS.HIGHLIGHTS);\n            case 3:\n              _t11 = _context10.v;\n              if (_t11) {\n                _context10.n = 4;\n                break;\n              }\n              _t11 = {};\n            case 4:\n              highlights = _t11;\n              totalVisits = Object.keys(visits).length;\n              totalTimeSpent = Object.values(visits).reduce(function (sum, v) {\n                return sum + v.totalTimeSpent;\n              }, 0);\n              totalHighlights = Object.values(highlights).reduce(function (sum, h) {\n                return sum + h.items.length;\n              }, 0);\n              totalSessions = Object.values(visits).reduce(function (sum, v) {\n                return sum + v.visits;\n              }, 0);\n              oneWeekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;\n              thisWeekVisits = Object.values(visits).filter(function (v) {\n                return v.lastVisit >= oneWeekAgo;\n              }).length;\n              return _context10.a(2, {\n                totalVisits: totalVisits,\n                totalTimeSpent: totalTimeSpent,\n                totalHighlights: totalHighlights,\n                totalSessions: totalSessions,\n                thisWeekVisits: thisWeekVisits,\n                averageTimePerVisit: totalSessions > 0 ? Math.floor(totalTimeSpent / totalSessions) : 0\n              });\n          }\n        }, _callee10, this);\n      }));\n      function getStats() {\n        return _getStats.apply(this, arguments);\n      }\n      return getStats;\n    }()\n  }, {\n    key: \"cleanup\",\n    value: function () {\n      var _cleanup = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee11() {\n        return _regenerator().w(function (_context11) {\n          while (1) switch (_context11.n) {\n            case 0:\n              console.log('Cleanup would happen here for free tier users');\n            case 1:\n              return _context11.a(2);\n          }\n        }, _callee11);\n      }));\n      function cleanup() {\n        return _cleanup.apply(this, arguments);\n      }\n      return cleanup;\n    }()\n  }, {\n    key: \"hashURL\",\n    value: function hashURL(url) {\n      return url.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 100);\n    }\n  }, {\n    key: \"exportData\",\n    value: function () {\n      var _exportData = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee12() {\n        var visits, highlights, insights, tags, settings, _t12, _t13, _t14, _t15, _t16;\n        return _regenerator().w(function (_context12) {\n          while (1) switch (_context12.n) {\n            case 0:\n              _context12.n = 1;\n              return this.get(this.KEYS.VISITS);\n            case 1:\n              _t12 = _context12.v;\n              if (_t12) {\n                _context12.n = 2;\n                break;\n              }\n              _t12 = {};\n            case 2:\n              visits = _t12;\n              _context12.n = 3;\n              return this.get(this.KEYS.HIGHLIGHTS);\n            case 3:\n              _t13 = _context12.v;\n              if (_t13) {\n                _context12.n = 4;\n                break;\n              }\n              _t13 = {};\n            case 4:\n              highlights = _t13;\n              _context12.n = 5;\n              return this.get(this.KEYS.INSIGHTS);\n            case 5:\n              _t14 = _context12.v;\n              if (_t14) {\n                _context12.n = 6;\n                break;\n              }\n              _t14 = {};\n            case 6:\n              insights = _t14;\n              _context12.n = 7;\n              return this.get(this.KEYS.TAGS);\n            case 7:\n              _t15 = _context12.v;\n              if (_t15) {\n                _context12.n = 8;\n                break;\n              }\n              _t15 = {};\n            case 8:\n              tags = _t15;\n              _context12.n = 9;\n              return this.get(this.KEYS.SETTINGS);\n            case 9:\n              _t16 = _context12.v;\n              if (_t16) {\n                _context12.n = 10;\n                break;\n              }\n              _t16 = {};\n            case 10:\n              settings = _t16;\n              return _context12.a(2, {\n                visits: visits,\n                highlights: highlights,\n                insights: insights,\n                tags: tags,\n                settings: settings,\n                exportDate: Date.now()\n              });\n          }\n        }, _callee12, this);\n      }));\n      function exportData() {\n        return _exportData.apply(this, arguments);\n      }\n      return exportData;\n    }()\n  }, {\n    key: \"importData\",\n    value: function () {\n      var _importData = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee13(data) {\n        return _regenerator().w(function (_context13) {\n          while (1) switch (_context13.n) {\n            case 0:\n              if (!data.visits) {\n                _context13.n = 1;\n                break;\n              }\n              _context13.n = 1;\n              return this.set(this.KEYS.VISITS, data.visits);\n            case 1:\n              if (!data.highlights) {\n                _context13.n = 2;\n                break;\n              }\n              _context13.n = 2;\n              return this.set(this.KEYS.HIGHLIGHTS, data.highlights);\n            case 2:\n              if (!data.insights) {\n                _context13.n = 3;\n                break;\n              }\n              _context13.n = 3;\n              return this.set(this.KEYS.INSIGHTS, data.insights);\n            case 3:\n              if (!data.tags) {\n                _context13.n = 4;\n                break;\n              }\n              _context13.n = 4;\n              return this.set(this.KEYS.TAGS, data.tags);\n            case 4:\n              if (!data.settings) {\n                _context13.n = 5;\n                break;\n              }\n              _context13.n = 5;\n              return this.set(this.KEYS.SETTINGS, data.settings);\n            case 5:\n              return _context13.a(2);\n          }\n        }, _callee13, this);\n      }));\n      function importData(_x11) {\n        return _importData.apply(this, arguments);\n      }\n      return importData;\n    }()\n  }]);\n}(); // AI Processor Class\nvar AIProcessor = /*#__PURE__*/function () {\n  function AIProcessor() {\n    _classCallCheck(this, AIProcessor);\n    this.apiKey = null;\n    this.provider = 'openai';\n    this.loadConfig();\n  }\n  return _createClass(AIProcessor, [{\n    key: \"loadConfig\",\n    value: function () {\n      var _loadConfig = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee14() {\n        var _this = this;\n        return _regenerator().w(function (_context14) {\n          while (1) switch (_context14.n) {\n            case 0:\n              chrome.storage.local.get(['ai_api_key', 'ai_provider'], function (result) {\n                _this.apiKey = result.ai_api_key || null;\n                _this.provider = result.ai_provider || 'openai';\n              });\n            case 1:\n              return _context14.a(2);\n          }\n        }, _callee14);\n      }));\n      function loadConfig() {\n        return _loadConfig.apply(this, arguments);\n      }\n      return loadConfig;\n    }()\n  }, {\n    key: \"generateSummary\",\n    value: function () {\n      var _generateSummary = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee15(content) {\n        var _t17;\n        return _regenerator().w(function (_context15) {\n          while (1) switch (_context15.p = _context15.n) {\n            case 0:\n              if (this.apiKey) {\n                _context15.n = 1;\n                break;\n              }\n              console.warn('No AI API key configured');\n              return _context15.a(2, this.generateFallbackSummary(content));\n            case 1:\n              _context15.p = 1;\n              if (!(this.provider === 'openai')) {\n                _context15.n = 3;\n                break;\n              }\n              _context15.n = 2;\n              return this.openAISummary(content);\n            case 2:\n              return _context15.a(2, _context15.v);\n            case 3:\n              if (!(this.provider === 'anthropic')) {\n                _context15.n = 5;\n                break;\n              }\n              _context15.n = 4;\n              return this.anthropicSummary(content);\n            case 4:\n              return _context15.a(2, _context15.v);\n            case 5:\n              _context15.n = 7;\n              break;\n            case 6:\n              _context15.p = 6;\n              _t17 = _context15.v;\n              console.error('AI summary error:', _t17);\n              return _context15.a(2, this.generateFallbackSummary(content));\n            case 7:\n              return _context15.a(2);\n          }\n        }, _callee15, this, [[1, 6]]);\n      }));\n      function generateSummary(_x12) {\n        return _generateSummary.apply(this, arguments);\n      }\n      return generateSummary;\n    }()\n  }, {\n    key: \"openAISummary\",\n    value: function () {\n      var _openAISummary = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee16(content) {\n        var response, data;\n        return _regenerator().w(function (_context16) {\n          while (1) switch (_context16.n) {\n            case 0:\n              _context16.n = 1;\n              return fetch('https://api.openai.com/v1/chat/completions', {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json',\n                  'Authorization': \"Bearer \".concat(this.apiKey)\n                },\n                body: JSON.stringify({\n                  model: 'gpt-3.5-turbo',\n                  messages: [{\n                    role: 'system',\n                    content: 'You are a concise summarizer. Create a 1-2 sentence summary of the following content that captures the main topic and purpose.'\n                  }, {\n                    role: 'user',\n                    content: content.substring(0, 3000)\n                  }],\n                  max_tokens: 100,\n                  temperature: 0.5\n                })\n              });\n            case 1:\n              response = _context16.v;\n              _context16.n = 2;\n              return response.json();\n            case 2:\n              data = _context16.v;\n              return _context16.a(2, data.choices[0].message.content.trim());\n          }\n        }, _callee16, this);\n      }));\n      function openAISummary(_x13) {\n        return _openAISummary.apply(this, arguments);\n      }\n      return openAISummary;\n    }()\n  }, {\n    key: \"predictTags\",\n    value: function () {\n      var _predictTags = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee17(content, title) {\n        var _t18;\n        return _regenerator().w(function (_context17) {\n          while (1) switch (_context17.p = _context17.n) {\n            case 0:\n              if (this.apiKey) {\n                _context17.n = 1;\n                break;\n              }\n              return _context17.a(2, this.generateFallbackTags(content, title));\n            case 1:\n              _context17.p = 1;\n              if (!(this.provider === 'openai')) {\n                _context17.n = 3;\n                break;\n              }\n              _context17.n = 2;\n              return this.openAITags(content, title);\n            case 2:\n              return _context17.a(2, _context17.v);\n            case 3:\n              _context17.n = 5;\n              break;\n            case 4:\n              _context17.p = 4;\n              _t18 = _context17.v;\n              console.error('AI tagging error:', _t18);\n              return _context17.a(2, this.generateFallbackTags(content, title));\n            case 5:\n              return _context17.a(2);\n          }\n        }, _callee17, this, [[1, 4]]);\n      }));\n      function predictTags(_x14, _x15) {\n        return _predictTags.apply(this, arguments);\n      }\n      return predictTags;\n    }()\n  }, {\n    key: \"openAITags\",\n    value: function () {\n      var _openAITags = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee18(content, title) {\n        var response, data, tags;\n        return _regenerator().w(function (_context18) {\n          while (1) switch (_context18.n) {\n            case 0:\n              _context18.n = 1;\n              return fetch('https://api.openai.com/v1/chat/completions', {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json',\n                  'Authorization': \"Bearer \".concat(this.apiKey)\n                },\n                body: JSON.stringify({\n                  model: 'gpt-3.5-turbo',\n                  messages: [{\n                    role: 'system',\n                    content: 'Generate 3-5 relevant tags for this content. Return only the tags separated by commas, like: learning, ai, research'\n                  }, {\n                    role: 'user',\n                    content: \"Title: \".concat(title, \"\\n\\nContent: \").concat(content.substring(0, 2000))\n                  }],\n                  max_tokens: 50,\n                  temperature: 0.7\n                })\n              });\n            case 1:\n              response = _context18.v;\n              _context18.n = 2;\n              return response.json();\n            case 2:\n              data = _context18.v;\n              tags = data.choices[0].message.content.trim().split(',').map(function (t) {\n                return t.trim();\n              });\n              return _context18.a(2, tags.slice(0, 5));\n          }\n        }, _callee18, this);\n      }));\n      function openAITags(_x16, _x17) {\n        return _openAITags.apply(this, arguments);\n      }\n      return openAITags;\n    }()\n  }, {\n    key: \"extractTopics\",\n    value: function () {\n      var _extractTopics = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee19(content) {\n        var _t19;\n        return _regenerator().w(function (_context19) {\n          while (1) switch (_context19.p = _context19.n) {\n            case 0:\n              if (this.apiKey) {\n                _context19.n = 1;\n                break;\n              }\n              return _context19.a(2, this.generateFallbackTopics(content));\n            case 1:\n              _context19.p = 1;\n              if (!(this.provider === 'openai')) {\n                _context19.n = 3;\n                break;\n              }\n              _context19.n = 2;\n              return this.openAITopics(content);\n            case 2:\n              return _context19.a(2, _context19.v);\n            case 3:\n              _context19.n = 5;\n              break;\n            case 4:\n              _context19.p = 4;\n              _t19 = _context19.v;\n              console.error('AI topic extraction error:', _t19);\n              return _context19.a(2, this.generateFallbackTopics(content));\n            case 5:\n              return _context19.a(2);\n          }\n        }, _callee19, this, [[1, 4]]);\n      }));\n      function extractTopics(_x18) {\n        return _extractTopics.apply(this, arguments);\n      }\n      return extractTopics;\n    }()\n  }, {\n    key: \"openAITopics\",\n    value: function () {\n      var _openAITopics = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee20(content) {\n        var response, data;\n        return _regenerator().w(function (_context20) {\n          while (1) switch (_context20.n) {\n            case 0:\n              _context20.n = 1;\n              return fetch('https://api.openai.com/v1/chat/completions', {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json',\n                  'Authorization': \"Bearer \".concat(this.apiKey)\n                },\n                body: JSON.stringify({\n                  model: 'gpt-3.5-turbo',\n                  messages: [{\n                    role: 'system',\n                    content: 'Extract 3-5 key topics or concepts from this content. Return only the topics separated by commas.'\n                  }, {\n                    role: 'user',\n                    content: content.substring(0, 2000)\n                  }],\n                  max_tokens: 60,\n                  temperature: 0.5\n                })\n              });\n            case 1:\n              response = _context20.v;\n              _context20.n = 2;\n              return response.json();\n            case 2:\n              data = _context20.v;\n              return _context20.a(2, data.choices[0].message.content.trim().split(',').map(function (t) {\n                return t.trim();\n              }));\n          }\n        }, _callee20, this);\n      }));\n      function openAITopics(_x19) {\n        return _openAITopics.apply(this, arguments);\n      }\n      return openAITopics;\n    }()\n  }, {\n    key: \"generateFallbackSummary\",\n    value: function generateFallbackSummary(content) {\n      var sentences = content.split(/[.!?]+/).filter(function (s) {\n        return s.trim().length > 20;\n      });\n      return sentences.slice(0, 2).join('. ').substring(0, 200) + '...';\n    }\n  }, {\n    key: \"generateFallbackTags\",\n    value: function generateFallbackTags(content, title) {\n      var text = (title + ' ' + content).toLowerCase();\n      var commonWords = ['the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by', 'from', 'is', 'was', 'are', 'were', 'been', 'be', 'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'could', 'should', 'may', 'might', 'can', 'this', 'that', 'these', 'those'];\n      var words = text.split(/\\W+/).filter(function (w) {\n        return w.length > 3 && !commonWords.includes(w) && !/^\\d+$/.test(w);\n      });\n      var freq = {};\n      words.forEach(function (w) {\n        return freq[w] = (freq[w] || 0) + 1;\n      });\n      var sorted = Object.entries(freq).sort(function (a, b) {\n        return b[1] - a[1];\n      }).slice(0, 5).map(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 1),\n          word = _ref2[0];\n        return word;\n      });\n      return sorted;\n    }\n  }, {\n    key: \"generateFallbackTopics\",\n    value: function generateFallbackTopics(content) {\n      return this.generateFallbackTags(content, '');\n    }\n  }]);\n}(); // Main Background Worker Class\nvar EchoLensBackground = /*#__PURE__*/function () {\n  function EchoLensBackground() {\n    _classCallCheck(this, EchoLensBackground);\n    this.storage = new StorageManager();\n    this.ai = new AIProcessor();\n    this.activeSessions = new Map();\n    this.init();\n  }\n  return _createClass(EchoLensBackground, [{\n    key: \"init\",\n    value: function init() {\n      var _this2 = this;\n      // Listen for messages from content scripts\n      chrome.runtime.onMessage.addListener(function (message, sender, sendResponse) {\n        _this2.handleMessage(message, sender, sendResponse);\n        return true; // Keep channel open for async response\n      });\n\n      // Listen for tab updates\n      chrome.tabs.onUpdated.addListener(function (tabId, changeInfo, tab) {\n        if (changeInfo.status === 'complete') {\n          _this2.handleTabLoad(tabId, tab);\n        }\n      });\n\n      // Listen for tab closures\n      chrome.tabs.onRemoved.addListener(function (tabId) {\n        _this2.handleTabClose(tabId);\n      });\n\n      // Set up periodic cleanup\n      chrome.alarms.create('cleanup', {\n        periodInMinutes: 60\n      });\n      chrome.alarms.onAlarm.addListener(function (alarm) {\n        if (alarm.name === 'cleanup') {\n          _this2.performCleanup();\n        }\n      });\n      console.log('🌌 EchoLens Background Service Worker initialized');\n    }\n  }, {\n    key: \"handleMessage\",\n    value: function () {\n      var _handleMessage = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee21(message, sender, sendResponse) {\n        var type, data, url, context, memories, results, stats, exportData, _t20, _t21;\n        return _regenerator().w(function (_context21) {\n          while (1) switch (_context21.p = _context21.n) {\n            case 0:\n              type = message.type, data = message.data, url = message.url;\n              _context21.p = 1;\n              _t20 = type;\n              _context21.n = _t20 === 'CONTEXT_UPDATE' ? 2 : _t20 === 'SAVE_HIGHLIGHT' ? 4 : _t20 === 'GET_PREVIOUS_CONTEXT' ? 6 : _t20 === 'PAGE_UNLOAD' ? 8 : _t20 === 'GET_MEMORIES' ? 10 : _t20 === 'SEARCH_MEMORIES' ? 12 : _t20 === 'ADD_TAG' ? 14 : _t20 === 'GET_STATS' ? 16 : _t20 === 'EXPORT_DATA' ? 18 : _t20 === 'IMPORT_DATA' ? 20 : 22;\n              break;\n            case 2:\n              _context21.n = 3;\n              return this.handleContextUpdate(data, sender.tab);\n            case 3:\n              sendResponse({\n                success: true\n              });\n              return _context21.a(3, 23);\n            case 4:\n              _context21.n = 5;\n              return this.saveHighlight(data);\n            case 5:\n              sendResponse({\n                success: true\n              });\n              return _context21.a(3, 23);\n            case 6:\n              _context21.n = 7;\n              return this.getPreviousContext(url);\n            case 7:\n              context = _context21.v;\n              sendResponse({\n                context: context\n              });\n              return _context21.a(3, 23);\n            case 8:\n              _context21.n = 9;\n              return this.handlePageUnload(data, sender.tab);\n            case 9:\n              sendResponse({\n                success: true\n              });\n              return _context21.a(3, 23);\n            case 10:\n              _context21.n = 11;\n              return this.getMemories(data);\n            case 11:\n              memories = _context21.v;\n              sendResponse({\n                memories: memories\n              });\n              return _context21.a(3, 23);\n            case 12:\n              _context21.n = 13;\n              return this.searchMemories(data.query);\n            case 13:\n              results = _context21.v;\n              sendResponse({\n                results: results\n              });\n              return _context21.a(3, 23);\n            case 14:\n              _context21.n = 15;\n              return this.addTag(data.url, data.tag);\n            case 15:\n              sendResponse({\n                success: true\n              });\n              return _context21.a(3, 23);\n            case 16:\n              _context21.n = 17;\n              return this.getStats();\n            case 17:\n              stats = _context21.v;\n              sendResponse({\n                stats: stats\n              });\n              return _context21.a(3, 23);\n            case 18:\n              _context21.n = 19;\n              return this.exportData();\n            case 19:\n              exportData = _context21.v;\n              sendResponse({\n                data: exportData\n              });\n              return _context21.a(3, 23);\n            case 20:\n              _context21.n = 21;\n              return this.importData(data);\n            case 21:\n              sendResponse({\n                success: true\n              });\n              return _context21.a(3, 23);\n            case 22:\n              sendResponse({\n                error: 'Unknown message type'\n              });\n            case 23:\n              _context21.n = 25;\n              break;\n            case 24:\n              _context21.p = 24;\n              _t21 = _context21.v;\n              console.error('Error handling message:', _t21);\n              sendResponse({\n                error: _t21.message\n              });\n            case 25:\n              return _context21.a(2);\n          }\n        }, _callee21, this, [[1, 24]]);\n      }));\n      function handleMessage(_x20, _x21, _x22) {\n        return _handleMessage.apply(this, arguments);\n      }\n      return handleMessage;\n    }()\n  }, {\n    key: \"handleContextUpdate\",\n    value: function () {\n      var _handleContextUpdate = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee22(context, tab) {\n        var url, title, content, timeSpent, session;\n        return _regenerator().w(function (_context22) {\n          while (1) switch (_context22.n) {\n            case 0:\n              url = context.url, title = context.title, content = context.content, timeSpent = context.timeSpent; // Only process if meaningful time spent (>10 seconds)\n              if (!(timeSpent < 10)) {\n                _context22.n = 1;\n                break;\n              }\n              return _context22.a(2);\n            case 1:\n              // Get or create session\n              session = this.activeSessions.get(tab.id);\n              if (!session) {\n                session = {\n                  url: url,\n                  title: title,\n                  startTime: Date.now(),\n                  tabId: tab.id\n                };\n                this.activeSessions.set(tab.id, session);\n              }\n\n              // Update session data\n              session.lastUpdate = Date.now();\n              session.context = context;\n\n              // Check if we should process with AI\n              if (!(timeSpent > 30 && !session.aiProcessed)) {\n                _context22.n = 2;\n                break;\n              }\n              session.aiProcessed = true;\n              _context22.n = 2;\n              return this.processWithAI(context);\n            case 2:\n              _context22.n = 3;\n              return this.storage.updateVisit(context);\n            case 3:\n              return _context22.a(2);\n          }\n        }, _callee22, this);\n      }));\n      function handleContextUpdate(_x23, _x24) {\n        return _handleContextUpdate.apply(this, arguments);\n      }\n      return handleContextUpdate;\n    }()\n  }, {\n    key: \"processWithAI\",\n    value: function () {\n      var _processWithAI = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee23(context) {\n        var summary, tags, topics, _t22;\n        return _regenerator().w(function (_context23) {\n          while (1) switch (_context23.p = _context23.n) {\n            case 0:\n              _context23.p = 0;\n              _context23.n = 1;\n              return this.ai.generateSummary(context.content);\n            case 1:\n              summary = _context23.v;\n              _context23.n = 2;\n              return this.ai.predictTags(context.content, context.title);\n            case 2:\n              tags = _context23.v;\n              _context23.n = 3;\n              return this.ai.extractTopics(context.content);\n            case 3:\n              topics = _context23.v;\n              _context23.n = 4;\n              return this.storage.saveAIInsights(context.url, {\n                summary: summary,\n                tags: tags,\n                topics: topics,\n                timestamp: Date.now()\n              });\n            case 4:\n              console.log('✨ AI processing complete for:', context.url);\n              _context23.n = 6;\n              break;\n            case 5:\n              _context23.p = 5;\n              _t22 = _context23.v;\n              console.error('AI processing error:', _t22);\n            case 6:\n              return _context23.a(2);\n          }\n        }, _callee23, this, [[0, 5]]);\n      }));\n      function processWithAI(_x25) {\n        return _processWithAI.apply(this, arguments);\n      }\n      return processWithAI;\n    }()\n  }, {\n    key: \"handleTabLoad\",\n    value: function () {\n      var _handleTabLoad = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee24(tabId, tab) {\n        var previousContext;\n        return _regenerator().w(function (_context24) {\n          while (1) switch (_context24.n) {\n            case 0:\n              if (!(!tab.url || tab.url.startsWith('chrome://'))) {\n                _context24.n = 1;\n                break;\n              }\n              return _context24.a(2);\n            case 1:\n              _context24.n = 2;\n              return this.storage.getVisitHistory(tab.url);\n            case 2:\n              previousContext = _context24.v;\n              if (previousContext && previousContext.visits > 0) {\n                console.log(\"\\uD83D\\uDD2E Returning user to: \".concat(tab.url, \" (\").concat(previousContext.visits, \" previous visits)\"));\n              }\n            case 3:\n              return _context24.a(2);\n          }\n        }, _callee24, this);\n      }));\n      function handleTabLoad(_x26, _x27) {\n        return _handleTabLoad.apply(this, arguments);\n      }\n      return handleTabLoad;\n    }()\n  }, {\n    key: \"handleTabClose\",\n    value: function () {\n      var _handleTabClose = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee25(tabId) {\n        var session;\n        return _regenerator().w(function (_context25) {\n          while (1) switch (_context25.n) {\n            case 0:\n              session = this.activeSessions.get(tabId);\n              if (!(session && session.context)) {\n                _context25.n = 2;\n                break;\n              }\n              _context25.n = 1;\n              return this.storage.updateVisit(session.context);\n            case 1:\n              this.activeSessions[\"delete\"](tabId);\n            case 2:\n              return _context25.a(2);\n          }\n        }, _callee25, this);\n      }));\n      function handleTabClose(_x28) {\n        return _handleTabClose.apply(this, arguments);\n      }\n      return handleTabClose;\n    }()\n  }, {\n    key: \"handlePageUnload\",\n    value: function () {\n      var _handlePageUnload = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee26(context, tab) {\n        return _regenerator().w(function (_context26) {\n          while (1) switch (_context26.n) {\n            case 0:\n              _context26.n = 1;\n              return this.storage.updateVisit(context);\n            case 1:\n              this.activeSessions[\"delete\"](tab.id);\n            case 2:\n              return _context26.a(2);\n          }\n        }, _callee26, this);\n      }));\n      function handlePageUnload(_x29, _x30) {\n        return _handlePageUnload.apply(this, arguments);\n      }\n      return handlePageUnload;\n    }()\n  }, {\n    key: \"saveHighlight\",\n    value: function () {\n      var _saveHighlight2 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee27(data) {\n        return _regenerator().w(function (_context27) {\n          while (1) switch (_context27.n) {\n            case 0:\n              _context27.n = 1;\n              return this.storage.saveHighlight(data);\n            case 1:\n              return _context27.a(2);\n          }\n        }, _callee27, this);\n      }));\n      function saveHighlight(_x31) {\n        return _saveHighlight2.apply(this, arguments);\n      }\n      return saveHighlight;\n    }()\n  }, {\n    key: \"getPreviousContext\",\n    value: function () {\n      var _getPreviousContext = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee28(url) {\n        var history, highlights, insights;\n        return _regenerator().w(function (_context28) {\n          while (1) switch (_context28.n) {\n            case 0:\n              _context28.n = 1;\n              return this.storage.getVisitHistory(url);\n            case 1:\n              history = _context28.v;\n              _context28.n = 2;\n              return this.storage.getHighlights(url);\n            case 2:\n              highlights = _context28.v;\n              _context28.n = 3;\n              return this.storage.getAIInsights(url);\n            case 3:\n              insights = _context28.v;\n              if (history) {\n                _context28.n = 4;\n                break;\n              }\n              return _context28.a(2, null);\n            case 4:\n              return _context28.a(2, {\n                visits: history.visits || 0,\n                lastVisit: history.lastVisit,\n                totalTimeSpent: history.totalTimeSpent || 0,\n                highlights: highlights.slice(0, 5),\n                tags: (insights === null || insights === void 0 ? void 0 : insights.tags) || [],\n                summary: insights === null || insights === void 0 ? void 0 : insights.summary\n              });\n          }\n        }, _callee28, this);\n      }));\n      function getPreviousContext(_x32) {\n        return _getPreviousContext.apply(this, arguments);\n      }\n      return getPreviousContext;\n    }()\n  }, {\n    key: \"getMemories\",\n    value: function () {\n      var _getMemories2 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee29() {\n        var filters,\n          _args29 = arguments;\n        return _regenerator().w(function (_context29) {\n          while (1) switch (_context29.n) {\n            case 0:\n              filters = _args29.length > 0 && _args29[0] !== undefined ? _args29[0] : {};\n              _context29.n = 1;\n              return this.storage.getMemories(filters);\n            case 1:\n              return _context29.a(2, _context29.v);\n          }\n        }, _callee29, this);\n      }));\n      function getMemories() {\n        return _getMemories2.apply(this, arguments);\n      }\n      return getMemories;\n    }()\n  }, {\n    key: \"searchMemories\",\n    value: function () {\n      var _searchMemories = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee30(query) {\n        var allMemories, results;\n        return _regenerator().w(function (_context30) {\n          while (1) switch (_context30.n) {\n            case 0:\n              _context30.n = 1;\n              return this.storage.getAllMemories();\n            case 1:\n              allMemories = _context30.v;\n              // Simple text search across titles, content, and highlights\n              results = allMemories.filter(function (memory) {\n                var _memory$highlights;\n                var searchText = \"\".concat(memory.title, \" \").concat(memory.content, \" \").concat((_memory$highlights = memory.highlights) === null || _memory$highlights === void 0 ? void 0 : _memory$highlights.join(' ')).toLowerCase();\n                return searchText.includes(query.toLowerCase());\n              }); // Sort by relevance (number of matches)\n              return _context30.a(2, results.sort(function (a, b) {\n                var aMatches = (a.title + a.content).toLowerCase().split(query.toLowerCase()).length;\n                var bMatches = (b.title + b.content).toLowerCase().split(query.toLowerCase()).length;\n                return bMatches - aMatches;\n              }));\n          }\n        }, _callee30, this);\n      }));\n      function searchMemories(_x33) {\n        return _searchMemories.apply(this, arguments);\n      }\n      return searchMemories;\n    }()\n  }, {\n    key: \"addTag\",\n    value: function () {\n      var _addTag2 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee31(url, tag) {\n        return _regenerator().w(function (_context31) {\n          while (1) switch (_context31.n) {\n            case 0:\n              _context31.n = 1;\n              return this.storage.addTag(url, tag);\n            case 1:\n              return _context31.a(2);\n          }\n        }, _callee31, this);\n      }));\n      function addTag(_x34, _x35) {\n        return _addTag2.apply(this, arguments);\n      }\n      return addTag;\n    }()\n  }, {\n    key: \"getStats\",\n    value: function () {\n      var _getStats2 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee32() {\n        return _regenerator().w(function (_context32) {\n          while (1) switch (_context32.n) {\n            case 0:\n              _context32.n = 1;\n              return this.storage.getStats();\n            case 1:\n              return _context32.a(2, _context32.v);\n          }\n        }, _callee32, this);\n      }));\n      function getStats() {\n        return _getStats2.apply(this, arguments);\n      }\n      return getStats;\n    }()\n  }, {\n    key: \"exportData\",\n    value: function () {\n      var _exportData2 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee33() {\n        return _regenerator().w(function (_context33) {\n          while (1) switch (_context33.n) {\n            case 0:\n              _context33.n = 1;\n              return this.storage.exportData();\n            case 1:\n              return _context33.a(2, _context33.v);\n          }\n        }, _callee33, this);\n      }));\n      function exportData() {\n        return _exportData2.apply(this, arguments);\n      }\n      return exportData;\n    }()\n  }, {\n    key: \"importData\",\n    value: function () {\n      var _importData2 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee34(data) {\n        return _regenerator().w(function (_context34) {\n          while (1) switch (_context34.n) {\n            case 0:\n              _context34.n = 1;\n              return this.storage.importData(data);\n            case 1:\n              return _context34.a(2, _context34.v);\n          }\n        }, _callee34, this);\n      }));\n      function importData(_x36) {\n        return _importData2.apply(this, arguments);\n      }\n      return importData;\n    }()\n  }, {\n    key: \"performCleanup\",\n    value: function () {\n      var _performCleanup = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee35() {\n        return _regenerator().w(function (_context35) {\n          while (1) switch (_context35.n) {\n            case 0:\n              console.log('🧹 Performing cleanup...');\n              _context35.n = 1;\n              return this.storage.cleanup();\n            case 1:\n              return _context35.a(2);\n          }\n        }, _callee35, this);\n      }));\n      function performCleanup() {\n        return _performCleanup.apply(this, arguments);\n      }\n      return performCleanup;\n    }()\n  }]);\n}(); // Initialize the background service\nvar echoLens = new EchoLensBackground();\n\n//# sourceURL=webpack://echolens/./src/background/background.js?\n}");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/background/background.js"]();
/******/ 	
/******/ })()
;