/*! For license information please see background.js.LICENSE.txt */
(()=>{var e={234:()=>{},488:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function o(e,t,n){return(t=h(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var s=r&&r.prototype instanceof c?r:c,l=Object.create(s.prototype);return u(l,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,u=e,h.n=n,o}};function p(n,r){for(s=n,u=r,t=0;!f&&c&&!i&&t<l.length;t++){var i,a=l[t],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(t=s<2?e:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(t){a=e,s=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,i,a),!0),l}var o={};function c(){}function l(){}function f(){}t=Object.getPrototypeOf;var h=[][r]?t(t([][r]())):(u(t={},r,function(){return this}),t),p=f.prototype=c.prototype=Object.create(h);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=f,u(p,"constructor",f),u(f,"constructor",l),l.displayName="GeneratorFunction",u(f,i,"GeneratorFunction"),u(p),u(p,i,"Generator"),u(p,r,function(){return this}),u(p,"toString",function(){return"[object Generator]"}),(s=function(){return{w:a,m}})()}function u(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}u=function(e,t,n,r){function a(t,n){u(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},u(e,t,n,r)}function c(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){c(a,r,i,o,s,"next",e)}function s(e){c(a,r,i,o,s,"throw",e)}o(void 0)})}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,h(r.key),r)}}function h(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,n||"default");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}var p=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dbManager=t,this.currentTier="free",this.userId=null},t=[{key:"initialize",value:(_=l(s().m(function e(){var t;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.createTables();case 1:return e.n=2,this.loadUserTier();case 2:console.log("✨ Premium features initialized"),e.n=4;break;case 3:e.p=3,t=e.v,console.error("❌ Failed to initialize premium features:",t);case 4:return e.a(2)}},e,this,[[0,3]])})),function(){return _.apply(this,arguments)})},{key:"createTables",value:(T=l(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:if(this.dbManager.db){e.n=1;break}return e.n=1,this.dbManager.init();case 1:return this.dbManager.db.run("\n      CREATE TABLE IF NOT EXISTS user_subscription (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        user_id TEXT UNIQUE NOT NULL,\n        tier TEXT DEFAULT 'free',\n        started_at INTEGER NOT NULL,\n        expires_at INTEGER,\n        auto_renew BOOLEAN DEFAULT 0,\n        payment_method TEXT,\n        last_payment INTEGER\n      )\n    "),this.dbManager.db.run("\n      CREATE TABLE IF NOT EXISTS feature_usage_limits (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        feature_name TEXT NOT NULL,\n        usage_count INTEGER DEFAULT 0,\n        limit_count INTEGER NOT NULL,\n        reset_at INTEGER NOT NULL,\n        user_id TEXT NOT NULL\n      )\n    "),this.dbManager.db.run("\n      CREATE TABLE IF NOT EXISTS teams (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        team_id TEXT UNIQUE NOT NULL,\n        name TEXT NOT NULL,\n        owner_id TEXT NOT NULL,\n        tier TEXT DEFAULT 'team',\n        member_limit INTEGER DEFAULT 10,\n        created_at INTEGER NOT NULL\n      )\n    "),this.dbManager.db.run("\n      CREATE TABLE IF NOT EXISTS team_members (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        team_id TEXT NOT NULL,\n        user_id TEXT NOT NULL,\n        role TEXT DEFAULT 'member',\n        joined_at INTEGER NOT NULL,\n        permissions TEXT,\n        UNIQUE(team_id, user_id)\n      )\n    "),this.dbManager.db.run("\n      CREATE TABLE IF NOT EXISTS feature_flags (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        feature_name TEXT UNIQUE NOT NULL,\n        enabled BOOLEAN DEFAULT 0,\n        tier_required TEXT,\n        rollout_percentage INTEGER DEFAULT 100,\n        metadata TEXT\n      )\n    "),e.n=2,this.dbManager.saveDatabase();case 2:return e.a(2)}},e,this)})),function(){return T.apply(this,arguments)})},{key:"getTierFeatures",value:function(){return{free:{name:"Free",price:0,features:{basicTracking:!0,contextCapture:!0,browserHistory:!0,maxStoredPages:1e3,maxEchoSpaces:1,maxSkillTracking:3,achievementTracking:!0,basicAnalytics:!0,advancedAnalytics:!1,aiInsights:!1,exportFeatures:!1,teamCollaboration:!1,prioritySupport:!1,customIntegrations:!1,apiAccess:!1,dailyReflections:3,focusSessionsPerDay:3,weeklyDigests:1,exportFormats:["CSV"]}},pro:{name:"Pro",price:9.99,features:{basicTracking:!0,contextCapture:!0,browserHistory:!0,achievementTracking:!0,maxStoredPages:1e4,maxEchoSpaces:10,maxSkillTracking:999,basicAnalytics:!0,advancedAnalytics:!0,aiInsights:!0,exportFeatures:!0,teamCollaboration:!1,prioritySupport:!0,customIntegrations:!0,apiAccess:!1,dailyReflections:999,focusSessionsPerDay:999,weeklyDigests:999,exportFormats:["CSV","JSON","Notion","Obsidian","Markdown"],predictiveInsights:!0,futureSelfSimulation:!0,conversationalTwin:!0,customGoals:!0,advancedVisualization:!0}},team:{name:"Team",price:29.99,features:a(a({},this.getTierFeatures().pro.features),{},{teamCollaboration:!0,sharedEchoSpaces:!0,teamAnalytics:!0,memberManagement:!0,roleBasedAccess:!0,maxTeamMembers:10,maxSharedSpaces:25,knowledgeSharing:!0,teamInsights:!0,collaborativeGoals:!0,activityFeed:!0})},enterprise:{name:"Enterprise",price:99.99,features:a(a({},this.getTierFeatures().team.features),{},{apiAccess:!0,ssoIntegration:!0,customBranding:!0,dedicatedSupport:!0,advancedSecurity:!0,auditLogs:!0,customRetention:!0,maxTeamMembers:999,maxSharedSpaces:999,maxStoredPages:999999,adminDashboard:!0,usageAnalytics:!0,complianceReports:!0,customWorkflows:!0,onPremiseOption:!0})}}}},{key:"loadUserTier",value:(w=l(s().m(function e(){var t,n,r,i,a;return s().w(function(e){for(;;)switch(e.n){case 0:if(this.dbManager.db){e.n=1;break}return e.n=1,this.dbManager.init();case 1:t=this.dbManager.db,n=t.prepare("\n      SELECT tier, expires_at \n      FROM user_subscription \n      WHERE user_id = 'local-user'\n      ORDER BY started_at DESC \n      LIMIT 1\n    "),r="free",i=null,n.step()?(a=n.getAsObject(),r=a.tier,!(i=a.expires_at)||i>Date.now()?this.currentTier=r:this.currentTier="free"):this.currentTier="free",n.free(),this.userId="local-user";case 2:return e.a(2)}},e,this)})),function(){return w.apply(this,arguments)})},{key:"hasFeatureAccess",value:(E=l(s().m(function e(t){var n;return s().w(function(e){for(;;)switch(e.n){case 0:if(n=this.getTierFeatures()[this.currentTier]){e.n=1;break}return e.a(2,!1);case 1:return e.a(2,!0===n.features[t])}},e,this)})),function(e){return E.apply(this,arguments)})},{key:"getFeatureLimit",value:(y=l(s().m(function e(t){var n;return s().w(function(e){for(;;)switch(e.n){case 0:if(n=this.getTierFeatures()[this.currentTier]){e.n=1;break}return e.a(2,0);case 1:return e.a(2,n.features[t]||0)}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"checkUsageLimit",value:(b=l(s().m(function e(t){var r,i,a,o,u;return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.getFeatureLimit(t);case 1:if(999!==(r=e.v)&&999999!==r){e.n=2;break}return e.a(2,!0);case 2:if(this.dbManager.db.prepare("\n      SELECT usage_count, limit_count, reset_at \n      FROM feature_usage_limits \n      WHERE feature_name = ? AND user_id = ?\n    ",[t,this.userId]),0!==result.length&&0!==result[0].values.length){e.n=3;break}return e.a(2,!0);case 3:if(i=n(result[0].values[0],3),a=i[0],o=i[1],u=i[2],!(Date.now()>=u)){e.n=5;break}return e.n=4,this.resetFeatureUsage(t);case 4:return e.a(2,!0);case 5:return e.a(2,a<o)}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"incrementFeatureUsage",value:(v=l(s().m(function e(t){var r,i,a,o,u,c,l;return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.getFeatureLimit(t);case 1:return r=e.v,(i=this.dbManager.db).prepare("\n      SELECT id, usage_count, reset_at \n      FROM feature_usage_limits \n      WHERE feature_name = ? AND user_id = ?\n    ",[t,this.userId]),0===existing.length||0===existing[0].values.length?(a=Date.now()+864e5,i.run("\n        INSERT INTO feature_usage_limits (feature_name, usage_count, limit_count, reset_at, user_id)\n        VALUES (?, 1, ?, ?, ?)\n      ",[t,r,a,this.userId])):(o=n(existing[0].values[0],3),u=o[0],o[1],c=o[2],Date.now()>=c?(l=Date.now()+864e5,i.run("\n          UPDATE feature_usage_limits \n          SET usage_count = 1, reset_at = ? \n          WHERE id = ?\n        ",[l,u])):i.run("\n          UPDATE feature_usage_limits \n          SET usage_count = usage_count + 1 \n          WHERE id = ?\n        ",[u])),e.n=2,this.dbManager.saveDatabase();case 2:return e.a(2)}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"resetFeatureUsage",value:(g=l(s().m(function e(t){var n,r;return s().w(function(e){for(;;)switch(e.n){case 0:return n=this.dbManager.db,r=Date.now()+864e5,n.run("\n      UPDATE feature_usage_limits \n      SET usage_count = 0, reset_at = ? \n      WHERE feature_name = ? AND user_id = ?\n    ",[r,t,this.userId]),e.n=1,this.dbManager.saveDatabase();case 1:return e.a(2)}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"getCurrentTierInfo",value:(d=l(s().m(function e(){var t,r,i,o;return s().w(function(e){for(;;)if(0===e.n)return t=this.getTierFeatures()[this.currentTier],this.dbManager.db.prepare("\n      SELECT expires_at, auto_renew \n      FROM user_subscription \n      WHERE user_id = ? AND tier = ?\n      ORDER BY started_at DESC \n      LIMIT 1\n    ",[this.userId,this.currentTier]),r=null,i=!1,result.length>0&&result[0].values.length>0&&(o=n(result[0].values[0],2),r=o[0],i=o[1]),e.a(2,a(a({tier:this.currentTier},t),{},{expiresAt:r,autoRenew:i,daysRemaining:r?Math.ceil((r-Date.now())/864e5):null}))},e,this)})),function(){return d.apply(this,arguments)})},{key:"upgradeTier",value:(m=l(s().m(function e(t){var n,r,i,a,o=arguments;return s().w(function(e){for(;;)switch(e.n){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:30,["free","pro","team","enterprise"].includes(t)){e.n=1;break}return e.a(2,{success:!1,error:"Invalid tier"});case 1:return r=this.dbManager.db,i=Date.now(),a=i+24*n*60*60*1e3,r.run("\n      INSERT INTO user_subscription (user_id, tier, started_at, expires_at, auto_renew)\n      VALUES (?, ?, ?, ?, 1)\n    ",[this.userId,t,i,a]),e.n=2,this.dbManager.saveDatabase();case 2:return this.currentTier=t,r.run("\n      DELETE FROM feature_usage_limits \n      WHERE user_id = ?\n    ",[this.userId]),e.n=3,this.dbManager.saveDatabase();case 3:return e.a(2,{success:!0,tier:t,expiresAt:a})}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"createTeam",value:(p=l(s().m(function e(t){var n,r,i,a;return s().w(function(e){for(;;)switch(e.n){case 0:if("team"===this.currentTier||"enterprise"===this.currentTier){e.n=1;break}return e.a(2,{success:!1,error:"Team or Enterprise tier required"});case 1:return n="team_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),r=Date.now(),i=this.dbManager.db,a="enterprise"===this.currentTier?999:10,i.run("\n      INSERT INTO teams (team_id, name, owner_id, tier, member_limit, created_at)\n      VALUES (?, ?, ?, ?, ?, ?)\n    ",[n,t,this.userId,this.currentTier,a,r]),i.run("\n      INSERT INTO team_members (team_id, user_id, role, joined_at, permissions)\n      VALUES (?, ?, 'admin', ?, 'all')\n    ",[n,this.userId,r]),e.n=2,this.dbManager.saveDatabase();case 2:return e.a(2,{success:!0,teamId:n,name:t})}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"addTeamMember",value:(h=l(s().m(function e(t,r){var i,a,o,u,c,l=arguments;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:if(i=l.length>2&&void 0!==l[2]?l[2]:"member",(a=this.dbManager.db).prepare("\n      SELECT t.member_limit, COUNT(m.id) as current_members\n      FROM teams t\n      LEFT JOIN team_members m ON t.team_id = m.team_id\n      WHERE t.team_id = ?\n      GROUP BY t.team_id\n    ",[t]),0!==teamCheck.length&&0!==teamCheck[0].values.length){e.n=1;break}return e.a(2,{success:!1,error:"Team not found"});case 1:if(o=n(teamCheck[0].values[0],2),u=o[0],!(o[1]>=u)){e.n=2;break}return e.a(2,{success:!1,error:"Team member limit reached"});case 2:return c=Date.now(),e.p=3,a.run("\n        INSERT INTO team_members (team_id, user_id, role, joined_at)\n        VALUES (?, ?, ?, ?)\n      ",[t,r,i,c]),e.n=4,this.dbManager.saveDatabase();case 4:return e.a(2,{success:!0,userId:r,role:i});case 5:return e.p=5,e.v,e.a(2,{success:!1,error:"User already in team or invalid data"})}},e,this,[[3,5]])})),function(e,t){return h.apply(this,arguments)})},{key:"getTeamMembers",value:(c=l(s().m(function e(t){return s().w(function(e){for(;;)switch(e.n){case 0:if(this.dbManager.db.prepare("\n      SELECT user_id, role, joined_at, permissions\n      FROM team_members\n      WHERE team_id = ?\n      ORDER BY joined_at ASC\n    ",[t]),result.length){e.n=1;break}return e.a(2,[]);case 1:return e.a(2,this.formatQueryResults(result[0]))}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"getUserTeams",value:(u=l(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:if(this.dbManager.db.prepare("\n      SELECT t.team_id, t.name, t.tier, t.created_at, m.role,\n             (SELECT COUNT(*) FROM team_members WHERE team_id = t.team_id) as member_count\n      FROM teams t\n      INNER JOIN team_members m ON t.team_id = m.team_id\n      WHERE m.user_id = ?\n      ORDER BY t.created_at DESC\n    ",[this.userId]),result.length){e.n=1;break}return e.a(2,[]);case 1:return e.a(2,this.formatQueryResults(result[0]))}},e,this)})),function(){return u.apply(this,arguments)})},{key:"setFeatureFlag",value:(o=l(s().m(function e(t,n){var r,i,a=arguments;return s().w(function(e){for(;;)switch(e.n){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:null,i=a.length>3&&void 0!==a[3]?a[3]:100,this.dbManager.db.run("\n      INSERT OR REPLACE INTO feature_flags (feature_name, enabled, tier_required, rollout_percentage)\n      VALUES (?, ?, ?, ?)\n    ",[t,n?1:0,r,i]),e.n=1,this.dbManager.saveDatabase();case 1:return e.a(2)}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"isFeatureEnabled",value:(i=l(s().m(function e(t){var r,i,a,o,u,c,l;return s().w(function(e){for(;;)switch(e.n){case 0:if(this.dbManager.db.prepare("\n      SELECT enabled, tier_required, rollout_percentage\n      FROM feature_flags\n      WHERE feature_name = ?\n    ",[t]),result.length&&0!==result[0].values.length){e.n=1;break}return e.a(2,!1);case 1:if(r=n(result[0].values[0],3),i=r[0],a=r[1],o=r[2],i){e.n=2;break}return e.a(2,!1);case 2:if(!a){e.n=3;break}if(c=(u=["free","pro","team","enterprise"]).indexOf(a),!(u.indexOf(this.currentTier)<c)){e.n=3;break}return e.a(2,!1);case 3:if(!(o<100)){e.n=4;break}return l=this.hashUserId(this.userId),e.a(2,l%100<o);case 4:return e.a(2,!0)}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"hashUserId",value:function(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return Math.abs(t)}},{key:"formatQueryResults",value:function(e){var t=e.columns;return e.values.map(function(e){var n={};return t.forEach(function(t,r){n[t]=e[r]}),n})}}],t&&f(e.prototype,t),r&&f(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r,i,o,u,c,h,p,m,d,g,v,b,y,E,w,T,_}();e.exports&&(e.exports=p)},490:()=>{},826:(e,t,n)=>{e=n.nmd(e);var r=void 0,i=function(t){return r||(r=new Promise(function(r,i){var a,o=void 0!==t?t:{},s=o.onAbort;o.onAbort=function(e){i(new Error(e)),s&&s(e)},o.postRun=o.postRun||[],o.postRun.push(function(){r(o)}),e=void 0,a||=void 0!==o?o:{};var u="object"==typeof window,c="undefined"!=typeof WorkerGlobalScope,l="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node&&"renderer"!=process.type;a.onRuntimeInitialized=function(){function e(e,t){switch(typeof t){case"boolean":Q(e,t?1:0);break;case"number":H(e,t);break;case"string":B(e,t,-1,-1);break;case"object":if(null===t)Y(e);else if(null!=t.length){var n=yt(t,bt);z(e,n,t.length,-1),Ot(n)}else $(e,"Wrong API use : tried to return a value of an unknown type ("+t+").",-1);break;default:Y(e)}}function t(e,t){for(var n=[],r=0;r<e;r+=1){var i=X(t+4*r,"i32"),a=F(i);if(1===a||2===a)i=q(i);else if(3===a)i=U(i);else if(4===a){i=x(a=i),a=G(a);for(var o=new Uint8Array(i),s=0;s<i;s+=1)o[s]=T[a+s];i=o}else i=null;n.push(i)}return n}function n(e,t){this.Qa=e,this.db=t,this.Oa=1,this.lb=[]}function r(e,t){if(this.db=t,t=ne(e)+1,this.eb=St(t),null===this.eb)throw Error("Unable to allocate memory for the SQL string");re(e,_,this.eb,t),this.kb=this.eb,this.Za=this.pb=null}function i(e){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),null!=e){var t=this.filename,n="/",r=t;if(n&&(n="string"==typeof n?n:ke(n),r=t?J(n+"/"+t):n),r=function(e,t=438){return qe(e,4095&t|32768,0)}(r,t=fe(!0,!0)),e){if("string"==typeof e){n=Array(e.length);for(var i=0,a=e.length;i<a;++i)n[i]=e.charCodeAt(i);e=n}Ke(r,146|t),tt(n=Je(r,577),e,0,e.length,0),$e(n),Ke(r,t)}}this.handleError(u(this.filename,o)),this.db=X(o,"i32"),ee(this.db),this.fb={},this.Sa={}}var o=It(4),s=a.cwrap,u=s("sqlite3_open","number",["string","number"]),c=s("sqlite3_close_v2","number",["number"]),l=s("sqlite3_exec","number",["number","string","number","number","number"]),f=s("sqlite3_changes","number",["number"]),h=s("sqlite3_prepare_v2","number",["number","string","number","number","number"]),p=s("sqlite3_sql","string",["number"]),m=s("sqlite3_normalized_sql","string",["number"]),d=s("sqlite3_prepare_v2","number",["number","number","number","number","number"]),g=s("sqlite3_bind_text","number",["number","number","number","number","number"]),v=s("sqlite3_bind_blob","number",["number","number","number","number","number"]),b=s("sqlite3_bind_double","number",["number","number","number"]),y=s("sqlite3_bind_int","number",["number","number","number"]),E=s("sqlite3_bind_parameter_index","number",["number","string"]),w=s("sqlite3_step","number",["number"]),k=s("sqlite3_errmsg","string",["number"]),S=s("sqlite3_column_count","number",["number"]),O=s("sqlite3_data_count","number",["number"]),N=s("sqlite3_column_double","number",["number","number"]),A=s("sqlite3_column_text","string",["number","number"]),R=s("sqlite3_column_blob","number",["number","number"]),I=s("sqlite3_column_bytes","number",["number","number"]),L=s("sqlite3_column_type","number",["number","number"]),D=s("sqlite3_column_name","string",["number","number"]),P=s("sqlite3_reset","number",["number"]),M=s("sqlite3_clear_bindings","number",["number"]),C=s("sqlite3_finalize","number",["number"]),j=s("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),F=s("sqlite3_value_type","number",["number"]),x=s("sqlite3_value_bytes","number",["number"]),U=s("sqlite3_value_text","string",["number"]),G=s("sqlite3_value_blob","number",["number"]),q=s("sqlite3_value_double","number",["number"]),H=s("sqlite3_result_double","",["number","number"]),Y=s("sqlite3_result_null","",["number"]),B=s("sqlite3_result_text","",["number","string","number","number"]),z=s("sqlite3_result_blob","",["number","number","number","number"]),Q=s("sqlite3_result_int","",["number","number"]),$=s("sqlite3_result_error","",["number","string","number"]),Z=s("sqlite3_aggregate_context","number",["number","number"]),ee=s("RegisterExtensionFunctions","number",["number"]),te=s("sqlite3_update_hook","number",["number","number","number"]);n.prototype.bind=function(e){if(!this.Qa)throw"Statement closed";return this.reset(),Array.isArray(e)?this.Cb(e):null==e||"object"!=typeof e||this.Db(e)},n.prototype.step=function(){if(!this.Qa)throw"Statement closed";this.Oa=1;var e=w(this.Qa);switch(e){case 100:return!0;case 101:return!1;default:throw this.db.handleError(e)}},n.prototype.wb=function(e){return null==e&&(e=this.Oa,this.Oa+=1),N(this.Qa,e)},n.prototype.Gb=function(e){if(null==e&&(e=this.Oa,this.Oa+=1),e=A(this.Qa,e),"function"!=typeof BigInt)throw Error("BigInt is not supported");return BigInt(e)},n.prototype.Hb=function(e){return null==e&&(e=this.Oa,this.Oa+=1),A(this.Qa,e)},n.prototype.getBlob=function(e){null==e&&(e=this.Oa,this.Oa+=1);var t=I(this.Qa,e);e=R(this.Qa,e);for(var n=new Uint8Array(t),r=0;r<t;r+=1)n[r]=T[e+r];return n},n.prototype.get=function(e,t){t=t||{},null!=e&&this.bind(e)&&this.step(),e=[];for(var n=O(this.Qa),r=0;r<n;r+=1)switch(L(this.Qa,r)){case 1:var i=t.useBigInt?this.Gb(r):this.wb(r);e.push(i);break;case 2:e.push(this.wb(r));break;case 3:e.push(this.Hb(r));break;case 4:e.push(this.getBlob(r));break;default:e.push(null)}return e},n.prototype.getColumnNames=function(){for(var e=[],t=S(this.Qa),n=0;n<t;n+=1)e.push(D(this.Qa,n));return e},n.prototype.getAsObject=function(e,t){e=this.get(e,t),t=this.getColumnNames();for(var n={},r=0;r<t.length;r+=1)n[t[r]]=e[r];return n},n.prototype.getSQL=function(){return p(this.Qa)},n.prototype.getNormalizedSQL=function(){return m(this.Qa)},n.prototype.run=function(e){return null!=e&&this.bind(e),this.step(),this.reset()},n.prototype.sb=function(e,t){null==t&&(t=this.Oa,this.Oa+=1),e=ie(e);var n=yt(e,bt);this.lb.push(n),this.db.handleError(g(this.Qa,t,n,e.length-1,0))},n.prototype.Bb=function(e,t){null==t&&(t=this.Oa,this.Oa+=1);var n=yt(e,bt);this.lb.push(n),this.db.handleError(v(this.Qa,t,n,e.length,0))},n.prototype.rb=function(e,t){null==t&&(t=this.Oa,this.Oa+=1),this.db.handleError((e===(0|e)?y:b)(this.Qa,t,e))},n.prototype.Eb=function(e){null==e&&(e=this.Oa,this.Oa+=1),v(this.Qa,e,0,0,0)},n.prototype.tb=function(e,t){switch(null==t&&(t=this.Oa,this.Oa+=1),typeof e){case"string":return void this.sb(e,t);case"number":return void this.rb(e,t);case"bigint":return void this.sb(e.toString(),t);case"boolean":return void this.rb(e+0,t);case"object":if(null===e)return void this.Eb(t);if(null!=e.length)return void this.Bb(e,t)}throw"Wrong API use : tried to bind a value of an unknown type ("+e+")."},n.prototype.Db=function(e){var t=this;return Object.keys(e).forEach(function(n){var r=E(t.Qa,n);0!==r&&t.tb(e[n],r)}),!0},n.prototype.Cb=function(e){for(var t=0;t<e.length;t+=1)this.tb(e[t],t+1);return!0},n.prototype.reset=function(){return this.freemem(),0===M(this.Qa)&&0===P(this.Qa)},n.prototype.freemem=function(){for(var e;void 0!==(e=this.lb.pop());)Ot(e)},n.prototype.free=function(){this.freemem();var e=0===C(this.Qa);return delete this.db.fb[this.Qa],this.Qa=0,e},r.prototype.next=function(){if(null===this.eb)return{done:!0};if(null!==this.Za&&(this.Za.free(),this.Za=null),!this.db.db)throw this.mb(),Error("Database closed");var e=Lt(),t=It(4);W(o),W(t);try{this.db.handleError(d(this.db.db,this.kb,-1,o,t)),this.kb=X(t,"i32");var r=X(o,"i32");return 0===r?(this.mb(),{done:!0}):(this.Za=new n(r,this.db),this.db.fb[r]=this.Za,{value:this.Za,done:!1})}catch(e){throw this.pb=K(this.kb),this.mb(),e}finally{Rt(e)}},r.prototype.mb=function(){Ot(this.eb),this.eb=null},r.prototype.getRemainingSQL=function(){return null!==this.pb?this.pb:K(this.kb)},"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator&&(r.prototype[Symbol.iterator]=function(){return this}),i.prototype.run=function(e,t){if(!this.db)throw"Database closed";if(t){e=this.prepare(e,t);try{e.step()}finally{e.free()}}else this.handleError(l(this.db,e,0,0,o));return this},i.prototype.exec=function(e,t,r){if(!this.db)throw"Database closed";var i=Lt(),a=null;try{var s=vt(e),u=It(4);for(e=[];0!==X(s,"i8");){W(o),W(u),this.handleError(d(this.db,s,-1,o,u));var c=X(o,"i32");if(s=X(u,"i32"),0!==c){var l=null;for(a=new n(c,this),null!=t&&a.bind(t);a.step();)null===l&&(l={columns:a.getColumnNames(),values:[]},e.push(l)),l.values.push(a.get(null,r));a.free()}}return e}catch(e){throw a&&a.free(),e}finally{Rt(i)}},i.prototype.each=function(e,t,n,r,i){"function"==typeof t&&(r=n,n=t,t=void 0),e=this.prepare(e,t);try{for(;e.step();)n(e.getAsObject(null,i))}finally{e.free()}if("function"==typeof r)return r()},i.prototype.prepare=function(e,t){if(W(o),this.handleError(h(this.db,e,-1,o,0)),0===(e=X(o,"i32")))throw"Nothing to prepare";var r=new n(e,this);return null!=t&&r.bind(t),this.fb[e]=r},i.prototype.iterateStatements=function(e){return new r(e,this)},i.prototype.export=function(){Object.values(this.fb).forEach(function(e){e.free()}),Object.values(this.Sa).forEach(wt),this.Sa={},this.handleError(c(this.db));var e=function(e){var t,n="binary";if("utf8"!==n&&"binary"!==n)throw Error(`Invalid encoding type "${n}"`);var r=Je(e,r||0);e=ze(e).size;var i=new Uint8Array(e);return et(r,i,0,e,0),"utf8"===n?t=V(i):"binary"===n&&(t=i),$e(r),t}(this.filename);return this.handleError(u(this.filename,o)),this.db=X(o,"i32"),ee(this.db),e},i.prototype.close=function(){null!==this.db&&(Object.values(this.fb).forEach(function(e){e.free()}),Object.values(this.Sa).forEach(wt),this.Sa={},this.Ya&&(wt(this.Ya),this.Ya=void 0),this.handleError(c(this.db)),We("/"+this.filename),this.db=null)},i.prototype.handleError=function(e){if(0===e)return null;throw e=k(this.db),Error(e)},i.prototype.getRowsModified=function(){return f(this.db)},i.prototype.create_function=function(n,r){Object.prototype.hasOwnProperty.call(this.Sa,n)&&(wt(this.Sa[n]),delete this.Sa[n]);var i=Tt(function(n,i,a){i=t(i,a);try{var o=r.apply(null,i)}catch(e){return void $(n,e,-1)}e(n,o)},"viii");return this.Sa[n]=i,this.handleError(j(this.db,n,r.length,1,0,i,0,0,0)),this},i.prototype.create_aggregate=function(n,r){var i=r.init||function(){return null},a=r.finalize||function(e){return e},o=r.step;if(!o)throw"An aggregate function must have a step function in "+n;var s={};Object.hasOwnProperty.call(this.Sa,n)&&(wt(this.Sa[n]),delete this.Sa[n]),r=n+"__finalize",Object.hasOwnProperty.call(this.Sa,r)&&(wt(this.Sa[r]),delete this.Sa[r]);var u=Tt(function(e,n,r){var a=Z(e,1);Object.hasOwnProperty.call(s,a)||(s[a]=i()),n=t(n,r),n=[s[a]].concat(n);try{s[a]=o.apply(null,n)}catch(t){delete s[a],$(e,t,-1)}},"viii"),c=Tt(function(t){var n=Z(t,1);try{var r=a(s[n])}catch(e){return delete s[n],void $(t,e,-1)}e(t,r),delete s[n]},"vi");return this.Sa[n]=u,this.Sa[r]=c,this.handleError(j(this.db,n,o.length-1,1,0,0,u,c,0)),this},i.prototype.updateHook=function(e){this.Ya&&(te(this.db,0,0),wt(this.Ya),this.Ya=void 0),e&&(this.Ya=Tt(function(t,n,r,i,a){switch(n){case 18:t="insert";break;case 23:t="update";break;case 9:t="delete";break;default:throw"unknown operationCode in updateHook callback: "+n}if(r=r?V(_,r):"",i=i?V(_,i):"",a>Number.MAX_SAFE_INTEGER)throw"rowId too big to fit inside a Number";e(t,r,i,Number(a))},"viiiij"),te(this.db,this.Ya,0))},a.Database=i};var f,h,p={...a},m="./this.program",d=(e,t)=>{throw t},g="";if(l){var v=n(490);n(234),g="//",h=e=>(e=D(e)?new URL(e):e,v.readFileSync(e)),f=async e=>(e=D(e)?new URL(e):e,v.readFileSync(e,void 0)),!a.thisProgram&&1<process.argv.length&&(m=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),e.exports=a,d=(e,t)=>{throw process.exitCode=e,t}}else(u||c)&&(c?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),g=g.startsWith("blob:")?"":g.slice(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1),c&&(h=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),f=async e=>{if(D(e))return new Promise((t,n)=>{var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?t(r.response):n(r.status)},r.onerror=n,r.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)});var b=a.print||console.log.bind(console),y=a.printErr||console.error.bind(console);Object.assign(a,p),p=null,a.thisProgram&&(m=a.thisProgram);var E,w,T,_,k,S,O,N,A,R,I=a.wasmBinary,L=!1,D=e=>e.startsWith("file://");function P(){var e=E.buffer;a.HEAP8=T=new Int8Array(e),a.HEAP16=k=new Int16Array(e),a.HEAPU8=_=new Uint8Array(e),a.HEAPU16=new Uint16Array(e),a.HEAP32=S=new Int32Array(e),a.HEAPU32=O=new Uint32Array(e),a.HEAPF32=N=new Float32Array(e),a.HEAPF64=R=new Float64Array(e),a.HEAP64=A=new BigInt64Array(e),a.HEAPU64=new BigUint64Array(e)}var M,C=0,j=null;function F(e){throw a.onAbort?.(e),y(e="Aborted("+e+")"),L=!0,new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info.")}async function x(e,t){try{var n=await async function(e){if(!I)try{var t=await f(e);return new Uint8Array(t)}catch{}if(e==M&&I)e=new Uint8Array(I);else{if(!h)throw"both async and sync fetching of the wasm failed";e=h(e)}return e}(e);return await WebAssembly.instantiate(n,t)}catch(e){y(`failed to asynchronously prepare wasm: ${e}`),F(e)}}class U{name="ExitStatus";constructor(e){this.message=`Program terminated with exit(${e})`,this.status=e}}var G=e=>{for(;0<e.length;)e.shift()(a)},q=[],H=[],Y=()=>{var e=a.preRun.shift();H.unshift(e)};function X(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return T[e];case"i16":return k[e>>1];case"i32":return S[e>>2];case"i64":return A[e>>3];case"float":return N[e>>2];case"double":return R[e>>3];case"*":return O[e>>2];default:F(`invalid type for getValue: ${t}`)}}var B=a.noExitRuntime||!0;function W(e){var t="i32";switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":T[e]=0;break;case"i16":k[e>>1]=0;break;case"i32":S[e>>2]=0;break;case"i64":A[e>>3]=BigInt(0);break;case"float":N[e>>2]=0;break;case"double":R[e>>3]=0;break;case"*":O[e>>2]=0;break;default:F(`invalid type for setValue: ${t}`)}}var z="undefined"!=typeof TextDecoder?new TextDecoder:void 0,V=(e,t=0,n=NaN)=>{var r=t+n;for(n=t;e[n]&&!(n>=r);)++n;if(16<n-t&&e.buffer&&z)return z.decode(e.subarray(t,n));for(r="";t<n;){var i=e[t++];if(128&i){var a=63&e[t++];if(192==(224&i))r+=String.fromCharCode((31&i)<<6|a);else{var o=63&e[t++];65536>(i=224==(240&i)?(15&i)<<12|a<<6|o:(7&i)<<18|a<<12|o<<6|63&e[t++])?r+=String.fromCharCode(i):(i-=65536,r+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else r+=String.fromCharCode(i)}return r},K=(e,t)=>e?V(_,e,t):"",Q=(e,t)=>{for(var n=0,r=e.length-1;0<=r;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n;n--)e.unshift("..");return e},J=e=>{var t="/"===e.charAt(0),n="/"===e.slice(-1);return(e=Q(e.split("/").filter(e=>!!e),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e},$=e=>{var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&=t.slice(0,-1),e+t):"."},Z=e=>e&&e.match(/([^\/]+|\/)\/*$/)[1],ee=e=>{(ee=(()=>{if(l){var e=n(920);return t=>e.randomFillSync(t)}return e=>crypto.getRandomValues(e)})())(e)},te=[],ne=e=>{for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);127>=r?t++:2047>=r?t+=2:55296<=r&&57343>=r?(t+=4,++n):t+=3}return t},re=(e,t,n,r)=>{if(!(0<r))return 0;var i=n;r=n+r-1;for(var a=0;a<e.length;++a){var o=e.charCodeAt(a);if(55296<=o&&57343>=o)o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a);if(127>=o){if(n>=r)break;t[n++]=o}else{if(2047>=o){if(n+1>=r)break;t[n++]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;t[n++]=224|o>>12}else{if(n+3>=r)break;t[n++]=240|o>>18,t[n++]=128|o>>12&63}t[n++]=128|o>>6&63}t[n++]=128|63&o}}return t[n]=0,n-i},ie=(e,t)=>{var n=Array(ne(e)+1);return e=re(e,n,0,n.length),t&&(n.length=e),n},ae=[];function oe(e,t){ae[e]={input:[],output:[],cb:t},Ue(e,se)}var se={open(e){var t=ae[e.node.rdev];if(!t)throw new Ee(43);e.tty=t,e.seekable=!1},close(e){e.tty.cb.fsync(e.tty)},fsync(e){e.tty.cb.fsync(e.tty)},read(e,t,n,r){if(!e.tty||!e.tty.cb.xb)throw new Ee(60);for(var i=0,a=0;a<r;a++){try{var o=e.tty.cb.xb(e.tty)}catch(e){throw new Ee(29)}if(void 0===o&&0===i)throw new Ee(6);if(null==o)break;i++,t[n+a]=o}return i&&(e.node.atime=Date.now()),i},write(e,t,n,r){if(!e.tty||!e.tty.cb.qb)throw new Ee(60);try{for(var i=0;i<r;i++)e.tty.cb.qb(e.tty,t[n+i])}catch(e){throw new Ee(29)}return r&&(e.node.mtime=e.node.ctime=Date.now()),i}},ue={xb(){e:{if(!te.length){var e=null;if(l){var t=Buffer.alloc(256),n=0,r=process.stdin.fd;try{n=v.readSync(r,t,0,256)}catch(e){if(!e.toString().includes("EOF"))throw e;n=0}0<n&&(e=t.slice(0,n).toString("utf-8"))}else"undefined"!=typeof window&&"function"==typeof window.prompt&&(null!==(e=window.prompt("Input: "))&&(e+="\n"));if(!e){e=null;break e}te=ie(e,!0)}e=te.shift()}return e},qb(e,t){null===t||10===t?(b(V(e.output)),e.output=[]):0!=t&&e.output.push(t)},fsync(e){0<e.output?.length&&(b(V(e.output)),e.output=[])},Tb:()=>({Ob:25856,Qb:5,Nb:191,Pb:35387,Mb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}),Ub:()=>0,Vb:()=>[24,80]},ce={qb(e,t){null===t||10===t?(y(V(e.output)),e.output=[]):0!=t&&e.output.push(t)},fsync(e){0<e.output?.length&&(y(V(e.output)),e.output=[])}},le={Wa:null,Xa:()=>le.createNode(null,"/",16895,0),createNode(e,t,n,r){if(24576==(61440&n)||4096==(61440&n))throw new Ee(63);return le.Wa||(le.Wa={dir:{node:{Ta:le.La.Ta,Ua:le.La.Ua,lookup:le.La.lookup,hb:le.La.hb,rename:le.La.rename,unlink:le.La.unlink,rmdir:le.La.rmdir,readdir:le.La.readdir,symlink:le.La.symlink},stream:{Va:le.Ma.Va}},file:{node:{Ta:le.La.Ta,Ua:le.La.Ua},stream:{Va:le.Ma.Va,read:le.Ma.read,write:le.Ma.write,ib:le.Ma.ib,jb:le.Ma.jb}},link:{node:{Ta:le.La.Ta,Ua:le.La.Ua,readlink:le.La.readlink},stream:{}},ub:{node:{Ta:le.La.Ta,Ua:le.La.Ua},stream:xe}}),Re((n=Ae(e,t,n,r)).mode)?(n.La=le.Wa.dir.node,n.Ma=le.Wa.dir.stream,n.Na={}):32768==(61440&n.mode)?(n.La=le.Wa.file.node,n.Ma=le.Wa.file.stream,n.Ra=0,n.Na=null):40960==(61440&n.mode)?(n.La=le.Wa.link.node,n.Ma=le.Wa.link.stream):8192==(61440&n.mode)&&(n.La=le.Wa.ub.node,n.Ma=le.Wa.ub.stream),n.atime=n.mtime=n.ctime=Date.now(),e&&(e.Na[t]=n,e.atime=e.mtime=e.ctime=n.atime),n},Sb:e=>e.Na?e.Na.subarray?e.Na.subarray(0,e.Ra):new Uint8Array(e.Na):new Uint8Array(0),La:{Ta(e){var t={};return t.dev=8192==(61440&e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,Re(e.mode)?t.size=4096:32768==(61440&e.mode)?t.size=e.Ra:40960==(61440&e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.atime),t.mtime=new Date(e.mtime),t.ctime=new Date(e.ctime),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},Ua(e,t){for(var n of["mode","atime","mtime","ctime"])null!=t[n]&&(e[n]=t[n]);void 0!==t.size&&(t=t.size,e.Ra!=t&&(0==t?(e.Na=null,e.Ra=0):(n=e.Na,e.Na=new Uint8Array(t),n&&e.Na.set(n.subarray(0,Math.min(t,e.Ra))),e.Ra=t)))},lookup(){throw le.vb},hb:(e,t,n,r)=>le.createNode(e,t,n,r),rename(e,t,n){try{var r=Ne(t,n)}catch(e){}if(r){if(Re(e.mode))for(var i in r.Na)throw new Ee(55);Oe(r)}delete e.parent.Na[e.name],t.Na[n]=e,e.name=n,t.ctime=t.mtime=e.parent.ctime=e.parent.mtime=Date.now()},unlink(e,t){delete e.Na[t],e.ctime=e.mtime=Date.now()},rmdir(e,t){var n,r=Ne(e,t);for(n in r.Na)throw new Ee(55);delete e.Na[t],e.ctime=e.mtime=Date.now()},readdir:e=>[".","..",...Object.keys(e.Na)],symlink:(e,t,n)=>((e=le.createNode(e,t,41471,0)).link=n,e),readlink(e){if(40960!=(61440&e.mode))throw new Ee(28);return e.link}},Ma:{read(e,t,n,r,i){var a=e.node.Na;if(i>=e.node.Ra)return 0;if(8<(e=Math.min(e.node.Ra-i,r))&&a.subarray)t.set(a.subarray(i,i+e),n);else for(r=0;r<e;r++)t[n+r]=a[i+r];return e},write(e,t,n,r,i,a){if(t.buffer===T.buffer&&(a=!1),!r)return 0;if((e=e.node).mtime=e.ctime=Date.now(),t.subarray&&(!e.Na||e.Na.subarray)){if(a)return e.Na=t.subarray(n,n+r),e.Ra=r;if(0===e.Ra&&0===i)return e.Na=t.slice(n,n+r),e.Ra=r;if(i+r<=e.Ra)return e.Na.set(t.subarray(n,n+r),i),r}a=i+r;var o=e.Na?e.Na.length:0;if(o>=a||(a=Math.max(a,o*(1048576>o?2:1.125)>>>0),0!=o&&(a=Math.max(a,256)),o=e.Na,e.Na=new Uint8Array(a),0<e.Ra&&e.Na.set(o.subarray(0,e.Ra),0)),e.Na.subarray&&t.subarray)e.Na.set(t.subarray(n,n+r),i);else for(a=0;a<r;a++)e.Na[i+a]=t[n+a];return e.Ra=Math.max(e.Ra,i+r),r},Va(e,t,n){if(1===n?t+=e.position:2===n&&32768==(61440&e.node.mode)&&(t+=e.node.Ra),0>t)throw new Ee(28);return t},ib(e,t,n,r,i){if(32768!=(61440&e.node.mode))throw new Ee(43);if(e=e.node.Na,2&i||!e||e.buffer!==T.buffer){i=!0,r=65536*Math.ceil(t/65536);var a=Nt(65536,r);if(a&&_.fill(0,a,a+r),!(r=a))throw new Ee(48);e&&((0<n||n+t<e.length)&&(e=e.subarray?e.subarray(n,n+t):Array.prototype.slice.call(e,n,n+t)),T.set(e,r))}else i=!1,r=e.byteOffset;return{Kb:r,Ab:i}},jb:(e,t,n,r)=>(le.Ma.write(e,t,0,r,n,!1),0)}},fe=(e,t)=>{var n=0;return e&&(n|=365),t&&(n|=146),n},he=null,pe={},me=[],de=1,ge=null,ve=!1,be=!0,ye={},Ee=class{name="ErrnoError";constructor(e){this.Pa=e}},we=class{gb={};node=null;get flags(){return this.gb.flags}set flags(e){this.gb.flags=e}get position(){return this.gb.position}set position(e){this.gb.position=e}},Te=class{La={};Ma={};ab=null;constructor(e,t,n,r){e||=this,this.parent=e,this.Xa=e.Xa,this.id=de++,this.name=t,this.mode=n,this.rdev=r,this.atime=this.mtime=this.ctime=Date.now()}get read(){return!(365&~this.mode)}set read(e){e?this.mode|=365:this.mode&=-366}get write(){return!(146&~this.mode)}set write(e){e?this.mode|=146:this.mode&=-147}};function _e(e,t={}){if(!e)throw new Ee(44);t.nb??(t.nb=!0),"/"===e.charAt(0)||(e="//"+e);var n=0;e:for(;40>n;n++){e=e.split("/").filter(e=>!!e);for(var r=he,i="/",a=0;a<e.length;a++){var o=a===e.length-1;if(o&&t.parent)break;if("."!==e[a])if(".."===e[a])i=$(i),r=r.parent;else{i=J(i+"/"+e[a]);try{r=Ne(r,e[a])}catch(e){if(44===e?.Pa&&o&&t.Jb)return{path:i};throw e}if(!r.ab||o&&!t.nb||(r=r.ab.root),40960==(61440&r.mode)&&(!o||t.$a)){if(!r.La.readlink)throw new Ee(52);"/"===(r=r.La.readlink(r)).charAt(0)||(r=$(i)+"/"+r),e=r+"/"+e.slice(a+1).join("/");continue e}}}return{path:i,node:r}}throw new Ee(32)}function ke(e){for(var t;;){if(e===e.parent)return e=e.Xa.zb,t?"/"!==e[e.length-1]?`${e}/${t}`:e+t:e;t=t?`${e.name}/${t}`:e.name,e=e.parent}}function Se(e,t){for(var n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r)|0;return(e+n>>>0)%ge.length}function Oe(e){var t=Se(e.parent.id,e.name);if(ge[t]===e)ge[t]=e.bb;else for(t=ge[t];t;){if(t.bb===e){t.bb=e.bb;break}t=t.bb}}function Ne(e,t){var n=Re(e.mode)?(n=Le(e,"x"))?n:e.La.lookup?0:2:54;if(n)throw new Ee(n);for(n=ge[Se(e.id,t)];n;n=n.bb){var r=n.name;if(n.parent.id===e.id&&r===t)return n}return e.La.lookup(e,t)}function Ae(e,t,n,r){return t=Se((e=new Te(e,t,n,r)).parent.id,e.name),e.bb=ge[t],ge[t]=e}function Re(e){return 16384==(61440&e)}function Ie(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t}function Le(e,t){return be?0:!t.includes("r")||292&e.mode?t.includes("w")&&!(146&e.mode)||t.includes("x")&&!(73&e.mode)?2:0:2}function De(e,t){if(!Re(e.mode))return 54;try{return Ne(e,t),20}catch(e){}return Le(e,"wx")}function Pe(e,t,n){try{var r=Ne(e,t)}catch(e){return e.Pa}if(e=Le(e,"wx"))return e;if(n){if(!Re(r.mode))return 54;if(r===r.parent||"/"===ke(r))return 10}else if(Re(r.mode))return 31;return 0}function Me(e){if(!e)throw new Ee(63);return e}function Ce(e){if(!(e=me[e]))throw new Ee(8);return e}function je(e,t=-1){if(e=Object.assign(new we,e),-1==t)e:{for(t=0;4096>=t;t++)if(!me[t])break e;throw new Ee(33)}return e.fd=t,me[t]=e}function Fe(e,t,n){var r=e?.Ma.Ua;e=r?e:t,r??=t.La.Ua,Me(r),r(e,n)}var xe={open(e){e.Ma=pe[e.node.rdev].Ma,e.Ma.open?.(e)},Va(){throw new Ee(70)}};function Ue(e,t){pe[e]={Ma:t}}function Ge(e,t){var n="/"===t;if(n&&he)throw new Ee(10);if(!n&&t){var r=_e(t,{nb:!1});if(t=r.path,(r=r.node).ab)throw new Ee(10);if(!Re(r.mode))throw new Ee(54)}t={type:e,Wb:{},zb:t,Ib:[]},(e=e.Xa(t)).Xa=t,t.root=e,n?he=e:r&&(r.ab=t,r.Xa&&r.Xa.Ib.push(t))}function qe(e,t,n){var r=_e(e,{parent:!0}).node;if(!(e=Z(e)))throw new Ee(28);if("."===e||".."===e)throw new Ee(20);var i=De(r,e);if(i)throw new Ee(i);if(!r.La.hb)throw new Ee(63);return r.La.hb(r,e,t,n)}function He(e,t=511){return qe(e,1023&t|16384,0)}function Ye(e,t,n){void 0===n&&(n=t,t=438),qe(e,8192|t,n)}function Xe(e,t){if(!((...e)=>{for(var t="",n=!1,r=e.length-1;-1<=r&&!n;r--){if("string"!=typeof(n=0<=r?e[r]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";t=n+"/"+t,n="/"===n.charAt(0)}return(n?"/":"")+(t=Q(t.split("/").filter(e=>!!e),!n).join("/"))||"."})(e))throw new Ee(44);var n=_e(t,{parent:!0}).node;if(!n)throw new Ee(44);var r=De(n,t=Z(t));if(r)throw new Ee(r);if(!n.La.symlink)throw new Ee(63);n.La.symlink(n,t,e)}function Be(e){var t=_e(e,{parent:!0}).node,n=Ne(t,e=Z(e)),r=Pe(t,e,!0);if(r)throw new Ee(r);if(!t.La.rmdir)throw new Ee(63);if(n.ab)throw new Ee(10);t.La.rmdir(t,e),Oe(n)}function We(e){var t=_e(e,{parent:!0}).node;if(!t)throw new Ee(44);var n=Ne(t,e=Z(e)),r=Pe(t,e,!1);if(r)throw new Ee(r);if(!t.La.unlink)throw new Ee(63);if(n.ab)throw new Ee(10);t.La.unlink(t,e),Oe(n)}function ze(e,t){return Me((e=_e(e,{$a:!t}).node).La.Ta)(e)}function Ve(e,t,n,r){Fe(e,t,{mode:4095&n|-4096&t.mode,ctime:Date.now(),Fb:r})}function Ke(e,t){Ve(null,e="string"==typeof e?_e(e,{$a:!0}).node:e,t)}function Qe(e,t,n){if(Re(t.mode))throw new Ee(31);if(32768!=(61440&t.mode))throw new Ee(28);var r=Le(t,"w");if(r)throw new Ee(r);Fe(e,t,{size:n,timestamp:Date.now()})}function Je(e,t,n=438){if(""===e)throw new Ee(44);if("string"==typeof t){var r={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[t];if(void 0===r)throw Error(`Unknown file open mode: ${t}`);t=r}if(n=64&t?4095&n|32768:0,"object"==typeof e)r=e;else{var i=e.endsWith("/");r=(e=_e(e,{$a:!(131072&t),Jb:!0})).node,e=e.path}var o=!1;if(64&t)if(r){if(128&t)throw new Ee(20)}else{if(i)throw new Ee(31);r=qe(e,511|n,0),o=!0}if(!r)throw new Ee(44);if(8192==(61440&r.mode)&&(t&=-513),65536&t&&!Re(r.mode))throw new Ee(54);if(!o&&(i=r?40960==(61440&r.mode)?32:Re(r.mode)&&("r"!==Ie(t)||576&t)?31:Le(r,Ie(t)):44))throw new Ee(i);return 512&t&&!o&&Qe(null,i="string"==typeof(i=r)?_e(i,{$a:!0}).node:i,0),t&=-131713,(i=je({node:r,path:ke(r),flags:t,seekable:!0,position:0,Ma:r.Ma,Lb:[],error:!1})).Ma.open&&i.Ma.open(i),o&&Ke(r,511&n),!a.logReadFiles||1&t||e in ye||(ye[e]=1),i}function $e(e){if(null===e.fd)throw new Ee(8);e.ob&&(e.ob=null);try{e.Ma.close&&e.Ma.close(e)}catch(e){throw e}finally{me[e.fd]=null}e.fd=null}function Ze(e,t,n){if(null===e.fd)throw new Ee(8);if(!e.seekable||!e.Ma.Va)throw new Ee(70);if(0!=n&&1!=n&&2!=n)throw new Ee(28);e.position=e.Ma.Va(e,t,n),e.Lb=[]}function et(e,t,n,r,i){if(0>r||0>i)throw new Ee(28);if(null===e.fd)throw new Ee(8);if(1==(2097155&e.flags))throw new Ee(8);if(Re(e.node.mode))throw new Ee(31);if(!e.Ma.read)throw new Ee(28);var a=void 0!==i;if(a){if(!e.seekable)throw new Ee(70)}else i=e.position;return t=e.Ma.read(e,t,n,r,i),a||(e.position+=t),t}function tt(e,t,n,r,i){if(0>r||0>i)throw new Ee(28);if(null===e.fd)throw new Ee(8);if(!(2097155&e.flags))throw new Ee(8);if(Re(e.node.mode))throw new Ee(31);if(!e.Ma.write)throw new Ee(28);e.seekable&&1024&e.flags&&Ze(e,0,2);var a=void 0!==i;if(a){if(!e.seekable)throw new Ee(70)}else i=e.position;return t=e.Ma.write(e,t,n,r,i,void 0),a||(e.position+=t),t}function nt(e,t,n){e=J("/dev/"+e);var r=fe(!!t,!!n);nt.yb??(nt.yb=64);var i=nt.yb++<<8;Ue(i,{open(e){e.seekable=!1},close(){n?.buffer?.length&&n(10)},read(e,n,r,i){for(var a=0,o=0;o<i;o++){try{var s=t()}catch(e){throw new Ee(29)}if(void 0===s&&0===a)throw new Ee(6);if(null==s)break;a++,n[r+o]=s}return a&&(e.node.atime=Date.now()),a},write(e,t,r,i){for(var a=0;a<i;a++)try{n(t[r+a])}catch(e){throw new Ee(29)}return i&&(e.node.mtime=e.node.ctime=Date.now()),a}}),Ye(e,r,i)}function rt(e,t,n){if("/"===t.charAt(0))return t;if(e=-100===e?"/":Ce(e).path,0==t.length){if(!n)throw new Ee(44);return e}return e+"/"+t}function it(e,t){S[e>>2]=t.dev,S[e+4>>2]=t.mode,O[e+8>>2]=t.nlink,S[e+12>>2]=t.uid,S[e+16>>2]=t.gid,S[e+20>>2]=t.rdev,A[e+24>>3]=BigInt(t.size),S[e+32>>2]=4096,S[e+36>>2]=t.blocks;var n=t.atime.getTime(),r=t.mtime.getTime(),i=t.ctime.getTime();return A[e+40>>3]=BigInt(Math.floor(n/1e3)),O[e+48>>2]=n%1e3*1e6,A[e+56>>3]=BigInt(Math.floor(r/1e3)),O[e+64>>2]=r%1e3*1e6,A[e+72>>3]=BigInt(Math.floor(i/1e3)),O[e+80>>2]=i%1e3*1e6,A[e+88>>3]=BigInt(t.ino),0}var at,ot,st,ut=void 0,ct=()=>{var e=S[+ut>>2];return ut+=4,e},lt=0,ft=[0,31,60,91,121,152,182,213,244,274,305,335],ht=[0,31,59,90,120,151,181,212,243,273,304,334],pt={},mt=e=>{w=e,B||0<lt||(a.onExit?.(e),L=!0),d(e,new U(e))},dt={},gt=()=>{if(!at){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:m||"./this.program"};for(e in dt)void 0===dt[e]?delete t[e]:t[e]=dt[e];var n=[];for(e in t)n.push(`${e}=${t[e]}`);at=n}return at},vt=e=>{var t=ne(e)+1,n=It(t);return re(e,_,n,t),n},bt=0,yt=(e,t)=>(t=1==t?It(e.length):St(e.length),e.subarray||e.slice||(e=new Uint8Array(e)),_.set(e,t),t),Et=[],wt=e=>{ot.delete(st.get(e)),st.set(e,null),Et.push(e)},Tt=(e,t)=>{if(!ot){ot=new WeakMap;var n=st.length;if(ot)for(var r=0;r<0+n;r++){var i=st.get(r);i&&ot.set(i,r)}}if(n=ot.get(e)||0)return n;if(Et.length)n=Et.pop();else{try{st.grow(1)}catch(e){if(!(e instanceof RangeError))throw e;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}n=st.length-1}try{st.set(n,e)}catch(u){if(!(u instanceof TypeError))throw u;if("function"==typeof WebAssembly.Function){var a=WebAssembly.Function;r={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},i={parameters:[],results:"v"==t[0]?[]:[r[t[0]]]};for(var o=1;o<t.length;++o)i.parameters.push(r[t[o]]);t=new a(i,e)}else{r=[1],i=t.slice(0,1),t=t.slice(1),o={i:127,p:127,j:126,f:125,d:124,e:111},r.push(96);var s=t.length;for(a of(128>s?r.push(s):r.push(s%128|128,s>>7),t))r.push(o[a]);"v"==i?r.push(0):r.push(1,o[i]),t=[0,97,115,109,1,0,0,0,1],128>(a=r.length)?t.push(a):t.push(a%128|128,a>>7),t.push(...r),t.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),t=new WebAssembly.Module(new Uint8Array(t)),t=new WebAssembly.Instance(t,{e:{f:e}}).exports.f}st.set(n,t)}return ot.set(e,n),n};ge=Array(4096),Ge(le,"/"),He("/tmp"),He("/home"),He("/home/web_user"),function(){He("/dev"),Ue(259,{read:()=>0,write:(e,t,n,r)=>r,Va:()=>0}),Ye("/dev/null",259),oe(1280,ue),oe(1536,ce),Ye("/dev/tty",1280),Ye("/dev/tty1",1536);var e=new Uint8Array(1024),t=0,n=()=>(0===t&&(ee(e),t=e.byteLength),e[--t]);nt("random",n),nt("urandom",n),He("/dev/shm"),He("/dev/shm/tmp")}(),function(){He("/proc");var e=He("/proc/self");He("/proc/self/fd"),Ge({Xa(){var t=Ae(e,"fd",16895,73);return t.Ma={Va:le.Ma.Va},t.La={lookup(e,t){var n=Ce(e=+t);return(e={parent:null,Xa:{zb:"fake"},La:{readlink:()=>n.path},id:e+1}).parent=e},readdir:()=>Array.from(me.entries()).filter(([,e])=>e).map(([e])=>e.toString())},t}},"/proc/self/fd")}(),le.vb=new Ee(44),le.vb.stack="<generic error, no stack>";var _t,kt={a:(e,t,n,r)=>F(`Assertion failed: ${e?V(_,e):""}, at: `+[t?t?V(_,t):"":"unknown filename",n,r?r?V(_,r):"":"unknown function"]),i:function(e,t){try{return Ke(e=e?V(_,e):"",t),0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},L:function(e,t,n){try{if(t=rt(e,t=t?V(_,t):""),-8&n)return-28;var r=_e(t,{$a:!0}).node;return r?(e="",4&n&&(e+="r"),2&n&&(e+="w"),1&n&&(e+="x"),e&&Le(r,e)?-2:0):-44}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},j:function(e,t){try{var n=Ce(e);return Ve(n,n.node,t,!1),0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},h:function(e){try{var t=Ce(e);return Fe(t,t.node,{timestamp:Date.now(),Fb:!1}),0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},b:function(e,t,n){ut=n;try{var r=Ce(e);switch(t){case 0:var i=ct();if(0>i)break;for(;me[i];)i++;return function(e,t=-1){return e=je(e,t),e.Ma?.Rb?.(e),e}(r,i).fd;case 1:case 2:case 13:case 14:return 0;case 3:return r.flags;case 4:return i=ct(),r.flags|=i,0;case 12:return i=ct(),k[i+0>>1]=2,0}return-28}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},g:function(e,t){try{var n=Ce(e),r=n.node,i=n.Ma.Ta;return e=i?n:r,i??=r.La.Ta,Me(i),it(t,i(e))}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},H:function(e,t){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t);try{if(isNaN(t))return 61;var n=Ce(e);if(0>t||!(2097155&n.flags))throw new Ee(28);return Qe(n,n.node,t),0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},G:function(e,t){try{if(0===t)return-28;var n=ne("/")+1;return t<n?-68:(re("/",_,e,t),n)}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},K:function(e,t){try{return it(t,ze(e=e?V(_,e):"",!0))}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},C:function(e,t,n){try{return He(t=rt(e,t=t?V(_,t):""),n),0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},J:function(e,t,n,r){try{t=t?V(_,t):"";var i=256&r;return t=rt(e,t,4096&r),it(n,i?ze(t,!0):ze(t))}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},x:function(e,t,n,r){ut=r;try{return Je(t=rt(e,t=t?V(_,t):""),n,r?ct():0).fd}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},v:function(e,t,n,r){try{if(t=rt(e,t=t?V(_,t):""),0>=r)return-28;var i=_e(t).node;if(!i)throw new Ee(44);if(!i.La.readlink)throw new Ee(28);var a=i.La.readlink(i),o=Math.min(r,ne(a)),s=T[n+o];return re(a,_,n,r+1),T[n+o]=s,o}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},u:function(e){try{return Be(e=e?V(_,e):""),0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},f:function(e,t){try{return it(t,ze(e=e?V(_,e):""))}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},r:function(e,t,n){try{return t=rt(e,t=t?V(_,t):""),0===n?We(t):512===n?Be(t):F("Invalid flags passed to unlinkat"),0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},q:function(e,t,n){try{t=rt(e,t=t?V(_,t):"",!0);var r,i,a=Date.now();if(n){var o=O[n>>2]+4294967296*S[n+4>>2],s=S[n+8>>2];r=1073741823==s?a:1073741822==s?null:1e3*o+s/1e6,o=O[(n+=16)>>2]+4294967296*S[n+4>>2],i=1073741823==(s=S[n+8>>2])?a:1073741822==s?null:1e3*o+s/1e6}else i=r=a;if(null!==(i??r)){e=r;var u=_e(t,{$a:!0}).node;Me(u.La.Ua)(u,{atime:e,mtime:i})}return 0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},m:()=>F(""),l:()=>{B=!1,lt=0},A:function(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),e=new Date(1e3*e),S[t>>2]=e.getSeconds(),S[t+4>>2]=e.getMinutes(),S[t+8>>2]=e.getHours(),S[t+12>>2]=e.getDate(),S[t+16>>2]=e.getMonth(),S[t+20>>2]=e.getFullYear()-1900,S[t+24>>2]=e.getDay();var n=e.getFullYear();S[t+28>>2]=(0!=n%4||0==n%100&&0!=n%400?ht:ft)[e.getMonth()]+e.getDate()-1|0,S[t+36>>2]=-60*e.getTimezoneOffset(),n=new Date(e.getFullYear(),6,1).getTimezoneOffset();var r=new Date(e.getFullYear(),0,1).getTimezoneOffset();S[t+32>>2]=0|(n!=r&&e.getTimezoneOffset()==Math.min(r,n))},y:function(e,t,n,r,i,a,o){i=-9007199254740992>i||9007199254740992<i?NaN:Number(i);try{if(isNaN(i))return 61;var s=Ce(r);if(2&t&&!(2&n)&&2!=(2097155&s.flags))throw new Ee(2);if(1==(2097155&s.flags))throw new Ee(2);if(!s.Ma.ib)throw new Ee(43);if(!e)throw new Ee(28);var u=s.Ma.ib(s,e,i,t,n),c=u.Kb;return S[a>>2]=u.Ab,O[o>>2]=c,0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},z:function(e,t,n,r,i,a){a=-9007199254740992>a||9007199254740992<a?NaN:Number(a);try{var o=Ce(i);if(2&n){if(n=a,32768!=(61440&o.node.mode))throw new Ee(43);if(!(2&r)){var s=_.slice(e,e+t);o.Ma.jb&&o.Ma.jb(o,s,n,t,r)}}}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},n:(e,t)=>{if(pt[e]&&(clearTimeout(pt[e].id),delete pt[e]),!t)return 0;var n=setTimeout(()=>{delete pt[e],(e=>{if(!L)try{if(e(),!(B||0<lt))try{w=e=w,mt(e)}catch(e){e instanceof U||"unwind"==e||d(1,e)}}catch(e){e instanceof U||"unwind"==e||d(1,e)}})(()=>At(e,performance.now()))},t);return pt[e]={id:n,Xb:t},0},B:(e,t,n,r)=>{var i=(new Date).getFullYear(),a=new Date(i,0,1).getTimezoneOffset();i=new Date(i,6,1).getTimezoneOffset(),O[e>>2]=60*Math.max(a,i),S[t>>2]=Number(a!=i),e=(t=e=>{var t=Math.abs(e);return`UTC${0<=e?"-":"+"}${String(Math.floor(t/60)).padStart(2,"0")}${String(t%60).padStart(2,"0")}`})(a),t=t(i),i<a?(re(e,_,n,17),re(t,_,r,17)):(re(e,_,r,17),re(t,_,n,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:e=>{var t=_.length;if(2147483648<(e>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+100663296);e:{r=(Math.min(2147483648,65536*Math.ceil(Math.max(e,r)/65536))-E.buffer.byteLength+65535)/65536|0;try{E.grow(r),P();var i=1;break e}catch(e){}i=void 0}if(i)return!0}return!1},E:(e,t)=>{var n=0;return gt().forEach((r,i)=>{var a=t+n;for(i=O[e+4*i>>2]=a,a=0;a<r.length;++a)T[i++]=r.charCodeAt(a);T[i]=0,n+=r.length+1}),0},F:(e,t)=>{var n=gt();O[e>>2]=n.length;var r=0;return n.forEach(e=>r+=e.length+1),O[t>>2]=r,0},e:function(e){try{return $e(Ce(e)),0}catch(e){if("ErrnoError"!==e.name)throw e;return e.Pa}},p:function(e,t){try{var n=Ce(e);return T[t]=n.tty?2:Re(n.mode)?3:40960==(61440&n.mode)?7:4,k[t+2>>1]=0,A[t+8>>3]=BigInt(0),A[t+16>>3]=BigInt(0),0}catch(e){if("ErrnoError"!==e.name)throw e;return e.Pa}},w:function(e,t,n,r){try{e:{var i=Ce(e);e=t;for(var a,o=t=0;o<n;o++){var s=O[e>>2],u=O[e+4>>2];e+=8;var c=et(i,T,s,u,a);if(0>c){var l=-1;break e}if(t+=c,c<u)break;void 0!==a&&(a+=c)}l=t}return O[r>>2]=l,0}catch(e){if("ErrnoError"!==e.name)throw e;return e.Pa}},D:function(e,t,n,r){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t);try{if(isNaN(t))return 61;var i=Ce(e);return Ze(i,t,n),A[r>>3]=BigInt(i.position),i.ob&&0===t&&0===n&&(i.ob=null),0}catch(e){if("ErrnoError"!==e.name)throw e;return e.Pa}},I:function(e){try{var t=Ce(e);return t.Ma?.fsync?t.Ma.fsync(t):0}catch(e){if("ErrnoError"!==e.name)throw e;return e.Pa}},t:function(e,t,n,r){try{e:{var i=Ce(e);e=t;for(var a,o=t=0;o<n;o++){var s=O[e>>2],u=O[e+4>>2];e+=8;var c=tt(i,T,s,u,a);if(0>c){var l=-1;break e}if(t+=c,c<u)break;void 0!==a&&(a+=c)}l=t}return O[r>>2]=l,0}catch(e){if("ErrnoError"!==e.name)throw e;return e.Pa}},k:mt};!async function(){function e(e){return _t=e.exports,E=_t.M,P(),st=_t.O,C--,a.monitorRunDependencies?.(C),0==C&&j&&(e=j,j=null,e()),_t}C++,a.monitorRunDependencies?.(C);var t={a:kt};a.instantiateWasm?new Promise(n=>{a.instantiateWasm(t,(t,r)=>{e(t),n(t.exports)})}):(M??=a.locateFile?a.locateFile("sql-wasm.wasm",g):g+"sql-wasm.wasm",e((await async function(e){var t=M;if(!I&&"function"==typeof WebAssembly.instantiateStreaming&&!D(t)&&!l)try{var n=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(n,e)}catch(e){y(`wasm streaming compile failed: ${e}`),y("falling back to ArrayBuffer instantiation")}return x(t,e)}(t)).instance))}(),a._sqlite3_free=e=>(a._sqlite3_free=_t.P)(e),a._sqlite3_value_text=e=>(a._sqlite3_value_text=_t.Q)(e),a._sqlite3_prepare_v2=(e,t,n,r,i)=>(a._sqlite3_prepare_v2=_t.R)(e,t,n,r,i),a._sqlite3_step=e=>(a._sqlite3_step=_t.S)(e),a._sqlite3_reset=e=>(a._sqlite3_reset=_t.T)(e),a._sqlite3_exec=(e,t,n,r,i)=>(a._sqlite3_exec=_t.U)(e,t,n,r,i),a._sqlite3_finalize=e=>(a._sqlite3_finalize=_t.V)(e),a._sqlite3_column_name=(e,t)=>(a._sqlite3_column_name=_t.W)(e,t),a._sqlite3_column_text=(e,t)=>(a._sqlite3_column_text=_t.X)(e,t),a._sqlite3_column_type=(e,t)=>(a._sqlite3_column_type=_t.Y)(e,t),a._sqlite3_errmsg=e=>(a._sqlite3_errmsg=_t.Z)(e),a._sqlite3_clear_bindings=e=>(a._sqlite3_clear_bindings=_t._)(e),a._sqlite3_value_blob=e=>(a._sqlite3_value_blob=_t.$)(e),a._sqlite3_value_bytes=e=>(a._sqlite3_value_bytes=_t.aa)(e),a._sqlite3_value_double=e=>(a._sqlite3_value_double=_t.ba)(e),a._sqlite3_value_int=e=>(a._sqlite3_value_int=_t.ca)(e),a._sqlite3_value_type=e=>(a._sqlite3_value_type=_t.da)(e),a._sqlite3_result_blob=(e,t,n,r)=>(a._sqlite3_result_blob=_t.ea)(e,t,n,r),a._sqlite3_result_double=(e,t)=>(a._sqlite3_result_double=_t.fa)(e,t),a._sqlite3_result_error=(e,t,n)=>(a._sqlite3_result_error=_t.ga)(e,t,n),a._sqlite3_result_int=(e,t)=>(a._sqlite3_result_int=_t.ha)(e,t),a._sqlite3_result_int64=(e,t)=>(a._sqlite3_result_int64=_t.ia)(e,t),a._sqlite3_result_null=e=>(a._sqlite3_result_null=_t.ja)(e),a._sqlite3_result_text=(e,t,n,r)=>(a._sqlite3_result_text=_t.ka)(e,t,n,r),a._sqlite3_aggregate_context=(e,t)=>(a._sqlite3_aggregate_context=_t.la)(e,t),a._sqlite3_column_count=e=>(a._sqlite3_column_count=_t.ma)(e),a._sqlite3_data_count=e=>(a._sqlite3_data_count=_t.na)(e),a._sqlite3_column_blob=(e,t)=>(a._sqlite3_column_blob=_t.oa)(e,t),a._sqlite3_column_bytes=(e,t)=>(a._sqlite3_column_bytes=_t.pa)(e,t),a._sqlite3_column_double=(e,t)=>(a._sqlite3_column_double=_t.qa)(e,t),a._sqlite3_bind_blob=(e,t,n,r,i)=>(a._sqlite3_bind_blob=_t.ra)(e,t,n,r,i),a._sqlite3_bind_double=(e,t,n)=>(a._sqlite3_bind_double=_t.sa)(e,t,n),a._sqlite3_bind_int=(e,t,n)=>(a._sqlite3_bind_int=_t.ta)(e,t,n),a._sqlite3_bind_text=(e,t,n,r,i)=>(a._sqlite3_bind_text=_t.ua)(e,t,n,r,i),a._sqlite3_bind_parameter_index=(e,t)=>(a._sqlite3_bind_parameter_index=_t.va)(e,t),a._sqlite3_sql=e=>(a._sqlite3_sql=_t.wa)(e),a._sqlite3_normalized_sql=e=>(a._sqlite3_normalized_sql=_t.xa)(e),a._sqlite3_changes=e=>(a._sqlite3_changes=_t.ya)(e),a._sqlite3_close_v2=e=>(a._sqlite3_close_v2=_t.za)(e),a._sqlite3_create_function_v2=(e,t,n,r,i,o,s,u,c)=>(a._sqlite3_create_function_v2=_t.Aa)(e,t,n,r,i,o,s,u,c),a._sqlite3_update_hook=(e,t,n)=>(a._sqlite3_update_hook=_t.Ba)(e,t,n),a._sqlite3_open=(e,t)=>(a._sqlite3_open=_t.Ca)(e,t);var St=a._malloc=e=>(St=a._malloc=_t.Da)(e),Ot=a._free=e=>(Ot=a._free=_t.Ea)(e);a._RegisterExtensionFunctions=e=>(a._RegisterExtensionFunctions=_t.Fa)(e);var Nt=(e,t)=>(Nt=_t.Ga)(e,t),At=(e,t)=>(At=_t.Ha)(e,t),Rt=e=>(Rt=_t.Ia)(e),It=e=>(It=_t.Ja)(e),Lt=()=>(Lt=_t.Ka)();if(a.stackSave=()=>Lt(),a.stackRestore=e=>Rt(e),a.stackAlloc=e=>It(e),a.cwrap=(e,t,n,r)=>{var i=!n||n.every(e=>"number"===e||"boolean"===e);return"string"!==t&&i&&!r?a["_"+e]:(...r)=>((e,t,n,r)=>{var i={string:e=>{var t=0;return null!=e&&0!==e&&(t=vt(e)),t},array:e=>{var t=It(e.length);return T.set(e,t),t}};e=a["_"+e];var o,s=[],u=0;if(r)for(var c=0;c<r.length;c++){var l=i[n[c]];l?(0===u&&(u=Lt()),s[c]=l(r[c])):s[c]=r[c]}return n=e(...s),o=n,0!==u&&Rt(u),"string"===t?o?V(_,o):"":"boolean"===t?!!o:o})(e,t,n,r)},a.addFunction=Tt,a.removeFunction=wt,a.UTF8ToString=K,a.ALLOC_NORMAL=bt,a.allocate=yt,a.allocateUTF8OnStack=vt,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();return function e(){function t(){if(a.calledRun=!0,!L){var e,t;if(!a.noFSInit&&!ve)ve=!0,n??=a.stdin,e??=a.stdout,t??=a.stderr,n?nt("stdin",n):Xe("/dev/tty","/dev/stdin"),e?nt("stdout",null,e):Xe("/dev/tty","/dev/stdout"),t?nt("stderr",null,t):Xe("/dev/tty1","/dev/stderr"),Je("/dev/stdin",0),Je("/dev/stdout",1),Je("/dev/stderr",1);if(_t.N(),be=!1,a.onRuntimeInitialized?.(),a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;){var n=a.postRun.shift();q.unshift(n)}G(q)}}if(0<C)j=e;else{if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)Y();G(H),0<C?j=e:a.setStatus?(a.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>a.setStatus(""),1),t()},1)):t()}}(),o}))};e.exports=i,e.exports.default=i},920:()=>{}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r](a,a.exports,n),a.loaded=!0,a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";var e=n(826),t=n.n(e);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||u(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}}function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=u(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function u(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t,n){return(t=g(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return h(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,u=e,h.n=n,o}};function p(n,r){for(s=n,u=r,t=0;!f&&c&&!i&&t<l.length;t++){var i,a=l[t],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(t=s<2?e:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(t){a=e,s=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(h(t={},r,function(){return this}),t),p=c.prototype=s.prototype=Object.create(l);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,h(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return u.prototype=c,h(p,"constructor",c),h(c,"constructor",u),u.displayName="GeneratorFunction",h(c,i,"GeneratorFunction"),h(p),h(p,i,"Generator"),h(p,r,function(){return this}),h(p,"toString",function(){return"[object Generator]"}),(f=function(){return{w:a,m}})()}function h(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}h=function(e,t,n,r){function a(t,n){h(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},h(e,t,n,r)}function p(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function m(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){p(a,r,i,o,s,"next",e)}function s(e){p(a,r,i,o,s,"throw",e)}o(void 0)})}}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,g(r.key),r)}}function g(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}var v=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.db=null,this.SQL=null,this.dbName="supriai.db",this.isInitialized=!1},n=[{key:"init",value:(ae=m(f().m(function e(){var n,r,i;return f().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.isInitialized){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,t()({locateFile:function(e){return chrome.runtime.getURL(e)}});case 2:return this.SQL=e.v,e.n=3,chrome.storage.local.get([this.dbName]);case 3:if(!(n=e.v)[this.dbName]){e.n=4;break}r=new Uint8Array(n[this.dbName]),this.db=new this.SQL.Database(r),console.log("✅ Loaded existing database"),e.n=6;break;case 4:return this.db=new this.SQL.Database,e.n=5,this.createTables();case 5:console.log("✅ Created new database");case 6:this.isInitialized=!0,e.n=8;break;case 7:throw e.p=7,i=e.v,console.error("❌ Database initialization error:",i),i;case 8:return e.a(2)}},e,this,[[1,7]])})),function(){return ae.apply(this,arguments)})},{key:"createTables",value:(ie=m(f().m(function e(){return f().w(function(e){for(;;)switch(e.n){case 0:return this.db.run("\n      -- Visits table\n      CREATE TABLE IF NOT EXISTS visits (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        url TEXT NOT NULL UNIQUE,\n        url_hash TEXT NOT NULL,\n        title TEXT,\n        first_visit INTEGER NOT NULL,\n        last_visit INTEGER NOT NULL,\n        visit_count INTEGER DEFAULT 0,\n        total_time_spent INTEGER DEFAULT 0,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Sessions table\n      CREATE TABLE IF NOT EXISTS sessions (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        visit_id INTEGER NOT NULL,\n        timestamp INTEGER NOT NULL,\n        time_spent INTEGER DEFAULT 0,\n        scroll_depth REAL DEFAULT 0,\n        interactions INTEGER DEFAULT 0,\n        highlight_count INTEGER DEFAULT 0,\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE\n      );\n\n      -- Highlights table\n      CREATE TABLE IF NOT EXISTS highlights (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        visit_id INTEGER NOT NULL,\n        text TEXT NOT NULL,\n        timestamp INTEGER NOT NULL,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE\n      );\n\n      -- AI Insights table\n      CREATE TABLE IF NOT EXISTS insights (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        visit_id INTEGER NOT NULL UNIQUE,\n        summary TEXT,\n        topics TEXT,\n        timestamp INTEGER NOT NULL,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE\n      );\n\n      -- Tags table\n      CREATE TABLE IF NOT EXISTS tags (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT NOT NULL UNIQUE\n      );\n\n      -- Visit Tags junction table\n      CREATE TABLE IF NOT EXISTS visit_tags (\n        visit_id INTEGER NOT NULL,\n        tag_id INTEGER NOT NULL,\n        PRIMARY KEY (visit_id, tag_id),\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE,\n        FOREIGN KEY (tag_id) REFERENCES tags (id) ON DELETE CASCADE\n      );\n\n      -- Personality Snapshots table (for PersonaSync)\n      CREATE TABLE IF NOT EXISTS personality_snapshots (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        week_start INTEGER NOT NULL,\n        week_end INTEGER NOT NULL,\n        tone TEXT,\n        top_topics TEXT,\n        reading_habits TEXT,\n        emotional_themes TEXT,\n        summary TEXT,\n        total_time_spent INTEGER DEFAULT 0,\n        total_visits INTEGER DEFAULT 0,\n        total_highlights INTEGER DEFAULT 0,\n        dominant_interests TEXT,\n        quote_of_week TEXT,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Interest Evolution table\n      CREATE TABLE IF NOT EXISTS interest_evolution (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        topic TEXT NOT NULL,\n        period TEXT NOT NULL,\n        count INTEGER DEFAULT 0,\n        total_time INTEGER DEFAULT 0,\n        trend_score REAL DEFAULT 0,\n        status TEXT,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Mood Tracking table\n      CREATE TABLE IF NOT EXISTS mood_tracking (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        timestamp INTEGER NOT NULL,\n        sentiment TEXT,\n        sentiment_score REAL DEFAULT 0,\n        emotions TEXT,\n        tone TEXT,\n        url TEXT,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Goals table\n      CREATE TABLE IF NOT EXISTS goals (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        title TEXT NOT NULL,\n        description TEXT,\n        keywords TEXT,\n        priority TEXT DEFAULT 'medium',\n        target_hours REAL DEFAULT 0,\n        actual_hours REAL DEFAULT 0,\n        is_active INTEGER DEFAULT 1,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),\n        last_nudge INTEGER,\n        nudge_count INTEGER DEFAULT 0\n      );\n\n      -- Skills tracking\n      CREATE TABLE IF NOT EXISTS skill_activities (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        url TEXT NOT NULL,\n        skill TEXT NOT NULL,\n        confidence REAL DEFAULT 0,\n        keywords TEXT,\n        time_spent INTEGER DEFAULT 0,\n        timestamp INTEGER NOT NULL,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Achievements\n      CREATE TABLE IF NOT EXISTS achievements (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        achievement_id TEXT NOT NULL UNIQUE,\n        name TEXT NOT NULL,\n        icon TEXT,\n        points INTEGER DEFAULT 0,\n        unlocked_at INTEGER NOT NULL\n      );\n\n      -- Streaks\n      CREATE TABLE IF NOT EXISTS streaks (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        current_streak INTEGER DEFAULT 0,\n        longest_streak INTEGER DEFAULT 0,\n        last_active_date INTEGER NOT NULL,\n        updated_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Focus sessions\n      CREATE TABLE IF NOT EXISTS focus_sessions (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        start_time INTEGER NOT NULL,\n        end_time INTEGER NOT NULL,\n        duration INTEGER NOT NULL,\n        completed BOOLEAN DEFAULT 0,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Reflection prompts and responses\n      CREATE TABLE IF NOT EXISTS reflection_prompts (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        prompt TEXT NOT NULL,\n        timestamp INTEGER NOT NULL,\n        context TEXT\n      );\n\n      CREATE TABLE IF NOT EXISTS reflection_responses (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        prompt_id INTEGER NOT NULL,\n        response TEXT NOT NULL,\n        timestamp INTEGER NOT NULL,\n        FOREIGN KEY (prompt_id) REFERENCES reflection_prompts (id)\n      );\n\n      -- Weekly challenges\n      CREATE TABLE IF NOT EXISTS weekly_challenges (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        challenge_id TEXT NOT NULL,\n        week_start INTEGER NOT NULL,\n        progress INTEGER DEFAULT 0,\n        target INTEGER NOT NULL,\n        completed BOOLEAN DEFAULT 0\n      );\n\n      -- Feature usage tracking\n      CREATE TABLE IF NOT EXISTS feature_usage (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        feature_name TEXT NOT NULL,\n        usage_count INTEGER DEFAULT 0,\n        last_used INTEGER NOT NULL\n      );\n\n      -- Twin interactions\n      CREATE TABLE IF NOT EXISTS twin_interactions (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        question TEXT NOT NULL,\n        answer TEXT NOT NULL,\n        confidence TEXT,\n        timestamp INTEGER NOT NULL\n      );\n\n      -- Indexes for better performance\n      CREATE INDEX IF NOT EXISTS idx_visits_url_hash ON visits(url_hash);\n      CREATE INDEX IF NOT EXISTS idx_visits_last_visit ON visits(last_visit);\n      CREATE INDEX IF NOT EXISTS idx_sessions_visit_id ON sessions(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_highlights_visit_id ON highlights(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_insights_visit_id ON insights(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_visit_tags_visit_id ON visit_tags(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_visit_tags_tag_id ON visit_tags(tag_id);\n      CREATE INDEX IF NOT EXISTS idx_personality_snapshots_week ON personality_snapshots(week_start);\n      CREATE INDEX IF NOT EXISTS idx_interest_evolution_period ON interest_evolution(period);\n      CREATE INDEX IF NOT EXISTS idx_mood_tracking_timestamp ON mood_tracking(timestamp);\n    "),e.n=1,this.saveDatabase();case 1:return e.a(2)}},e,this)})),function(){return ie.apply(this,arguments)})},{key:"saveDatabase",value:(re=m(f().m(function e(){var t,n,r,i;return f().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.db){e.n=1;break}return e.a(2);case 1:if(e.p=1,t=this.db.export(),n=Array.from(t),!((r=(n.length/1024/1024).toFixed(2))>9)){e.n=2;break}return console.warn("⚠️ Database size: ".concat(r,"MB - approaching 10MB limit!")),e.n=2,this.cleanup();case 2:return e.n=3,chrome.storage.local.set(l({},this.dbName,n));case 3:console.log("💾 Database saved (".concat(r,"MB)")),e.n=5;break;case 4:e.p=4,i=e.v,console.error("❌ Error saving database:",i);case 5:return e.a(2)}},e,this,[[1,4]])})),function(){return re.apply(this,arguments)})},{key:"hashURL",value:function(e){return e.replace(/[^a-zA-Z0-9]/g,"_").substring(0,100)}},{key:"getOrCreateVisit",value:(ne=m(f().m(function e(t,n){var r,i,a,o,s;return f().w(function(e){for(;;)if(0===e.n)return r=this.hashURL(t),(i=this.db.prepare("SELECT * FROM visits WHERE url_hash = ?")).bind([r]),a=null,i.step()&&(a=i.getAsObject()),i.free(),a||(o=Date.now(),this.db.run("INSERT INTO visits (url, url_hash, title, first_visit, last_visit, visit_count) VALUES (?, ?, ?, ?, ?, ?)",[t,r,n,o,o,0]),(s=this.db.prepare("SELECT * FROM visits WHERE url_hash = ?")).bind([r]),s.step()&&(a=s.getAsObject()),s.free()),e.a(2,a)},e,this)})),function(e,t){return ne.apply(this,arguments)})},{key:"updateVisit",value:(te=m(f().m(function e(t){var n,r,i,a,o,s,u,c;return f().w(function(e){for(;;)switch(e.n){case 0:return n=t.url,r=t.title,i=t.timeSpent,a=t.scrollDepth,o=t.interactions,s=t.highlights,e.n=1,this.getOrCreateVisit(n,r);case 1:return u=e.v,c=Date.now(),this.db.run("UPDATE visits \n       SET last_visit = ?, \n           visit_count = visit_count + 1, \n           total_time_spent = total_time_spent + ?,\n           title = ?\n       WHERE id = ?",[c,i||0,r,u.id]),this.db.run("INSERT INTO sessions (visit_id, timestamp, time_spent, scroll_depth, interactions, highlight_count)\n       VALUES (?, ?, ?, ?, ?, ?)",[u.id,c,i||0,a||0,o||0,(null==s?void 0:s.length)||0]),this.db.run("DELETE FROM sessions \n       WHERE visit_id = ? \n       AND id NOT IN (\n         SELECT id FROM sessions \n         WHERE visit_id = ? \n         ORDER BY timestamp DESC \n         LIMIT 50\n       )",[u.id,u.id]),e.n=2,this.saveDatabase();case 2:return e.a(2,u)}},e,this)})),function(e){return te.apply(this,arguments)})},{key:"getVisitHistory",value:(ee=m(f().m(function e(t){var n,r,i,a,o;return f().w(function(e){for(;;)switch(e.n){case 0:if(n=this.hashURL(t),(r=this.db.prepare("\n      SELECT v.*, \n             (SELECT COUNT(*) FROM sessions WHERE visit_id = v.id) as session_count\n      FROM visits v\n      WHERE v.url_hash = ?\n    ")).bind([n]),i=null,r.step()&&(i=r.getAsObject()),r.free(),i){e.n=1;break}return e.a(2,null);case 1:for((a=this.db.prepare("\n      SELECT * FROM sessions \n      WHERE visit_id = ? \n      ORDER BY timestamp DESC \n      LIMIT 50\n    ")).bind([i.id]),o=[];a.step();)o.push(a.getAsObject());return a.free(),i.sessions=o,e.a(2,i)}},e,this)})),function(e){return ee.apply(this,arguments)})},{key:"saveHighlight",value:(Z=m(f().m(function e(t){var n,r,i,a,o;return f().w(function(e){for(;;)switch(e.n){case 0:return n=t.text,r=t.url,i=t.title,a=t.timestamp,e.n=1,this.getOrCreateVisit(r,i);case 1:return o=e.v,this.db.run("INSERT INTO highlights (visit_id, text, timestamp) VALUES (?, ?, ?)",[o.id,n,a||Date.now()]),this.db.run("DELETE FROM highlights \n       WHERE visit_id = ? \n       AND id NOT IN (\n         SELECT id FROM highlights \n         WHERE visit_id = ? \n         ORDER BY timestamp DESC \n         LIMIT 100\n       )",[o.id,o.id]),e.n=2,this.saveDatabase();case 2:return e.a(2)}},e,this)})),function(e){return Z.apply(this,arguments)})},{key:"getHighlights",value:($=m(f().m(function e(t){var n,r,i;return f().w(function(e){for(;;)if(0===e.n){for(n=this.hashURL(t),(r=this.db.prepare("\n      SELECT h.* \n      FROM highlights h\n      JOIN visits v ON h.visit_id = v.id\n      WHERE v.url_hash = ?\n      ORDER BY h.timestamp DESC\n      LIMIT 100\n    ")).bind([n]),i=[];r.step();)i.push(r.getAsObject());return r.free(),e.a(2,i)}},e,this)})),function(e){return $.apply(this,arguments)})},{key:"saveAIInsights",value:(J=m(f().m(function e(t,n){var r,i,a,o,u,c;return f().w(function(e){for(;;)switch(e.p=e.n){case 0:return this.hashURL(t),e.n=1,this.getOrCreateVisit(t,"");case 1:if(r=e.v,JSON.stringify(n.tags||[]),i=JSON.stringify(n.topics||[]),this.db.run("INSERT INTO insights (visit_id, summary, topics, timestamp)\n       VALUES (?, ?, ?, ?)\n       ON CONFLICT(visit_id) DO UPDATE SET\n         summary = excluded.summary,\n         topics = excluded.topics,\n         timestamp = excluded.timestamp",[r.id,n.summary||"",i,n.timestamp||Date.now()]),!(n.tags&&n.tags.length>0)){e.n=8;break}a=s(n.tags),e.p=2,a.s();case 3:if((o=a.n()).done){e.n=5;break}return u=o.value,e.n=4,this.addTag(t,u);case 4:e.n=3;break;case 5:e.n=7;break;case 6:e.p=6,c=e.v,a.e(c);case 7:return e.p=7,a.f(),e.f(7);case 8:return e.n=9,this.saveDatabase();case 9:return e.a(2)}},e,this,[[2,6,7,8]])})),function(e,t){return J.apply(this,arguments)})},{key:"getAIInsights",value:(Q=m(f().m(function e(t){var n,r,i;return f().w(function(e){for(;;)switch(e.n){case 0:if(n=this.hashURL(t),(r=this.db.prepare("\n      SELECT i.* \n      FROM insights i\n      JOIN visits v ON i.visit_id = v.id\n      WHERE v.url_hash = ?\n    ")).bind([n]),i=null,r.step()&&(i=r.getAsObject()).topics&&(i.topics=JSON.parse(i.topics)),r.free(),!i){e.n=2;break}return e.n=1,this.getTags(t);case 1:i.tags=e.v;case 2:return e.a(2,i)}},e,this)})),function(e){return Q.apply(this,arguments)})},{key:"addTag",value:(K=m(f().m(function e(t,n){var r,i,a,o;return f().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.getOrCreateVisit(t,"");case 1:r=e.v,i=null,(a=this.db.prepare("SELECT id FROM tags WHERE name = ?")).bind([n]),a.step()&&(i=a.getAsObject().id),a.free(),i||(this.db.run("INSERT INTO tags (name) VALUES (?)",[n]),(o=this.db.prepare("SELECT id FROM tags WHERE name = ?")).bind([n]),o.step()&&(i=o.getAsObject().id),o.free());try{this.db.run("INSERT OR IGNORE INTO visit_tags (visit_id, tag_id) VALUES (?, ?)",[r.id,i])}catch(e){}return e.n=2,this.saveDatabase();case 2:return e.a(2)}},e,this)})),function(e,t){return K.apply(this,arguments)})},{key:"getTags",value:(V=m(f().m(function e(t){var n,r,i;return f().w(function(e){for(;;)if(0===e.n){for(n=this.hashURL(t),(r=this.db.prepare("\n      SELECT t.name \n      FROM tags t\n      JOIN visit_tags vt ON t.id = vt.tag_id\n      JOIN visits v ON vt.visit_id = v.id\n      WHERE v.url_hash = ?\n    ")).bind([n]),i=[];r.step();)i.push(r.getAsObject().name);return r.free(),e.a(2,i)}},e,this)})),function(e){return V.apply(this,arguments)})},{key:"getMemories",value:(z=m(f().m(function e(){var t,n,r,i,a,o,s,u,c,l,h,p,m=arguments;return f().w(function(e){for(;;)switch(e.n){case 0:n="\n      SELECT v.*\n      FROM visits v\n      WHERE 1=1\n    ",r=[],(t=m.length>0&&void 0!==m[0]?m[0]:{}).minVisits&&(n+=" AND v.visit_count >= ?",r.push(t.minVisits)),t.minTimeSpent&&(n+=" AND v.total_time_spent >= ?",r.push(t.minTimeSpent)),t.dateFrom&&(n+=" AND v.last_visit >= ?",r.push(t.dateFrom)),t.tag&&(n+=" AND v.id IN (\n        SELECT vt.visit_id FROM visit_tags vt\n        JOIN tags t ON vt.tag_id = t.id\n        WHERE t.name = ?\n      )",r.push(t.tag)),n+=" ORDER BY v.last_visit DESC",(i=this.db.prepare(n)).bind(r),a=[];case 1:if(!i.step()){e.n=5;break}return o=i.getAsObject(),(s=this.db.prepare("SELECT COUNT(*) as count FROM highlights WHERE visit_id = ?")).bind([o.id]),s.step()&&s.getAsObject().count,s.free(),e.n=2,this.getTags(o.url);case 2:return u=e.v,e.n=3,this.getAIInsights(o.url);case 3:for(c=e.v,(l=this.db.prepare("\n        SELECT * FROM sessions \n        WHERE visit_id = ? \n        ORDER BY timestamp DESC \n        LIMIT 10\n      ")).bind([o.id]),h=[];l.step();)h.push(l.getAsObject());return l.free(),e.n=4,this.getHighlights(o.url);case 4:p=e.v,a.push({url:o.url,title:o.title,visits:o.visit_count,lastVisit:o.last_visit,firstVisit:o.first_visit,totalTimeSpent:o.total_time_spent,highlights:p,insights:c,tags:u,sessions:h}),e.n=1;break;case 5:return i.free(),e.a(2,a)}},e,this)})),function(){return z.apply(this,arguments)})},{key:"getStats",value:(W=m(f().m(function e(){var t,n,r;return f().w(function(e){for(;;)if(0===e.n)return t={totalVisits:0,totalTimeSpent:0,totalHighlights:0,totalSessions:0,thisWeekVisits:0,averageTimePerVisit:0},(n=this.db.prepare("SELECT COUNT(*) as count FROM visits")).step()&&(t.totalVisits=n.getAsObject().count),n.free(),(n=this.db.prepare("SELECT SUM(total_time_spent) as total FROM visits")).step()&&(t.totalTimeSpent=n.getAsObject().total||0),n.free(),(n=this.db.prepare("SELECT COUNT(*) as count FROM highlights")).step()&&(t.totalHighlights=n.getAsObject().count),n.free(),(n=this.db.prepare("SELECT SUM(visit_count) as total FROM visits")).step()&&(t.totalSessions=n.getAsObject().total||0),n.free(),r=Date.now()-6048e5,(n=this.db.prepare("SELECT COUNT(*) as count FROM visits WHERE last_visit >= ?")).bind([r]),n.step()&&(t.thisWeekVisits=n.getAsObject().count),n.free(),t.totalSessions>0&&(t.averageTimePerVisit=Math.floor(t.totalTimeSpent/t.totalSessions)),e.a(2,t)},e,this)})),function(){return W.apply(this,arguments)})},{key:"exportData",value:(B=m(f().m(function e(){var t;return f().w(function(e){for(;;)if(0===e.n)return t=this.db.export(),e.a(2,{database:Array.from(t),exportDate:Date.now(),version:"2.0"})},e,this)})),function(){return B.apply(this,arguments)})},{key:"importData",value:(X=m(f().m(function e(t){var n,r;return f().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,"2.0"!==t.version||!t.database){e.n=2;break}return n=new Uint8Array(t.database),this.db=new this.SQL.Database(n),e.n=1,this.saveDatabase();case 1:e.n=3;break;case 2:if(!t.visits){e.n=3;break}return e.n=3,this.migrateFromChromeStorage(t);case 3:e.n=5;break;case 4:throw e.p=4,r=e.v,console.error("Import error:",r),r;case 5:return e.a(2)}},e,this,[[0,4]])})),function(e){return X.apply(this,arguments)})},{key:"migrateFromChromeStorage",value:(Y=m(f().m(function e(t){var n,r,i,a,u,c,l,h,p,m,d,g,v,b,y,E,w,T,_,k,S,O,N,A,R,I,L,D;return f().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log("🔄 Migrating from chrome.storage..."),!t.visits){e.n=3;break}k=o(t.visits);case 1:if((S=k()).done){e.n=3;break}return n=S.value,r=t.visits[n],e.n=2,this.getOrCreateVisit(r.url,r.title);case 2:if(i=e.v,this.db.run("UPDATE visits \n           SET first_visit = ?, last_visit = ?, visit_count = ?, total_time_spent = ?\n           WHERE id = ?",[r.firstVisit,r.lastVisit,r.visits,r.totalTimeSpent,i.id]),r.sessions){a=s(r.sessions);try{for(a.s();!(u=a.n()).done;)c=u.value,this.db.run("INSERT INTO sessions (visit_id, timestamp, time_spent, scroll_depth, interactions, highlight_count)\n               VALUES (?, ?, ?, ?, ?, ?)",[i.id,c.timestamp,c.timeSpent||0,c.scrollDepth||0,c.interactions||0,c.highlightCount||0])}catch(e){a.e(e)}finally{a.f()}}e.n=1;break;case 3:if(!t.highlights){e.n=6;break}O=o(t.highlights);case 4:if((N=O()).done){e.n=6;break}return l=N.value,h=t.highlights[l],e.n=5,this.getOrCreateVisit(h.url,h.title);case 5:if(p=e.v,h.items){m=s(h.items);try{for(m.s();!(d=m.n()).done;)g=d.value,this.db.run("INSERT INTO highlights (visit_id, text, timestamp) VALUES (?, ?, ?)",[p.id,g.text,g.timestamp])}catch(e){m.e(e)}finally{m.f()}}e.n=4;break;case 6:if(!t.insights){e.n=9;break}A=o(t.insights);case 7:if((R=A()).done){e.n=9;break}return v=R.value,b=t.insights[v],e.n=8,this.saveAIInsights(b.url,b);case 8:e.n=7;break;case 9:if(!t.tags){e.n=18;break}I=o(t.tags);case 10:if((L=I()).done){e.n=18;break}if(y=L.value,!(E=t.tags[y]).tags){e.n=17;break}w=s(E.tags),e.p=11,w.s();case 12:if((T=w.n()).done){e.n=14;break}return _=T.value,e.n=13,this.addTag(E.url,_);case 13:e.n=12;break;case 14:e.n=16;break;case 15:e.p=15,D=e.v,w.e(D);case 16:return e.p=16,w.f(),e.f(16);case 17:e.n=10;break;case 18:return e.n=19,this.saveDatabase();case 19:console.log("✅ Migration complete");case 20:return e.a(2)}},e,this,[[11,15,16,17]])})),function(e){return Y.apply(this,arguments)})},{key:"cleanup",value:(H=m(f().m(function e(){var t;return f().w(function(e){for(;;)switch(e.n){case 0:return t=Date.now()-31536e6,this.db.run("DELETE FROM sessions WHERE timestamp < ?",[t]),this.db.run("\n      DELETE FROM tags \n      WHERE id NOT IN (SELECT DISTINCT tag_id FROM visit_tags)\n    "),e.n=1,this.saveDatabase();case 1:return e.a(2)}},e,this)})),function(){return H.apply(this,arguments)})},{key:"savePersonalitySnapshot",value:(q=m(f().m(function e(t){return f().w(function(e){for(;;)switch(e.n){case 0:return this.db.run("INSERT INTO personality_snapshots (\n        week_start, week_end, tone, top_topics, reading_habits, \n        emotional_themes, summary, total_time_spent, total_visits, \n        total_highlights, dominant_interests, quote_of_week\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",[t.weekStart,t.weekEnd,t.tone,JSON.stringify(t.topTopics),t.readingHabits,JSON.stringify(t.emotionalThemes),t.summary,t.totalTimeSpent,t.totalVisits,t.totalHighlights,JSON.stringify(t.dominantInterests),t.quoteOfWeek||""]),e.n=1,this.saveDatabase();case 1:return e.a(2)}},e,this)})),function(e){return q.apply(this,arguments)})},{key:"getPersonalitySnapshots",value:(G=m(f().m(function e(){var t,n,r,i,a=arguments;return f().w(function(e){for(;;)if(0===e.n){for(t=a.length>0&&void 0!==a[0]?a[0]:10,(n=this.db.prepare("\n      SELECT * FROM personality_snapshots \n      ORDER BY week_start DESC \n      LIMIT ?\n    ")).bind([t]),r=[];n.step();)i=n.getAsObject(),r.push({id:i.id,weekStart:i.week_start,weekEnd:i.week_end,tone:i.tone,topTopics:JSON.parse(i.top_topics||"[]"),readingHabits:i.reading_habits,emotionalThemes:JSON.parse(i.emotional_themes||"[]"),summary:i.summary,totalTimeSpent:i.total_time_spent,totalVisits:i.total_visits,totalHighlights:i.total_highlights,dominantInterests:JSON.parse(i.dominant_interests||"[]"),quoteOfWeek:i.quote_of_week,createdAt:i.created_at});return n.free(),e.a(2,r)}},e,this)})),function(){return G.apply(this,arguments)})},{key:"saveInterestEvolution",value:(U=m(f().m(function e(t){var n,r,i;return f().w(function(e){for(;;)switch(e.n){case 0:n=s(t);try{for(n.s();!(r=n.n()).done;)i=r.value,this.db.run("INSERT INTO interest_evolution (\n          topic, period, count, total_time, trend_score, status\n        ) VALUES (?, ?, ?, ?, ?, ?)",[i.topic,i.period,i.count,i.totalTime||0,i.trendScore||0,i.status||"steady"])}catch(e){n.e(e)}finally{n.f()}return e.n=1,this.saveDatabase();case 1:return e.a(2)}},e,this)})),function(e){return U.apply(this,arguments)})},{key:"getInterestEvolution",value:(x=m(f().m(function e(){var t,n,r;return f().w(function(e){for(;;)if(0===e.n){for(t=this.db.prepare("\n      SELECT * FROM interest_evolution \n      ORDER BY period DESC, count DESC\n    "),n=[];t.step();)r=t.getAsObject(),n.push({id:r.id,topic:r.topic,period:r.period,count:r.count,totalTime:r.total_time,trendScore:r.trend_score,status:r.status,createdAt:r.created_at});return t.free(),e.a(2,n)}},e,this)})),function(){return x.apply(this,arguments)})},{key:"saveMoodData",value:(F=m(f().m(function e(t){return f().w(function(e){for(;;)switch(e.n){case 0:return this.db.run("INSERT INTO mood_tracking (\n        timestamp, sentiment, sentiment_score, emotions, tone, url\n      ) VALUES (?, ?, ?, ?, ?, ?)",[t.timestamp,t.sentiment,t.sentimentScore||0,JSON.stringify(t.emotions||[]),t.tone||"",t.url||""]),e.n=1,this.saveDatabase();case 1:return e.a(2)}},e,this)})),function(e){return F.apply(this,arguments)})},{key:"getMoodHistory",value:(j=m(f().m(function e(){var t,n,r,i,a,o=arguments;return f().w(function(e){for(;;)if(0===e.n){for(t=o.length>0&&void 0!==o[0]?o[0]:30,n=Date.now()-24*t*60*60*1e3,(r=this.db.prepare("\n      SELECT * FROM mood_tracking \n      WHERE timestamp >= ?\n      ORDER BY timestamp DESC\n    ")).bind([n]),i=[];r.step();)a=r.getAsObject(),i.push({id:a.id,timestamp:a.timestamp,sentiment:a.sentiment,sentimentScore:a.sentiment_score,emotions:JSON.parse(a.emotions||"[]"),tone:a.tone,url:a.url,createdAt:a.created_at});return r.free(),e.a(2,i)}},e,this)})),function(){return j.apply(this,arguments)})},{key:"getWeeklyMoodSummary",value:(C=m(f().m(function e(){var t,n,r,i,o,s,u,c,l;return f().w(function(e){for(;;)if(0===e.n){for(t=Date.now()-6048e5,(n=this.db.prepare("\n      SELECT sentiment, COUNT(*) as count, AVG(sentiment_score) as avg_score\n      FROM mood_tracking \n      WHERE timestamp >= ?\n      GROUP BY sentiment\n    ")).bind([t]),r={positive:0,negative:0,neutral:0,averageScore:0,dominantMood:"neutral"},i=0,o=0;n.step();)s=n.getAsObject(),u=s.sentiment||"neutral",c=s.count||0,l=s.avg_score||0,r[u]=c,i+=c,o+=l*c;return n.free(),i>0&&(r.averageScore=o/i,r.dominantMood=Object.entries(r).filter(function(e){var t=a(e,1)[0];return["positive","negative","neutral"].includes(t)}).sort(function(e,t){return t[1]-e[1]})[0][0]),e.a(2,r)}},e,this)})),function(){return C.apply(this,arguments)})},{key:"getWeeklyData",value:(M=m(f().m(function e(){var t,n,r,a,o,s,u,c,l,h,p,m;return f().w(function(e){for(;;)if(0===e.n){for(t=Date.now()-6048e5,n=Date.now(),(r=this.db.prepare("\n      SELECT * FROM visits \n      WHERE last_visit >= ? AND last_visit < ?\n      ORDER BY last_visit DESC\n    ")).bind([t,n]),a=[];r.step();)a.push(r.getAsObject());for(r.free(),(o=this.db.prepare("\n      SELECT h.* FROM highlights h\n      JOIN visits v ON h.visit_id = v.id\n      WHERE h.timestamp >= ? AND h.timestamp < ?\n    ")).bind([t,n]),s=[];o.step();)s.push(o.getAsObject());for(o.free(),(u=this.db.prepare("\n      SELECT i.topics FROM insights i\n      JOIN visits v ON i.visit_id = v.id\n      WHERE v.last_visit >= ? AND v.last_visit < ?\n    ")).bind([t,n]),c=[];u.step();)(l=u.getAsObject()).topics&&(h=JSON.parse(l.topics),c.push.apply(c,i(h)));return u.free(),(p=this.db.prepare("\n      SELECT SUM(total_time_spent) as total FROM visits\n      WHERE last_visit >= ? AND last_visit < ?\n    ")).bind([t,n]),m=0,p.step()&&(m=p.getAsObject().total||0),p.free(),e.a(2,{weekStart:t,weekEnd:n,visits:a,highlights:s,topics:c,timeSpent:m})}},e,this)})),function(){return M.apply(this,arguments)})},{key:"saveSkillActivity",value:(P=m(f().m(function e(t){return f().w(function(e){for(;;)switch(e.n){case 0:return this.db.run("INSERT INTO skill_activities (\n        url, skill, confidence, keywords, time_spent, timestamp\n      ) VALUES (?, ?, ?, ?, ?, ?)",[t.url||"manual",t.skill,t.confidence||1,t.keywords||"",t.time_spent||0,t.timestamp||Date.now()]),e.n=1,this.saveDatabase();case 1:return e.a(2)}},e,this)})),function(e){return P.apply(this,arguments)})},{key:"getSkillStats",value:(D=m(f().m(function e(){var t,n,r;return f().w(function(e){for(;;)if(0===e.n){for(t=this.db.prepare("\n      SELECT \n        skill,\n        COUNT(*) as visit_count,\n        SUM(time_spent) as total_time,\n        AVG(confidence) as avg_confidence,\n        MIN(timestamp) as first_seen,\n        MAX(timestamp) as last_seen\n      FROM skill_activities\n      GROUP BY skill\n      ORDER BY total_time DESC, visit_count DESC\n    "),n=[];t.step();)r=t.getAsObject(),n.push({skill:r.skill,visit_count:r.visit_count,total_time:r.total_time||0,avg_confidence:r.avg_confidence||0,first_seen:r.first_seen,last_seen:r.last_seen});return t.free(),e.a(2,n)}},e,this)})),function(){return D.apply(this,arguments)})},{key:"getSkillByName",value:(L=m(f().m(function e(t){var n,r,i;return f().w(function(e){for(;;)if(0===e.n)return(n=this.db.prepare("\n      SELECT \n        skill,\n        COUNT(*) as visit_count,\n        SUM(time_spent) as total_time,\n        AVG(confidence) as avg_confidence,\n        MIN(timestamp) as first_seen,\n        MAX(timestamp) as last_seen\n      FROM skill_activities\n      WHERE skill = ?\n      GROUP BY skill\n    ")).bind([t]),r=null,n.step()&&(i=n.getAsObject(),r={skill:i.skill,visit_count:i.visit_count,total_time:i.total_time||0,avg_confidence:i.avg_confidence||0,first_seen:i.first_seen,last_seen:i.last_seen}),n.free(),e.a(2,r)},e,this)})),function(e){return L.apply(this,arguments)})},{key:"getSkillActivitiesSince",value:(I=m(f().m(function e(t){var n,r,i;return f().w(function(e){for(;;)if(0===e.n){for((n=this.db.prepare("\n      SELECT * FROM skill_activities\n      WHERE timestamp >= ?\n      ORDER BY timestamp DESC\n    ")).bind([t]),r=[];n.step();)i=n.getAsObject(),r.push({id:i.id,url:i.url,skill:i.skill,confidence:i.confidence,keywords:i.keywords,time_spent:i.time_spent,timestamp:i.timestamp,created_at:i.created_at});return n.free(),e.a(2,r)}},e,this)})),function(e){return I.apply(this,arguments)})},{key:"getAllSkills",value:(R=m(f().m(function e(){var t,n,r;return f().w(function(e){for(;;)if(0===e.n){for(t=this.db.prepare("\n      SELECT \n        skill,\n        COUNT(*) as visit_count,\n        SUM(time_spent) as total_time,\n        MAX(timestamp) as last_activity,\n        AVG(confidence) as avg_confidence\n      FROM skill_activities\n      GROUP BY skill\n      ORDER BY total_time DESC\n    "),n=[];t.step();)r=t.getAsObject(),n.push({name:r.skill,total_time:r.total_time||0,visit_count:r.visit_count||0,last_activity:r.last_activity,confidence:r.avg_confidence||0});return t.free(),e.a(2,n)}},e,this)})),function(){return R.apply(this,arguments)})},{key:"deleteSkillActivity",value:(A=m(f().m(function e(t){return f().w(function(e){for(;;)switch(e.n){case 0:return this.db.run("DELETE FROM skill_activities WHERE skill = ?",[t]),e.n=1,this.saveDatabase();case 1:return e.a(2)}},e,this)})),function(e){return A.apply(this,arguments)})},{key:"updateSkillTimeSpent",value:(N=m(f().m(function e(t,n,r){return f().w(function(e){for(;;)switch(e.n){case 0:return this.db.run("UPDATE skill_activities \n       SET time_spent = time_spent + ? \n       WHERE url = ? AND skill = ? AND timestamp = (\n         SELECT MAX(timestamp) FROM skill_activities WHERE url = ? AND skill = ?\n       )",[r,t,n,t,n]),e.n=1,this.saveDatabase();case 1:return e.a(2)}},e,this)})),function(e,t,n){return N.apply(this,arguments)})},{key:"executeSQL",value:(O=m(f().m(function e(t){var n,r,i,a,o=arguments;return f().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:[],this.db){e.n=1;break}return console.error("❌ Database not initialized"),e.a(2,[]);case 1:for(e.p=1,r=this.db.prepare(t),n.length>0&&r.bind(n),i=[];r.step();)i.push(r.getAsObject());return r.free(),e.a(2,i);case 2:return e.p=2,a=e.v,console.error("❌ SQL execution error:",a),e.a(2,[])}},e,this,[[1,2]])})),function(e){return O.apply(this,arguments)})},{key:"executeSQLUpdate",value:(S=m(f().m(function e(t){var n,r,i=arguments;return f().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:[],this.db){e.n=1;break}return console.error("❌ Database not initialized"),e.a(2);case 1:return e.p=1,this.db.run(t,n),e.n=2,this.saveDatabase();case 2:e.n=4;break;case 3:e.p=3,r=e.v,console.error("❌ SQL update error:",r);case 4:return e.a(2)}},e,this,[[1,3]])})),function(e){return S.apply(this,arguments)})},{key:"getFocusSessionsSince",value:(k=m(f().m(function e(t){var n,r,i;return f().w(function(e){for(;;)if(0===e.n){for((n=this.db.prepare("\n      SELECT * FROM focus_sessions \n      WHERE start_time >= ?\n      ORDER BY start_time DESC\n    ")).bind([t]),r=[];n.step();)i=n.getAsObject(),r.push({id:i.id,startTime:i.start_time,endTime:i.end_time,duration:i.duration,completed:1===i.completed,createdAt:i.created_at});return n.free(),e.a(2,r)}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"saveFocusSession",value:(_=m(f().m(function e(t){return f().w(function(e){for(;;)switch(e.n){case 0:return this.db.run("INSERT INTO focus_sessions (start_time, end_time, duration, completed)\n       VALUES (?, ?, ?, ?)",[t.startTime,t.endTime,t.duration,t.completed?1:0]),e.n=1,this.saveDatabase();case 1:return e.a(2)}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"updateFocusSession",value:(T=m(f().m(function e(t,n){return f().w(function(e){for(;;)switch(e.n){case 0:return this.db.run("UPDATE focus_sessions \n       SET completed = ?\n       WHERE id = ?",[n?1:0,t]),e.n=1,this.saveDatabase();case 1:return e.a(2)}},e,this)})),function(e,t){return T.apply(this,arguments)})},{key:"getTotalFocusTime",value:(w=m(f().m(function e(){var t,n,r,i,a=arguments;return f().w(function(e){for(;;)if(0===e.n)return t=a.length>0&&void 0!==a[0]?a[0]:30,n=Date.now()-24*t*60*60*1e3,(r=this.db.prepare("\n      SELECT SUM(duration) as total \n      FROM focus_sessions \n      WHERE start_time >= ? AND completed = 1\n    ")).bind([n]),i=0,r.step()&&(i=r.getAsObject().total||0),r.free(),e.a(2,i)},e,this)})),function(){return w.apply(this,arguments)})},{key:"getAchievements",value:(E=m(f().m(function e(){var t,n,r;return f().w(function(e){for(;;)if(0===e.n){for(t=this.db.prepare("\n      SELECT * FROM achievements \n      ORDER BY unlocked_at DESC\n    "),n=[];t.step();)r=t.getAsObject(),n.push({id:r.id,achievementId:r.achievement_id,name:r.name,icon:r.icon,points:r.points,unlockedAt:r.unlocked_at});return t.free(),e.a(2,n)}},e,this)})),function(){return E.apply(this,arguments)})},{key:"saveAchievement",value:(y=m(f().m(function e(t){var n;return f().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,this.db.run("INSERT OR IGNORE INTO achievements (achievement_id, name, icon, points, unlocked_at)\n         VALUES (?, ?, ?, ?, ?)",[t.achievementId,t.name,t.icon||"🏆",t.points||0,t.unlockedAt||Date.now()]),e.n=1,this.saveDatabase();case 1:e.n=3;break;case 2:e.p=2,n=e.v,console.error("Error saving achievement:",n);case 3:return e.a(2)}},e,this,[[0,2]])})),function(e){return y.apply(this,arguments)})},{key:"getStreak",value:(b=m(f().m(function e(){var t,n,r,i;return f().w(function(e){for(;;)switch(e.n){case 0:if(t=this.db.prepare("\n      SELECT * FROM streaks \n      ORDER BY id DESC \n      LIMIT 1\n    "),n=null,t.step()&&(r=t.getAsObject(),n={currentStreak:r.current_streak,longestStreak:r.longest_streak,lastActiveDate:r.last_active_date,updatedAt:r.updated_at}),t.free(),n){e.n=2;break}return i=Date.now(),this.db.run("INSERT INTO streaks (current_streak, longest_streak, last_active_date)\n         VALUES (0, 0, ?)",[i]),e.n=1,this.saveDatabase();case 1:return e.a(2,{currentStreak:0,longestStreak:0,lastActiveDate:i,updatedAt:i});case 2:return e.a(2,n)}},e,this)})),function(){return b.apply(this,arguments)})},{key:"updateStreak",value:(v=m(f().m(function e(t){return f().w(function(e){for(;;)switch(e.n){case 0:return this.db.run("UPDATE streaks \n       SET current_streak = ?, longest_streak = ?, last_active_date = ?\n       WHERE id = (SELECT id FROM streaks ORDER BY id DESC LIMIT 1)",[t.currentStreak,t.longestStreak,t.lastActiveDate]),e.n=1,this.saveDatabase();case 1:return e.a(2)}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"getDailyPrompt",value:(g=m(f().m(function e(){var t,n,r;return f().w(function(e){for(;;)if(0===e.n)return(new Date).toDateString(),(t=this.db.prepare("\n      SELECT * FROM reflection_prompts \n      WHERE date(timestamp / 1000, 'unixepoch') = date(?, 'unixepoch')\n      ORDER BY id DESC \n      LIMIT 1\n    ")).bind([Date.now()/1e3]),n=null,t.step()&&(r=t.getAsObject(),n={id:r.id,prompt:r.prompt,timestamp:r.timestamp,context:r.context}),t.free(),e.a(2,n)},e,this)})),function(){return g.apply(this,arguments)})},{key:"saveReflectionPrompt",value:(p=m(f().m(function e(t){var n,r;return f().w(function(e){for(;;)switch(e.n){case 0:return this.db.run("INSERT INTO reflection_prompts (prompt, timestamp, context)\n       VALUES (?, ?, ?)",[t.prompt,t.timestamp||Date.now(),t.context||""]),e.n=1,this.saveDatabase();case 1:return n=this.db.prepare("SELECT last_insert_rowid() as id"),r=null,n.step()&&(r=n.getAsObject().id),n.free(),e.a(2,r)}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"saveReflectionResponse",value:(h=m(f().m(function e(t){return f().w(function(e){for(;;)switch(e.n){case 0:return this.db.run("INSERT INTO reflection_responses (prompt_id, response, timestamp)\n       VALUES (?, ?, ?)",[t.promptId,t.response,t.timestamp||Date.now()]),e.n=1,this.saveDatabase();case 1:return e.a(2)}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"getReflectionResponses",value:(c=m(f().m(function e(t){var n,r,i;return f().w(function(e){for(;;)if(0===e.n){for((n=this.db.prepare("\n      SELECT * FROM reflection_responses \n      WHERE prompt_id = ?\n      ORDER BY timestamp DESC\n    ")).bind([t]),r=[];n.step();)i=n.getAsObject(),r.push({id:i.id,promptId:i.prompt_id,response:i.response,timestamp:i.timestamp});return n.free(),e.a(2,r)}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"close",value:(u=m(f().m(function e(){return f().w(function(e){for(;;)switch(e.n){case 0:if(!this.db){e.n=2;break}return e.n=1,this.saveDatabase();case 1:this.db.close(),this.db=null,this.isInitialized=!1;case 2:return e.a(2)}},e,this)})),function(){return u.apply(this,arguments)})}],n&&d(e.prototype,n),r&&d(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r,u,c,h,p,g,v,b,y,E,w,T,_,k,S,O,N,A,R,I,L,D,P,M,C,j,F,x,U,G,q,H,Y,X,B,W,z,V,K,Q,J,$,Z,ee,te,ne,re,ie,ae}();function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return E(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function w(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return T(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,u=e,h.n=n,o}};function p(n,r){for(s=n,u=r,t=0;!f&&c&&!i&&t<l.length;t++){var i,a=l[t],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(t=s<2?e:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(t){a=e,s=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(T(t={},r,function(){return this}),t),f=c.prototype=s.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,T(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,T(f,"constructor",c),T(c,"constructor",u),u.displayName="GeneratorFunction",T(c,i,"GeneratorFunction"),T(f),T(f,i,"Generator"),T(f,r,function(){return this}),T(f,"toString",function(){return"[object Generator]"}),(w=function(){return{w:a,m:h}})()}function T(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}T=function(e,t,n,r){function a(t,n){T(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},T(e,t,n,r)}function _(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function k(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){_(a,r,i,o,s,"next",e)}function s(e){_(a,r,i,o,s,"throw",e)}o(void 0)})}}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,O(r.key),r)}}function O(e){var t=function(e,t){if("object"!=b(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=b(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==b(t)?t:t+""}var N=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.apiKey=null,this.provider="openai",this.loadConfig()},t=[{key:"loadConfig",value:(p=k(w().m(function e(){var t=this;return w().w(function(e){for(;;)switch(e.n){case 0:chrome.storage.local.get(["ai_api_key","ai_provider"],function(e){t.apiKey=e.ai_api_key||null,t.provider=e.ai_provider||"openai"});case 1:return e.a(2)}},e)})),function(){return p.apply(this,arguments)})},{key:"generateSummary",value:(h=k(w().m(function e(t){var n;return w().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.apiKey){e.n=1;break}return console.warn("No AI API key configured"),e.a(2,this.generateFallbackSummary(t));case 1:if(e.p=1,"openai"!==this.provider){e.n=3;break}return e.n=2,this.openAISummary(t);case 2:case 4:return e.a(2,e.v);case 3:if("anthropic"!==this.provider){e.n=5;break}return e.n=4,this.anthropicSummary(t);case 5:e.n=7;break;case 6:return e.p=6,n=e.v,console.error("AI summary error:",n),e.a(2,this.generateFallbackSummary(t));case 7:return e.a(2)}},e,this,[[1,6]])})),function(e){return h.apply(this,arguments)})},{key:"openAISummary",value:(f=k(w().m(function e(t){var n,r;return w().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a concise summarizer. Create a 1-2 sentence summary of the following content that captures the main topic and purpose."},{role:"user",content:t.substring(0,3e3)}],max_tokens:100,temperature:.5})});case 1:return n=e.v,e.n=2,n.json();case 2:return r=e.v,e.a(2,r.choices[0].message.content.trim())}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"anthropicSummary",value:(l=k(w().m(function e(t){var n,r;return w().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-haiku-20240307",max_tokens:100,messages:[{role:"user",content:"Summarize this content in 1-2 sentences:\n\n".concat(t.substring(0,3e3))}]})});case 1:return n=e.v,e.n=2,n.json();case 2:return r=e.v,e.a(2,r.content[0].text.trim())}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"predictTags",value:(c=k(w().m(function e(t,n){var r;return w().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.apiKey){e.n=1;break}return e.a(2,this.generateFallbackTags(t,n));case 1:if(e.p=1,"openai"!==this.provider){e.n=3;break}return e.n=2,this.openAITags(t,n);case 2:case 4:return e.a(2,e.v);case 3:if("anthropic"!==this.provider){e.n=5;break}return e.n=4,this.anthropicTags(t,n);case 5:e.n=7;break;case 6:return e.p=6,r=e.v,console.error("AI tagging error:",r),e.a(2,this.generateFallbackTags(t,n));case 7:return e.a(2)}},e,this,[[1,6]])})),function(e,t){return c.apply(this,arguments)})},{key:"openAITags",value:(u=k(w().m(function e(t,n){var r,i,a;return w().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"Generate 3-5 relevant tags for this content. Return only the tags separated by commas, like: learning, ai, research"},{role:"user",content:"Title: ".concat(n,"\n\nContent: ").concat(t.substring(0,2e3))}],max_tokens:50,temperature:.7})});case 1:return r=e.v,e.n=2,r.json();case 2:return i=e.v,a=i.choices[0].message.content.trim().split(",").map(function(e){return e.trim()}),e.a(2,a.slice(0,5))}},e,this)})),function(e,t){return u.apply(this,arguments)})},{key:"anthropicTags",value:(s=k(w().m(function e(t,n){var r,i,a;return w().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-haiku-20240307",max_tokens:50,messages:[{role:"user",content:"Generate 3-5 relevant tags for this content. Return only tags separated by commas.\n\nTitle: ".concat(n,"\n\nContent: ").concat(t.substring(0,2e3))}]})});case 1:return r=e.v,e.n=2,r.json();case 2:return i=e.v,a=i.content[0].text.trim().split(",").map(function(e){return e.trim()}),e.a(2,a.slice(0,5))}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"extractTopics",value:(o=k(w().m(function e(t){var n;return w().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.apiKey){e.n=1;break}return e.a(2,this.generateFallbackTopics(t));case 1:if(e.p=1,"openai"!==this.provider){e.n=3;break}return e.n=2,this.openAITopics(t);case 2:case 4:return e.a(2,e.v);case 3:if("anthropic"!==this.provider){e.n=5;break}return e.n=4,this.anthropicTopics(t);case 5:e.n=7;break;case 6:return e.p=6,n=e.v,console.error("AI topic extraction error:",n),e.a(2,this.generateFallbackTopics(t));case 7:return e.a(2)}},e,this,[[1,6]])})),function(e){return o.apply(this,arguments)})},{key:"openAITopics",value:(a=k(w().m(function e(t){var n,r;return w().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"Extract 3-5 key topics or concepts from this content. Return only the topics separated by commas."},{role:"user",content:t.substring(0,2e3)}],max_tokens:60,temperature:.5})});case 1:return n=e.v,e.n=2,n.json();case 2:return r=e.v,e.a(2,r.choices[0].message.content.trim().split(",").map(function(e){return e.trim()}))}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"anthropicTopics",value:(i=k(w().m(function e(t){var n,r;return w().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-haiku-20240307",max_tokens:60,messages:[{role:"user",content:"Extract 3-5 key topics or concepts from this content. Return only topics separated by commas.\n\n".concat(t.substring(0,2e3))}]})});case 1:return n=e.v,e.n=2,n.json();case 2:return r=e.v,e.a(2,r.content[0].text.trim().split(",").map(function(e){return e.trim()}))}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"generateFallbackSummary",value:function(e){return e.split(/[.!?]+/).filter(function(e){return e.trim().length>20}).slice(0,2).join(". ").substring(0,200)+"..."}},{key:"generateFallbackTags",value:function(e,t){var n=(t+" "+e).toLowerCase(),r=["the","a","an","and","or","but","in","on","at","to","for","of","with","by","from","is","was","are","were","been","be","have","has","had","do","does","did","will","would","could","should","may","might","can","this","that","these","those"],i=n.split(/\W+/).filter(function(e){return e.length>3&&!r.includes(e)&&!/^\d+$/.test(e)}),a={};return i.forEach(function(e){return a[e]=(a[e]||0)+1}),Object.entries(a).sort(function(e,t){return t[1]-e[1]}).slice(0,5).map(function(e){return y(e,1)[0]})}},{key:"generateFallbackTopics",value:function(e){return this.generateFallbackTags(e,"")}},{key:"generatePersonalityReport",value:(r=k(w().m(function e(t){var n,r,i,a,o,s,u,c,l,f;return w().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.apiKey){e.n=1;break}return e.a(2,this.generateFallbackPersonalityReport(t));case 1:return e.p=1,n=t.visits,r=t.highlights,i=t.topics,a=t.timeSpent,o=Object.entries(i.reduce(function(e,t){return e[t]=(e[t]||0)+1,e},{})).sort(function(e,t){return t[1]-e[1]}).slice(0,5).map(function(e){return y(e,1)[0]}),s="Analyze this week's browsing data and create a personality snapshot:\n\nVisits: ".concat(n.length," pages\nTime Spent: ").concat(Math.floor(a/3600)," hours\nTop Topics: ").concat(o.join(", "),"\nHighlights Saved: ").concat(r.length,"\n\nGenerate a brief personality snapshot with:\n1. Overall tone (2-3 descriptive words)\n2. Top 3-5 topics\n3. Reading habits description\n4. Emotional themes (2-4 emotions)\n5. A 2-sentence summary\n6. 3 dominant interests\n\nFormat as JSON with keys: tone, topTopics, readingHabits, emotionalThemes, summary, dominantInterests"),e.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are an insightful personality analyst. Create concise, meaningful personality snapshots."},{role:"user",content:s}],max_tokens:300,temperature:.6})});case 2:return u=e.v,e.n=3,u.json();case 3:return c=e.v,l=c.choices[0].message.content.trim(),e.p=4,e.a(2,JSON.parse(l));case 5:return e.p=5,e.v,e.a(2,this.generateFallbackPersonalityReport(t));case 6:return e.p=6,f=e.v,console.error("Personality report error:",f),e.a(2,this.generateFallbackPersonalityReport(t));case 7:return e.a(2)}},e,this,[[4,5],[1,6]])})),function(e){return r.apply(this,arguments)})},{key:"generateFallbackPersonalityReport",value:function(e){var t=e.visits,n=e.topics,r=e.highlights,i=Object.entries(n.reduce(function(e,t){return e[t]=(e[t]||0)+1,e},{})).sort(function(e,t){return t[1]-e[1]}).slice(0,5).map(function(e){return y(e,1)[0]});return{tone:"curious, engaged, thoughtful",topTopics:i,readingHabits:"Explored ".concat(t.length," pages with ").concat(r.length," highlights"),emotionalThemes:["curiosity","interest","focus"],summary:"This week, your reading leaned toward ".concat(i.slice(0,3).join(", "),". Your tone: curious and engaged."),dominantInterests:i.slice(0,3)}}}],t&&S(e.prototype,t),n&&S(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,i,a,o,s,u,c,l,f,h,p}();function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function R(e){return function(e){if(Array.isArray(e))return D(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||L(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||L(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){if(e){if("string"==typeof e)return D(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function P(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return M(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,u=e,h.n=n,o}};function p(n,r){for(s=n,u=r,t=0;!f&&c&&!i&&t<l.length;t++){var i,a=l[t],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(t=s<2?e:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(t){a=e,s=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(M(t={},r,function(){return this}),t),f=c.prototype=s.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,M(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,M(f,"constructor",c),M(c,"constructor",u),u.displayName="GeneratorFunction",M(c,i,"GeneratorFunction"),M(f),M(f,i,"Generator"),M(f,r,function(){return this}),M(f,"toString",function(){return"[object Generator]"}),(P=function(){return{w:a,m:h}})()}function M(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}M=function(e,t,n,r){function a(t,n){M(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},M(e,t,n,r)}function C(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function j(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){C(a,r,i,o,s,"next",e)}function s(e){C(a,r,i,o,s,"throw",e)}o(void 0)})}}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,x(r.key),r)}}function x(e){var t=function(e,t){if("object"!=A(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=A(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==A(t)?t:t+""}var U=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ai=t},t=[{key:"generateWeeklySnapshot",value:(s=j(P().m(function e(t){var n,r,i,a,o;return P().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.visits,r=t.highlights,t.topics,i=t.timeSpent,e.p=1,this.ai.apiKey){e.n=2;break}return e.a(2,this.generateFallbackSnapshot(t));case 2:return e.n=3,this.ai.generatePersonalityReport(t);case 3:return a=e.v,e.a(2,{timestamp:Date.now(),weekStart:t.weekStart,weekEnd:t.weekEnd,tone:a.tone,topTopics:a.topTopics,readingHabits:a.readingHabits,emotionalThemes:a.emotionalThemes,summary:a.summary,totalTimeSpent:i,totalVisits:n.length,totalHighlights:r.length,dominantInterests:a.dominantInterests});case 4:return e.p=4,o=e.v,console.error("Snapshot generation error:",o),e.a(2,this.generateFallbackSnapshot(t))}},e,this,[[1,4]])})),function(e){return s.apply(this,arguments)})},{key:"analyzeTone",value:(o=j(P().m(function e(t){var n,r,i;return P().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.ai.apiKey){e.n=1;break}return e.a(2,this.generateFallbackTone(t));case 1:return e.p=1,e.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:'Analyze the tone of the reading content. Return 2-3 descriptive words like "analytical, reflective, optimistic" or "critical, curious, thoughtful".'},{role:"user",content:t.substring(0,2e3)}],max_tokens:20,temperature:.5})});case 2:return n=e.v,e.n=3,n.json();case 3:return r=e.v,e.a(2,r.choices[0].message.content.trim());case 4:return e.p=4,i=e.v,console.error("Tone analysis error:",i),e.a(2,this.generateFallbackTone(t))}},e,this,[[1,4]])})),function(e){return o.apply(this,arguments)})},{key:"detectEmotionalThemes",value:(a=j(P().m(function e(t){var n,r,i;return P().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.ai.apiKey){e.n=1;break}return e.a(2,this.generateFallbackEmotions(t));case 1:return e.p=1,e.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:'Identify the emotional themes in this content. Return 2-4 emotions like "curiosity, nostalgia, hope" or "anxiety, determination, wonder".'},{role:"user",content:t.substring(0,2e3)}],max_tokens:30,temperature:.6})});case 2:return n=e.v,e.n=3,n.json();case 3:return r=e.v,e.a(2,r.choices[0].message.content.trim().split(",").map(function(e){return e.trim()}));case 4:return e.p=4,i=e.v,console.error("Emotional theme detection error:",i),e.a(2,this.generateFallbackEmotions(t))}},e,this,[[1,4]])})),function(e){return a.apply(this,arguments)})},{key:"generateWeeklyQuote",value:(i=j(P().m(function e(t){var n,r,i;return P().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.ai.apiKey){e.n=1;break}return e.a(2,this.getFallbackQuote());case 1:return e.p=1,e.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"Generate an inspiring quote that matches the user's weekly vibe. Keep it under 100 characters, thoughtful and motivating."},{role:"user",content:"This week's vibe: ".concat(t.tone,". Topics: ").concat(t.topTopics.join(", "),". Emotional themes: ").concat(t.emotionalThemes.join(", "),".")}],max_tokens:60,temperature:.8})});case 2:return n=e.v,e.n=3,n.json();case 3:return r=e.v,e.a(2,r.choices[0].message.content.trim().replace(/^["']|["']$/g,""));case 4:return e.p=4,i=e.v,console.error("Quote generation error:",i),e.a(2,this.getFallbackQuote())}},e,this,[[1,4]])})),function(e){return i.apply(this,arguments)})},{key:"analyzeSentiment",value:(r=j(P().m(function e(t){var n,r,i,a;return P().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.ai.apiKey){e.n=1;break}return e.a(2,this.generateFallbackSentiment(t));case 1:return e.p=1,e.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:'Analyze the sentiment. Return ONLY one word: "positive", "negative", or "neutral".'},{role:"user",content:t.substring(0,1e3)}],max_tokens:5,temperature:.3})});case 2:return n=e.v,e.n=3,n.json();case 3:return r=e.v,i=r.choices[0].message.content.trim().toLowerCase(),e.a(2,{sentiment:i,score:"positive"===i?.7:"negative"===i?-.7:0});case 4:return e.p=4,a=e.v,console.error("Sentiment analysis error:",a),e.a(2,this.generateFallbackSentiment(t))}},e,this,[[1,4]])})),function(e){return r.apply(this,arguments)})},{key:"generateFallbackSnapshot",value:function(e){var t=e.visits,n=e.topics,r={};n.forEach(function(e){r[e]=(r[e]||0)+1});var i=Object.entries(r).sort(function(e,t){return t[1]-e[1]}).slice(0,5).map(function(e){return I(e,1)[0]});return{timestamp:Date.now(),weekStart:e.weekStart,weekEnd:e.weekEnd,tone:"curious, engaged",topTopics:i,readingHabits:"Regular browsing",emotionalThemes:["curiosity","interest"],summary:"This week, you explored ".concat(i.slice(0,3).join(", "),". Your tone: curious and engaged."),totalTimeSpent:e.timeSpent,totalVisits:t.length,totalHighlights:e.highlights.length,dominantInterests:i.slice(0,3)}}},{key:"generateFallbackTone",value:function(e){for(var t=e.toLowerCase(),n={},r=0,i=Object.entries({analytical:["data","analysis","study","research","evidence"],creative:["design","art","creative","innovation","imagine"],technical:["code","software","development","programming","system"],curious:["why","how","what","learn","understand"],optimistic:["success","growth","opportunity","future","potential"]});r<i.length;r++){var a=I(i[r],2),o=a[0],s=a[1];n[o]=s.filter(function(e){return t.includes(e)}).length}var u=Object.entries(n).sort(function(e,t){return t[1]-e[1]}).slice(0,2).map(function(e){return I(e,1)[0]});return u.length>0?u.join(", "):"curious, thoughtful"}},{key:"generateFallbackEmotions",value:function(e){return["curiosity","interest","focus"]}},{key:"generateFallbackSentiment",value:function(e){var t=["good","great","amazing","love","excellent","happy","success"],n=["bad","terrible","hate","problem","issue","difficult","fail"],r=e.toLowerCase().split(/\s+/),i=r.filter(function(e){return t.includes(e)}).length,a=r.filter(function(e){return n.includes(e)}).length;return i>a?{sentiment:"positive",score:.5}:a>i?{sentiment:"negative",score:-.5}:{sentiment:"neutral",score:0}}},{key:"getFallbackQuote",value:function(){var e=["Your curiosity is your compass.","Every search shapes who you're becoming.","Your digital journey reflects your growth.","Learning is a continuous adventure.","Your interests tell your story."];return e[Math.floor(Math.random()*e.length)]}},{key:"calculateInterestEvolution",value:function(e){var t={};return e.forEach(function(e){var n,r=new Date(e.timestamp).toISOString().slice(0,7);t[r]||(t[r]={topics:[],count:0}),e.topics&&((n=t[r].topics).push.apply(n,R(e.topics)),t[r].count++)}),Object.entries(t).map(function(e){var t=I(e,2),n=t[0],r=t[1],i={};return r.topics.forEach(function(e){i[e]=(i[e]||0)+1}),{period:n,topTopics:Object.entries(i).sort(function(e,t){return t[1]-e[1]}).slice(0,5).map(function(e){var t=I(e,2);return{topic:t[0],count:t[1]}}),totalVisits:r.count}})}},{key:"detectTrendingInterests",value:function(e,t){var n={};e.topics.forEach(function(e){n[e]=(n[e]||0)+1});var r={};t.forEach(function(e){var t;null===(t=e.topics)||void 0===t||t.forEach(function(e){r[e]=(r[e]||0)+1})});for(var i=[],a=0,o=Object.entries(n);a<o.length;a++){var s=I(o[a],2),u=s[0],c=s[1],l=(r[u]||0)/Math.max(t.length,1),f=c-l;f>0&&i.push({topic:u,currentCount:c,previousAvg:l,trendScore:f,status:f>2?"rising":"steady"})}return i.sort(function(e,t){return t.trendScore-e.trendScore}).slice(0,10)}}],t&&F(e.prototype,t),n&&F(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,i,a,o,s}();function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||Y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Y(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Y(e,t){if(e){if("string"==typeof e)return X(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(e,t):void 0}}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach(function(t){z(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function z(e,t,n){return(t=Z(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return K(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,u=e,h.n=n,o}};function p(n,r){for(s=n,u=r,t=0;!f&&c&&!i&&t<l.length;t++){var i,a=l[t],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(t=s<2?e:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(t){a=e,s=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(K(t={},r,function(){return this}),t),f=c.prototype=s.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,K(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,K(f,"constructor",c),K(c,"constructor",u),u.displayName="GeneratorFunction",K(c,i,"GeneratorFunction"),K(f),K(f,i,"Generator"),K(f,r,function(){return this}),K(f,"toString",function(){return"[object Generator]"}),(V=function(){return{w:a,m:h}})()}function K(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}K=function(e,t,n,r){function a(t,n){K(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},K(e,t,n,r)}function Q(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function J(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Q(a,r,i,o,s,"next",e)}function s(e){Q(a,r,i,o,s,"throw",e)}o(void 0)})}}function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Z(r.key),r)}}function Z(e){var t=function(e,t){if("object"!=G(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=G(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==G(t)?t:t+""}var ee=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ai=t,this.db=n,this.activeGoals=[],this.sessionTracking=new Map,this.loadGoals()},t=[{key:"loadGoals",value:(h=J(V().m(function e(){var t=this;return V().w(function(e){for(;;)switch(e.n){case 0:chrome.storage.local.get(["user_goals"],function(e){t.activeGoals=e.user_goals||[]});case 1:return e.a(2)}},e)})),function(){return h.apply(this,arguments)})},{key:"saveGoals",value:(f=J(V().m(function e(){return V().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,chrome.storage.local.set({user_goals:this.activeGoals});case 1:return e.a(2)}},e,this)})),function(){return f.apply(this,arguments)})},{key:"addGoal",value:(l=J(V().m(function e(t){var n;return V().w(function(e){for(;;)switch(e.n){case 0:return n={id:Date.now(),title:t.title,description:t.description,keywords:t.keywords||[],priority:t.priority||"medium",createdAt:Date.now(),targetHours:t.targetHours||0,actualHours:0,lastNudge:null,nudgeCount:0,isActive:!0},this.activeGoals.push(n),e.n=1,this.saveGoals();case 1:return e.a(2,n)}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"updateGoal",value:(c=J(V().m(function e(t){var n;return V().w(function(e){for(;;)switch(e.n){case 0:if(-1===(n=this.activeGoals.findIndex(function(e){return e.id===t.id}))){e.n=2;break}return this.activeGoals[n]=W(W({},this.activeGoals[n]),{},{title:t.title,description:t.description,keywords:t.keywords||[],priority:t.priority,targetHours:t.targetHours}),e.n=1,this.saveGoals();case 1:return e.a(2,!0);case 2:return e.a(2,!1)}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"updateGoalProgress",value:(u=J(V().m(function e(t,n){var r;return V().w(function(e){for(;;)switch(e.n){case 0:if(!(r=this.activeGoals.find(function(e){return e.id===t}))){e.n=1;break}return r.actualHours+=n/3600,e.n=1,this.saveGoals();case 1:return e.a(2)}},e,this)})),function(e,t){return u.apply(this,arguments)})},{key:"checkAlignment",value:(s=J(V().m(function e(t,n,r,i){var a,o,s,u,c,l,f;return V().w(function(e){for(;;)switch(e.p=e.n){case 0:if(0!==this.activeGoals.length){e.n=1;break}return e.a(2,null);case 1:a=(n+" "+r).toLowerCase(),o=[],s=H(this.activeGoals),e.p=2,s.s();case 3:if((u=s.n()).done){e.n=6;break}if((c=u.value).isActive){e.n=4;break}return e.a(3,5);case 4:if(!this.isContentAlignedWithGoal(a,c)){e.n=5;break}return o.push(c),e.n=5,this.updateGoalProgress(c.id,i);case 5:e.n=3;break;case 6:e.n=8;break;case 7:e.p=7,f=e.v,s.e(f);case 8:return e.p=8,s.f(),e.f(8);case 9:if(l="".concat(Date.now(),"_").concat(t),this.sessionTracking.set(l,{url:t,title:n,aligned:o.length>0,goals:o.map(function(e){return e.id}),timeSpent:i}),!(0===o.length&&i>300)){e.n=10;break}return e.a(2,this.generateNudge(n,i));case 10:return e.a(2,{aligned:!0,goals:o,message:o.length>0?"Great! This aligns with your goal: ".concat(o[0].title):null})}},e,this,[[2,7,8,9]])})),function(e,t,n,r){return s.apply(this,arguments)})},{key:"isContentAlignedWithGoal",value:function(e,t){return 0!==t.keywords.length&&t.keywords.filter(function(t){return e.includes(t.toLowerCase())}).length>0}},{key:"generateNudge",value:function(e,t){var n=this.activeGoals.filter(function(e){return e.isActive}).sort(function(e,t){var n={high:3,medium:2,low:1};return(n[t.priority]||0)-(n[e.priority]||0)}).slice(0,3);if(0===n.length)return null;var r=n[0],i=Math.floor(t/60);if(r.lastNudge&&Date.now()-r.lastNudge<36e5)return null;r.lastNudge=Date.now(),r.nudgeCount++,this.saveGoals();var a=[{title:"Mindful Moment 🧘",message:"You've spent ".concat(i,' minutes here. Still working on "').concat(r.title,'"?'),tone:"gentle"},{title:"Goal Check-In 🎯",message:'Remember your goal: "'.concat(r.title,'". Want to refocus?'),tone:"encouraging"},{title:"Progress Update 📊",message:'Goal: "'.concat(r.title,'" — ').concat(r.actualHours.toFixed(1),"h / ").concat(r.targetHours,"h. Keep it up!"),tone:"motivating"},{title:"Gentle Reminder 💡",message:"".concat(i,' minutes here. Just checking: is this aligned with "').concat(r.title,'"?'),tone:"curious"}];return W(W({},a[r.nudgeCount%a.length]),{},{goal:r,timeSpent:i,showNudge:!0})}},{key:"getGoalProgress",value:function(){return this.activeGoals.map(function(e){return{id:e.id,title:e.title,progress:e.targetHours>0?(e.actualHours/e.targetHours*100).toFixed(1):0,actualHours:e.actualHours.toFixed(1),targetHours:e.targetHours,isOnTrack:e.actualHours>=.7*e.targetHours,priority:e.priority,isActive:e.isActive}})}},{key:"toggleGoal",value:(o=J(V().m(function e(t){var n;return V().w(function(e){for(;;)switch(e.n){case 0:if(!(n=this.activeGoals.find(function(e){return e.id===t}))){e.n=1;break}return n.isActive=!n.isActive,e.n=1,this.saveGoals();case 1:return e.a(2)}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"deleteGoal",value:(a=J(V().m(function e(t){return V().w(function(e){for(;;)switch(e.n){case 0:return this.activeGoals=this.activeGoals.filter(function(e){return e.id!==t}),e.n=1,this.saveGoals();case 1:return e.a(2)}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"getWeeklyInsights",value:(i=J(V().m(function e(){var t,n,r,i,a,o,s,u,c;return V().w(function(e){for(;;)if(0===e.n){t=Date.now()-6048e5,n=0,r=0,i=H(this.sessionTracking.entries());try{for(i.s();!(a=i.n()).done;)o=q(a.value,2),s=o[0],u=o[1],parseInt(s.split("_")[0])>t&&(r+=u.timeSpent,u.aligned&&(n+=u.timeSpent))}catch(e){i.e(e)}finally{i.f()}return c=r>0?(n/r*100).toFixed(1):0,e.a(2,{alignmentRate:parseFloat(c),totalAlignedHours:(n/3600).toFixed(1),totalHours:(r/3600).toFixed(1),activeGoals:this.activeGoals.filter(function(e){return e.isActive}).length,mostProgressedGoal:this.getMostProgressedGoal()})}},e,this)})),function(){return i.apply(this,arguments)})},{key:"getMostProgressedGoal",value:function(){var e=Date.now()-6048e5;return this.activeGoals.filter(function(t){return t.isActive&&t.createdAt<e}).map(function(e){return{title:e.title,weeklyProgress:e.actualHours}}).sort(function(e,t){return t.weeklyProgress-e.weeklyProgress})[0]||null}},{key:"suggestGoals",value:(r=J(V().m(function e(t,n){var r,i,a,o=this;return V().w(function(e){for(;;)if(0===e.n)return r={},t.forEach(function(e){r[e]=(r[e]||0)+1}),i=Object.entries(r).sort(function(e,t){return t[1]-e[1]}).slice(0,5).map(function(e){return q(e,1)[0]}),a=i.filter(function(e){return!o.activeGoals.some(function(t){return t.keywords.some(function(t){return t.toLowerCase().includes(e.toLowerCase())})})}).map(function(e){return{title:"Learn more about ".concat(e),description:"You've been exploring ".concat(e," recently. Set a goal to dive deeper!"),keywords:[e],priority:"medium",suggestedTargetHours:10}}),e.a(2,a.slice(0,3))},e)})),function(e,t){return r.apply(this,arguments)})}],t&&$(e.prototype,t),n&&$(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,i,a,o,s,u,c,l,f,h}();function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function ne(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=ie(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function re(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||ie(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ie(e,t){if(e){if("string"==typeof e)return ae(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ae(e,t):void 0}}function ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function oe(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return se(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,u=e,h.n=n,o}};function p(n,r){for(s=n,u=r,t=0;!f&&c&&!i&&t<l.length;t++){var i,a=l[t],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(t=s<2?e:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(t){a=e,s=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(se(t={},r,function(){return this}),t),f=c.prototype=s.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,se(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,se(f,"constructor",c),se(c,"constructor",u),u.displayName="GeneratorFunction",se(c,i,"GeneratorFunction"),se(f),se(f,i,"Generator"),se(f,r,function(){return this}),se(f,"toString",function(){return"[object Generator]"}),(oe=function(){return{w:a,m:h}})()}function se(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}se=function(e,t,n,r){function a(t,n){se(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},se(e,t,n,r)}function ue(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ce(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){ue(a,r,i,o,s,"next",e)}function s(e){ue(a,r,i,o,s,"throw",e)}o(void 0)})}}function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,fe(r.key),r)}}function fe(e){var t=function(e,t){if("object"!=te(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=te(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==te(t)?t:t+""}var he=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ai=t,this.db=n,this.twinProfile=null,this.loadProfile()},t=[{key:"loadProfile",value:(l=ce(oe().m(function e(){var t=this;return oe().w(function(e){for(;;)switch(e.n){case 0:chrome.storage.local.get(["digital_twin_profile"],function(e){t.twinProfile=e.digital_twin_profile||t.createEmptyProfile()});case 1:return e.a(2)}},e)})),function(){return l.apply(this,arguments)})},{key:"saveProfile",value:(c=ce(oe().m(function e(){return oe().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,chrome.storage.local.set({digital_twin_profile:this.twinProfile});case 1:return e.a(2)}},e,this)})),function(){return c.apply(this,arguments)})},{key:"createEmptyProfile",value:function(){return{createdAt:Date.now(),lastUpdated:Date.now(),interestHistory:[],toneHistory:[],topicPreferences:{},emotionalPatterns:{},browsingPatterns:{peakHours:[],averageSessionDuration:0,favoriteCategories:[]},personalityTraits:[],thoughtPatterns:[],learningStyle:null,totalDataPoints:0}}},{key:"updateTwin",value:(u=ce(oe().m(function e(t){var n,r,i,a,o,s,u,c=this;return oe().w(function(e){for(;;)switch(e.n){case 0:return n=t.topics,r=t.tone,i=t.emotions,a=t.timestamp,o=t.timeSpent,s=t.category,this.twinProfile||(this.twinProfile=this.createEmptyProfile()),n&&n.forEach(function(e){c.twinProfile.topicPreferences[e]||(c.twinProfile.topicPreferences[e]={count:0,totalTime:0,firstSeen:a,lastSeen:a}),c.twinProfile.topicPreferences[e].count++,c.twinProfile.topicPreferences[e].totalTime+=o||0,c.twinProfile.topicPreferences[e].lastSeen=a}),r&&(this.twinProfile.toneHistory.push({tone:r,timestamp:a}),this.twinProfile.toneHistory.length>100&&(this.twinProfile.toneHistory=this.twinProfile.toneHistory.slice(-100))),i&&i.forEach(function(e){c.twinProfile.emotionalPatterns[e]||(c.twinProfile.emotionalPatterns[e]=0),c.twinProfile.emotionalPatterns[e]++}),u=new Date(a).getHours(),this.twinProfile.browsingPatterns.peakHours[u]||(this.twinProfile.browsingPatterns.peakHours[u]=0),this.twinProfile.browsingPatterns.peakHours[u]++,s&&(this.twinProfile.browsingPatterns.favoriteCategories.includes(s)||this.twinProfile.browsingPatterns.favoriteCategories.push(s)),this.twinProfile.totalDataPoints++,this.twinProfile.lastUpdated=a,e.n=1,this.saveProfile();case 1:return e.a(2)}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"askTwin",value:(s=ce(oe().m(function e(t){var n,r,i,a;return oe().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.ai.apiKey){e.n=1;break}return e.a(2,this.generateFallbackResponse(t));case 1:return e.p=1,n=this.buildTwinContext(),e.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You are the user's digital twin - a reflection of their browsing personality and interests. \n              \nYour role is to answer questions about the user's past interests, behaviors, and patterns based on the data below.\n\nUSER PROFILE:\n".concat(n,'\n\nRespond as if you ARE the user, using "I" and reflecting their personality. Be insightful, honest, and helpful.')},{role:"user",content:t}],max_tokens:200,temperature:.7})});case 2:return r=e.v,e.n=3,r.json();case 3:return i=e.v,e.a(2,{answer:i.choices[0].message.content.trim(),confidence:this.calculateConfidence(),timestamp:Date.now()});case 4:return e.p=4,a=e.v,console.error("Digital twin error:",a),e.a(2,this.generateFallbackResponse(t))}},e,this,[[1,4]])})),function(e){return s.apply(this,arguments)})},{key:"buildTwinContext",value:function(){var e=Object.entries(this.twinProfile.topicPreferences).sort(function(e,t){return t[1].count-e[1].count}).slice(0,10).map(function(e){var t=re(e,2),n=t[0],r=t[1];return"".concat(n," (").concat(r.count," times)")}),t=this.twinProfile.toneHistory.slice(-10).map(function(e){return e.tone}).join(", "),n=Object.entries(this.twinProfile.emotionalPatterns).sort(function(e,t){return t[1]-e[1]}).slice(0,5).map(function(e){var t=re(e,2),n=t[0],r=t[1];return"".concat(n," (").concat(r,")")}),r=this.twinProfile.browsingPatterns.peakHours.reduce(function(e,t,n){return t>(e.count||0)?{hour:n,count:t}:e},{});return"\nTop Interests: ".concat(e.join(", "),"\nRecent Tone: ").concat(t||"curious, thoughtful","\nEmotional Patterns: ").concat(n.join(", "),"\nMost Active Hour: ").concat(r.hour||"N/A",":00\nFavorite Categories: ").concat(this.twinProfile.browsingPatterns.favoriteCategories.join(", "),"\nTotal Data Points: ").concat(this.twinProfile.totalDataPoints,"\nProfile Age: ").concat(Math.floor((Date.now()-this.twinProfile.createdAt)/864e5)," days\n    ").trim()}},{key:"calculateConfidence",value:function(){return this.twinProfile.totalDataPoints<10?"low":this.twinProfile.totalDataPoints<50?"medium":this.twinProfile.totalDataPoints<200?"high":"very high"}},{key:"generateFallbackResponse",value:function(e){var t=e.toLowerCase();if(t.includes("topic")||t.includes("interest")){var n=Object.entries(this.twinProfile.topicPreferences).sort(function(e,t){return t[1].count-e[1].count}).slice(0,3).map(function(e){return re(e,1)[0]});return{answer:"Based on your browsing, you've been most interested in: ".concat(n.join(", ")),confidence:"medium",timestamp:Date.now()}}if(t.includes("avoid")||t.includes("less")){var r=Object.entries(this.twinProfile.topicPreferences).sort(function(e,t){return e[1].count-t[1].count}).slice(0,3).map(function(e){return re(e,1)[0]});return{answer:"You seem to have explored these less: ".concat(r.join(", ")),confidence:"medium",timestamp:Date.now()}}if(t.includes("year ago")||t.includes("last year")){var i=Object.entries(this.twinProfile.topicPreferences).filter(function(e){var t=re(e,2);return t[0],t[1].lastSeen<Date.now()-15552e6}).slice(0,3).map(function(e){return re(e,1)[0]});return{answer:i.length>0?"Looking back, you were interested in: ".concat(i.join(", ")):"I don't have enough historical data to answer that yet.",confidence:"low",timestamp:Date.now()}}return{answer:"I'm still learning about you. Keep browsing and I'll have better insights soon!",confidence:"low",timestamp:Date.now()}}},{key:"getTwinSummary",value:function(){var e=Object.entries(this.twinProfile.topicPreferences).sort(function(e,t){return t[1].count-e[1].count}).slice(0,5).map(function(e){var t=re(e,2),n=t[0],r=t[1];return{topic:n,count:r.count,totalTime:r.totalTime,recency:Date.now()-r.lastSeen}}),t=Object.entries(this.twinProfile.emotionalPatterns).sort(function(e,t){return t[1]-e[1]}).slice(0,3).map(function(e){return re(e,1)[0]}),n=this.twinProfile.browsingPatterns.peakHours.map(function(e,t){return{hour:t,count:e}}).filter(function(e){return e.count>0}).sort(function(e,t){return t.count-e.count}).slice(0,3);return{maturityLevel:this.calculateConfidence(),topInterests:e,dominantEmotions:t,peakBrowsingHours:n,totalDataPoints:this.twinProfile.totalDataPoints,profileAge:Math.floor((Date.now()-this.twinProfile.createdAt)/864e5),lastUpdated:this.twinProfile.lastUpdated}}},{key:"compareWithPast",value:(o=ce(oe().m(function e(){var t,n,r,i,a,o,s,u=arguments;return oe().w(function(e){for(;;)if(0===e.n)return t=u.length>0&&void 0!==u[0]?u[0]:30,n=Date.now()-24*t*60*60*1e3,r=Object.entries(this.twinProfile.topicPreferences).filter(function(e){var t=re(e,2),r=(t[0],t[1]);return r.lastSeen<n&&r.firstSeen<n}).sort(function(e,t){return t[1].count-e[1].count}).slice(0,5).map(function(e){return re(e,1)[0]}),i=Object.entries(this.twinProfile.topicPreferences).filter(function(e){var t=re(e,2);return t[0],t[1].lastSeen>=n}).sort(function(e,t){return t[1].count-e[1].count}).slice(0,5).map(function(e){return re(e,1)[0]}),a=i.filter(function(e){return!r.includes(e)}),o=r.filter(function(e){return!i.includes(e)}),s=i.filter(function(e){return r.includes(e)}),e.a(2,{past:r,current:i,new:a,faded:o,continuing:s,periodDays:t})},e,this)})),function(){return o.apply(this,arguments)})},{key:"predictFutureInterests",value:function(){return{likelyNextInterests:Object.entries(this.twinProfile.topicPreferences).filter(function(e){var t=re(e,2);return t[0],t[1].lastSeen>Date.now()-12096e5}).sort(function(e,t){return t[1].count-e[1].count}).slice(0,5).map(function(e){return re(e,1)[0]}),reasoning:"Based on your recent browsing patterns and interest evolution"}}},{key:"predictInterestMapping",value:(a=ce(oe().m(function e(){var t,n,r,i,a,o,s,u,c,l;return oe().w(function(e){for(;;)if(0===e.n){t=Object.entries(this.twinProfile.topicPreferences).sort(function(e,t){return t[1].lastSeen-e[1].lastSeen}).slice(0,10),n=[],r=ne(t);try{for(r.s();!(i=r.n()).done;)a=re(i.value,2),o=a[0],s=a[1],u=(Date.now()-s.firstSeen)/864e5,c=s.count/Math.max(u,1),l=c>.5&&Date.now()-s.lastSeen<12096e5,n.push({topic:o,currentLevel:this.calculateTopicLevel(s),growthRate:c,likelyContinuation:l?"high":"medium",recommendedAction:this.getRecommendedAction(s,c),relatedTopics:this.findRelatedTopics(o)})}catch(e){r.e(e)}finally{r.f()}return e.a(2,{predictions:n,suggestedNewTopics:this.suggestNewTopics(),timestamp:Date.now()})}},e,this)})),function(){return a.apply(this,arguments)})},{key:"calculateTopicLevel",value:function(e){var t=e.totalTime/36e5;return t<2?"beginner":t<10?"intermediate":t<50?"advanced":"expert"}},{key:"getRecommendedAction",value:function(e,t){return(Date.now()-e.lastSeen)/864e5>30?"This topic has faded. Consider revisiting or moving on.":t>1?"You're deeply engaged! Consider taking a course or building a project.":t>.3?"Steady exploration. Keep the momentum going!":"Light exploration. Dive deeper if interested."}},{key:"findRelatedTopics",value:function(e){for(var t=e.toLowerCase(),n=0,r=Object.entries({programming:["web development","software engineering","coding"],ai:["machine learning","data science","neural networks"],design:["ui/ux","creative","visual arts"],business:["startup","entrepreneurship","management"],marketing:["social media","content creation","seo"]});n<r.length;n++){var i=re(r[n],2),a=i[0],o=i[1];if(t.includes(a))return o}return[]}},{key:"suggestNewTopics",value:function(){var e=Object.keys(this.twinProfile.topicPreferences),t=[];return e.some(function(e){return e.includes("programming")})&&t.push({topic:"AI/ML",reason:"Natural extension of your programming interests",confidence:.8}),e.some(function(e){return e.includes("design")})&&t.push({topic:"Frontend Development",reason:"Combine design with code",confidence:.7}),t}},{key:"futureSelfSimulation",value:(i=ce(oe().m(function e(t){var n,r,i,a,o,s,u,c=arguments;return oe().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:6,this.ai.apiKey){e.n=1;break}return e.a(2,this.generateFutureSelfFallback(t,n));case 1:return e.p=1,r=this.buildTwinContext(),e.n=2,this.predictInterestMapping();case 2:return i=e.v,a="Based on this user profile and their interest trends, \n      simulate what they might think about this question ".concat(n," months from now:\n      \n      USER PROFILE: ").concat(r,"\n      \n      CURRENT TRENDS: ").concat(JSON.stringify(i.predictions.slice(0,3)),"\n      \n      QUESTION: ").concat(t,"\n      \n      Consider:\n      1. How their interests might evolve\n      2. What skills they might acquire\n      3. How their perspective might mature\n      4. What new connections they might make\n      \n      Respond as their future self would."),e.n=3,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You are simulating a user's future self based on their current interests and trends."},{role:"user",content:a}],max_tokens:250,temperature:.8})});case 3:return o=e.v,e.n=4,o.json();case 4:return s=e.v,e.a(2,{answer:s.choices[0].message.content.trim(),confidence:"medium",monthsAhead:n,timestamp:Date.now(),disclaimer:"This is a simulation based on your current patterns. Your actual future self may think differently!"});case 5:return e.p=5,u=e.v,console.error("Future self simulation error:",u),e.a(2,this.generateFutureSelfFallback(t,n))}},e,this,[[1,5]])})),function(e){return i.apply(this,arguments)})},{key:"generateFutureSelfFallback",value:function(e,t){var n=Object.entries(this.twinProfile.topicPreferences).sort(function(e,t){return t[1].totalTime-e[1].totalTime}).slice(0,3).map(function(e){return re(e,1)[0]});return{answer:"In ".concat(t," months, after spending more time with ").concat(n.join(", "),", I'll likely have a deeper perspective on this. My current exploration suggests I'm heading towards mastery in these areas."),confidence:"low",monthsAhead:t,timestamp:Date.now(),disclaimer:"This is a basic prediction. Enable AI features for more accurate future self simulation."}}},{key:"conversationalTwin",value:(r=ce(oe().m(function e(t){var n,r,i,a;return oe().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.ai.apiKey){e.n=1;break}return e.a(2,this.generateConversationalFallback(t));case 1:return e.p=1,n=this.buildTwinContext(),e.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.ai.apiKey)},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You are this user's digital twin. You know them based on:\n              \n".concat(n,"\n\nHave a natural conversation. Be helpful, insightful, and reflect their personality.\nOffer summaries, advice, creative prompts, or answer questions about their patterns.")},{role:"user",content:t}],max_tokens:300,temperature:.7})});case 2:return r=e.v,e.n=3,r.json();case 3:return i=e.v,e.n=4,this.db.saveTwinInteraction(t,i.choices[0].message.content.trim(),this.calculateConfidence());case 4:return e.a(2,{response:i.choices[0].message.content.trim(),confidence:this.calculateConfidence(),timestamp:Date.now()});case 5:return e.p=5,a=e.v,console.error("Conversational twin error:",a),e.a(2,this.generateConversationalFallback(t))}},e,this,[[1,5]])})),function(e){return r.apply(this,arguments)})},{key:"generateConversationalFallback",value:function(e){var t=e.toLowerCase();if(t.includes("summary")||t.includes("what have i")){var n=Object.entries(this.twinProfile.topicPreferences).sort(function(e,t){return t[1].count-e[1].count}).slice(0,5).map(function(e){return re(e,1)[0]});return{response:"Based on your browsing, you've been most engaged with: ".concat(n.join(", "),". You have ").concat(this.twinProfile.totalDataPoints," data points collected."),confidence:"medium",timestamp:Date.now()}}if(t.includes("advice")||t.includes("should"))return{response:"Based on your patterns, I suggest focusing on one topic deeply rather than spreading too thin. Your most consistent interest could become a valuable skill!",confidence:"low",timestamp:Date.now()};if(t.includes("creative")||t.includes("idea")){var r=Object.keys(this.twinProfile.topicPreferences).slice(0,2);return{response:"Creative prompt: What if you combined ".concat(r[0]," with ").concat(r[1],"? Sometimes the best innovations come from unexpected combinations!"),confidence:"medium",timestamp:Date.now()}}return{response:"I'm your digital twin, still learning about you! Keep browsing and I'll have better insights. You can ask me for summaries, advice, or creative prompts.",confidence:"low",timestamp:Date.now()}}}],t&&le(e.prototype,t),n&&le(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,i,a,o,s,u,c,l}();function pe(e){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(e)}function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach(function(t){ge(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ge(e,t,n){return(t=Oe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ve(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return be(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,u=e,h.n=n,o}};function p(n,r){for(s=n,u=r,t=0;!f&&c&&!i&&t<l.length;t++){var i,a=l[t],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(t=s<2?e:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(t){a=e,s=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(be(t={},r,function(){return this}),t),f=c.prototype=s.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,be(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,be(f,"constructor",c),be(c,"constructor",u),u.displayName="GeneratorFunction",be(c,i,"GeneratorFunction"),be(f),be(f,i,"Generator"),be(f,r,function(){return this}),be(f,"toString",function(){return"[object Generator]"}),(ve=function(){return{w:a,m:h}})()}function be(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}be=function(e,t,n,r){function a(t,n){be(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},be(e,t,n,r)}function ye(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=we(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||we(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function we(e,t){if(e){if("string"==typeof e)return Te(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Te(e,t):void 0}}function Te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _e(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ke(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){_e(a,r,i,o,s,"next",e)}function s(e){_e(a,r,i,o,s,"throw",e)}o(void 0)})}}function Se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Oe(r.key),r)}}function Oe(e){var t=function(e,t){if("object"!=pe(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=pe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==pe(t)?t:t+""}var Ne=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ai=t,this.db=n,this.skillDatabase=this.initializeSkillDatabase()},t=[{key:"initializeSkillDatabase",value:function(){return{programming:{keywords:["code","programming","developer","software","javascript","python","react","node","api","git","typescript","html","css","java","c++","rust"],courses:[{title:"freeCodeCamp",url:"https://www.freecodecamp.org",type:"free"},{title:"The Odin Project",url:"https://www.theodinproject.com",type:"free"},{title:"Codecademy",url:"https://www.codecademy.com",type:"freemium"},{title:"Frontend Masters",url:"https://frontendmasters.com",type:"paid"}],relatedSkills:["design","ai","data-science"]},design:{keywords:["design","ui","ux","figma","sketch","adobe","creative","typography","color","layout","prototype"],courses:[{title:"Refactoring UI",url:"https://refactoringui.com",type:"paid"},{title:"Daily UI Challenge",url:"https://www.dailyui.co",type:"free"},{title:"Design Course",url:"https://designcourse.com",type:"free"}],relatedSkills:["programming","marketing"]},ai:{keywords:["ai","machine learning","neural network","deep learning","nlp","chatgpt","llm","artificial intelligence","tensorflow","pytorch"],courses:[{title:"Fast.ai",url:"https://www.fast.ai",type:"free"},{title:"DeepLearning.AI",url:"https://www.deeplearning.ai",type:"free"},{title:"Coursera ML Specialization",url:"https://www.coursera.org/specializations/machine-learning-introduction",type:"freemium"}],relatedSkills:["programming","data-science","math"]},"data-science":{keywords:["data science","analytics","visualization","statistics","pandas","numpy","tableau","sql","data analysis"],courses:[{title:"Kaggle Learn",url:"https://www.kaggle.com/learn",type:"free"},{title:"DataCamp",url:"https://www.datacamp.com",type:"freemium"}],relatedSkills:["ai","programming","business"]},marketing:{keywords:["marketing","seo","social media","content","copywriting","branding","advertising","analytics"],courses:[{title:"HubSpot Academy",url:"https://academy.hubspot.com",type:"free"},{title:"Google Digital Garage",url:"https://learndigital.withgoogle.com",type:"free"}],relatedSkills:["design","business","writing"]},business:{keywords:["business","startup","entrepreneurship","management","strategy","finance","investment","saas"],courses:[{title:"Y Combinator Startup School",url:"https://www.startupschool.org",type:"free"},{title:"Indie Hackers",url:"https://www.indiehackers.com",type:"free"}],relatedSkills:["marketing","finance"]},writing:{keywords:["writing","blog","content","copywriting","journalism","author","editor","storytelling"],courses:[{title:"Purdue OWL",url:"https://owl.purdue.edu",type:"free"},{title:"Copyblogger",url:"https://copyblogger.com",type:"free"}],relatedSkills:["marketing","communication"]},productivity:{keywords:["productivity","time management","notion","obsidian","gtd","workflow","organization"],courses:[{title:"Getting Things Done",url:"https://gettingthingsdone.com",type:"paid"},{title:"Notion Template Gallery",url:"https://www.notion.so/templates",type:"free"}],relatedSkills:["personal-development"]},"personal-development":{keywords:["self improvement","mindfulness","meditation","habits","psychology","mental health","wellness"],courses:[{title:"Headspace",url:"https://www.headspace.com",type:"paid"},{title:"James Clear (Atomic Habits)",url:"https://jamesclear.com",type:"free"}],relatedSkills:["productivity","health"]}}}},{key:"detectSkills",value:(s=ke(ve().m(function e(t,n,r,i){var a,o,s,u,c,l,f,h,p,m,d,g;return ve().w(function(e){for(;;)switch(e.p=e.n){case 0:for(a=[],o="".concat(n," ").concat(t," ").concat(i.join(" ")).toLowerCase(),s=0,u=Object.entries(this.skillDatabase);s<u.length;s++)c=Ee(u[s],2),l=c[0],f=c[1],(h=f.keywords.filter(function(e){return o.includes(e.toLowerCase())})).length>0&&a.push({skill:l,confidence:Math.min(h.length/f.keywords.length,1),matchedKeywords:h,timestamp:Date.now()});if(!(a.length>0)){e.n=7;break}p=ye(a),e.p=1,p.s();case 2:if((m=p.n()).done){e.n=4;break}return d=m.value,e.n=3,this.db.saveSkillActivity({url:r,skill:d.skill,confidence:d.confidence,keywords:d.matchedKeywords.join(","),time_spent:0,timestamp:Date.now()});case 3:e.n=2;break;case 4:e.n=6;break;case 5:e.p=5,g=e.v,p.e(g);case 6:return e.p=6,p.f(),e.f(6);case 7:return e.a(2,a)}},e,this,[[1,5,6,7]])})),function(e,t,n,r){return s.apply(this,arguments)})},{key:"getSkillProgress",value:(o=ke(ve().m(function e(){var t,n,r,i=this;return ve().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.db.getSkillStats();case 1:return t=e.v,n=t.map(function(e){var t;return{skill:e.skill,totalXP:i.calculateXP(e),activityCount:e.visit_count||0,totalTime:e.total_time||0,lastActivity:e.last_seen,firstSeen:e.first_seen,level:i.calculateSkillLevel(e),trend:i.calculateTrend(e),relatedSkills:(null===(t=i.skillDatabase[e.skill])||void 0===t?void 0:t.relatedSkills)||[]}}),e.n=2,this.generateRecommendations(t);case 2:return r=e.v,e.a(2,{success:!0,skills:n,recommendations:r,totalSkillsExplored:t.length})}},e,this)})),function(){return o.apply(this,arguments)})},{key:"calculateXP",value:function(e){var t=e.visit_count,n=void 0===t?0:t,r=e.total_time,i=(void 0===r?0:r)/36e5;return Math.floor(5*n+10*i)}},{key:"calculateSkillLevel",value:function(e){e.visit_count;var t=e.total_time/36e5;return t<1?{level:"Curious",value:1}:t<5?{level:"Exploring",value:2}:t<20?{level:"Learning",value:3}:t<50?{level:"Practicing",value:4}:t<100?{level:"Skilled",value:5}:{level:"Expert",value:6}}},{key:"calculateTrend",value:function(e){var t=e.last_seen,n=(Date.now()-t)/864e5;return n<7?"📈 Growing":n<30?"➡️ Stable":"📉 Fading"}},{key:"generateRecommendations",value:(a=ke(ve().m(function e(t){var n,r,i,a,o,s,u,c,l;return ve().w(function(e){for(;;)switch(e.p=e.n){case 0:n=[],r=t.sort(function(e,t){return t.last_seen-e.last_seen}).slice(0,5),i=ye(r),e.p=1,i.s();case 2:if((a=i.n()).done){e.n=5;break}if(o=a.value,s=this.skillDatabase[o.skill]){e.n=3;break}return e.a(3,4);case 3:this.calculateSkillLevel(o),u=this.calculateXP(o),c=this.getLevelForXP(u),n.push({skill:o.skill,currentLevel:c.name,resources:s.courses.map(function(e){return{title:e.title,url:e.url,platform:e.type,type:e.type}}),suggestedNext:s.relatedSkills,reason:this.generateRecommendationReason(o,c)});case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,l=e.v,i.e(l);case 7:return e.p=7,i.f(),e.f(7);case 8:return e.a(2,n)}},e,this,[[1,6,7,8]])})),function(e){return a.apply(this,arguments)})},{key:"getLevelForXP",value:function(e){return e>=1e3?{level:5,name:"Expert",color:"#8b5cf6"}:e>=500?{level:4,name:"Advanced",color:"#6366f1"}:e>=200?{level:3,name:"Intermediate",color:"#3b82f6"}:e>=50?{level:2,name:"Learner",color:"#10b981"}:{level:1,name:"Beginner",color:"#6b7280"}}},{key:"generateRecommendationReason",value:function(e,t){var n=(Date.now()-e.last_seen)/864e5;return t.value<=2?"You're just getting started with ".concat(e.skill,". Here are some beginner-friendly resources."):n>30?"You haven't explored ".concat(e.skill," in ").concat(Math.floor(n)," days. Refresh your knowledge with these resources."):t.value>=4?"You're skilled in ".concat(e.skill,"! Consider these advanced resources or explore related topics."):"You're actively learning ".concat(e.skill,". Keep building your skills with these resources.")}},{key:"getWeeklySkillSummary",value:(i=ke(ve().m(function e(){var t,n,r,i;return ve().w(function(e){for(;;)switch(e.n){case 0:return t=Date.now()-6048e5,e.n=1,this.db.getSkillActivitiesSince(t);case 1:return n=e.v,r={},n.forEach(function(e){r[e.skill]||(r[e.skill]={count:0,time:0}),r[e.skill].count++,r[e.skill].time+=e.time_spent||0}),i=Object.entries(r).sort(function(e,t){return t[1].time-e[1].time})[0],e.a(2,{totalSkillsExplored:Object.keys(r).length,topSkill:i?{name:i[0],count:i[1].count,time:i[1].time}:null,allSkills:Object.entries(r).map(function(e){var t=Ee(e,2);return de({skill:t[0]},t[1])})})}},e,this)})),function(){return i.apply(this,arguments)})},{key:"generateLearningPath",value:(r=ke(ve().m(function e(t){var n,r,i;return ve().w(function(e){for(;;)switch(e.n){case 0:if(n=this.skillDatabase[t]){e.n=1;break}return e.a(2,{error:"Skill not found"});case 1:return e.n=2,this.db.getSkillByName(t);case 2:return r=e.v,i=r?this.calculateSkillLevel(r):{level:"Beginner",value:0},e.a(2,{skill:t,currentLevel:i.level,recommendedCourses:n.courses,relatedSkills:n.relatedSkills,milestones:[{hours:1,title:"First Steps",description:"Get familiar with basic concepts"},{hours:5,title:"Foundation",description:"Build core understanding"},{hours:20,title:"Competence",description:"Apply knowledge to real projects"},{hours:50,title:"Proficiency",description:"Master advanced techniques"},{hours:100,title:"Expertise",description:"Teach and create original work"}],currentProgress:r?{hours:(r.total_time/36e5).toFixed(1),visits:r.visit_count}:{hours:0,visits:0}})}},e,this)})),function(e){return r.apply(this,arguments)})}],t&&Se(e.prototype,t),n&&Se(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,i,a,o,s}();function Ae(e){return Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ae(e)}function Re(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(Ae(e)+" is not iterable")}function Ie(e){return function(e){if(Array.isArray(e))return Fe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||je(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(n),!0).forEach(function(t){Pe(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Pe(e,t,n){return(t=Ye(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Me(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=je(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||je(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function je(e,t){if(e){if("string"==typeof e)return Fe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Fe(e,t):void 0}}function Fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function xe(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return Ue(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,u=e,h.n=n,o}};function p(n,r){for(s=n,u=r,t=0;!f&&c&&!i&&t<l.length;t++){var i,a=l[t],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(t=s<2?e:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(t){a=e,s=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Ue(t={},r,function(){return this}),t),f=c.prototype=s.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Ue(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,Ue(f,"constructor",c),Ue(c,"constructor",u),u.displayName="GeneratorFunction",Ue(c,i,"GeneratorFunction"),Ue(f),Ue(f,i,"Generator"),Ue(f,r,function(){return this}),Ue(f,"toString",function(){return"[object Generator]"}),(xe=function(){return{w:a,m:h}})()}function Ue(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}Ue=function(e,t,n,r){function a(t,n){Ue(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Ue(e,t,n,r)}function Ge(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function qe(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Ge(a,r,i,o,s,"next",e)}function s(e){Ge(a,r,i,o,s,"throw",e)}o(void 0)})}}function He(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ye(r.key),r)}}function Ye(e){var t=function(e,t){if("object"!=Ae(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Ae(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ae(t)?t:t+""}var Xe=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ai=t,this.db=n,this.learningDomains=this.initializeLearningDomains(),this.engagementThresholds={minActiveTime:60,deepLearningTime:1200,scrollDepthMin:.3,revisitBonus:1.5}},t=[{key:"initializeDatabase",value:(l=qe(xe().m(function e(){return xe().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.db.executeSQL("\n      CREATE TABLE IF NOT EXISTS learning_sessions (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        url TEXT NOT NULL,\n        title TEXT,\n        domain TEXT,\n        category TEXT,\n        subcategory TEXT,\n        learning_type TEXT,\n        time_spent INTEGER DEFAULT 0,\n        active_time INTEGER DEFAULT 0,\n        scroll_depth REAL DEFAULT 0,\n        revisit_count INTEGER DEFAULT 1,\n        interaction_score REAL DEFAULT 0,\n        engagement_level TEXT,\n        timestamp INTEGER NOT NULL,\n        date TEXT NOT NULL,\n        session_id TEXT\n      );\n\n      CREATE TABLE IF NOT EXISTS learning_paths (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        path_name TEXT NOT NULL,\n        topics TEXT, -- JSON array\n        start_date INTEGER,\n        last_activity INTEGER,\n        total_time INTEGER DEFAULT 0,\n        completion_score REAL DEFAULT 0,\n        skill_level TEXT,\n        recommended_next TEXT -- JSON array\n      );\n\n      CREATE TABLE IF NOT EXISTS learning_insights (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        insight_type TEXT,\n        insight_data TEXT, -- JSON\n        generated_at INTEGER,\n        relevance_score REAL\n      );\n\n      CREATE TABLE IF NOT EXISTS learning_goals (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        goal_name TEXT NOT NULL,\n        target_skill TEXT,\n        target_hours INTEGER,\n        current_hours INTEGER DEFAULT 0,\n        deadline INTEGER,\n        status TEXT DEFAULT 'active',\n        created_at INTEGER\n      );\n\n      CREATE INDEX IF NOT EXISTS idx_learning_date ON learning_sessions(date);\n      CREATE INDEX IF NOT EXISTS idx_learning_category ON learning_sessions(category);\n      CREATE INDEX IF NOT EXISTS idx_learning_domain ON learning_sessions(domain);\n    ");case 1:return e.a(2)}},e,this)})),function(){return l.apply(this,arguments)})},{key:"initializeLearningDomains",value:function(){return{"Frontend Development":{platforms:["mdn","w3schools","css-tricks","frontendmasters","codecademy"],keywords:["html","css","javascript","react","vue","angular","frontend","dom","responsive"],subcategories:["HTML","CSS","JavaScript","React","Vue","Angular","TypeScript","Web Components"]},"Backend Development":{platforms:["nodejs.org","expressjs","django","flask","spring.io"],keywords:["node","express","django","flask","api","backend","server","database","rest","graphql"],subcategories:["Node.js","Python","Java","APIs","Databases","Authentication","Microservices"]},"Data Science":{platforms:["kaggle","datacamp","jupyter","tensorflow","pytorch"],keywords:["python","pandas","numpy","machine learning","data","analysis","statistics","ai","ml"],subcategories:["Python","Pandas","NumPy","Matplotlib","Scikit-learn","Statistics","Data Visualization"]},"Machine Learning & AI":{platforms:["tensorflow","pytorch","huggingface","openai","deeplearning.ai"],keywords:["machine learning","deep learning","neural network","ai","model","tensorflow","pytorch"],subcategories:["Neural Networks","NLP","Computer Vision","Deep Learning","MLOps","Transformers"]},"Mobile Development":{platforms:["developer.android","developer.apple","reactnative","flutter.dev"],keywords:["android","ios","mobile","react native","flutter","swift","kotlin"],subcategories:["Android","iOS","React Native","Flutter","Swift","Kotlin"]},"Cloud & DevOps":{platforms:["aws.amazon","cloud.google","azure.microsoft","docker","kubernetes"],keywords:["aws","azure","gcp","cloud","docker","kubernetes","devops","ci/cd","terraform"],subcategories:["AWS","Azure","GCP","Docker","Kubernetes","CI/CD","Infrastructure"]},"Database & SQL":{platforms:["postgresql","mongodb","redis","mysql","oracle"],keywords:["sql","database","query","mongodb","postgresql","mysql","nosql","orm"],subcategories:["SQL","NoSQL","PostgreSQL","MongoDB","Database Design","Query Optimization"]},Cybersecurity:{platforms:["owasp","kali","hackthebox","tryhackme"],keywords:["security","encryption","penetration","vulnerability","hacking","cyber","authentication"],subcategories:["Web Security","Network Security","Cryptography","Penetration Testing","OWASP"]},"Design & UX":{platforms:["figma","adobe","dribbble","behance","uxdesign"],keywords:["design","ui","ux","figma","photoshop","prototype","wireframe","user experience"],subcategories:["UI Design","UX Research","Prototyping","Design Systems","Accessibility"]},"Programming Fundamentals":{platforms:["leetcode","hackerrank","codewars","exercism","geeksforgeeks"],keywords:["algorithm","data structure","coding","programming","leetcode","problem solving"],subcategories:["Algorithms","Data Structures","Problem Solving","Competitive Programming"]}}}},{key:"isLearningResource",value:function(e,t){if(!e)return!1;var n=e.toLowerCase(),r=(t||"").toLowerCase(),i=["youtube.com/watch","udemy.com","coursera.org","edx.org","linkedin.com/learning","pluralsight.com","codecademy.com","freecodecamp.org","khanacademy.org","w3schools.com","mdn","stackoverflow.com","geeksforgeeks.org","tutorialspoint.com","medium.com","dev.to","hashnode.com","css-tricks.com","smashingmagazine.com","github.com","gitlab.com","docs.","documentation","tutorial","learn","course"].some(function(e){return n.includes(e)}),a=["tutorial","guide","learn","course","documentation","docs","how to","introduction to"].some(function(e){return r.includes(e)});return i||a}},{key:"categorizeLearning",value:(c=qe(xe().m(function e(t,n){var r,i,a,o,s,u,c,l,f,h,p,m,d,g,v,b,y,E,w,T=arguments;return xe().w(function(e){for(;;)if(0===e.n){for(r=T.length>2&&void 0!==T[2]?T[2]:"",i=t.toLowerCase(),a=(n||"").toLowerCase(),o=r.toLowerCase(),s="".concat(a," ").concat(o).substring(0,1e3),u="General Learning",c=null,l=0,f=0,h=Object.entries(this.learningDomains);f<h.length;f++){p=Ce(h[f],2),m=p[0],d=p[1],g=0,d.platforms.some(function(e){return i.includes(e)})&&(g+=3),v=d.keywords.filter(function(e){return s.includes(e.toLowerCase())}),g+=2*v.length,b=Me(d.subcategories);try{for(b.s();!(y=b.n()).done;)E=y.value,s.includes(E.toLowerCase())&&(g+=2,(!c||g>l)&&(c=E))}catch(e){b.e(e)}finally{b.f()}g>l&&(l=g,u=m)}return w="Reading",i.includes("youtube")||i.includes("video")?w="Video":i.includes("exercise")||i.includes("practice")||i.includes("coding")?w="Practice":i.includes("course")||i.includes("tutorial")?w="Course":(i.includes("docs")||i.includes("documentation"))&&(w="Documentation"),e.a(2,{category:u,subcategory:c,learningType:w,confidence:Math.min(l/10,1)})}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"calculateEngagementScore",value:function(e,t,n,r){var i=0;return e>=this.engagementThresholds.deepLearningTime?i+=40:e>=this.engagementThresholds.minActiveTime&&(i+=e/this.engagementThresholds.deepLearningTime*40),i+=Math.min(20*t,20),n>1&&(i+=Math.min(5*(n-1),20)),i+={Practice:20,Video:15,Course:18,Documentation:12,Reading:10}[r]||10,Math.min(i,100)}},{key:"getEngagementLevel",value:function(e){return e>=80?"Deep Learning":e>=60?"Active Study":e>=40?"Moderate Engagement":e>=20?"Light Reading":"Browsing"}},{key:"saveLearningSession",value:(u=qe(xe().m(function e(t){var n,r,i,a,o,s,u,c,l,f,h,p,m,d,g,v;return xe().w(function(e){for(;;)switch(e.n){case 0:if(n=t.url,r=t.title,i=t.timeSpent,a=t.activeTime,o=t.scrollDepth,s=void 0===o?0:o,u=t.revisitCount,c=void 0===u?1:u,l=t.sessionId,this.isLearningResource(n,r)){e.n=1;break}return e.a(2,null);case 1:return e.n=2,this.categorizeLearning(n,r);case 2:return f=e.v,h=this.calculateEngagementScore(a||i,s,c,f.learningType),p=this.getEngagementLevel(h),m=new URL(n).hostname,d=Date.now(),g=new Date(d).toISOString().split("T")[0],v=[n,r,m,f.category,f.subcategory,f.learningType,i,a||i,s,c,h,p,d,g,l||"session_".concat(d)],e.n=3,this.db.executeSQL("\n      INSERT INTO learning_sessions (\n        url, title, domain, category, subcategory, learning_type,\n        time_spent, active_time, scroll_depth, revisit_count,\n        interaction_score, engagement_level, timestamp, date, session_id\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    ",v);case 3:return e.n=4,this.updateLearningPath(f.category,f.subcategory);case 4:return e.n=5,this.generateInsights();case 5:return e.a(2,{category:f.category,subcategory:f.subcategory,interactionScore:h,engagementLevel:p})}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"updateLearningPath",value:(s=qe(xe().m(function e(t,n){var r,i,a,o,s,u,c,l;return xe().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}return e.a(2);case 1:return r=Date.now(),e.n=2,this.db.executeSQL("SELECT * FROM learning_paths WHERE path_name = ?",[t]);case 2:if(!((i=e.v)&&i.length>0)){e.n=5;break}return o=i[0],s=JSON.parse(o.topics||"[]"),n&&!s.includes(n)&&s.push(n),e.n=3,this.db.executeSQL("SELECT SUM(active_time) as total FROM learning_sessions WHERE category = ?",[t]);case 3:return u=e.v,c=(null===(a=u[0])||void 0===a?void 0:a.total)||0,e.n=4,this.db.executeSQL("UPDATE learning_paths \n         SET topics = ?, last_activity = ?, total_time = ?\n         WHERE path_name = ?",[JSON.stringify(s),r,c,t]);case 4:e.n=6;break;case 5:return l=n?[n]:[],e.n=6,this.db.executeSQL("INSERT INTO learning_paths (path_name, topics, start_date, last_activity, total_time)\n         VALUES (?, ?, ?, ?, 0)",[t,JSON.stringify(l),r,r]);case 6:return e.a(2)}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"getLearningAnalytics",value:(o=qe(xe().m(function e(){var t,n,r,i,a,o,s,u,c,l,f,h,p,m=arguments;return xe().w(function(e){for(;;)switch(e.n){case 0:t=m.length>0&&void 0!==m[0]?m[0]:"week",n=Date.now(),p=t,e.n="today"===p?1:"week"===p?2:"month"===p?3:"all"===p?4:5;break;case 1:return r=(new Date).setHours(0,0,0,0),e.a(3,6);case 2:return r=n-6048e5,e.a(3,6);case 3:return r=n-2592e6,e.a(3,6);case 4:return r=0,e.a(3,6);case 5:r=n-6048e5;case 6:return e.n=7,this.db.executeSQL("SELECT * FROM learning_sessions \n       WHERE timestamp >= ? \n       ORDER BY timestamp DESC",[r]);case 7:return i=e.v,a=i.length,o=i.reduce(function(e,t){return e+(t.active_time||0)},0),s=i.length>0?i.reduce(function(e,t){return e+t.interaction_score},0)/i.length:0,u={},i.forEach(function(e){var t=e.category;u[t]||(u[t]={count:0,totalTime:0,avgScore:0,sessions:[]}),u[t].count++,u[t].totalTime+=e.active_time||0,u[t].sessions.push(e)}),Object.keys(u).forEach(function(e){var t=u[e];t.avgScore=t.sessions.reduce(function(e,t){return e+t.interaction_score},0)/t.count}),c=Object.entries(u).sort(function(e,t){return t[1].totalTime-e[1].totalTime}).slice(0,5).map(function(e){var t=Ce(e,2),n=t[0],r=t[1];return{name:n,time:r.totalTime,sessions:r.count,avgScore:r.avgScore}}),e.n=8,this.db.executeSQL("SELECT * FROM learning_paths ORDER BY last_activity DESC LIMIT 10");case 8:return l=e.v,f={},i.forEach(function(e){var t=e.date;f[t]||(f[t]={time:0,sessions:0,categories:new Set}),f[t].time+=e.active_time||0,f[t].sessions++,f[t].categories.add(e.category)}),h=Object.entries(f).sort(function(e,t){return t[0].localeCompare(e[0])}).slice(0,30).map(function(e){var t=Ce(e,2),n=t[0],r=t[1];return{date:n,time:r.time,sessions:r.sessions,categories:r.categories.size}}),e.a(2,{summary:{totalSessions:a,totalTime:o,avgEngagement:Math.round(s),timeRange:t},topCategories:c,learningPaths:l.map(function(e){return De(De({},e),{},{topics:JSON.parse(e.topics||"[]"),recommendedNext:JSON.parse(e.recommended_next||"[]")})}),dailyBreakdown:h,recentSessions:i.slice(0,20)})}},e,this)})),function(){return o.apply(this,arguments)})},{key:"generateInsights",value:(a=qe(xe().m(function e(){var t,n,r,i,a,o,s,u,c,l,f,h,p;return xe().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.getLearningAnalytics("month");case 1:return t=e.v,n=[],t.dailyBreakdown.length>7&&(r=t.dailyBreakdown.slice(0,7),(i=r.reduce(function(e,t){return e+t.time},0)/7)>1800&&n.push({type:"consistency",title:"Great Learning Consistency! 🔥",description:"You've averaged ".concat(Math.round(i/60)," minutes of learning per day this week."),relevance:.9})),t.topCategories.length>0&&(a=t.topCategories[0],(o=a.time/t.summary.totalTime*100)>60&&n.push({type:"focus",title:"Deep Focus on ".concat(a.name),description:"".concat(Math.round(o),"% of your learning time is in ").concat(a.name,". Consider exploring related topics!"),relevance:.85})),e.n=2,this.db.executeSQL("SELECT * FROM learning_sessions WHERE timestamp >= ?",[Date.now()-2592e6]);case 2:s=e.v,u=new Array(24).fill(0),s.forEach(function(e){var t=new Date(e.timestamp).getHours();u[t]+=e.active_time||0}),c=u.indexOf(Math.max.apply(Math,Ie(u))),u[c]>0&&(l=c<12?"morning":c<17?"afternoon":"evening",n.push({type:"timing",title:"You're a ".concat(l," learner"),description:"Your peak learning time is around ".concat(c,":00. Most productive sessions happen in the ").concat(l,"."),relevance:.75})),f=0,h=n;case 3:if(!(f<h.length)){e.n=5;break}return p=h[f],e.n=4,this.db.executeSQL("INSERT INTO learning_insights (insight_type, insight_data, generated_at, relevance_score)\n         VALUES (?, ?, ?, ?)",[p.type,JSON.stringify(p),Date.now(),p.relevance]);case 4:f++,e.n=3;break;case 5:return e.a(2,n)}},e,this)})),function(){return a.apply(this,arguments)})},{key:"getRecommendations",value:(i=qe(xe().m(function e(){var t,n,r,i,a,o,s=this;return xe().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,this.getLearningAnalytics("month");case 1:t=e.v,n=[],r=Me(t.learningPaths.slice(0,3)),e.p=2,a=xe().m(function e(){var t,r,a,o;return xe().w(function(e){for(;;)switch(e.n){case 0:t=i.value,r=t.topics||[],(a=s.learningDomains[t.path_name])&&r.length>0&&(o=a.subcategories.filter(function(e){return!r.includes(e)})).length>0&&n.push({type:"next_topic",category:t.path_name,title:"Continue your ".concat(t.path_name," journey"),suggestions:o.slice(0,3),reason:"You've covered: ".concat(r.join(", "))});case 1:return e.a(2)}},e)}),r.s();case 3:if((i=r.n()).done){e.n=5;break}return e.d(Re(a()),4);case 4:e.n=3;break;case 5:e.n=7;break;case 6:e.p=6,o=e.v,r.e(o);case 7:return e.p=7,r.f(),e.f(7);case 8:return e.n=9,this.db.executeSQL("SELECT category, subcategory, AVG(interaction_score) as avg_score\n       FROM learning_sessions\n       WHERE timestamp >= ?\n       GROUP BY category\n       HAVING avg_score > 70\n       ORDER BY avg_score DESC\n       LIMIT 3",[Date.now()-2592e6]);case 9:return e.v.forEach(function(e){n.push({type:"strength",category:e.category,title:"You excel at ".concat(e.category),score:Math.round(e.avg_score),reason:"Your engagement score is ".concat(Math.round(e.avg_score),"/100")})}),e.a(2,n)}},e,this,[[2,6,7,8]])})),function(){return i.apply(this,arguments)})},{key:"getLearningStreak",value:(r=qe(xe().m(function e(){var t,n,r,i,a,o,s,u,c,l;return xe().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,this.db.executeSQL("SELECT DISTINCT date FROM learning_sessions \n       ORDER BY date DESC");case 1:if(0!==(t=e.v).length){e.n=2;break}return e.a(2,0);case 2:n=0,r=(new Date).toISOString().split("T")[0],i=new Date(r),a=Me(t),e.p=3,a.s();case 4:if((o=a.n()).done){e.n=7;break}if(s=o.value,u=s.date,c=i.toISOString().split("T")[0],u!==c){e.n=5;break}n++,i.setDate(i.getDate()-1),e.n=6;break;case 5:return e.a(3,7);case 6:e.n=4;break;case 7:e.n=9;break;case 8:e.p=8,l=e.v,a.e(l);case 9:return e.p=9,a.f(),e.f(9);case 10:return e.a(2,n)}},e,this,[[3,8,9,10]])})),function(){return r.apply(this,arguments)})}],t&&He(e.prototype,t),n&&He(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,i,a,o,s,u,c,l}(),Be=n(488),We=n.n(Be);function ze(e){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ze(e)}function Ve(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||$e(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ke(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return Qe(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,u=e,h.n=n,o}};function p(n,r){for(s=n,u=r,t=0;!f&&c&&!i&&t<l.length;t++){var i,a=l[t],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(t=s<2?e:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(t){a=e,s=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Qe(t={},r,function(){return this}),t),f=c.prototype=s.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Qe(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,Qe(f,"constructor",c),Qe(c,"constructor",u),u.displayName="GeneratorFunction",Qe(c,i,"GeneratorFunction"),Qe(f),Qe(f,i,"Generator"),Qe(f,r,function(){return this}),Qe(f,"toString",function(){return"[object Generator]"}),(Ke=function(){return{w:a,m:h}})()}function Qe(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}Qe=function(e,t,n,r){function a(t,n){Qe(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Qe(e,t,n,r)}function Je(e){return function(e){if(Array.isArray(e))return Ze(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||$e(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $e(e,t){if(e){if("string"==typeof e)return Ze(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ze(e,t):void 0}}function Ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function et(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function tt(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){et(a,r,i,o,s,"next",e)}function s(e){et(a,r,i,o,s,"throw",e)}o(void 0)})}}function nt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,rt(r.key),r)}}function rt(e){var t=function(e,t){if("object"!=ze(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ze(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ze(t)?t:t+""}var it=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ai=t,this.db=n,this.focusModeActive=!1,this.reflectionPrompts=this.initializePrompts()},t=[{key:"initializePrompts",value:function(){return["What was the most interesting thing you learned today?","How did your browsing make you feel today?","What topic would you like to explore deeper tomorrow?","Did you discover anything unexpected today?","What connections did you notice between different topics?","How does today's learning align with your goals?","What surprised you most about your interests today?","If you could share one thing from today's browsing, what would it be?","How has your curiosity evolved this week?","What patterns do you notice in your learning journey?"]}},{key:"getMoodTimeline",value:(f=tt(Ke().m(function e(){var t,n,r,i,a,o=this,s=arguments;return Ke().w(function(e){for(;;)switch(e.n){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:30,n=Date.now()-24*t*60*60*1e3,e.n=1,this.db.getMoodDataSince(n);case 1:return r=e.v,i={},r.forEach(function(e){var t,n=new Date(e.timestamp).toDateString();i[n]||(i[n]={date:n,timestamp:new Date(n).getTime(),sentiments:[],emotions:[],tones:[]}),i[n].sentiments.push(e.sentiment_score||0),e.emotions&&(t=i[n].emotions).push.apply(t,Je(e.emotions.split(","))),e.tone&&i[n].tones.push(e.tone)}),a=Object.values(i).map(function(e){var t=e.sentiments.reduce(function(e,t){return e+t},0)/e.sentiments.length,n=o.getMostFrequent(e.emotions),r=o.getMostFrequent(e.tones);return{date:e.date,timestamp:e.timestamp,sentiment:o.getSentimentLabel(t),sentimentScore:t,emotion:n,tone:r,color:o.getSentimentColor(t),emoji:o.getSentimentEmoji(t)}}),e.a(2,{timeline:a.sort(function(e,t){return e.timestamp-t.timestamp}),summary:this.analyzeMoodSummary(a)})}},e,this)})),function(){return f.apply(this,arguments)})},{key:"getMostFrequent",value:function(e){if(0===e.length)return null;var t={};return e.forEach(function(e){return t[e]=(t[e]||0)+1}),Object.entries(t).sort(function(e,t){return t[1]-e[1]})[0][0]}},{key:"getSentimentLabel",value:function(e){return e>.3?"positive":e<-.3?"negative":"neutral"}},{key:"getSentimentColor",value:function(e){return e>.5?"#4ade80":e>.2?"#a3e635":e>-.2?"#fbbf24":e>-.5?"#fb923c":"#f87171"}},{key:"getSentimentEmoji",value:function(e){return e>.5?"😊":e>.2?"🙂":e>-.2?"😐":e>-.5?"😕":"😔"}},{key:"analyzeMoodSummary",value:function(e){if(0===e.length)return null;var t=e.map(function(e){return e.sentimentScore}),n=t.reduce(function(e,t){return e+t},0)/t.length,r=(e.filter(function(e){return"positive"===e.sentiment}).length,e.filter(function(e){return"negative"===e.sentiment}).length),i=e.filter(function(e){return"neutral"===e.sentiment}).length,a=this.calculateMoodTrend(e),o=this.generateMoodInsights(e,n,a);return{averageSentiment:n,positiveDays,negativeDays:r,neutralDays:i,positivePercentage:Math.round(positiveDays/e.length*100),trend:a,insights:o}}},{key:"calculateMoodTrend",value:function(e){if(e.length<7)return"insufficient_data";var t=e.slice(-7),n=e.slice(-14,-7);if(0===n.length)return"insufficient_data";var r=t.reduce(function(e,t){return e+t.sentimentScore},0)/t.length-n.reduce(function(e,t){return e+t.sentimentScore},0)/n.length;return r>.1?"improving":r<-.1?"declining":"stable"}},{key:"generateMoodInsights",value:function(e,t,n){var r=[];return t>.3?r.push({type:"positive",message:"Your overall mood has been positive! Your content choices are uplifting.",icon:"✨"}):t<-.3&&r.push({type:"concern",message:"You've been browsing heavier content lately. Consider balancing with lighter topics.",icon:"💭"}),"improving"===n?r.push({type:"positive",message:"Your mood is trending upward! Keep exploring what makes you curious.",icon:"📈"}):"declining"===n&&r.push({type:"suggestion",message:"Your mood seems down this week. Try exploring topics that energize you.",icon:"🌱"}),e.slice(-7).every(function(e){return"positive"===e.sentiment})&&r.push({type:"achievement",message:"7 days of positive browsing! You're cultivating great digital habits.",icon:"🎉"}),r}},{key:"getDailyPrompt",value:(l=tt(Ke().m(function e(){var t,n,r,i,a,o,s,u;return Ke().w(function(e){for(;;)switch(e.n){case 0:return t=(new Date).toDateString(),e.n=1,this.db.getLastReflectionPrompt();case 1:if(!(n=e.v)||new Date(n.timestamp).toDateString()!==t){e.n=2;break}return e.a(2,n);case 2:return r=(new Date).setHours(0,0,0,0),e.n=3,this.db.getVisitsSince(r);case 3:return i=e.v,e.n=4,this.db.getSkillActivitiesSince(r);case 4:return a=e.v,0===i.length?o="What would you like to explore today?":a.length>0?(s=a[0].skill,o="You've been exploring ".concat(s," today. What insights have you gained?")):o=this.reflectionPrompts[Math.floor(Math.random()*this.reflectionPrompts.length)],u={prompt:o,timestamp:Date.now(),context:{visitCount:i.length,skills:a.map(function(e){return e.skill})}},e.n=5,this.db.saveReflectionPrompt(u);case 5:return e.a(2,u)}},e,this)})),function(){return l.apply(this,arguments)})},{key:"saveReflectionResponse",value:(c=tt(Ke().m(function e(t,n){var r;return Ke().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.db.saveReflectionResponse({prompt_id:t,response:n,timestamp:Date.now()});case 1:return e.n=2,this.ai.analyzeSentiment(n);case 2:return r=e.v,e.a(2,{saved:!0,sentiment:r})}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"activateFocusMode",value:(u=tt(Ke().m(function e(){var t,n,r,i,a,o=arguments;return Ke().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:15e5,console.log("🎯 Activating focus mode with duration:",t,"ms"),this.focusModeActive=!0,n={startTime:Date.now(),duration:t,endTime:Date.now()+t},e.n=1,chrome.storage.local.set({focus_mode:n});case 1:return console.log("✅ Focus mode session saved to storage:",n),e.p=2,e.n=3,chrome.tabs.query({});case 3:r=e.v,console.log("📢 Notifying",r.length,"tabs about focus mode"),r.forEach(function(e){e.id&&e.url&&!e.url.startsWith("chrome://")&&chrome.tabs.sendMessage(e.id,{type:"FOCUS_MODE_ACTIVATED",duration:t}).catch(function(){})}),e.n=5;break;case 4:e.p=4,a=e.v,console.error("❌ Error notifying tabs:",a);case 5:return i=t/6e4,console.log("⏰ Setting alarm for",i,"minutes"),chrome.alarms.create("end_focus_mode",{delayInMinutes:i}),console.log("✅ Focus mode activated successfully"),e.a(2,n)}},e,this,[[2,4]])})),function(){return u.apply(this,arguments)})},{key:"deactivateFocusMode",value:(s=tt(Ke().m(function e(){var t,n;return Ke().w(function(e){for(;;)switch(e.n){case 0:return this.focusModeActive=!1,e.n=1,chrome.storage.local.get(["focus_mode"]);case 1:if(!(t=e.v).focus_mode){e.n=2;break}return n=Date.now()-t.focus_mode.startTime,e.n=2,this.db.saveFocusSession({start_time:t.focus_mode.startTime,end_time:Date.now(),duration:n,completed:n>=.9*t.focus_mode.duration});case 2:return e.n=3,chrome.storage.local.remove("focus_mode");case 3:return e.n=4,chrome.tabs.query({});case 4:e.v.forEach(function(e){chrome.tabs.sendMessage(e.id,{type:"FOCUS_MODE_DEACTIVATED"}).catch(function(){})}),chrome.alarms.clear("end_focus_mode");case 5:return e.a(2)}},e,this)})),function(){return s.apply(this,arguments)})},{key:"getFocusModeStatus",value:(o=tt(Ke().m(function e(){var t,n;return Ke().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,chrome.storage.local.get(["focus_mode"]);case 1:if((t=e.v).focus_mode){e.n=2;break}return e.a(2,{active:!1});case 2:return n=t.focus_mode.endTime-Date.now(),e.a(2,{active:n>0,startTime:t.focus_mode.startTime,endTime:t.focus_mode.endTime,remaining:n,progress:Math.round((t.focus_mode.duration-n)/t.focus_mode.duration*100)})}},e)})),function(){return o.apply(this,arguments)})},{key:"getFocusStats",value:(a=tt(Ke().m(function e(){var t,n,r,i,a,o,s=arguments;return Ke().w(function(e){for(;;)switch(e.n){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:30,n=Date.now()-24*t*60*60*1e3,e.n=1,this.db.getFocusSessionsSince(n);case 1:return r=e.v,i=r.filter(function(e){return e.completed}),a=r.reduce(function(e,t){return e+t.duration},0),o=r.length>0?a/r.length:0,e.a(2,{totalSessions:r.length,completedSessions:i.length,completionRate:r.length>0?Math.round(i.length/r.length*100):0,totalFocusTime:a,avgSessionDuration:o,longestSession:r.length>0?Math.max.apply(Math,Je(r.map(function(e){return e.duration}))):0,recentSessions:r.slice(-5).reverse()})}},e,this)})),function(){return a.apply(this,arguments)})},{key:"getMindfulSuggestions",value:(i=tt(Ke().m(function e(){var t,n,r,i,a,o,s,u,c;return Ke().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Promise.all([this.getMoodTimeline(7),this.getFocusStats(7),this.db.getVisitsSince((new Date).setHours(0,0,0,0))]);case 1:return n=e.v,r=Ve(n,3),i=r[0],a=r[1],o=r[2],s=[],a.completionRate<50&&a.totalSessions>2&&s.push({type:"focus",title:"Improve Focus Completion",message:"Try shorter focus sessions (15 min) to build the habit.",action:"Start 15-min session",icon:"🎯"}),"declining"===(null===(t=i.summary)||void 0===t?void 0:t.trend)&&s.push({type:"wellness",title:"Lighten Your Content",message:"You've been browsing heavy topics. Try exploring uplifting content.",action:"Explore positive topics",icon:"🌈"}),u=o.reduce(function(e,t){return e+(t.time_spent||0)},0),(c=u/36e5)>3&&s.push({type:"break",title:"Time for a Break",message:"You've been browsing for ".concat(c.toFixed(1)," hours today. Take a mindful break!"),action:"Set break reminder",icon:"☕"}),e.a(2,s)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"getMindfulnessReport",value:(r=tt(Ke().m(function e(){var t,n,r,i,a,o,s,u,c,l,f,h,p,m,d,g,v=arguments;return Ke().w(function(e){for(;;)switch(e.n){case 0:return a=v.length>0&&void 0!==v[0]?v[0]:7,e.n=1,Promise.all([this.getMoodTimeline(a),this.getFocusStats(a),this.db.getReflectionsSince(Date.now()-24*a*60*60*1e3)]);case 1:return o=e.v,s=Ve(o,3),u=s[0],c=s[1],l=s[2],f="Last ".concat(a," days"),h={average:(null===(t=u.summary)||void 0===t?void 0:t.averageSentiment)||0,trend:(null===(n=u.summary)||void 0===n?void 0:n.trend)||"unknown",positivePercentage:(null===(r=u.summary)||void 0===r?void 0:r.positivePercentage)||0,insights:(null===(i=u.summary)||void 0===i?void 0:i.insights)||[]},p={sessions:c.totalSessions,completionRate:c.completionRate,totalTime:c.totalFocusTime,avgDuration:c.avgSessionDuration},m={totalReflections:l.length,reflectionRate:Math.round(l.length/a*100)/100},d=this.calculateMindfulnessScore(u,c,l),e.n=2,this.getMindfulSuggestions();case 2:return g=e.v,e.a(2,{period:f,mood:h,focus:p,reflection:m,overallScore:d,recommendations:g})}},e,this)})),function(){return r.apply(this,arguments)})},{key:"calculateMindfulnessScore",value:function(e,t,n){var r,i=0;return i+=20*(((null===(r=e.summary)||void 0===r?void 0:r.averageSentiment)||0)+1),i+=t.completionRate/100*30,i+=Math.min(n.length/7*30,30),Math.round(i)}}],t&&nt(e.prototype,t),n&&nt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,i,a,o,s,u,c,l,f}();function at(e){return at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},at(e)}function ot(e){return function(e){if(Array.isArray(e))return ct(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ut(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function st(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||ut(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ut(e,t){if(e){if("string"==typeof e)return ct(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ct(e,t):void 0}}function ct(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lt(Object(n),!0).forEach(function(t){ht(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ht(e,t,n){return(t=bt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pt(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof s?r:s,c=Object.create(u.prototype);return mt(c,"_invoke",function(n,r,i){var a,s,u,c=0,l=i||[],f=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,u=e,h.n=n,o}};function p(n,r){for(s=n,u=r,t=0;!f&&c&&!i&&t<l.length;t++){var i,a=l[t],p=h.p,m=a[2];n>3?(i=m===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=n<2&&p<a[1])?(s=0,h.v=r,h.n=a[1]):p<m&&(i=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,h.n=m,s=0))}if(i||n>1)return o;throw f=!0,r}return function(i,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),s=l,u=m;(t=s<2?e:u)||!f;){a||(s?s<3?(s>1&&(h.n=-1),p(s,u)):h.n=u:h.v=u);try{if(c=2,a){if(s||(i="next"),t=a[i]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),s=1);a=e}else if((t=(f=h.n<0)?u:n.call(r,h))!==o)break}catch(t){a=e,s=1,u=t}finally{c=1}}return{value:t,done:f}}}(n,i,a),!0),c}var o={};function s(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(mt(t={},r,function(){return this}),t),f=c.prototype=s.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,mt(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,mt(f,"constructor",c),mt(c,"constructor",u),u.displayName="GeneratorFunction",mt(c,i,"GeneratorFunction"),mt(f),mt(f,i,"Generator"),mt(f,r,function(){return this}),mt(f,"toString",function(){return"[object Generator]"}),(pt=function(){return{w:a,m:h}})()}function mt(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}mt=function(e,t,n,r){function a(t,n){mt(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},mt(e,t,n,r)}function dt(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function gt(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){dt(a,r,i,o,s,"next",e)}function s(e){dt(a,r,i,o,s,"throw",e)}o(void 0)})}}function vt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,bt(r.key),r)}}function bt(e){var t=function(e,t){if("object"!=at(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=at(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==at(t)?t:t+""}new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.db=new v,this.ai=new N,this.personalityEngine=null,this.goalAlignment=null,this.digitalTwin=null,this.skillTracker=null,this.learningAnalytics=null,this.premiumFeatures=null,this.mindfulness=null,this.activeSessions=new Map,this.learningSessionTracker=new Map,this.focusModeBlockedTabs=new Set,this.init()},t=[{key:"init",value:(I=gt(pt().m(function e(){var t,n=this;return pt().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("🚀 Initializing SupriAI Background Service..."),e.n=1,this.db.init();case 1:return console.log("✅ Database initialized"),this.personalityEngine=new U(this.ai),this.goalAlignment=new ee(this.ai,this.db),this.digitalTwin=new he(this.ai,this.db),this.skillTracker=new Ne(this.ai,this.db),this.learningAnalytics=new Xe(this.ai,this.db),this.premiumFeatures=new(We())(this.db),this.mindfulness=new it(this.ai,this.db),console.log("✅ All modules initialized"),e.n=2,this.learningAnalytics.initializeDatabase();case 2:return console.log("✅ Learning analytics database ready"),e.n=3,this.premiumFeatures.initialize();case 3:console.log("✅ Premium features initialized"),chrome.runtime.onMessage.addListener(function(e,t,r){return n.handleMessage(e,t,r),!0}),console.log("✅ Message listeners registered"),e.n=5;break;case 4:e.p=4,t=e.v,console.error("❌ Initialization error:",t),chrome.runtime.onMessage.addListener(function(e,n,r){return r({error:"Service not initialized: "+t.message}),!0});case 5:chrome.tabs.onUpdated.addListener(function(e,t,r){"complete"===t.status&&n.handleTabLoad(e,r)}),chrome.tabs.onActivated.addListener(function(e){n.handleTabActivation(e.tabId)}),chrome.tabs.onRemoved.addListener(function(e){n.handleTabClose(e)}),chrome.webNavigation.onBeforeNavigate.addListener(function(e){n.handleNavigation(e)}),chrome.alarms.create("cleanup",{periodInMinutes:60}),chrome.alarms.create("weeklySnapshot",{periodInMinutes:10080}),chrome.alarms.create("moodTracking",{periodInMinutes:30}),chrome.alarms.onAlarm.addListener(function(e){"cleanup"===e.name?n.performCleanup():"weeklySnapshot"===e.name?n.generateWeeklySnapshot():"moodTracking"===e.name?n.updateMoodTracking():"end_focus_mode"===e.name&&n.handleFocusModeEnd()}),console.log("✨ SupriAI Background Service Worker initialized");case 6:return e.a(2)}},e,this,[[0,4]])})),function(){return I.apply(this,arguments)})},{key:"handleMessage",value:(R=gt(pt().m(function e(t,n,r){var i,a,o,s,u,c,l,f,h,p,m,d,g,v,b,y,E,w,T,_,k,S,O,N,A,R,I,L,D,P,M,C,j,F,x,U,G,q,H,Y,X,B,W,z,V,K,Q,J,$,Z,ee,te,ne,re,ie,ae,oe,se,ue,ce,le,fe,he,pe,me,de,ge,ve,be,ye,Ee,we,Te,_e,ke,Se,Oe,Ne;return pt().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.db&&this.db.isInitialized){e.n=4;break}return console.warn("⚠️ Database not ready, attempting to initialize..."),e.p=1,e.n=2,this.db.init();case 2:e.n=4;break;case 3:return e.p=3,te=e.v,console.error("❌ Failed to initialize database:",te),r({error:"Database not initialized",success:!1}),e.a(2);case 4:a=t.type,o=t.data,s=t.url,e.p=5,ne=a,e.n="CONTEXT_UPDATE"===ne?6:"SAVE_HIGHLIGHT"===ne?8:"GET_PREVIOUS_CONTEXT"===ne?10:"PAGE_UNLOAD"===ne?12:"GET_MEMORIES"===ne?14:"SEARCH_MEMORIES"===ne?18:"ADD_TAG"===ne?22:"GET_STATS"===ne?26:"EXPORT_DATA"===ne?30:"IMPORT_DATA"===ne?32:"GET_PERSONALITY_SNAPSHOTS"===ne?34:"GET_INTEREST_EVOLUTION"===ne?36:"GET_MOOD_SUMMARY"===ne?38:"ADD_GOAL"===ne?40:"UPDATE_GOAL"===ne?42:"GET_GOALS"===ne?44:"TOGGLE_GOAL"===ne?45:"DELETE_GOAL"===ne?47:"GET_GOAL_INSIGHTS"===ne?49:"ASK_TWIN"===ne?51:"GET_TWIN_SUMMARY"===ne?53:"COMPARE_INTERESTS"===ne?54:"GET_SKILL_PROGRESS"===ne?56:"GET_LEARNING_PATHS"===ne?63:"ADD_CUSTOM_SKILL"===ne?65:"GET_LEARNING_PATH"===ne?70:"DELETE_SKILL"===ne?72:"GET_ALL_SKILLS"===ne?74:"GET_WEEKLY_SKILL_SUMMARY"===ne?78:"GET_ACHIEVEMENTS"===ne?82:"GET_STREAK"===ne?86:"GET_SUBSCRIPTION_INFO"===ne?90:"UPGRADE_SUBSCRIPTION"===ne?92:"CHECK_FEATURE_ACCESS"===ne?94:"GET_FEATURE_LIMIT"===ne?96:"CHECK_USAGE_LIMIT"===ne?98:"INCREMENT_FEATURE_USAGE"===ne?100:"CREATE_TEAM"===ne?102:"GET_USER_TEAMS"===ne?104:"ADD_TEAM_MEMBER"===ne?106:"GET_TEAM_MEMBERS"===ne?108:"SAVE_LEARNING_SESSION"===ne?110:"GET_LEARNING_ANALYTICS"===ne?114:"GET_LEARNING_RECOMMENDATIONS"===ne?118:"GET_LEARNING_INSIGHTS"===ne?122:"GET_LEARNING_STREAK"===ne?126:"TRACK_LEARNING_ACTIVITY"===ne?130:"START_FOCUS_MODE"===ne?131:"STOP_FOCUS_MODE"===ne?138:"GET_FOCUS_STATUS"===ne?144:"GET_MOOD_TIMELINE"===ne?148:"LOG_MOOD"===ne?152:"GET_FOCUS_SESSIONS"===ne?156:"GET_DAILY_PROMPT"===ne?160:"SAVE_REFLECTION"===ne?164:"GET_MINDFULNESS_SCORE"===ne?168:172;break;case 6:return e.n=7,this.handleContextUpdate(o,n.tab);case 7:return r({success:!0}),e.a(3,173);case 8:return e.n=9,this.saveHighlight(o);case 9:return r({success:!0}),e.a(3,173);case 10:return e.n=11,this.getPreviousContext(s);case 11:return u=e.v,r({context:u}),e.a(3,173);case 12:return e.n=13,this.handlePageUnload(o,n.tab);case 13:return r({success:!0}),e.a(3,173);case 14:return e.p=14,e.n=15,this.getMemories(o);case 15:c=e.v,r({memories:c||[]}),e.n=17;break;case 16:e.p=16,re=e.v,console.error("Error getting memories:",re),r({memories:[],error:re.message});case 17:return e.a(3,173);case 18:return e.p=18,e.n=19,this.searchMemories(o.query);case 19:l=e.v,r({results:l||[]}),e.n=21;break;case 20:e.p=20,ie=e.v,console.error("Error searching memories:",ie),r({results:[],error:ie.message});case 21:return e.a(3,173);case 22:return e.p=22,e.n=23,this.addTag(o.url,o.tag);case 23:r({success:!0}),e.n=25;break;case 24:e.p=24,ae=e.v,console.error("Error adding tag:",ae),r({success:!1,error:ae.message});case 25:return e.a(3,173);case 26:return e.p=26,e.n=27,this.getStats();case 27:f=e.v,r({stats:f||{totalVisits:0,totalTimeSpent:0,totalHighlights:0,totalSessions:0,thisWeekVisits:0,averageTimePerVisit:0}}),e.n=29;break;case 28:e.p=28,oe=e.v,console.error("Error getting stats:",oe),r({stats:{totalVisits:0,totalTimeSpent:0,totalHighlights:0,totalSessions:0,thisWeekVisits:0,averageTimePerVisit:0},error:oe.message});case 29:return e.a(3,173);case 30:return e.n=31,this.exportData();case 31:return h=e.v,r({data:h}),e.a(3,173);case 32:return e.n=33,this.importData(o);case 33:return r({success:!0}),e.a(3,173);case 34:return e.n=35,this.db.getPersonalitySnapshots(null==o?void 0:o.limit);case 35:return p=e.v,r({snapshots:p}),e.a(3,173);case 36:return e.n=37,this.db.getInterestEvolution();case 37:return m=e.v,r({evolution:m}),e.a(3,173);case 38:return e.n=39,this.db.getWeeklyMoodSummary();case 39:return d=e.v,r({moodSummary:d}),e.a(3,173);case 40:return e.n=41,this.goalAlignment.addGoal(o);case 41:return g=e.v,r({goal:g}),e.a(3,173);case 42:return e.n=43,this.goalAlignment.updateGoal(o);case 43:return r({success:!0}),e.a(3,173);case 44:return v=this.goalAlignment.getGoalProgress(),r({goals:v}),e.a(3,173);case 45:return e.n=46,this.goalAlignment.toggleGoal(o.goalId);case 46:return r({success:!0}),e.a(3,173);case 47:return e.n=48,this.goalAlignment.deleteGoal(o.goalId);case 48:return r({success:!0}),e.a(3,173);case 49:return e.n=50,this.goalAlignment.getWeeklyInsights();case 50:return b=e.v,r({insights:b}),e.a(3,173);case 51:return e.n=52,this.digitalTwin.askTwin(o.question);case 52:return y=e.v,r({response:y}),e.a(3,173);case 53:return E=this.digitalTwin.getTwinSummary(),r({summary:E}),e.a(3,173);case 54:return e.n=55,this.digitalTwin.compareWithPast((null==o?void 0:o.days)||30);case 55:return w=e.v,r({comparison:w}),e.a(3,173);case 56:if(e.p=56,!o||!o.skill){e.n=58;break}return e.n=57,this.db.getSkillByName(o.skill);case 57:(T=e.v)?(_=this.skillTracker.calculateSkillLevel(T),k=this.skillTracker.calculateXP(T.total_time),r({success:!0,progress:{skill:o.skill,level:_.value,xp:k,xp_percentage:_.xp_percentage||0,total_time:T.total_time}})):r({success:!1,error:"Skill not found"}),e.n=60;break;case 58:return e.n=59,this.skillTracker.getSkillProgress();case 59:S=e.v,r(ft({success:!0},S));case 60:e.n=62;break;case 61:e.p=61,se=e.v,console.error("Error getting skill progress:",se),r({success:!1,error:se.message,skills:[]});case 62:return e.a(3,173);case 63:return e.n=64,this.skillTracker.getSkillProgress();case 64:return O=e.v,r({success:!0,paths:O.recommendations||[]}),e.a(3,173);case 65:if(e.p=65,N=o.skill||o.name||t.skill||t.name){e.n=66;break}return r({success:!1,error:"Skill name is required"}),e.a(3,173);case 66:return e.n=67,this.db.saveSkillActivity({url:"manual",skill:N,confidence:1,keywords:"",time_spent:0,timestamp:Date.now()});case 67:console.log("✅ Custom skill added:",N),r({success:!0,message:'Skill "'.concat(N,'" added successfully')}),e.n=69;break;case 68:e.p=68,ue=e.v,console.error("❌ Error adding custom skill:",ue),r({success:!1,error:ue.message||"Failed to add skill"});case 69:return e.a(3,173);case 70:return e.n=71,this.skillTracker.generateLearningPath(o.skill);case 71:return(A=e.v).error?r({success:!1,message:A.error}):(R=A.recommendedCourses||[],r({success:!0,learningPath:R})),e.a(3,173);case 72:return e.n=73,this.db.deleteSkillActivity(o.skill);case 73:return r({success:!0}),e.a(3,173);case 74:return e.p=74,e.n=75,this.db.getAllSkills();case 75:I=e.v,r({success:!0,skills:I||[]}),e.n=77;break;case 76:e.p=76,ce=e.v,console.error("Error getting all skills:",ce),r({success:!1,error:ce.message,skills:[]});case 77:return e.a(3,173);case 78:return e.p=78,e.n=79,this.skillTracker.getWeeklySkillSummary();case 79:L=e.v,r({success:!0,summary:L||{}}),e.n=81;break;case 80:e.p=80,le=e.v,console.error("Error getting weekly skill summary:",le),r({success:!1,error:le.message,summary:{}});case 81:return e.a(3,173);case 82:return e.p=82,e.n=83,this.db.getAchievements();case 83:D=e.v,r({success:!0,achievements:D||[]}),e.n=85;break;case 84:e.p=84,fe=e.v,console.error("Error getting achievements:",fe),r({success:!1,error:fe.message,achievements:[]});case 85:return e.a(3,173);case 86:return e.p=86,e.n=87,this.db.getStreak();case 87:P=e.v,r({success:!0,streak:P||{currentStreak:0,longestStreak:0}}),e.n=89;break;case 88:e.p=88,he=e.v,console.error("Error getting streak:",he),r({success:!1,error:he.message,streak:{currentStreak:0,longestStreak:0}});case 89:return e.a(3,173);case 90:return e.n=91,this.premiumFeatures.getCurrentTierInfo();case 91:return M=e.v,r({success:!0,subscription:M}),e.a(3,173);case 92:return e.n=93,this.premiumFeatures.upgradeTier(o.tier,o.duration);case 93:return C=e.v,r(C),e.a(3,173);case 94:return e.n=95,this.premiumFeatures.hasFeatureAccess(o.feature);case 95:return j=e.v,r({success:!0,hasAccess:j}),e.a(3,173);case 96:return e.n=97,this.premiumFeatures.getFeatureLimit(o.feature);case 97:return F=e.v,r({success:!0,limit:F}),e.a(3,173);case 98:return e.n=99,this.premiumFeatures.checkUsageLimit(o.feature);case 99:return x=e.v,r({success:!0,withinLimit:x}),e.a(3,173);case 100:return e.n=101,this.premiumFeatures.incrementFeatureUsage(o.feature);case 101:return r({success:!0}),e.a(3,173);case 102:return e.n=103,this.premiumFeatures.createTeam(o.teamName);case 103:return U=e.v,r(U),e.a(3,173);case 104:return e.n=105,this.premiumFeatures.getUserTeams();case 105:return G=e.v,r({success:!0,teams:G}),e.a(3,173);case 106:return e.n=107,this.premiumFeatures.addTeamMember(o.teamId,o.userId,o.role);case 107:return q=e.v,r(q),e.a(3,173);case 108:return e.n=109,this.premiumFeatures.getTeamMembers(o.teamId);case 109:return H=e.v,r({success:!0,members:H}),e.a(3,173);case 110:return e.p=110,e.n=111,this.learningAnalytics.saveLearningSession(o);case 111:Y=e.v,r({success:!0,result:Y}),e.n=113;break;case 112:e.p=112,pe=e.v,console.error("Error saving learning session:",pe),r({success:!1,error:pe.message});case 113:return e.a(3,173);case 114:return e.p=114,e.n=115,this.learningAnalytics.getLearningAnalytics((null==o?void 0:o.timeRange)||"week");case 115:X=e.v,r({success:!0,analytics:X||{}}),e.n=117;break;case 116:e.p=116,me=e.v,console.error("Error getting learning analytics:",me),r({success:!1,error:me.message,analytics:{}});case 117:return e.a(3,173);case 118:return e.p=118,e.n=119,this.learningAnalytics.getRecommendations();case 119:B=e.v,r({success:!0,recommendations:B||[]}),e.n=121;break;case 120:e.p=120,de=e.v,console.error("Error getting learning recommendations:",de),r({success:!1,error:de.message,recommendations:[]});case 121:return e.a(3,173);case 122:return e.p=122,e.n=123,this.learningAnalytics.generateInsights();case 123:W=e.v,r({success:!0,insights:W||{}}),e.n=125;break;case 124:e.p=124,ge=e.v,console.error("Error getting learning insights:",ge),r({success:!1,error:ge.message,insights:{}});case 125:return e.a(3,173);case 126:return e.p=126,e.n=127,this.learningAnalytics.getLearningStreak();case 127:z=e.v,r({success:!0,streak:z||{currentStreak:0,longestStreak:0}}),e.n=129;break;case 128:e.p=128,ve=e.v,console.error("Error getting learning streak:",ve),r({success:!1,error:ve.message,streak:{currentStreak:0,longestStreak:0}});case 129:return e.a(3,173);case 130:return(V=null===(i=n.tab)||void 0===i?void 0:i.id)&&o&&this.updateLearningSession(V,o),r({success:!0}),e.a(3,173);case 131:if(console.log("📥 Received START_FOCUS_MODE request with data:",o),e.p=132,o&&o.duration){e.n=133;break}return console.error("❌ No duration provided in START_FOCUS_MODE"),r({success:!1,error:"Duration is required"}),e.a(3,173);case 133:return console.log("🎯 Starting focus mode with duration:",o.duration,"ms"),e.n=134,this.mindfulness.activateFocusMode(o.duration);case 134:return K=e.v,console.log("✅ Focus session created:",K),e.n=135,this.enableFocusModeBlocking();case 135:console.log("✅ Focus mode blocking enabled"),r({success:!0,session:K}),e.n=137;break;case 136:e.p=136,be=e.v,console.error("❌ Error starting focus mode:",be),r({success:!1,error:be.message});case 137:return e.a(3,173);case 138:return console.log("📥 Received STOP_FOCUS_MODE request"),e.p=139,e.n=140,this.mindfulness.deactivateFocusMode();case 140:return e.n=141,this.disableFocusModeBlocking();case 141:console.log("✅ Focus mode stopped successfully"),r({success:!0}),e.n=143;break;case 142:e.p=142,ye=e.v,console.error("❌ Error stopping focus mode:",ye),r({success:!1,error:ye.message});case 143:return e.a(3,173);case 144:return e.p=144,e.n=145,this.mindfulness.getFocusModeStatus();case 145:Q=e.v,r({success:!0,status:Q}),e.n=147;break;case 146:e.p=146,Ee=e.v,console.error("❌ Error getting focus status:",Ee),r({success:!1,error:Ee.message});case 147:return e.a(3,173);case 148:return e.p=148,e.n=149,this.mindfulness.getMoodTimeline((null==o?void 0:o.days)||30);case 149:J=e.v,r({success:!0,timeline:(null==J?void 0:J.timeline)||[]}),e.n=151;break;case 150:e.p=150,we=e.v,console.error("Error getting mood timeline:",we),r({success:!1,error:we.message,timeline:[]});case 151:return e.a(3,173);case 152:return e.p=152,e.n=153,this.db.saveMoodData({timestamp:Date.now(),mood:o.mood,sentiment:this.getMoodSentiment(o.mood),sentimentScore:this.getMoodScore(o.mood),emotions:o.mood,tone:"manual",url:"manual_log"});case 153:r({success:!0}),e.n=155;break;case 154:e.p=154,Te=e.v,console.error("Error logging mood:",Te),r({success:!1,error:Te.message});case 155:return e.a(3,173);case 156:return e.p=156,e.n=157,this.db.getFocusSessionsSince(Date.now()-24*((null==o?void 0:o.days)||30)*60*60*1e3);case 157:$=e.v,r({success:!0,sessions:$||[]}),e.n=159;break;case 158:e.p=158,_e=e.v,console.error("Error getting focus sessions:",_e),r({success:!1,error:_e.message,sessions:[]});case 159:return e.a(3,173);case 160:return e.p=160,e.n=161,this.mindfulness.getDailyPrompt();case 161:Z=e.v,r({success:!0,prompt:Z||null}),e.n=163;break;case 162:e.p=162,ke=e.v,console.error("Error getting daily prompt:",ke),r({success:!1,error:ke.message,prompt:null});case 163:return e.a(3,173);case 164:return e.p=164,e.n=165,this.mindfulness.saveReflectionResponse(o.promptId,o.response);case 165:r({success:!0}),e.n=167;break;case 166:e.p=166,Se=e.v,console.error("Error saving reflection:",Se),r({success:!1,error:Se.message});case 167:return e.a(3,173);case 168:return e.p=168,e.n=169,this.mindfulness.getMindfulnessReport(7);case 169:ee=e.v,r({success:!0,score:(null==ee?void 0:ee.overallScore)||0}),e.n=171;break;case 170:e.p=170,Oe=e.v,console.error("Error getting mindfulness score:",Oe),r({success:!1,error:Oe.message,score:0});case 171:return e.a(3,173);case 172:r({error:"Unknown message type"});case 173:e.n=175;break;case 174:e.p=174,Ne=e.v,console.error("Error handling message:",Ne),r({error:Ne.message});case 175:return e.a(2)}},e,this,[[168,170],[164,166],[160,162],[156,158],[152,154],[148,150],[144,146],[139,142],[132,136],[126,128],[122,124],[118,120],[114,116],[110,112],[86,88],[82,84],[78,80],[74,76],[65,68],[56,61],[26,28],[22,24],[18,20],[14,16],[5,174],[1,3]])})),function(e,t,n){return R.apply(this,arguments)})},{key:"handleContextUpdate",value:(A=gt(pt().m(function e(t,n){var r,i,a,o;return pt().w(function(e){for(;;)switch(e.n){case 0:if(r=t.url,i=t.title,t.content,!((a=t.timeSpent)<10)){e.n=1;break}return e.a(2);case 1:if((o=this.activeSessions.get(n.id))||(o={url:r,title:i,startTime:Date.now(),tabId:n.id},this.activeSessions.set(n.id,o)),o.lastUpdate=Date.now(),o.context=t,!(a>30)||o.aiProcessed){e.n=2;break}return o.aiProcessed=!0,e.n=2,this.processWithAI(t);case 2:return e.n=3,this.db.updateVisit(t);case 3:return e.a(2)}},e,this)})),function(e,t){return A.apply(this,arguments)})},{key:"processWithAI",value:(O=gt(pt().m(function e(t){var n,r,i,a,o,s,u,c;return pt().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.ai.generateSummary(t.content);case 1:return n=e.v,e.n=2,this.ai.predictTags(t.content,t.title);case 2:return r=e.v,e.n=3,this.ai.extractTopics(t.content);case 3:return i=e.v,e.n=4,this.personalityEngine.analyzeTone(t.content);case 4:return a=e.v,e.n=5,this.personalityEngine.detectEmotionalThemes(t.content);case 5:return o=e.v,e.n=6,this.personalityEngine.analyzeSentiment(t.content);case 6:return s=e.v,e.n=7,this.skillTracker.detectSkills(t.content,t.title,t.url,i);case 7:return e.n=8,this.db.saveAIInsights(t.url,{summary:n,tags:r,topics:i,timestamp:Date.now()});case 8:return e.n=9,this.db.saveMoodData({timestamp:Date.now(),sentiment:s.sentiment,sentimentScore:s.score,emotions:o,tone:a,url:t.url});case 9:return e.n=10,this.digitalTwin.updateTwin({topics:i,tone:a,emotions:o,timestamp:Date.now(),timeSpent:t.timeSpent,category:this.categorizeContent(i)});case 10:return e.n=11,this.goalAlignment.checkAlignment(t.url,t.title,t.content,t.timeSpent);case 11:null!=(u=e.v)&&u.showNudge&&chrome.tabs.query({active:!0,currentWindow:!0},function(e){e[0]&&chrome.tabs.sendMessage(e[0].id,{type:"SHOW_NUDGE",nudge:u})}),console.log("✨ AI processing complete for:",t.url),e.n=13;break;case 12:e.p=12,c=e.v,console.error("AI processing error:",c);case 13:return e.a(2)}},e,this,[[0,12]])})),function(e){return O.apply(this,arguments)})},{key:"categorizeContent",value:function(e){for(var t,n=function(){var t=st(i[r],2),n=t[0],a=t[1];if(e.some(function(e){return a.some(function(t){return e.toLowerCase().includes(t)})}))return{v:n}},r=0,i=Object.entries({tech:["programming","code","software","development","ai","tech"],learning:["learn","education","tutorial","course","study"],design:["design","ui","ux","creative","art"],business:["business","startup","marketing","finance"],entertainment:["gaming","movies","music","entertainment"],news:["news","current","events","politics"],personal:["health","wellness","lifestyle","personal"]});r<i.length;r++)if(t=n())return t.v;return"other"}},{key:"generateWeeklySnapshot",value:(S=gt(pt().m(function e(){return pt().w(function(e){for(;;)switch(e.n){case 0:if(!this.personalityEngine){e.n=1;break}return e.n=1,this.personalityEngine.generateWeeklySnapshot();case 1:return e.a(2)}},e,this)})),function(){return S.apply(this,arguments)})},{key:"updateMoodTracking",value:(k=gt(pt().m(function e(){return pt().w(function(e){for(;;)switch(e.n){case 0:console.log("💭 Mood tracking update");case 1:return e.a(2)}},e)})),function(){return k.apply(this,arguments)})},{key:"handleTabActivation",value:(_=gt(pt().m(function e(t){var n,r,i;return pt().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,chrome.tabs.get(t);case 1:if((n=e.v)&&n.url&&!n.url.startsWith("chrome://")){e.n=2;break}return e.a(2);case 2:r="session_".concat(t,"_").concat(Date.now()),this.learningSessionTracker.set(t,{sessionId:r,url:n.url,title:n.title,startTime:Date.now(),activeTime:0,lastActivity:Date.now(),scrollDepth:0}),console.log("📚 Started learning session for tab ".concat(t)),e.n=4;break;case 3:e.p=3,i=e.v,console.error("Error starting learning session:",i);case 4:return e.a(2)}},e,this,[[0,3]])})),function(e){return _.apply(this,arguments)})},{key:"updateLearningSession",value:function(e,t){var n=this.learningSessionTracker.get(e);if(n){var r=Date.now(),i=r-n.lastActivity;i<3e4&&(n.activeTime+=i),n.lastActivity=r,void 0!==t.scrollDepth&&(n.scrollDepth=Math.max(n.scrollDepth,t.scrollDepth)),this.learningSessionTracker.set(e,n)}}},{key:"endLearningSession",value:(T=gt(pt().m(function e(t){var n,r,i,a;return pt().w(function(e){for(;;)switch(e.n){case 0:if(n=this.learningSessionTracker.get(t)){e.n=1;break}return e.a(2);case 1:return r=Date.now(),i=Math.floor((r-n.startTime)/1e3),e.n=2,this.checkRevisitCount(n.url);case 2:return a=e.v,e.n=3,this.learningAnalytics.saveLearningSession({url:n.url,title:n.title,timeSpent:i,activeTime:Math.floor(n.activeTime/1e3),scrollDepth:n.scrollDepth,revisitCount:a+1,sessionId:n.sessionId});case 3:this.learningSessionTracker.delete(t),console.log("📚 Ended learning session for tab ".concat(t,": ").concat(i,"s total, ").concat(Math.floor(n.activeTime/1e3),"s active"));case 4:return e.a(2)}},e,this)})),function(e){return T.apply(this,arguments)})},{key:"checkRevisitCount",value:(w=gt(pt().m(function e(t){var n,r;return pt().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.db.executeSQL("SELECT COUNT(*) as count FROM learning_sessions WHERE url = ?",[t]);case 1:return r=e.v,e.a(2,(null===(n=r[0])||void 0===n?void 0:n.count)||0);case 2:return e.p=2,e.v,e.a(2,0)}},e,this,[[0,2]])})),function(e){return w.apply(this,arguments)})},{key:"handleTabLoad",value:(E=gt(pt().m(function e(t,n){var r;return pt().w(function(e){for(;;)switch(e.n){case 0:if(n.url&&!n.url.startsWith("chrome://")){e.n=1;break}return e.a(2);case 1:return e.n=2,this.db.getVisitHistory(n.url);case 2:return(r=e.v)&&r.visit_count>0&&console.log("🔮 Returning user to: ".concat(n.url," (").concat(r.visit_count," previous visits)")),e.n=3,this.handleTabActivation(t);case 3:return e.a(2)}},e,this)})),function(e,t){return E.apply(this,arguments)})},{key:"handleTabClose",value:(y=gt(pt().m(function e(t){var n;return pt().w(function(e){for(;;)switch(e.n){case 0:if(!(n=this.activeSessions.get(t))||!n.context){e.n=2;break}return e.n=1,this.db.updateVisit(n.context);case 1:this.activeSessions.delete(t);case 2:return e.n=3,this.endLearningSession(t);case 3:return e.a(2)}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"handlePageUnload",value:(b=gt(pt().m(function e(t,n){return pt().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.db.updateVisit(t);case 1:this.activeSessions.delete(n.id);case 2:return e.a(2)}},e,this)})),function(e,t){return b.apply(this,arguments)})},{key:"saveHighlight",value:(g=gt(pt().m(function e(t){return pt().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.db.saveHighlight(t);case 1:return e.a(2)}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"getPreviousContext",value:(d=gt(pt().m(function e(t){var n,r,i;return pt().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.db.getVisitHistory(t);case 1:return n=e.v,e.n=2,this.db.getHighlights(t);case 2:return r=e.v,e.n=3,this.db.getAIInsights(t);case 3:if(i=e.v,n){e.n=4;break}return e.a(2,null);case 4:return e.a(2,{visits:n.visit_count||0,lastVisit:n.last_visit,totalTimeSpent:n.total_time_spent||0,highlights:r.slice(0,5),tags:(null==i?void 0:i.tags)||[],summary:null==i?void 0:i.summary})}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"getMemories",value:(m=gt(pt().m(function e(){var t,n=arguments;return pt().w(function(e){for(;;)switch(e.n){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.n=1,this.db.getMemories(t);case 1:return e.a(2,e.v)}},e,this)})),function(){return m.apply(this,arguments)})},{key:"searchMemories",value:(p=gt(pt().m(function e(t){var n,r;return pt().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.db.getMemories();case 1:return n=e.v,r=n.filter(function(e){var n=e.highlights.map(function(e){return e.text||""}).join(" ");return"".concat(e.title," ").concat(n).toLowerCase().includes(t.toLowerCase())}),e.a(2,r.sort(function(e,n){var r=e.title.toLowerCase().split(t.toLowerCase()).length;return n.title.toLowerCase().split(t.toLowerCase()).length-r}))}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"addTag",value:(h=gt(pt().m(function e(t,n){return pt().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.db.addTag(t,n);case 1:return e.a(2)}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"getStats",value:(f=gt(pt().m(function e(){return pt().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.db.getStats();case 1:return e.a(2,e.v)}},e,this)})),function(){return f.apply(this,arguments)})},{key:"exportData",value:(l=gt(pt().m(function e(){return pt().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.db.exportData();case 1:return e.a(2,e.v)}},e,this)})),function(){return l.apply(this,arguments)})},{key:"importData",value:(c=gt(pt().m(function e(t){return pt().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.db.importData(t);case 1:return e.a(2,e.v)}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"performCleanup",value:(u=gt(pt().m(function e(){return pt().w(function(e){for(;;)switch(e.n){case 0:return console.log("🧹 Performing cleanup..."),e.n=1,this.db.cleanup();case 1:return e.a(2)}},e,this)})),function(){return u.apply(this,arguments)})},{key:"enableFocusModeBlocking",value:(s=gt(pt().m(function e(){var t,n,r,i,a,o;return pt().w(function(e){for(;;)switch(e.p=e.n){case 0:return console.log("🎯 Focus mode blocking enabled - Only educational content allowed"),e.n=1,chrome.storage.local.set({focus_mode_blocking:!0});case 1:return t=this.getEducationalDomains(),n=t.map(function(e,t){return{id:t+1,priority:2,action:{type:"allow"},condition:{urlFilter:"*://*.".concat(e,"/*"),resourceTypes:["main_frame"]}}}),r={id:1e4,priority:1,action:{type:"redirect",redirect:{extensionPath:"/focus-block.html"}},condition:{urlFilter:"*://*/*",resourceTypes:["main_frame"],excludedInitiatorDomains:["localhost","127.0.0.1"]}},e.p=2,e.n=3,chrome.declarativeNetRequest.getDynamicRules();case 3:if(i=e.v,!((a=i.map(function(e){return e.id})).length>0)){e.n=4;break}return e.n=4,chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:a});case 4:return e.n=5,chrome.declarativeNetRequest.updateDynamicRules({addRules:[].concat(ot(n),[r])});case 5:console.log("✅ Focus mode blocking rules activated:",n.length,"educational domains allowed"),e.n=7;break;case 6:return e.p=6,o=e.v,console.error("❌ Error setting up declarativeNetRequest rules:",o),e.n=7,this.enableWebNavigationBlocking();case 7:return e.a(2)}},e,this,[[2,6]])})),function(){return s.apply(this,arguments)})},{key:"enableWebNavigationBlocking",value:(o=gt(pt().m(function e(){return pt().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,chrome.storage.local.set({focus_mode_blocking_nav:!0});case 1:console.log("🎯 Using webNavigation fallback for blocking");case 2:return e.a(2)}},e)})),function(){return o.apply(this,arguments)})},{key:"getEducationalDomains",value:function(){return["edu","ac.uk","ac.in","edu.au","wikipedia.org","coursera.org","udemy.com","edx.org","khanacademy.org","mit.edu","stanford.edu","harvard.edu","arxiv.org","scholar.google.com","researchgate.net","stackoverflow.com","github.com","medium.com","dev.to","freecodecamp.org","w3schools.com","developer.mozilla.org","mdn.mozilla.org","docs.python.org","docs.oracle.com","docs.microsoft.com","learn.microsoft.com","cloud.google.com","aws.amazon.com","learn.jquery.com","vuejs.org","reactjs.org","angular.io","nodejs.org","leetcode.com","hackerrank.com","codewars.com","codecademy.com","udacity.com","pluralsight.com","lynda.com","linkedin.com/learning","skillshare.com","brilliant.org","duolingo.com","memrise.com","quizlet.com","sciencedirect.com","nature.com","science.org","jstor.org","springer.com","wiley.com","elsevier.com","ted.com","youtube.com/education","youtube.com/learning","notion.so","evernote.com","onenote.com","trello.com","asana.com","books.google.com","goodreads.com","readthedocs.io","readthedocs.org"]}},{key:"disableFocusModeBlocking",value:(a=gt(pt().m(function e(){var t,n,r;return pt().w(function(e){for(;;)switch(e.p=e.n){case 0:return console.log("✅ Focus mode blocking disabled"),e.n=1,chrome.storage.local.remove(["focus_mode_blocking","focus_mode_blocking_nav","blocked_sites_count"]);case 1:return this.focusModeBlockedTabs.clear(),e.p=2,e.n=3,chrome.declarativeNetRequest.getDynamicRules();case 3:if(t=e.v,!((n=t.map(function(e){return e.id})).length>0)){e.n=5;break}return e.n=4,chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:n});case 4:console.log("✅ Removed",n.length,"blocking rules");case 5:e.n=7;break;case 6:e.p=6,r=e.v,console.error("Error removing declarativeNetRequest rules:",r);case 7:return e.a(2)}},e,this,[[2,6]])})),function(){return a.apply(this,arguments)})},{key:"handleNavigation",value:(i=gt(pt().m(function e(t){var n,r;return pt().w(function(e){for(;;)switch(e.n){case 0:if(0===t.frameId){e.n=1;break}return e.a(2);case 1:return e.n=2,chrome.storage.local.get(["focus_mode_blocking"]);case 2:if(e.v.focus_mode_blocking){e.n=3;break}return e.a(2);case 3:if(!(n=t.url).startsWith("chrome://")&&!n.startsWith("chrome-extension://")){e.n=4;break}return e.a(2);case 4:this.isEducationalContent(n)||(console.log("🚫 Blocked non-educational URL during focus mode: ".concat(n)),this.focusModeBlockedTabs.add(t.tabId),r=this.createBlockPage(n),chrome.tabs.update(t.tabId,{url:"data:text/html;charset=utf-8,"+encodeURIComponent(r)}));case 5:return e.a(2)}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"isEducationalContent",value:function(e){var t=e.toLowerCase();return["edu","wikipedia.org","coursera.org","udemy.com","edx.org","khanacademy.org","mit.edu","stanford.edu","harvard.edu","arxiv.org","scholar.google.com","researchgate.net","stackoverflow.com","github.com","medium.com","dev.to","freecodecamp.org","w3schools.com","mdn.mozilla.org","docs.","tutorial","learn","course","education","academic","study","research","library","books.google","sciencedirect.com","nature.com","science.org","ted.com"].some(function(e){return t.includes(e)})}},{key:"createBlockPage",value:function(e){return'\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <meta charset="UTF-8">\n        <title>Focus Mode Active</title>\n        <style>\n          * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n          }\n          \n          body {\n            font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            min-height: 100vh;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            padding: 20px;\n          }\n          \n          .container {\n            background: white;\n            border-radius: 20px;\n            padding: 60px 40px;\n            max-width: 600px;\n            width: 100%;\n            text-align: center;\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n          }\n          \n          .icon {\n            font-size: 80px;\n            margin-bottom: 20px;\n            animation: pulse 2s ease-in-out infinite;\n          }\n          \n          @keyframes pulse {\n            0%, 100% { transform: scale(1); }\n            50% { transform: scale(1.1); }\n          }\n          \n          h1 {\n            color: #2d3748;\n            font-size: 32px;\n            margin-bottom: 16px;\n            font-weight: 700;\n          }\n          \n          .subtitle {\n            color: #718096;\n            font-size: 18px;\n            margin-bottom: 30px;\n            line-height: 1.6;\n          }\n          \n          .blocked-url {\n            background: #f7fafc;\n            border: 2px solid #e2e8f0;\n            border-radius: 8px;\n            padding: 16px;\n            margin: 20px 0;\n            word-break: break-all;\n            color: #4a5568;\n            font-family: monospace;\n            font-size: 14px;\n          }\n          \n          .reason {\n            background: #fff5f5;\n            border-left: 4px solid #f56565;\n            padding: 16px;\n            margin: 20px 0;\n            text-align: left;\n            border-radius: 4px;\n          }\n          \n          .reason-title {\n            font-weight: 600;\n            color: #c53030;\n            margin-bottom: 8px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n          }\n          \n          .reason-text {\n            color: #742a2a;\n            font-size: 14px;\n            line-height: 1.6;\n          }\n          \n          .tips {\n            background: #f0fff4;\n            border-left: 4px solid #48bb78;\n            padding: 20px;\n            margin: 20px 0;\n            text-align: left;\n            border-radius: 4px;\n          }\n          \n          .tips-title {\n            font-weight: 600;\n            color: #2f855a;\n            margin-bottom: 12px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n          }\n          \n          .tips ul {\n            list-style: none;\n            padding-left: 0;\n          }\n          \n          .tips li {\n            color: #276749;\n            font-size: 14px;\n            line-height: 1.8;\n            padding-left: 24px;\n            position: relative;\n          }\n          \n          .tips li:before {\n            content: "✓";\n            position: absolute;\n            left: 0;\n            color: #48bb78;\n            font-weight: bold;\n          }\n          \n          .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 30px;\n            flex-wrap: wrap;\n            justify-content: center;\n          }\n          \n          .btn {\n            padding: 14px 28px;\n            border: none;\n            border-radius: 8px;\n            font-size: 16px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            text-decoration: none;\n            display: inline-block;\n          }\n          \n          .btn-primary {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n          }\n          \n          .btn-primary:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);\n          }\n          \n          .btn-secondary {\n            background: #e2e8f0;\n            color: #2d3748;\n          }\n          \n          .btn-secondary:hover {\n            background: #cbd5e0;\n          }\n          \n          .timer {\n            margin-top: 20px;\n            padding: 16px;\n            background: #edf2f7;\n            border-radius: 8px;\n            color: #4a5568;\n            font-weight: 600;\n          }\n        </style>\n      </head>\n      <body>\n        <div class="container">\n          <div class="icon">🎯</div>\n          <h1>Focus Mode is Active</h1>\n          <p class="subtitle">Stay on track with your learning goals!</p>\n          \n          <div class="blocked-url">\n            <strong>Blocked URL:</strong><br>\n            '.concat(e,'\n          </div>\n          \n          <div class="reason">\n            <div class="reason-title">\n              <span>⚠️</span>\n              <span>Why was this blocked?</span>\n            </div>\n            <div class="reason-text">\n              This website doesn\'t appear to be educational content. During focus mode, \n              only educational resources are accessible to help you stay focused on learning.\n            </div>\n          </div>\n          \n          <div class="tips">\n            <div class="tips-title">\n              <span>💡</span>\n              <span>Allowed Educational Sites</span>\n            </div>\n            <ul>\n              <li>Educational institutions (.edu domains)</li>\n              <li>Learning platforms (Coursera, Udemy, Khan Academy, etc.)</li>\n              <li>Documentation sites (MDN, W3Schools, official docs)</li>\n              <li>Research platforms (Wikipedia, arXiv, Google Scholar)</li>\n              <li>Developer communities (Stack Overflow, GitHub)</li>\n              <li>Tutorial sites (freeCodeCamp, TED, Medium educational content)</li>\n            </ul>\n          </div>\n          \n          <div class="timer" id="timer">\n            Focus session in progress...\n          </div>\n          \n          <div class="actions">\n            <button class="btn btn-primary" onclick="window.history.back()">\n              ← Go Back\n            </button>\n            <button class="btn btn-secondary" onclick="window.close()">\n              Close Tab\n            </button>\n          </div>\n        </div>\n        \n        <script>\n          // Update timer with remaining focus time\n          chrome.storage.local.get([\'focus_mode\'], (result) => {\n            if (result.focus_mode) {\n              const remaining = result.focus_mode.endTime - Date.now();\n              const minutes = Math.floor(remaining / 60000);\n              document.getElementById(\'timer\').textContent = \n                `Focus session ends in ${minutes} minutes`;\n            }\n          });\n        <\/script>\n      </body>\n      </html>\n    ')}},{key:"handleFocusModeEnd",value:(r=gt(pt().m(function e(){return pt().w(function(e){for(;;)switch(e.n){case 0:return console.log("⏰ Focus mode timer ended"),e.n=1,this.mindfulness.deactivateFocusMode();case 1:return e.n=2,this.disableFocusModeBlocking();case 2:chrome.notifications.create({type:"basic",iconUrl:"icon.png",title:"Focus Session Complete!",message:"Great work! You completed your focus session. Time for a break! 🎉",priority:2});case 3:return e.a(2)}},e,this)})),function(){return r.apply(this,arguments)})},{key:"getMoodSentiment",value:function(e){return{energized:"positive",happy:"positive",calm:"positive",neutral:"neutral",tired:"neutral",stressed:"negative",frustrated:"negative"}[e]||"neutral"}},{key:"getMoodScore",value:function(e){return{energized:.8,happy:.7,calm:.6,neutral:0,tired:-.3,stressed:-.6,frustrated:-.7}[e]||0}}],t&&vt(e.prototype,t),n&&vt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,i,a,o,s,u,c,l,f,h,p,m,d,g,b,y,E,w,T,_,k,S,O,A,R,I}())})()})();