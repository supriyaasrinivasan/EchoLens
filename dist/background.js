/*! For license information please see background.js.LICENSE.txt */
(()=>{var t={234:()=>{},490:()=>{},826:(t,e,r)=>{t=r.nmd(t);var n=void 0,i=function(e){return n||(n=new Promise(function(n,i){var a,s=void 0!==e?e:{},o=s.onAbort;s.onAbort=function(t){i(new Error(t)),o&&o(t)},s.postRun=s.postRun||[],s.postRun.push(function(){n(s)}),t=void 0,a||=void 0!==s?s:{};var u="object"==typeof window,c="undefined"!=typeof WorkerGlobalScope,l="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node&&"renderer"!=process.type;a.onRuntimeInitialized=function(){function t(t,e){switch(typeof e){case"boolean":$(t,e?1:0);break;case"number":H(t,e);break;case"string":z(t,e,-1,-1);break;case"object":if(null===e)G(t);else if(null!=e.length){var r=ye(e,ge);B(t,r,e.length,-1),Se(r)}else J(t,"Wrong API use : tried to return a value of an unknown type ("+e+").",-1);break;default:G(t)}}function e(t,e){for(var r=[],n=0;n<t;n+=1){var i=V(e+4*n,"i32"),a=F(i);if(1===a||2===a)i=W(i);else if(3===a)i=P(i);else if(4===a){i=x(a=i),a=j(a);for(var s=new Uint8Array(i),o=0;o<i;o+=1)s[o]=E[a+o];i=s}else i=null;r.push(i)}return r}function r(t,e){this.Qa=t,this.db=e,this.Oa=1,this.lb=[]}function n(t,e){if(this.db=e,e=rt(t)+1,this.eb=Oe(e),null===this.eb)throw Error("Unable to allocate memory for the SQL string");nt(t,T,this.eb,e),this.kb=this.eb,this.Za=this.pb=null}function i(t){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),null!=t){var e=this.filename,r="/",n=e;if(r&&(r="string"==typeof r?r:Nt(r),n=e?K(r+"/"+e):r),n=function(t,e=438){return Wt(t,4095&e|32768,0)}(n,e=ht(!0,!0)),t){if("string"==typeof t){r=Array(t.length);for(var i=0,a=t.length;i<a;++i)r[i]=t.charCodeAt(i);t=r}Yt(n,146|e),ee(r=Kt(n,577),t,0,t.length,0),Jt(r),Yt(n,e)}}this.handleError(u(this.filename,s)),this.db=V(s,"i32"),tt(this.db),this.fb={},this.Sa={}}var s=Ie(4),o=a.cwrap,u=o("sqlite3_open","number",["string","number"]),c=o("sqlite3_close_v2","number",["number"]),l=o("sqlite3_exec","number",["number","string","number","number","number"]),h=o("sqlite3_changes","number",["number"]),f=o("sqlite3_prepare_v2","number",["number","string","number","number","number"]),p=o("sqlite3_sql","string",["number"]),b=o("sqlite3_normalized_sql","string",["number"]),d=o("sqlite3_prepare_v2","number",["number","number","number","number","number"]),m=o("sqlite3_bind_text","number",["number","number","number","number","number"]),v=o("sqlite3_bind_blob","number",["number","number","number","number","number"]),g=o("sqlite3_bind_double","number",["number","number","number"]),y=o("sqlite3_bind_int","number",["number","number","number"]),w=o("sqlite3_bind_parameter_index","number",["number","string"]),_=o("sqlite3_step","number",["number"]),N=o("sqlite3_errmsg","string",["number"]),O=o("sqlite3_column_count","number",["number"]),S=o("sqlite3_data_count","number",["number"]),k=o("sqlite3_column_double","number",["number","number"]),A=o("sqlite3_column_text","string",["number","number"]),R=o("sqlite3_column_blob","number",["number","number"]),I=o("sqlite3_column_bytes","number",["number","number"]),L=o("sqlite3_column_type","number",["number","number"]),q=o("sqlite3_column_name","string",["number","number"]),M=o("sqlite3_reset","number",["number"]),C=o("sqlite3_clear_bindings","number",["number"]),D=o("sqlite3_finalize","number",["number"]),U=o("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),F=o("sqlite3_value_type","number",["number"]),x=o("sqlite3_value_bytes","number",["number"]),P=o("sqlite3_value_text","string",["number"]),j=o("sqlite3_value_blob","number",["number"]),W=o("sqlite3_value_double","number",["number"]),H=o("sqlite3_result_double","",["number","number"]),G=o("sqlite3_result_null","",["number"]),z=o("sqlite3_result_text","",["number","string","number","number"]),B=o("sqlite3_result_blob","",["number","number","number","number"]),$=o("sqlite3_result_int","",["number","number"]),J=o("sqlite3_result_error","",["number","string","number"]),Z=o("sqlite3_aggregate_context","number",["number","number"]),tt=o("RegisterExtensionFunctions","number",["number"]),et=o("sqlite3_update_hook","number",["number","number","number"]);r.prototype.bind=function(t){if(!this.Qa)throw"Statement closed";return this.reset(),Array.isArray(t)?this.Cb(t):null==t||"object"!=typeof t||this.Db(t)},r.prototype.step=function(){if(!this.Qa)throw"Statement closed";this.Oa=1;var t=_(this.Qa);switch(t){case 100:return!0;case 101:return!1;default:throw this.db.handleError(t)}},r.prototype.wb=function(t){return null==t&&(t=this.Oa,this.Oa+=1),k(this.Qa,t)},r.prototype.Gb=function(t){if(null==t&&(t=this.Oa,this.Oa+=1),t=A(this.Qa,t),"function"!=typeof BigInt)throw Error("BigInt is not supported");return BigInt(t)},r.prototype.Hb=function(t){return null==t&&(t=this.Oa,this.Oa+=1),A(this.Qa,t)},r.prototype.getBlob=function(t){null==t&&(t=this.Oa,this.Oa+=1);var e=I(this.Qa,t);t=R(this.Qa,t);for(var r=new Uint8Array(e),n=0;n<e;n+=1)r[n]=E[t+n];return r},r.prototype.get=function(t,e){e=e||{},null!=t&&this.bind(t)&&this.step(),t=[];for(var r=S(this.Qa),n=0;n<r;n+=1)switch(L(this.Qa,n)){case 1:var i=e.useBigInt?this.Gb(n):this.wb(n);t.push(i);break;case 2:t.push(this.wb(n));break;case 3:t.push(this.Hb(n));break;case 4:t.push(this.getBlob(n));break;default:t.push(null)}return t},r.prototype.getColumnNames=function(){for(var t=[],e=O(this.Qa),r=0;r<e;r+=1)t.push(q(this.Qa,r));return t},r.prototype.getAsObject=function(t,e){t=this.get(t,e),e=this.getColumnNames();for(var r={},n=0;n<e.length;n+=1)r[e[n]]=t[n];return r},r.prototype.getSQL=function(){return p(this.Qa)},r.prototype.getNormalizedSQL=function(){return b(this.Qa)},r.prototype.run=function(t){return null!=t&&this.bind(t),this.step(),this.reset()},r.prototype.sb=function(t,e){null==e&&(e=this.Oa,this.Oa+=1),t=it(t);var r=ye(t,ge);this.lb.push(r),this.db.handleError(m(this.Qa,e,r,t.length-1,0))},r.prototype.Bb=function(t,e){null==e&&(e=this.Oa,this.Oa+=1);var r=ye(t,ge);this.lb.push(r),this.db.handleError(v(this.Qa,e,r,t.length,0))},r.prototype.rb=function(t,e){null==e&&(e=this.Oa,this.Oa+=1),this.db.handleError((t===(0|t)?y:g)(this.Qa,e,t))},r.prototype.Eb=function(t){null==t&&(t=this.Oa,this.Oa+=1),v(this.Qa,t,0,0,0)},r.prototype.tb=function(t,e){switch(null==e&&(e=this.Oa,this.Oa+=1),typeof t){case"string":return void this.sb(t,e);case"number":return void this.rb(t,e);case"bigint":return void this.sb(t.toString(),e);case"boolean":return void this.rb(t+0,e);case"object":if(null===t)return void this.Eb(e);if(null!=t.length)return void this.Bb(t,e)}throw"Wrong API use : tried to bind a value of an unknown type ("+t+")."},r.prototype.Db=function(t){var e=this;return Object.keys(t).forEach(function(r){var n=w(e.Qa,r);0!==n&&e.tb(t[r],n)}),!0},r.prototype.Cb=function(t){for(var e=0;e<t.length;e+=1)this.tb(t[e],e+1);return!0},r.prototype.reset=function(){return this.freemem(),0===C(this.Qa)&&0===M(this.Qa)},r.prototype.freemem=function(){for(var t;void 0!==(t=this.lb.pop());)Se(t)},r.prototype.free=function(){this.freemem();var t=0===D(this.Qa);return delete this.db.fb[this.Qa],this.Qa=0,t},n.prototype.next=function(){if(null===this.eb)return{done:!0};if(null!==this.Za&&(this.Za.free(),this.Za=null),!this.db.db)throw this.mb(),Error("Database closed");var t=Le(),e=Ie(4);X(s),X(e);try{this.db.handleError(d(this.db.db,this.kb,-1,s,e)),this.kb=V(e,"i32");var n=V(s,"i32");return 0===n?(this.mb(),{done:!0}):(this.Za=new r(n,this.db),this.db.fb[n]=this.Za,{value:this.Za,done:!1})}catch(t){throw this.pb=Y(this.kb),this.mb(),t}finally{Re(t)}},n.prototype.mb=function(){Se(this.eb),this.eb=null},n.prototype.getRemainingSQL=function(){return null!==this.pb?this.pb:Y(this.kb)},"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator&&(n.prototype[Symbol.iterator]=function(){return this}),i.prototype.run=function(t,e){if(!this.db)throw"Database closed";if(e){t=this.prepare(t,e);try{t.step()}finally{t.free()}}else this.handleError(l(this.db,t,0,0,s));return this},i.prototype.exec=function(t,e,n){if(!this.db)throw"Database closed";var i=Le(),a=null;try{var o=ve(t),u=Ie(4);for(t=[];0!==V(o,"i8");){X(s),X(u),this.handleError(d(this.db,o,-1,s,u));var c=V(s,"i32");if(o=V(u,"i32"),0!==c){var l=null;for(a=new r(c,this),null!=e&&a.bind(e);a.step();)null===l&&(l={columns:a.getColumnNames(),values:[]},t.push(l)),l.values.push(a.get(null,n));a.free()}}return t}catch(t){throw a&&a.free(),t}finally{Re(i)}},i.prototype.each=function(t,e,r,n,i){"function"==typeof e&&(n=r,r=e,e=void 0),t=this.prepare(t,e);try{for(;t.step();)r(t.getAsObject(null,i))}finally{t.free()}if("function"==typeof n)return n()},i.prototype.prepare=function(t,e){if(X(s),this.handleError(f(this.db,t,-1,s,0)),0===(t=V(s,"i32")))throw"Nothing to prepare";var n=new r(t,this);return null!=e&&n.bind(e),this.fb[t]=n},i.prototype.iterateStatements=function(t){return new n(t,this)},i.prototype.export=function(){Object.values(this.fb).forEach(function(t){t.free()}),Object.values(this.Sa).forEach(_e),this.Sa={},this.handleError(c(this.db));var t=function(t){var e,r="binary";if("utf8"!==r&&"binary"!==r)throw Error(`Invalid encoding type "${r}"`);var n=Kt(t,n||0);t=Bt(t).size;var i=new Uint8Array(t);return te(n,i,0,t,0),"utf8"===r?e=Q(i):"binary"===r&&(e=i),Jt(n),e}(this.filename);return this.handleError(u(this.filename,s)),this.db=V(s,"i32"),tt(this.db),t},i.prototype.close=function(){null!==this.db&&(Object.values(this.fb).forEach(function(t){t.free()}),Object.values(this.Sa).forEach(_e),this.Sa={},this.Ya&&(_e(this.Ya),this.Ya=void 0),this.handleError(c(this.db)),Xt("/"+this.filename),this.db=null)},i.prototype.handleError=function(t){if(0===t)return null;throw t=N(this.db),Error(t)},i.prototype.getRowsModified=function(){return h(this.db)},i.prototype.create_function=function(r,n){Object.prototype.hasOwnProperty.call(this.Sa,r)&&(_e(this.Sa[r]),delete this.Sa[r]);var i=Ee(function(r,i,a){i=e(i,a);try{var s=n.apply(null,i)}catch(t){return void J(r,t,-1)}t(r,s)},"viii");return this.Sa[r]=i,this.handleError(U(this.db,r,n.length,1,0,i,0,0,0)),this},i.prototype.create_aggregate=function(r,n){var i=n.init||function(){return null},a=n.finalize||function(t){return t},s=n.step;if(!s)throw"An aggregate function must have a step function in "+r;var o={};Object.hasOwnProperty.call(this.Sa,r)&&(_e(this.Sa[r]),delete this.Sa[r]),n=r+"__finalize",Object.hasOwnProperty.call(this.Sa,n)&&(_e(this.Sa[n]),delete this.Sa[n]);var u=Ee(function(t,r,n){var a=Z(t,1);Object.hasOwnProperty.call(o,a)||(o[a]=i()),r=e(r,n),r=[o[a]].concat(r);try{o[a]=s.apply(null,r)}catch(e){delete o[a],J(t,e,-1)}},"viii"),c=Ee(function(e){var r=Z(e,1);try{var n=a(o[r])}catch(t){return delete o[r],void J(e,t,-1)}t(e,n),delete o[r]},"vi");return this.Sa[r]=u,this.Sa[n]=c,this.handleError(U(this.db,r,s.length-1,1,0,0,u,c,0)),this},i.prototype.updateHook=function(t){this.Ya&&(et(this.db,0,0),_e(this.Ya),this.Ya=void 0),t&&(this.Ya=Ee(function(e,r,n,i,a){switch(r){case 18:e="insert";break;case 23:e="update";break;case 9:e="delete";break;default:throw"unknown operationCode in updateHook callback: "+r}if(n=n?Q(T,n):"",i=i?Q(T,i):"",a>Number.MAX_SAFE_INTEGER)throw"rowId too big to fit inside a Number";t(e,n,i,Number(a))},"viiiij"),et(this.db,this.Ya,0))},a.Database=i};var h,f,p={...a},b="./this.program",d=(t,e)=>{throw e},m="";if(l){var v=r(490);r(234),m="//",f=t=>(t=q(t)?new URL(t):t,v.readFileSync(t)),h=async t=>(t=q(t)?new URL(t):t,v.readFileSync(t,void 0)),!a.thisProgram&&1<process.argv.length&&(b=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),t.exports=a,d=(t,e)=>{throw process.exitCode=t,e}}else(u||c)&&(c?m=self.location.href:"undefined"!=typeof document&&document.currentScript&&(m=document.currentScript.src),m=m.startsWith("blob:")?"":m.slice(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1),c&&(f=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),h=async t=>{if(q(t))return new Promise((e,r)=>{var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?e(n.response):r(n.status)},n.onerror=r,n.send(null)});var e=await fetch(t,{credentials:"same-origin"});if(e.ok)return e.arrayBuffer();throw Error(e.status+" : "+e.url)});var g=a.print||console.log.bind(console),y=a.printErr||console.error.bind(console);Object.assign(a,p),p=null,a.thisProgram&&(b=a.thisProgram);var w,_,E,T,N,O,S,k,A,R,I=a.wasmBinary,L=!1,q=t=>t.startsWith("file://");function M(){var t=w.buffer;a.HEAP8=E=new Int8Array(t),a.HEAP16=N=new Int16Array(t),a.HEAPU8=T=new Uint8Array(t),a.HEAPU16=new Uint16Array(t),a.HEAP32=O=new Int32Array(t),a.HEAPU32=S=new Uint32Array(t),a.HEAPF32=k=new Float32Array(t),a.HEAPF64=R=new Float64Array(t),a.HEAP64=A=new BigInt64Array(t),a.HEAPU64=new BigUint64Array(t)}var C,D=0,U=null;function F(t){throw a.onAbort?.(t),y(t="Aborted("+t+")"),L=!0,new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info.")}async function x(t,e){try{var r=await async function(t){if(!I)try{var e=await h(t);return new Uint8Array(e)}catch{}if(t==C&&I)t=new Uint8Array(I);else{if(!f)throw"both async and sync fetching of the wasm failed";t=f(t)}return t}(t);return await WebAssembly.instantiate(r,e)}catch(t){y(`failed to asynchronously prepare wasm: ${t}`),F(t)}}class P{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var j=t=>{for(;0<t.length;)t.shift()(a)},W=[],H=[],G=()=>{var t=a.preRun.shift();H.unshift(t)};function V(t,e="i8"){switch(e.endsWith("*")&&(e="*"),e){case"i1":case"i8":return E[t];case"i16":return N[t>>1];case"i32":return O[t>>2];case"i64":return A[t>>3];case"float":return k[t>>2];case"double":return R[t>>3];case"*":return S[t>>2];default:F(`invalid type for getValue: ${e}`)}}var z=a.noExitRuntime||!0;function X(t){var e="i32";switch(e.endsWith("*")&&(e="*"),e){case"i1":case"i8":E[t]=0;break;case"i16":N[t>>1]=0;break;case"i32":O[t>>2]=0;break;case"i64":A[t>>3]=BigInt(0);break;case"float":k[t>>2]=0;break;case"double":R[t>>3]=0;break;case"*":S[t>>2]=0;break;default:F(`invalid type for setValue: ${e}`)}}var B="undefined"!=typeof TextDecoder?new TextDecoder:void 0,Q=(t,e=0,r=NaN)=>{var n=e+r;for(r=e;t[r]&&!(r>=n);)++r;if(16<r-e&&t.buffer&&B)return B.decode(t.subarray(e,r));for(n="";e<r;){var i=t[e++];if(128&i){var a=63&t[e++];if(192==(224&i))n+=String.fromCharCode((31&i)<<6|a);else{var s=63&t[e++];65536>(i=224==(240&i)?(15&i)<<12|a<<6|s:(7&i)<<18|a<<12|s<<6|63&t[e++])?n+=String.fromCharCode(i):(i-=65536,n+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else n+=String.fromCharCode(i)}return n},Y=(t,e)=>t?Q(T,t,e):"",$=(t,e)=>{for(var r=0,n=t.length-1;0<=n;n--){var i=t[n];"."===i?t.splice(n,1):".."===i?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r;r--)t.unshift("..");return t},K=t=>{var e="/"===t.charAt(0),r="/"===t.slice(-1);return(t=$(t.split("/").filter(t=>!!t),!e).join("/"))||e||(t="."),t&&r&&(t+="/"),(e?"/":"")+t},J=t=>{var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(t).slice(1);return t=e[0],e=e[1],t||e?(e&&=e.slice(0,-1),t+e):"."},Z=t=>t&&t.match(/([^\/]+|\/)\/*$/)[1],tt=t=>{(tt=(()=>{if(l){var t=r(920);return e=>t.randomFillSync(e)}return t=>crypto.getRandomValues(t)})())(t)},et=[],rt=t=>{for(var e=0,r=0;r<t.length;++r){var n=t.charCodeAt(r);127>=n?e++:2047>=n?e+=2:55296<=n&&57343>=n?(e+=4,++r):e+=3}return e},nt=(t,e,r,n)=>{if(!(0<n))return 0;var i=r;n=r+n-1;for(var a=0;a<t.length;++a){var s=t.charCodeAt(a);if(55296<=s&&57343>=s)s=65536+((1023&s)<<10)|1023&t.charCodeAt(++a);if(127>=s){if(r>=n)break;e[r++]=s}else{if(2047>=s){if(r+1>=n)break;e[r++]=192|s>>6}else{if(65535>=s){if(r+2>=n)break;e[r++]=224|s>>12}else{if(r+3>=n)break;e[r++]=240|s>>18,e[r++]=128|s>>12&63}e[r++]=128|s>>6&63}e[r++]=128|63&s}}return e[r]=0,r-i},it=(t,e)=>{var r=Array(rt(t)+1);return t=nt(t,r,0,r.length),e&&(r.length=t),r},at=[];function st(t,e){at[t]={input:[],output:[],cb:e},Pt(t,ot)}var ot={open(t){var e=at[t.node.rdev];if(!e)throw new wt(43);t.tty=e,t.seekable=!1},close(t){t.tty.cb.fsync(t.tty)},fsync(t){t.tty.cb.fsync(t.tty)},read(t,e,r,n){if(!t.tty||!t.tty.cb.xb)throw new wt(60);for(var i=0,a=0;a<n;a++){try{var s=t.tty.cb.xb(t.tty)}catch(t){throw new wt(29)}if(void 0===s&&0===i)throw new wt(6);if(null==s)break;i++,e[r+a]=s}return i&&(t.node.atime=Date.now()),i},write(t,e,r,n){if(!t.tty||!t.tty.cb.qb)throw new wt(60);try{for(var i=0;i<n;i++)t.tty.cb.qb(t.tty,e[r+i])}catch(t){throw new wt(29)}return n&&(t.node.mtime=t.node.ctime=Date.now()),i}},ut={xb(){t:{if(!et.length){var t=null;if(l){var e=Buffer.alloc(256),r=0,n=process.stdin.fd;try{r=v.readSync(n,e,0,256)}catch(t){if(!t.toString().includes("EOF"))throw t;r=0}0<r&&(t=e.slice(0,r).toString("utf-8"))}else"undefined"!=typeof window&&"function"==typeof window.prompt&&(null!==(t=window.prompt("Input: "))&&(t+="\n"));if(!t){t=null;break t}et=it(t,!0)}t=et.shift()}return t},qb(t,e){null===e||10===e?(g(Q(t.output)),t.output=[]):0!=e&&t.output.push(e)},fsync(t){0<t.output?.length&&(g(Q(t.output)),t.output=[])},Tb:()=>({Ob:25856,Qb:5,Nb:191,Pb:35387,Mb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}),Ub:()=>0,Vb:()=>[24,80]},ct={qb(t,e){null===e||10===e?(y(Q(t.output)),t.output=[]):0!=e&&t.output.push(e)},fsync(t){0<t.output?.length&&(y(Q(t.output)),t.output=[])}},lt={Wa:null,Xa:()=>lt.createNode(null,"/",16895,0),createNode(t,e,r,n){if(24576==(61440&r)||4096==(61440&r))throw new wt(63);return lt.Wa||(lt.Wa={dir:{node:{Ta:lt.La.Ta,Ua:lt.La.Ua,lookup:lt.La.lookup,hb:lt.La.hb,rename:lt.La.rename,unlink:lt.La.unlink,rmdir:lt.La.rmdir,readdir:lt.La.readdir,symlink:lt.La.symlink},stream:{Va:lt.Ma.Va}},file:{node:{Ta:lt.La.Ta,Ua:lt.La.Ua},stream:{Va:lt.Ma.Va,read:lt.Ma.read,write:lt.Ma.write,ib:lt.Ma.ib,jb:lt.Ma.jb}},link:{node:{Ta:lt.La.Ta,Ua:lt.La.Ua,readlink:lt.La.readlink},stream:{}},ub:{node:{Ta:lt.La.Ta,Ua:lt.La.Ua},stream:xt}}),Rt((r=At(t,e,r,n)).mode)?(r.La=lt.Wa.dir.node,r.Ma=lt.Wa.dir.stream,r.Na={}):32768==(61440&r.mode)?(r.La=lt.Wa.file.node,r.Ma=lt.Wa.file.stream,r.Ra=0,r.Na=null):40960==(61440&r.mode)?(r.La=lt.Wa.link.node,r.Ma=lt.Wa.link.stream):8192==(61440&r.mode)&&(r.La=lt.Wa.ub.node,r.Ma=lt.Wa.ub.stream),r.atime=r.mtime=r.ctime=Date.now(),t&&(t.Na[e]=r,t.atime=t.mtime=t.ctime=r.atime),r},Sb:t=>t.Na?t.Na.subarray?t.Na.subarray(0,t.Ra):new Uint8Array(t.Na):new Uint8Array(0),La:{Ta(t){var e={};return e.dev=8192==(61440&t.mode)?t.id:1,e.ino=t.id,e.mode=t.mode,e.nlink=1,e.uid=0,e.gid=0,e.rdev=t.rdev,Rt(t.mode)?e.size=4096:32768==(61440&t.mode)?e.size=t.Ra:40960==(61440&t.mode)?e.size=t.link.length:e.size=0,e.atime=new Date(t.atime),e.mtime=new Date(t.mtime),e.ctime=new Date(t.ctime),e.blksize=4096,e.blocks=Math.ceil(e.size/e.blksize),e},Ua(t,e){for(var r of["mode","atime","mtime","ctime"])null!=e[r]&&(t[r]=e[r]);void 0!==e.size&&(e=e.size,t.Ra!=e&&(0==e?(t.Na=null,t.Ra=0):(r=t.Na,t.Na=new Uint8Array(e),r&&t.Na.set(r.subarray(0,Math.min(e,t.Ra))),t.Ra=e)))},lookup(){throw lt.vb},hb:(t,e,r,n)=>lt.createNode(t,e,r,n),rename(t,e,r){try{var n=kt(e,r)}catch(t){}if(n){if(Rt(t.mode))for(var i in n.Na)throw new wt(55);St(n)}delete t.parent.Na[t.name],e.Na[r]=t,t.name=r,e.ctime=e.mtime=t.parent.ctime=t.parent.mtime=Date.now()},unlink(t,e){delete t.Na[e],t.ctime=t.mtime=Date.now()},rmdir(t,e){var r,n=kt(t,e);for(r in n.Na)throw new wt(55);delete t.Na[e],t.ctime=t.mtime=Date.now()},readdir:t=>[".","..",...Object.keys(t.Na)],symlink:(t,e,r)=>((t=lt.createNode(t,e,41471,0)).link=r,t),readlink(t){if(40960!=(61440&t.mode))throw new wt(28);return t.link}},Ma:{read(t,e,r,n,i){var a=t.node.Na;if(i>=t.node.Ra)return 0;if(8<(t=Math.min(t.node.Ra-i,n))&&a.subarray)e.set(a.subarray(i,i+t),r);else for(n=0;n<t;n++)e[r+n]=a[i+n];return t},write(t,e,r,n,i,a){if(e.buffer===E.buffer&&(a=!1),!n)return 0;if((t=t.node).mtime=t.ctime=Date.now(),e.subarray&&(!t.Na||t.Na.subarray)){if(a)return t.Na=e.subarray(r,r+n),t.Ra=n;if(0===t.Ra&&0===i)return t.Na=e.slice(r,r+n),t.Ra=n;if(i+n<=t.Ra)return t.Na.set(e.subarray(r,r+n),i),n}a=i+n;var s=t.Na?t.Na.length:0;if(s>=a||(a=Math.max(a,s*(1048576>s?2:1.125)>>>0),0!=s&&(a=Math.max(a,256)),s=t.Na,t.Na=new Uint8Array(a),0<t.Ra&&t.Na.set(s.subarray(0,t.Ra),0)),t.Na.subarray&&e.subarray)t.Na.set(e.subarray(r,r+n),i);else for(a=0;a<n;a++)t.Na[i+a]=e[r+a];return t.Ra=Math.max(t.Ra,i+n),n},Va(t,e,r){if(1===r?e+=t.position:2===r&&32768==(61440&t.node.mode)&&(e+=t.node.Ra),0>e)throw new wt(28);return e},ib(t,e,r,n,i){if(32768!=(61440&t.node.mode))throw new wt(43);if(t=t.node.Na,2&i||!t||t.buffer!==E.buffer){i=!0,n=65536*Math.ceil(e/65536);var a=ke(65536,n);if(a&&T.fill(0,a,a+n),!(n=a))throw new wt(48);t&&((0<r||r+e<t.length)&&(t=t.subarray?t.subarray(r,r+e):Array.prototype.slice.call(t,r,r+e)),E.set(t,n))}else i=!1,n=t.byteOffset;return{Kb:n,Ab:i}},jb:(t,e,r,n)=>(lt.Ma.write(t,e,0,n,r,!1),0)}},ht=(t,e)=>{var r=0;return t&&(r|=365),e&&(r|=146),r},ft=null,pt={},bt=[],dt=1,mt=null,vt=!1,gt=!0,yt={},wt=class{name="ErrnoError";constructor(t){this.Pa=t}},_t=class{gb={};node=null;get flags(){return this.gb.flags}set flags(t){this.gb.flags=t}get position(){return this.gb.position}set position(t){this.gb.position=t}},Et=class{La={};Ma={};ab=null;constructor(t,e,r,n){t||=this,this.parent=t,this.Xa=t.Xa,this.id=dt++,this.name=e,this.mode=r,this.rdev=n,this.atime=this.mtime=this.ctime=Date.now()}get read(){return!(365&~this.mode)}set read(t){t?this.mode|=365:this.mode&=-366}get write(){return!(146&~this.mode)}set write(t){t?this.mode|=146:this.mode&=-147}};function Tt(t,e={}){if(!t)throw new wt(44);e.nb??(e.nb=!0),"/"===t.charAt(0)||(t="//"+t);var r=0;t:for(;40>r;r++){t=t.split("/").filter(t=>!!t);for(var n=ft,i="/",a=0;a<t.length;a++){var s=a===t.length-1;if(s&&e.parent)break;if("."!==t[a])if(".."===t[a])i=J(i),n=n.parent;else{i=K(i+"/"+t[a]);try{n=kt(n,t[a])}catch(t){if(44===t?.Pa&&s&&e.Jb)return{path:i};throw t}if(!n.ab||s&&!e.nb||(n=n.ab.root),40960==(61440&n.mode)&&(!s||e.$a)){if(!n.La.readlink)throw new wt(52);"/"===(n=n.La.readlink(n)).charAt(0)||(n=J(i)+"/"+n),t=n+"/"+t.slice(a+1).join("/");continue t}}}return{path:i,node:n}}throw new wt(32)}function Nt(t){for(var e;;){if(t===t.parent)return t=t.Xa.zb,e?"/"!==t[t.length-1]?`${t}/${e}`:t+e:t;e=e?`${t.name}/${e}`:t.name,t=t.parent}}function Ot(t,e){for(var r=0,n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n)|0;return(t+r>>>0)%mt.length}function St(t){var e=Ot(t.parent.id,t.name);if(mt[e]===t)mt[e]=t.bb;else for(e=mt[e];e;){if(e.bb===t){e.bb=t.bb;break}e=e.bb}}function kt(t,e){var r=Rt(t.mode)?(r=Lt(t,"x"))?r:t.La.lookup?0:2:54;if(r)throw new wt(r);for(r=mt[Ot(t.id,e)];r;r=r.bb){var n=r.name;if(r.parent.id===t.id&&n===e)return r}return t.La.lookup(t,e)}function At(t,e,r,n){return e=Ot((t=new Et(t,e,r,n)).parent.id,t.name),t.bb=mt[e],mt[e]=t}function Rt(t){return 16384==(61440&t)}function It(t){var e=["r","w","rw"][3&t];return 512&t&&(e+="w"),e}function Lt(t,e){return gt?0:!e.includes("r")||292&t.mode?e.includes("w")&&!(146&t.mode)||e.includes("x")&&!(73&t.mode)?2:0:2}function qt(t,e){if(!Rt(t.mode))return 54;try{return kt(t,e),20}catch(t){}return Lt(t,"wx")}function Mt(t,e,r){try{var n=kt(t,e)}catch(t){return t.Pa}if(t=Lt(t,"wx"))return t;if(r){if(!Rt(n.mode))return 54;if(n===n.parent||"/"===Nt(n))return 10}else if(Rt(n.mode))return 31;return 0}function Ct(t){if(!t)throw new wt(63);return t}function Dt(t){if(!(t=bt[t]))throw new wt(8);return t}function Ut(t,e=-1){if(t=Object.assign(new _t,t),-1==e)t:{for(e=0;4096>=e;e++)if(!bt[e])break t;throw new wt(33)}return t.fd=e,bt[e]=t}function Ft(t,e,r){var n=t?.Ma.Ua;t=n?t:e,n??=e.La.Ua,Ct(n),n(t,r)}var xt={open(t){t.Ma=pt[t.node.rdev].Ma,t.Ma.open?.(t)},Va(){throw new wt(70)}};function Pt(t,e){pt[t]={Ma:e}}function jt(t,e){var r="/"===e;if(r&&ft)throw new wt(10);if(!r&&e){var n=Tt(e,{nb:!1});if(e=n.path,(n=n.node).ab)throw new wt(10);if(!Rt(n.mode))throw new wt(54)}e={type:t,Wb:{},zb:e,Ib:[]},(t=t.Xa(e)).Xa=e,e.root=t,r?ft=t:n&&(n.ab=e,n.Xa&&n.Xa.Ib.push(e))}function Wt(t,e,r){var n=Tt(t,{parent:!0}).node;if(!(t=Z(t)))throw new wt(28);if("."===t||".."===t)throw new wt(20);var i=qt(n,t);if(i)throw new wt(i);if(!n.La.hb)throw new wt(63);return n.La.hb(n,t,e,r)}function Ht(t,e=511){return Wt(t,1023&e|16384,0)}function Gt(t,e,r){void 0===r&&(r=e,e=438),Wt(t,8192|e,r)}function Vt(t,e){if(!((...t)=>{for(var e="",r=!1,n=t.length-1;-1<=n&&!r;n--){if("string"!=typeof(r=0<=n?t[n]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!r)return"";e=r+"/"+e,r="/"===r.charAt(0)}return(r?"/":"")+(e=$(e.split("/").filter(t=>!!t),!r).join("/"))||"."})(t))throw new wt(44);var r=Tt(e,{parent:!0}).node;if(!r)throw new wt(44);var n=qt(r,e=Z(e));if(n)throw new wt(n);if(!r.La.symlink)throw new wt(63);r.La.symlink(r,e,t)}function zt(t){var e=Tt(t,{parent:!0}).node,r=kt(e,t=Z(t)),n=Mt(e,t,!0);if(n)throw new wt(n);if(!e.La.rmdir)throw new wt(63);if(r.ab)throw new wt(10);e.La.rmdir(e,t),St(r)}function Xt(t){var e=Tt(t,{parent:!0}).node;if(!e)throw new wt(44);var r=kt(e,t=Z(t)),n=Mt(e,t,!1);if(n)throw new wt(n);if(!e.La.unlink)throw new wt(63);if(r.ab)throw new wt(10);e.La.unlink(e,t),St(r)}function Bt(t,e){return Ct((t=Tt(t,{$a:!e}).node).La.Ta)(t)}function Qt(t,e,r,n){Ft(t,e,{mode:4095&r|-4096&e.mode,ctime:Date.now(),Fb:n})}function Yt(t,e){Qt(null,t="string"==typeof t?Tt(t,{$a:!0}).node:t,e)}function $t(t,e,r){if(Rt(e.mode))throw new wt(31);if(32768!=(61440&e.mode))throw new wt(28);var n=Lt(e,"w");if(n)throw new wt(n);Ft(t,e,{size:r,timestamp:Date.now()})}function Kt(t,e,r=438){if(""===t)throw new wt(44);if("string"==typeof e){var n={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[e];if(void 0===n)throw Error(`Unknown file open mode: ${e}`);e=n}if(r=64&e?4095&r|32768:0,"object"==typeof t)n=t;else{var i=t.endsWith("/");n=(t=Tt(t,{$a:!(131072&e),Jb:!0})).node,t=t.path}var s=!1;if(64&e)if(n){if(128&e)throw new wt(20)}else{if(i)throw new wt(31);n=Wt(t,511|r,0),s=!0}if(!n)throw new wt(44);if(8192==(61440&n.mode)&&(e&=-513),65536&e&&!Rt(n.mode))throw new wt(54);if(!s&&(i=n?40960==(61440&n.mode)?32:Rt(n.mode)&&("r"!==It(e)||576&e)?31:Lt(n,It(e)):44))throw new wt(i);return 512&e&&!s&&$t(null,i="string"==typeof(i=n)?Tt(i,{$a:!0}).node:i,0),e&=-131713,(i=Ut({node:n,path:Nt(n),flags:e,seekable:!0,position:0,Ma:n.Ma,Lb:[],error:!1})).Ma.open&&i.Ma.open(i),s&&Yt(n,511&r),!a.logReadFiles||1&e||t in yt||(yt[t]=1),i}function Jt(t){if(null===t.fd)throw new wt(8);t.ob&&(t.ob=null);try{t.Ma.close&&t.Ma.close(t)}catch(t){throw t}finally{bt[t.fd]=null}t.fd=null}function Zt(t,e,r){if(null===t.fd)throw new wt(8);if(!t.seekable||!t.Ma.Va)throw new wt(70);if(0!=r&&1!=r&&2!=r)throw new wt(28);t.position=t.Ma.Va(t,e,r),t.Lb=[]}function te(t,e,r,n,i){if(0>n||0>i)throw new wt(28);if(null===t.fd)throw new wt(8);if(1==(2097155&t.flags))throw new wt(8);if(Rt(t.node.mode))throw new wt(31);if(!t.Ma.read)throw new wt(28);var a=void 0!==i;if(a){if(!t.seekable)throw new wt(70)}else i=t.position;return e=t.Ma.read(t,e,r,n,i),a||(t.position+=e),e}function ee(t,e,r,n,i){if(0>n||0>i)throw new wt(28);if(null===t.fd)throw new wt(8);if(!(2097155&t.flags))throw new wt(8);if(Rt(t.node.mode))throw new wt(31);if(!t.Ma.write)throw new wt(28);t.seekable&&1024&t.flags&&Zt(t,0,2);var a=void 0!==i;if(a){if(!t.seekable)throw new wt(70)}else i=t.position;return e=t.Ma.write(t,e,r,n,i,void 0),a||(t.position+=e),e}function re(t,e,r){t=K("/dev/"+t);var n=ht(!!e,!!r);re.yb??(re.yb=64);var i=re.yb++<<8;Pt(i,{open(t){t.seekable=!1},close(){r?.buffer?.length&&r(10)},read(t,r,n,i){for(var a=0,s=0;s<i;s++){try{var o=e()}catch(t){throw new wt(29)}if(void 0===o&&0===a)throw new wt(6);if(null==o)break;a++,r[n+s]=o}return a&&(t.node.atime=Date.now()),a},write(t,e,n,i){for(var a=0;a<i;a++)try{r(e[n+a])}catch(t){throw new wt(29)}return i&&(t.node.mtime=t.node.ctime=Date.now()),a}}),Gt(t,n,i)}function ne(t,e,r){if("/"===e.charAt(0))return e;if(t=-100===t?"/":Dt(t).path,0==e.length){if(!r)throw new wt(44);return t}return t+"/"+e}function ie(t,e){O[t>>2]=e.dev,O[t+4>>2]=e.mode,S[t+8>>2]=e.nlink,O[t+12>>2]=e.uid,O[t+16>>2]=e.gid,O[t+20>>2]=e.rdev,A[t+24>>3]=BigInt(e.size),O[t+32>>2]=4096,O[t+36>>2]=e.blocks;var r=e.atime.getTime(),n=e.mtime.getTime(),i=e.ctime.getTime();return A[t+40>>3]=BigInt(Math.floor(r/1e3)),S[t+48>>2]=r%1e3*1e6,A[t+56>>3]=BigInt(Math.floor(n/1e3)),S[t+64>>2]=n%1e3*1e6,A[t+72>>3]=BigInt(Math.floor(i/1e3)),S[t+80>>2]=i%1e3*1e6,A[t+88>>3]=BigInt(e.ino),0}var ae,se,oe,ue=void 0,ce=()=>{var t=O[+ue>>2];return ue+=4,t},le=0,he=[0,31,60,91,121,152,182,213,244,274,305,335],fe=[0,31,59,90,120,151,181,212,243,273,304,334],pe={},be=t=>{_=t,z||0<le||(a.onExit?.(t),L=!0),d(t,new P(t))},de={},me=()=>{if(!ae){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:b||"./this.program"};for(t in de)void 0===de[t]?delete e[t]:e[t]=de[t];var r=[];for(t in e)r.push(`${t}=${e[t]}`);ae=r}return ae},ve=t=>{var e=rt(t)+1,r=Ie(e);return nt(t,T,r,e),r},ge=0,ye=(t,e)=>(e=1==e?Ie(t.length):Oe(t.length),t.subarray||t.slice||(t=new Uint8Array(t)),T.set(t,e),e),we=[],_e=t=>{se.delete(oe.get(t)),oe.set(t,null),we.push(t)},Ee=(t,e)=>{if(!se){se=new WeakMap;var r=oe.length;if(se)for(var n=0;n<0+r;n++){var i=oe.get(n);i&&se.set(i,n)}}if(r=se.get(t)||0)return r;if(we.length)r=we.pop();else{try{oe.grow(1)}catch(t){if(!(t instanceof RangeError))throw t;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}r=oe.length-1}try{oe.set(r,t)}catch(u){if(!(u instanceof TypeError))throw u;if("function"==typeof WebAssembly.Function){var a=WebAssembly.Function;n={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},i={parameters:[],results:"v"==e[0]?[]:[n[e[0]]]};for(var s=1;s<e.length;++s)i.parameters.push(n[e[s]]);e=new a(i,t)}else{n=[1],i=e.slice(0,1),e=e.slice(1),s={i:127,p:127,j:126,f:125,d:124,e:111},n.push(96);var o=e.length;for(a of(128>o?n.push(o):n.push(o%128|128,o>>7),e))n.push(s[a]);"v"==i?n.push(0):n.push(1,s[i]),e=[0,97,115,109,1,0,0,0,1],128>(a=n.length)?e.push(a):e.push(a%128|128,a>>7),e.push(...n),e.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),e=new WebAssembly.Module(new Uint8Array(e)),e=new WebAssembly.Instance(e,{e:{f:t}}).exports.f}oe.set(r,e)}return se.set(t,r),r};mt=Array(4096),jt(lt,"/"),Ht("/tmp"),Ht("/home"),Ht("/home/web_user"),function(){Ht("/dev"),Pt(259,{read:()=>0,write:(t,e,r,n)=>n,Va:()=>0}),Gt("/dev/null",259),st(1280,ut),st(1536,ct),Gt("/dev/tty",1280),Gt("/dev/tty1",1536);var t=new Uint8Array(1024),e=0,r=()=>(0===e&&(tt(t),e=t.byteLength),t[--e]);re("random",r),re("urandom",r),Ht("/dev/shm"),Ht("/dev/shm/tmp")}(),function(){Ht("/proc");var t=Ht("/proc/self");Ht("/proc/self/fd"),jt({Xa(){var e=At(t,"fd",16895,73);return e.Ma={Va:lt.Ma.Va},e.La={lookup(t,e){var r=Dt(t=+e);return(t={parent:null,Xa:{zb:"fake"},La:{readlink:()=>r.path},id:t+1}).parent=t},readdir:()=>Array.from(bt.entries()).filter(([,t])=>t).map(([t])=>t.toString())},e}},"/proc/self/fd")}(),lt.vb=new wt(44),lt.vb.stack="<generic error, no stack>";var Te,Ne={a:(t,e,r,n)=>F(`Assertion failed: ${t?Q(T,t):""}, at: `+[e?e?Q(T,e):"":"unknown filename",r,n?n?Q(T,n):"":"unknown function"]),i:function(t,e){try{return Yt(t=t?Q(T,t):"",e),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},L:function(t,e,r){try{if(e=ne(t,e=e?Q(T,e):""),-8&r)return-28;var n=Tt(e,{$a:!0}).node;return n?(t="",4&r&&(t+="r"),2&r&&(t+="w"),1&r&&(t+="x"),t&&Lt(n,t)?-2:0):-44}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},j:function(t,e){try{var r=Dt(t);return Qt(r,r.node,e,!1),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},h:function(t){try{var e=Dt(t);return Ft(e,e.node,{timestamp:Date.now(),Fb:!1}),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},b:function(t,e,r){ue=r;try{var n=Dt(t);switch(e){case 0:var i=ce();if(0>i)break;for(;bt[i];)i++;return function(t,e=-1){return t=Ut(t,e),t.Ma?.Rb?.(t),t}(n,i).fd;case 1:case 2:case 13:case 14:return 0;case 3:return n.flags;case 4:return i=ce(),n.flags|=i,0;case 12:return i=ce(),N[i+0>>1]=2,0}return-28}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},g:function(t,e){try{var r=Dt(t),n=r.node,i=r.Ma.Ta;return t=i?r:n,i??=n.La.Ta,Ct(i),ie(e,i(t))}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},H:function(t,e){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e);try{if(isNaN(e))return 61;var r=Dt(t);if(0>e||!(2097155&r.flags))throw new wt(28);return $t(r,r.node,e),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},G:function(t,e){try{if(0===e)return-28;var r=rt("/")+1;return e<r?-68:(nt("/",T,t,e),r)}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},K:function(t,e){try{return ie(e,Bt(t=t?Q(T,t):"",!0))}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},C:function(t,e,r){try{return Ht(e=ne(t,e=e?Q(T,e):""),r),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},J:function(t,e,r,n){try{e=e?Q(T,e):"";var i=256&n;return e=ne(t,e,4096&n),ie(r,i?Bt(e,!0):Bt(e))}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},x:function(t,e,r,n){ue=n;try{return Kt(e=ne(t,e=e?Q(T,e):""),r,n?ce():0).fd}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},v:function(t,e,r,n){try{if(e=ne(t,e=e?Q(T,e):""),0>=n)return-28;var i=Tt(e).node;if(!i)throw new wt(44);if(!i.La.readlink)throw new wt(28);var a=i.La.readlink(i),s=Math.min(n,rt(a)),o=E[r+s];return nt(a,T,r,n+1),E[r+s]=o,s}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},u:function(t){try{return zt(t=t?Q(T,t):""),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},f:function(t,e){try{return ie(e,Bt(t=t?Q(T,t):""))}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},r:function(t,e,r){try{return e=ne(t,e=e?Q(T,e):""),0===r?Xt(e):512===r?zt(e):F("Invalid flags passed to unlinkat"),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},q:function(t,e,r){try{e=ne(t,e=e?Q(T,e):"",!0);var n,i,a=Date.now();if(r){var s=S[r>>2]+4294967296*O[r+4>>2],o=O[r+8>>2];n=1073741823==o?a:1073741822==o?null:1e3*s+o/1e6,s=S[(r+=16)>>2]+4294967296*O[r+4>>2],i=1073741823==(o=O[r+8>>2])?a:1073741822==o?null:1e3*s+o/1e6}else i=n=a;if(null!==(i??n)){t=n;var u=Tt(e,{$a:!0}).node;Ct(u.La.Ua)(u,{atime:t,mtime:i})}return 0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},m:()=>F(""),l:()=>{z=!1,le=0},A:function(t,e){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t),t=new Date(1e3*t),O[e>>2]=t.getSeconds(),O[e+4>>2]=t.getMinutes(),O[e+8>>2]=t.getHours(),O[e+12>>2]=t.getDate(),O[e+16>>2]=t.getMonth(),O[e+20>>2]=t.getFullYear()-1900,O[e+24>>2]=t.getDay();var r=t.getFullYear();O[e+28>>2]=(0!=r%4||0==r%100&&0!=r%400?fe:he)[t.getMonth()]+t.getDate()-1|0,O[e+36>>2]=-60*t.getTimezoneOffset(),r=new Date(t.getFullYear(),6,1).getTimezoneOffset();var n=new Date(t.getFullYear(),0,1).getTimezoneOffset();O[e+32>>2]=0|(r!=n&&t.getTimezoneOffset()==Math.min(n,r))},y:function(t,e,r,n,i,a,s){i=-9007199254740992>i||9007199254740992<i?NaN:Number(i);try{if(isNaN(i))return 61;var o=Dt(n);if(2&e&&!(2&r)&&2!=(2097155&o.flags))throw new wt(2);if(1==(2097155&o.flags))throw new wt(2);if(!o.Ma.ib)throw new wt(43);if(!t)throw new wt(28);var u=o.Ma.ib(o,t,i,e,r),c=u.Kb;return O[a>>2]=u.Ab,S[s>>2]=c,0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},z:function(t,e,r,n,i,a){a=-9007199254740992>a||9007199254740992<a?NaN:Number(a);try{var s=Dt(i);if(2&r){if(r=a,32768!=(61440&s.node.mode))throw new wt(43);if(!(2&n)){var o=T.slice(t,t+e);s.Ma.jb&&s.Ma.jb(s,o,r,e,n)}}}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},n:(t,e)=>{if(pe[t]&&(clearTimeout(pe[t].id),delete pe[t]),!e)return 0;var r=setTimeout(()=>{delete pe[t],(t=>{if(!L)try{if(t(),!(z||0<le))try{_=t=_,be(t)}catch(t){t instanceof P||"unwind"==t||d(1,t)}}catch(t){t instanceof P||"unwind"==t||d(1,t)}})(()=>Ae(t,performance.now()))},e);return pe[t]={id:r,Xb:e},0},B:(t,e,r,n)=>{var i=(new Date).getFullYear(),a=new Date(i,0,1).getTimezoneOffset();i=new Date(i,6,1).getTimezoneOffset(),S[t>>2]=60*Math.max(a,i),O[e>>2]=Number(a!=i),t=(e=t=>{var e=Math.abs(t);return`UTC${0<=t?"-":"+"}${String(Math.floor(e/60)).padStart(2,"0")}${String(e%60).padStart(2,"0")}`})(a),e=e(i),i<a?(nt(t,T,r,17),nt(e,T,n,17)):(nt(t,T,n,17),nt(e,T,r,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:t=>{var e=T.length;if(2147483648<(t>>>=0))return!1;for(var r=1;4>=r;r*=2){var n=e*(1+.2/r);n=Math.min(n,t+100663296);t:{n=(Math.min(2147483648,65536*Math.ceil(Math.max(t,n)/65536))-w.buffer.byteLength+65535)/65536|0;try{w.grow(n),M();var i=1;break t}catch(t){}i=void 0}if(i)return!0}return!1},E:(t,e)=>{var r=0;return me().forEach((n,i)=>{var a=e+r;for(i=S[t+4*i>>2]=a,a=0;a<n.length;++a)E[i++]=n.charCodeAt(a);E[i]=0,r+=n.length+1}),0},F:(t,e)=>{var r=me();S[t>>2]=r.length;var n=0;return r.forEach(t=>n+=t.length+1),S[e>>2]=n,0},e:function(t){try{return Jt(Dt(t)),0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},p:function(t,e){try{var r=Dt(t);return E[e]=r.tty?2:Rt(r.mode)?3:40960==(61440&r.mode)?7:4,N[e+2>>1]=0,A[e+8>>3]=BigInt(0),A[e+16>>3]=BigInt(0),0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},w:function(t,e,r,n){try{t:{var i=Dt(t);t=e;for(var a,s=e=0;s<r;s++){var o=S[t>>2],u=S[t+4>>2];t+=8;var c=te(i,E,o,u,a);if(0>c){var l=-1;break t}if(e+=c,c<u)break;void 0!==a&&(a+=c)}l=e}return S[n>>2]=l,0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},D:function(t,e,r,n){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e);try{if(isNaN(e))return 61;var i=Dt(t);return Zt(i,e,r),A[n>>3]=BigInt(i.position),i.ob&&0===e&&0===r&&(i.ob=null),0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},I:function(t){try{var e=Dt(t);return e.Ma?.fsync?e.Ma.fsync(e):0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},t:function(t,e,r,n){try{t:{var i=Dt(t);t=e;for(var a,s=e=0;s<r;s++){var o=S[t>>2],u=S[t+4>>2];t+=8;var c=ee(i,E,o,u,a);if(0>c){var l=-1;break t}if(e+=c,c<u)break;void 0!==a&&(a+=c)}l=e}return S[n>>2]=l,0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},k:be};!async function(){function t(t){return Te=t.exports,w=Te.M,M(),oe=Te.O,D--,a.monitorRunDependencies?.(D),0==D&&U&&(t=U,U=null,t()),Te}D++,a.monitorRunDependencies?.(D);var e={a:Ne};a.instantiateWasm?new Promise(r=>{a.instantiateWasm(e,(e,n)=>{t(e),r(e.exports)})}):(C??=a.locateFile?a.locateFile("sql-wasm.wasm",m):m+"sql-wasm.wasm",t((await async function(t){var e=C;if(!I&&"function"==typeof WebAssembly.instantiateStreaming&&!q(e)&&!l)try{var r=fetch(e,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(r,t)}catch(t){y(`wasm streaming compile failed: ${t}`),y("falling back to ArrayBuffer instantiation")}return x(e,t)}(e)).instance))}(),a._sqlite3_free=t=>(a._sqlite3_free=Te.P)(t),a._sqlite3_value_text=t=>(a._sqlite3_value_text=Te.Q)(t),a._sqlite3_prepare_v2=(t,e,r,n,i)=>(a._sqlite3_prepare_v2=Te.R)(t,e,r,n,i),a._sqlite3_step=t=>(a._sqlite3_step=Te.S)(t),a._sqlite3_reset=t=>(a._sqlite3_reset=Te.T)(t),a._sqlite3_exec=(t,e,r,n,i)=>(a._sqlite3_exec=Te.U)(t,e,r,n,i),a._sqlite3_finalize=t=>(a._sqlite3_finalize=Te.V)(t),a._sqlite3_column_name=(t,e)=>(a._sqlite3_column_name=Te.W)(t,e),a._sqlite3_column_text=(t,e)=>(a._sqlite3_column_text=Te.X)(t,e),a._sqlite3_column_type=(t,e)=>(a._sqlite3_column_type=Te.Y)(t,e),a._sqlite3_errmsg=t=>(a._sqlite3_errmsg=Te.Z)(t),a._sqlite3_clear_bindings=t=>(a._sqlite3_clear_bindings=Te._)(t),a._sqlite3_value_blob=t=>(a._sqlite3_value_blob=Te.$)(t),a._sqlite3_value_bytes=t=>(a._sqlite3_value_bytes=Te.aa)(t),a._sqlite3_value_double=t=>(a._sqlite3_value_double=Te.ba)(t),a._sqlite3_value_int=t=>(a._sqlite3_value_int=Te.ca)(t),a._sqlite3_value_type=t=>(a._sqlite3_value_type=Te.da)(t),a._sqlite3_result_blob=(t,e,r,n)=>(a._sqlite3_result_blob=Te.ea)(t,e,r,n),a._sqlite3_result_double=(t,e)=>(a._sqlite3_result_double=Te.fa)(t,e),a._sqlite3_result_error=(t,e,r)=>(a._sqlite3_result_error=Te.ga)(t,e,r),a._sqlite3_result_int=(t,e)=>(a._sqlite3_result_int=Te.ha)(t,e),a._sqlite3_result_int64=(t,e)=>(a._sqlite3_result_int64=Te.ia)(t,e),a._sqlite3_result_null=t=>(a._sqlite3_result_null=Te.ja)(t),a._sqlite3_result_text=(t,e,r,n)=>(a._sqlite3_result_text=Te.ka)(t,e,r,n),a._sqlite3_aggregate_context=(t,e)=>(a._sqlite3_aggregate_context=Te.la)(t,e),a._sqlite3_column_count=t=>(a._sqlite3_column_count=Te.ma)(t),a._sqlite3_data_count=t=>(a._sqlite3_data_count=Te.na)(t),a._sqlite3_column_blob=(t,e)=>(a._sqlite3_column_blob=Te.oa)(t,e),a._sqlite3_column_bytes=(t,e)=>(a._sqlite3_column_bytes=Te.pa)(t,e),a._sqlite3_column_double=(t,e)=>(a._sqlite3_column_double=Te.qa)(t,e),a._sqlite3_bind_blob=(t,e,r,n,i)=>(a._sqlite3_bind_blob=Te.ra)(t,e,r,n,i),a._sqlite3_bind_double=(t,e,r)=>(a._sqlite3_bind_double=Te.sa)(t,e,r),a._sqlite3_bind_int=(t,e,r)=>(a._sqlite3_bind_int=Te.ta)(t,e,r),a._sqlite3_bind_text=(t,e,r,n,i)=>(a._sqlite3_bind_text=Te.ua)(t,e,r,n,i),a._sqlite3_bind_parameter_index=(t,e)=>(a._sqlite3_bind_parameter_index=Te.va)(t,e),a._sqlite3_sql=t=>(a._sqlite3_sql=Te.wa)(t),a._sqlite3_normalized_sql=t=>(a._sqlite3_normalized_sql=Te.xa)(t),a._sqlite3_changes=t=>(a._sqlite3_changes=Te.ya)(t),a._sqlite3_close_v2=t=>(a._sqlite3_close_v2=Te.za)(t),a._sqlite3_create_function_v2=(t,e,r,n,i,s,o,u,c)=>(a._sqlite3_create_function_v2=Te.Aa)(t,e,r,n,i,s,o,u,c),a._sqlite3_update_hook=(t,e,r)=>(a._sqlite3_update_hook=Te.Ba)(t,e,r),a._sqlite3_open=(t,e)=>(a._sqlite3_open=Te.Ca)(t,e);var Oe=a._malloc=t=>(Oe=a._malloc=Te.Da)(t),Se=a._free=t=>(Se=a._free=Te.Ea)(t);a._RegisterExtensionFunctions=t=>(a._RegisterExtensionFunctions=Te.Fa)(t);var ke=(t,e)=>(ke=Te.Ga)(t,e),Ae=(t,e)=>(Ae=Te.Ha)(t,e),Re=t=>(Re=Te.Ia)(t),Ie=t=>(Ie=Te.Ja)(t),Le=()=>(Le=Te.Ka)();if(a.stackSave=()=>Le(),a.stackRestore=t=>Re(t),a.stackAlloc=t=>Ie(t),a.cwrap=(t,e,r,n)=>{var i=!r||r.every(t=>"number"===t||"boolean"===t);return"string"!==e&&i&&!n?a["_"+t]:(...n)=>((t,e,r,n)=>{var i={string:t=>{var e=0;return null!=t&&0!==t&&(e=ve(t)),e},array:t=>{var e=Ie(t.length);return E.set(t,e),e}};t=a["_"+t];var s,o=[],u=0;if(n)for(var c=0;c<n.length;c++){var l=i[r[c]];l?(0===u&&(u=Le()),o[c]=l(n[c])):o[c]=n[c]}return r=t(...o),s=r,0!==u&&Re(u),"string"===e?s?Q(T,s):"":"boolean"===e?!!s:s})(t,e,r,n)},a.addFunction=Ee,a.removeFunction=_e,a.UTF8ToString=Y,a.ALLOC_NORMAL=ge,a.allocate=ye,a.allocateUTF8OnStack=ve,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();return function t(){function e(){if(a.calledRun=!0,!L){var t,e;if(!a.noFSInit&&!vt)vt=!0,r??=a.stdin,t??=a.stdout,e??=a.stderr,r?re("stdin",r):Vt("/dev/tty","/dev/stdin"),t?re("stdout",null,t):Vt("/dev/tty","/dev/stdout"),e?re("stderr",null,e):Vt("/dev/tty1","/dev/stderr"),Kt("/dev/stdin",0),Kt("/dev/stdout",1),Kt("/dev/stderr",1);if(Te.N(),gt=!1,a.onRuntimeInitialized?.(),a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;){var r=a.postRun.shift();W.unshift(r)}j(W)}}if(0<D)U=t;else{if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)G();j(H),0<D?U=t:a.setStatus?(a.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>a.setStatus(""),1),e()},1)):e()}}(),s}))};t.exports=i,t.exports.default=i},920:()=>{}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var a=e[n]={id:n,loaded:!1,exports:{}};return t[n](a,a.exports,r),a.loaded=!0,a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{"use strict";var t=r(826),e=r.n(t);function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function i(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}}function a(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return s(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){u=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw a}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function o(t,e,r){return(e=p(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function a(r,n,i,a){var u=n&&n.prototype instanceof o?n:o,l=Object.create(u.prototype);return c(l,"_invoke",function(r,n,i){var a,o,u,c=0,l=i||[],h=!1,f={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return a=e,o=0,u=t,f.n=r,s}};function p(r,n){for(o=r,u=n,e=0;!h&&c&&!i&&e<l.length;e++){var i,a=l[e],p=f.p,b=a[2];r>3?(i=b===n)&&(u=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=t):a[0]<=p&&((i=r<2&&p<a[1])?(o=0,f.v=n,f.n=a[1]):p<b&&(i=r<3||a[0]>n||n>b)&&(a[4]=r,a[5]=n,f.n=b,o=0))}if(i||r>1)return s;throw h=!0,n}return function(i,l,b){if(c>1)throw TypeError("Generator is already running");for(h&&1===l&&p(l,b),o=l,u=b;(e=o<2?t:u)||!h;){a||(o?o<3?(o>1&&(f.n=-1),p(o,u)):f.n=u:f.v=u);try{if(c=2,a){if(o||(i="next"),e=a[i]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,o<2&&(o=0)}else 1===o&&(e=a.return)&&e.call(a),o<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),o=1);a=t}else if((e=(h=f.n<0)?u:r.call(n,f))!==s)break}catch(e){a=t,o=1,u=e}finally{c=1}}return{value:e,done:h}}}(r,i,a),!0),l}var s={};function o(){}function l(){}function h(){}e=Object.getPrototypeOf;var f=[][n]?e(e([][n]())):(c(e={},n,function(){return this}),e),p=h.prototype=o.prototype=Object.create(f);function b(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,c(t,i,"GeneratorFunction")),t.prototype=Object.create(p),t}return l.prototype=h,c(p,"constructor",h),c(h,"constructor",l),l.displayName="GeneratorFunction",c(h,i,"GeneratorFunction"),c(p),c(p,i,"Generator"),c(p,n,function(){return this}),c(p,"toString",function(){return"[object Generator]"}),(u=function(){return{w:a,m:b}})()}function c(t,e,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}c=function(t,e,r,n){function a(e,r){c(t,e,function(t){return this._invoke(e,r,t)})}e?i?i(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(a("next",0),a("throw",1),a("return",2))},c(t,e,r,n)}function l(t,e,r,n,i,a,s){try{var o=t[a](s),u=o.value}catch(t){return void r(t)}o.done?e(u):Promise.resolve(u).then(n,i)}function h(t){return function(){var e=this,r=arguments;return new Promise(function(n,i){var a=t.apply(e,r);function s(t){l(a,n,i,s,o,"next",t)}function o(t){l(a,n,i,s,o,"throw",t)}s(void 0)})}}function f(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,p(n.key),n)}}function p(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}var b=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.db=null,this.SQL=null,this.dbName="echolens.db",this.isInitialized=!1},r=[{key:"init",value:(A=h(u().m(function t(){var r,n,i;return u().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.isInitialized){t.n=1;break}return t.a(2);case 1:return t.p=1,t.n=2,e()({locateFile:function(t){return"dist/".concat(t)}});case 2:return this.SQL=t.v,t.n=3,chrome.storage.local.get([this.dbName]);case 3:if(!(r=t.v)[this.dbName]){t.n=4;break}n=new Uint8Array(r[this.dbName]),this.db=new this.SQL.Database(n),console.log("✅ Loaded existing database"),t.n=6;break;case 4:return this.db=new this.SQL.Database,t.n=5,this.createTables();case 5:console.log("✅ Created new database");case 6:this.isInitialized=!0,t.n=8;break;case 7:throw t.p=7,i=t.v,console.error("❌ Database initialization error:",i),i;case 8:return t.a(2)}},t,this,[[1,7]])})),function(){return A.apply(this,arguments)})},{key:"createTables",value:(k=h(u().m(function t(){return u().w(function(t){for(;;)switch(t.n){case 0:return this.db.run("\n      -- Visits table\n      CREATE TABLE IF NOT EXISTS visits (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        url TEXT NOT NULL UNIQUE,\n        url_hash TEXT NOT NULL,\n        title TEXT,\n        first_visit INTEGER NOT NULL,\n        last_visit INTEGER NOT NULL,\n        visit_count INTEGER DEFAULT 0,\n        total_time_spent INTEGER DEFAULT 0,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      -- Sessions table\n      CREATE TABLE IF NOT EXISTS sessions (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        visit_id INTEGER NOT NULL,\n        timestamp INTEGER NOT NULL,\n        time_spent INTEGER DEFAULT 0,\n        scroll_depth REAL DEFAULT 0,\n        interactions INTEGER DEFAULT 0,\n        highlight_count INTEGER DEFAULT 0,\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE\n      );\n\n      -- Highlights table\n      CREATE TABLE IF NOT EXISTS highlights (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        visit_id INTEGER NOT NULL,\n        text TEXT NOT NULL,\n        timestamp INTEGER NOT NULL,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE\n      );\n\n      -- AI Insights table\n      CREATE TABLE IF NOT EXISTS insights (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        visit_id INTEGER NOT NULL UNIQUE,\n        summary TEXT,\n        topics TEXT,\n        timestamp INTEGER NOT NULL,\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE\n      );\n\n      -- Tags table\n      CREATE TABLE IF NOT EXISTS tags (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT NOT NULL UNIQUE\n      );\n\n      -- Visit Tags junction table\n      CREATE TABLE IF NOT EXISTS visit_tags (\n        visit_id INTEGER NOT NULL,\n        tag_id INTEGER NOT NULL,\n        PRIMARY KEY (visit_id, tag_id),\n        FOREIGN KEY (visit_id) REFERENCES visits (id) ON DELETE CASCADE,\n        FOREIGN KEY (tag_id) REFERENCES tags (id) ON DELETE CASCADE\n      );\n\n      -- Indexes for better performance\n      CREATE INDEX IF NOT EXISTS idx_visits_url_hash ON visits(url_hash);\n      CREATE INDEX IF NOT EXISTS idx_visits_last_visit ON visits(last_visit);\n      CREATE INDEX IF NOT EXISTS idx_sessions_visit_id ON sessions(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_highlights_visit_id ON highlights(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_insights_visit_id ON insights(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_visit_tags_visit_id ON visit_tags(visit_id);\n      CREATE INDEX IF NOT EXISTS idx_visit_tags_tag_id ON visit_tags(tag_id);\n    "),t.n=1,this.saveDatabase();case 1:return t.a(2)}},t,this)})),function(){return k.apply(this,arguments)})},{key:"saveDatabase",value:(S=h(u().m(function t(){var e,r;return u().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.db){t.n=1;break}return t.a(2);case 1:return t.p=1,e=this.db.export(),t.n=2,chrome.storage.local.set(o({},this.dbName,Array.from(e)));case 2:t.n=4;break;case 3:t.p=3,r=t.v,console.error("❌ Error saving database:",r);case 4:return t.a(2)}},t,this,[[1,3]])})),function(){return S.apply(this,arguments)})},{key:"hashURL",value:function(t){return t.replace(/[^a-zA-Z0-9]/g,"_").substring(0,100)}},{key:"getOrCreateVisit",value:(O=h(u().m(function t(e,r){var n,i,a,s,o;return u().w(function(t){for(;;)if(0===t.n)return n=this.hashURL(e),(i=this.db.prepare("SELECT * FROM visits WHERE url_hash = ?")).bind([n]),a=null,i.step()&&(a=i.getAsObject()),i.free(),a||(s=Date.now(),this.db.run("INSERT INTO visits (url, url_hash, title, first_visit, last_visit, visit_count) VALUES (?, ?, ?, ?, ?, ?)",[e,n,r,s,s,0]),(o=this.db.prepare("SELECT * FROM visits WHERE url_hash = ?")).bind([n]),o.step()&&(a=o.getAsObject()),o.free()),t.a(2,a)},t,this)})),function(t,e){return O.apply(this,arguments)})},{key:"updateVisit",value:(N=h(u().m(function t(e){var r,n,i,a,s,o,c,l;return u().w(function(t){for(;;)switch(t.n){case 0:return r=e.url,n=e.title,i=e.timeSpent,a=e.scrollDepth,s=e.interactions,o=e.highlights,t.n=1,this.getOrCreateVisit(r,n);case 1:return c=t.v,l=Date.now(),this.db.run("UPDATE visits \n       SET last_visit = ?, \n           visit_count = visit_count + 1, \n           total_time_spent = total_time_spent + ?,\n           title = ?\n       WHERE id = ?",[l,i||0,n,c.id]),this.db.run("INSERT INTO sessions (visit_id, timestamp, time_spent, scroll_depth, interactions, highlight_count)\n       VALUES (?, ?, ?, ?, ?, ?)",[c.id,l,i||0,a||0,s||0,(null==o?void 0:o.length)||0]),this.db.run("DELETE FROM sessions \n       WHERE visit_id = ? \n       AND id NOT IN (\n         SELECT id FROM sessions \n         WHERE visit_id = ? \n         ORDER BY timestamp DESC \n         LIMIT 50\n       )",[c.id,c.id]),t.n=2,this.saveDatabase();case 2:return t.a(2,c)}},t,this)})),function(t){return N.apply(this,arguments)})},{key:"getVisitHistory",value:(T=h(u().m(function t(e){var r,n,i,a,s;return u().w(function(t){for(;;)switch(t.n){case 0:if(r=this.hashURL(e),(n=this.db.prepare("\n      SELECT v.*, \n             (SELECT COUNT(*) FROM sessions WHERE visit_id = v.id) as session_count\n      FROM visits v\n      WHERE v.url_hash = ?\n    ")).bind([r]),i=null,n.step()&&(i=n.getAsObject()),n.free(),i){t.n=1;break}return t.a(2,null);case 1:for((a=this.db.prepare("\n      SELECT * FROM sessions \n      WHERE visit_id = ? \n      ORDER BY timestamp DESC \n      LIMIT 50\n    ")).bind([i.id]),s=[];a.step();)s.push(a.getAsObject());return a.free(),i.sessions=s,t.a(2,i)}},t,this)})),function(t){return T.apply(this,arguments)})},{key:"saveHighlight",value:(E=h(u().m(function t(e){var r,n,i,a,s;return u().w(function(t){for(;;)switch(t.n){case 0:return r=e.text,n=e.url,i=e.title,a=e.timestamp,t.n=1,this.getOrCreateVisit(n,i);case 1:return s=t.v,this.db.run("INSERT INTO highlights (visit_id, text, timestamp) VALUES (?, ?, ?)",[s.id,r,a||Date.now()]),this.db.run("DELETE FROM highlights \n       WHERE visit_id = ? \n       AND id NOT IN (\n         SELECT id FROM highlights \n         WHERE visit_id = ? \n         ORDER BY timestamp DESC \n         LIMIT 100\n       )",[s.id,s.id]),t.n=2,this.saveDatabase();case 2:return t.a(2)}},t,this)})),function(t){return E.apply(this,arguments)})},{key:"getHighlights",value:(_=h(u().m(function t(e){var r,n,i;return u().w(function(t){for(;;)if(0===t.n){for(r=this.hashURL(e),(n=this.db.prepare("\n      SELECT h.* \n      FROM highlights h\n      JOIN visits v ON h.visit_id = v.id\n      WHERE v.url_hash = ?\n      ORDER BY h.timestamp DESC\n      LIMIT 100\n    ")).bind([r]),i=[];n.step();)i.push(n.getAsObject());return n.free(),t.a(2,i)}},t,this)})),function(t){return _.apply(this,arguments)})},{key:"saveAIInsights",value:(w=h(u().m(function t(e,r){var n,i,s,o,c,l;return u().w(function(t){for(;;)switch(t.p=t.n){case 0:return this.hashURL(e),t.n=1,this.getOrCreateVisit(e,"");case 1:if(n=t.v,JSON.stringify(r.tags||[]),i=JSON.stringify(r.topics||[]),this.db.run("INSERT INTO insights (visit_id, summary, topics, timestamp)\n       VALUES (?, ?, ?, ?)\n       ON CONFLICT(visit_id) DO UPDATE SET\n         summary = excluded.summary,\n         topics = excluded.topics,\n         timestamp = excluded.timestamp",[n.id,r.summary||"",i,r.timestamp||Date.now()]),!(r.tags&&r.tags.length>0)){t.n=8;break}s=a(r.tags),t.p=2,s.s();case 3:if((o=s.n()).done){t.n=5;break}return c=o.value,t.n=4,this.addTag(e,c);case 4:t.n=3;break;case 5:t.n=7;break;case 6:t.p=6,l=t.v,s.e(l);case 7:return t.p=7,s.f(),t.f(7);case 8:return t.n=9,this.saveDatabase();case 9:return t.a(2)}},t,this,[[2,6,7,8]])})),function(t,e){return w.apply(this,arguments)})},{key:"getAIInsights",value:(y=h(u().m(function t(e){var r,n,i;return u().w(function(t){for(;;)switch(t.n){case 0:if(r=this.hashURL(e),(n=this.db.prepare("\n      SELECT i.* \n      FROM insights i\n      JOIN visits v ON i.visit_id = v.id\n      WHERE v.url_hash = ?\n    ")).bind([r]),i=null,n.step()&&(i=n.getAsObject()).topics&&(i.topics=JSON.parse(i.topics)),n.free(),!i){t.n=2;break}return t.n=1,this.getTags(e);case 1:i.tags=t.v;case 2:return t.a(2,i)}},t,this)})),function(t){return y.apply(this,arguments)})},{key:"addTag",value:(g=h(u().m(function t(e,r){var n,i,a,s;return u().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.getOrCreateVisit(e,"");case 1:n=t.v,i=null,(a=this.db.prepare("SELECT id FROM tags WHERE name = ?")).bind([r]),a.step()&&(i=a.getAsObject().id),a.free(),i||(this.db.run("INSERT INTO tags (name) VALUES (?)",[r]),(s=this.db.prepare("SELECT id FROM tags WHERE name = ?")).bind([r]),s.step()&&(i=s.getAsObject().id),s.free());try{this.db.run("INSERT OR IGNORE INTO visit_tags (visit_id, tag_id) VALUES (?, ?)",[n.id,i])}catch(t){}return t.n=2,this.saveDatabase();case 2:return t.a(2)}},t,this)})),function(t,e){return g.apply(this,arguments)})},{key:"getTags",value:(v=h(u().m(function t(e){var r,n,i;return u().w(function(t){for(;;)if(0===t.n){for(r=this.hashURL(e),(n=this.db.prepare("\n      SELECT t.name \n      FROM tags t\n      JOIN visit_tags vt ON t.id = vt.tag_id\n      JOIN visits v ON vt.visit_id = v.id\n      WHERE v.url_hash = ?\n    ")).bind([r]),i=[];n.step();)i.push(n.getAsObject().name);return n.free(),t.a(2,i)}},t,this)})),function(t){return v.apply(this,arguments)})},{key:"getMemories",value:(m=h(u().m(function t(){var e,r,n,i,a,s,o,c,l,h,f,p,b=arguments;return u().w(function(t){for(;;)switch(t.n){case 0:r="\n      SELECT v.*\n      FROM visits v\n      WHERE 1=1\n    ",n=[],(e=b.length>0&&void 0!==b[0]?b[0]:{}).minVisits&&(r+=" AND v.visit_count >= ?",n.push(e.minVisits)),e.minTimeSpent&&(r+=" AND v.total_time_spent >= ?",n.push(e.minTimeSpent)),e.dateFrom&&(r+=" AND v.last_visit >= ?",n.push(e.dateFrom)),e.tag&&(r+=" AND v.id IN (\n        SELECT vt.visit_id FROM visit_tags vt\n        JOIN tags t ON vt.tag_id = t.id\n        WHERE t.name = ?\n      )",n.push(e.tag)),r+=" ORDER BY v.last_visit DESC",(i=this.db.prepare(r)).bind(n),a=[];case 1:if(!i.step()){t.n=5;break}return s=i.getAsObject(),(o=this.db.prepare("SELECT COUNT(*) as count FROM highlights WHERE visit_id = ?")).bind([s.id]),o.step()&&o.getAsObject().count,o.free(),t.n=2,this.getTags(s.url);case 2:return c=t.v,t.n=3,this.getAIInsights(s.url);case 3:for(l=t.v,(h=this.db.prepare("\n        SELECT * FROM sessions \n        WHERE visit_id = ? \n        ORDER BY timestamp DESC \n        LIMIT 10\n      ")).bind([s.id]),f=[];h.step();)f.push(h.getAsObject());return h.free(),t.n=4,this.getHighlights(s.url);case 4:p=t.v,a.push({url:s.url,title:s.title,visits:s.visit_count,lastVisit:s.last_visit,firstVisit:s.first_visit,totalTimeSpent:s.total_time_spent,highlights:p,insights:l,tags:c,sessions:f}),t.n=1;break;case 5:return i.free(),t.a(2,a)}},t,this)})),function(){return m.apply(this,arguments)})},{key:"getStats",value:(d=h(u().m(function t(){var e,r,n;return u().w(function(t){for(;;)if(0===t.n)return e={totalVisits:0,totalTimeSpent:0,totalHighlights:0,totalSessions:0,thisWeekVisits:0,averageTimePerVisit:0},(r=this.db.prepare("SELECT COUNT(*) as count FROM visits")).step()&&(e.totalVisits=r.getAsObject().count),r.free(),(r=this.db.prepare("SELECT SUM(total_time_spent) as total FROM visits")).step()&&(e.totalTimeSpent=r.getAsObject().total||0),r.free(),(r=this.db.prepare("SELECT COUNT(*) as count FROM highlights")).step()&&(e.totalHighlights=r.getAsObject().count),r.free(),(r=this.db.prepare("SELECT SUM(visit_count) as total FROM visits")).step()&&(e.totalSessions=r.getAsObject().total||0),r.free(),n=Date.now()-6048e5,(r=this.db.prepare("SELECT COUNT(*) as count FROM visits WHERE last_visit >= ?")).bind([n]),r.step()&&(e.thisWeekVisits=r.getAsObject().count),r.free(),e.totalSessions>0&&(e.averageTimePerVisit=Math.floor(e.totalTimeSpent/e.totalSessions)),t.a(2,e)},t,this)})),function(){return d.apply(this,arguments)})},{key:"exportData",value:(b=h(u().m(function t(){var e;return u().w(function(t){for(;;)if(0===t.n)return e=this.db.export(),t.a(2,{database:Array.from(e),exportDate:Date.now(),version:"2.0"})},t,this)})),function(){return b.apply(this,arguments)})},{key:"importData",value:(p=h(u().m(function t(e){var r,n;return u().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,"2.0"!==e.version||!e.database){t.n=2;break}return r=new Uint8Array(e.database),this.db=new this.SQL.Database(r),t.n=1,this.saveDatabase();case 1:t.n=3;break;case 2:if(!e.visits){t.n=3;break}return t.n=3,this.migrateFromChromeStorage(e);case 3:t.n=5;break;case 4:throw t.p=4,n=t.v,console.error("Import error:",n),n;case 5:return t.a(2)}},t,this,[[0,4]])})),function(t){return p.apply(this,arguments)})},{key:"migrateFromChromeStorage",value:(l=h(u().m(function t(e){var r,n,s,o,c,l,h,f,p,b,d,m,v,g,y,w,_,E,T,N,O,S,k,A,R,I,L,q;return u().w(function(t){for(;;)switch(t.p=t.n){case 0:if(console.log("🔄 Migrating from chrome.storage..."),!e.visits){t.n=3;break}N=i(e.visits);case 1:if((O=N()).done){t.n=3;break}return r=O.value,n=e.visits[r],t.n=2,this.getOrCreateVisit(n.url,n.title);case 2:if(s=t.v,this.db.run("UPDATE visits \n           SET first_visit = ?, last_visit = ?, visit_count = ?, total_time_spent = ?\n           WHERE id = ?",[n.firstVisit,n.lastVisit,n.visits,n.totalTimeSpent,s.id]),n.sessions){o=a(n.sessions);try{for(o.s();!(c=o.n()).done;)l=c.value,this.db.run("INSERT INTO sessions (visit_id, timestamp, time_spent, scroll_depth, interactions, highlight_count)\n               VALUES (?, ?, ?, ?, ?, ?)",[s.id,l.timestamp,l.timeSpent||0,l.scrollDepth||0,l.interactions||0,l.highlightCount||0])}catch(t){o.e(t)}finally{o.f()}}t.n=1;break;case 3:if(!e.highlights){t.n=6;break}S=i(e.highlights);case 4:if((k=S()).done){t.n=6;break}return h=k.value,f=e.highlights[h],t.n=5,this.getOrCreateVisit(f.url,f.title);case 5:if(p=t.v,f.items){b=a(f.items);try{for(b.s();!(d=b.n()).done;)m=d.value,this.db.run("INSERT INTO highlights (visit_id, text, timestamp) VALUES (?, ?, ?)",[p.id,m.text,m.timestamp])}catch(t){b.e(t)}finally{b.f()}}t.n=4;break;case 6:if(!e.insights){t.n=9;break}A=i(e.insights);case 7:if((R=A()).done){t.n=9;break}return v=R.value,g=e.insights[v],t.n=8,this.saveAIInsights(g.url,g);case 8:t.n=7;break;case 9:if(!e.tags){t.n=18;break}I=i(e.tags);case 10:if((L=I()).done){t.n=18;break}if(y=L.value,!(w=e.tags[y]).tags){t.n=17;break}_=a(w.tags),t.p=11,_.s();case 12:if((E=_.n()).done){t.n=14;break}return T=E.value,t.n=13,this.addTag(w.url,T);case 13:t.n=12;break;case 14:t.n=16;break;case 15:t.p=15,q=t.v,_.e(q);case 16:return t.p=16,_.f(),t.f(16);case 17:t.n=10;break;case 18:return t.n=19,this.saveDatabase();case 19:console.log("✅ Migration complete");case 20:return t.a(2)}},t,this,[[11,15,16,17]])})),function(t){return l.apply(this,arguments)})},{key:"cleanup",value:(c=h(u().m(function t(){var e;return u().w(function(t){for(;;)switch(t.n){case 0:return e=Date.now()-31536e6,this.db.run("DELETE FROM sessions WHERE timestamp < ?",[e]),this.db.run("\n      DELETE FROM tags \n      WHERE id NOT IN (SELECT DISTINCT tag_id FROM visit_tags)\n    "),t.n=1,this.saveDatabase();case 1:return t.a(2)}},t,this)})),function(){return c.apply(this,arguments)})},{key:"close",value:(s=h(u().m(function t(){return u().w(function(t){for(;;)switch(t.n){case 0:if(!this.db){t.n=2;break}return t.n=1,this.saveDatabase();case 1:this.db.close(),this.db=null,this.isInitialized=!1;case 2:return t.a(2)}},t,this)})),function(){return s.apply(this,arguments)})}],r&&f(t.prototype,r),n&&f(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,s,c,l,p,b,d,m,v,g,y,w,_,E,T,N,O,S,k,A}();function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a,s,o=[],u=!0,c=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(o.push(n.value),o.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw i}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return v(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function g(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function a(r,n,i,a){var u=n&&n.prototype instanceof o?n:o,c=Object.create(u.prototype);return y(c,"_invoke",function(r,n,i){var a,o,u,c=0,l=i||[],h=!1,f={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return a=e,o=0,u=t,f.n=r,s}};function p(r,n){for(o=r,u=n,e=0;!h&&c&&!i&&e<l.length;e++){var i,a=l[e],p=f.p,b=a[2];r>3?(i=b===n)&&(u=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=t):a[0]<=p&&((i=r<2&&p<a[1])?(o=0,f.v=n,f.n=a[1]):p<b&&(i=r<3||a[0]>n||n>b)&&(a[4]=r,a[5]=n,f.n=b,o=0))}if(i||r>1)return s;throw h=!0,n}return function(i,l,b){if(c>1)throw TypeError("Generator is already running");for(h&&1===l&&p(l,b),o=l,u=b;(e=o<2?t:u)||!h;){a||(o?o<3?(o>1&&(f.n=-1),p(o,u)):f.n=u:f.v=u);try{if(c=2,a){if(o||(i="next"),e=a[i]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,o<2&&(o=0)}else 1===o&&(e=a.return)&&e.call(a),o<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),o=1);a=t}else if((e=(h=f.n<0)?u:r.call(n,f))!==s)break}catch(e){a=t,o=1,u=e}finally{c=1}}return{value:e,done:h}}}(r,i,a),!0),c}var s={};function o(){}function u(){}function c(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(y(e={},n,function(){return this}),e),h=c.prototype=o.prototype=Object.create(l);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,y(t,i,"GeneratorFunction")),t.prototype=Object.create(h),t}return u.prototype=c,y(h,"constructor",c),y(c,"constructor",u),u.displayName="GeneratorFunction",y(c,i,"GeneratorFunction"),y(h),y(h,i,"Generator"),y(h,n,function(){return this}),y(h,"toString",function(){return"[object Generator]"}),(g=function(){return{w:a,m:f}})()}function y(t,e,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}y=function(t,e,r,n){function a(e,r){y(t,e,function(t){return this._invoke(e,r,t)})}e?i?i(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(a("next",0),a("throw",1),a("return",2))},y(t,e,r,n)}function w(t,e,r,n,i,a,s){try{var o=t[a](s),u=o.value}catch(t){return void r(t)}o.done?e(u):Promise.resolve(u).then(n,i)}function _(t){return function(){var e=this,r=arguments;return new Promise(function(n,i){var a=t.apply(e,r);function s(t){w(a,n,i,s,o,"next",t)}function o(t){w(a,n,i,s,o,"throw",t)}s(void 0)})}}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,O(n.key),n)}}function N(t,e,r){return e&&T(t.prototype,e),r&&T(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function O(t){var e=function(t,e){if("object"!=d(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==d(e)?e:e+""}var S=function(){return N(function t(){E(this,t),this.apiKey=null,this.provider="openai",this.loadConfig()},[{key:"loadConfig",value:(s=_(g().m(function t(){var e=this;return g().w(function(t){for(;;)switch(t.n){case 0:chrome.storage.local.get(["ai_api_key","ai_provider"],function(t){e.apiKey=t.ai_api_key||null,e.provider=t.ai_provider||"openai"});case 1:return t.a(2)}},t)})),function(){return s.apply(this,arguments)})},{key:"generateSummary",value:(a=_(g().m(function t(e){var r;return g().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.apiKey){t.n=1;break}return console.warn("No AI API key configured"),t.a(2,this.generateFallbackSummary(e));case 1:if(t.p=1,"openai"!==this.provider){t.n=3;break}return t.n=2,this.openAISummary(e);case 2:case 4:return t.a(2,t.v);case 3:if("anthropic"!==this.provider){t.n=5;break}return t.n=4,this.anthropicSummary(e);case 5:t.n=7;break;case 6:return t.p=6,r=t.v,console.error("AI summary error:",r),t.a(2,this.generateFallbackSummary(e));case 7:return t.a(2)}},t,this,[[1,6]])})),function(t){return a.apply(this,arguments)})},{key:"openAISummary",value:(i=_(g().m(function t(e){var r,n;return g().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a concise summarizer. Create a 1-2 sentence summary of the following content that captures the main topic and purpose."},{role:"user",content:e.substring(0,3e3)}],max_tokens:100,temperature:.5})});case 1:return r=t.v,t.n=2,r.json();case 2:return n=t.v,t.a(2,n.choices[0].message.content.trim())}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"predictTags",value:(n=_(g().m(function t(e,r){var n;return g().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.apiKey){t.n=1;break}return t.a(2,this.generateFallbackTags(e,r));case 1:if(t.p=1,"openai"!==this.provider){t.n=3;break}return t.n=2,this.openAITags(e,r);case 2:return t.a(2,t.v);case 3:t.n=5;break;case 4:return t.p=4,n=t.v,console.error("AI tagging error:",n),t.a(2,this.generateFallbackTags(e,r));case 5:return t.a(2)}},t,this,[[1,4]])})),function(t,e){return n.apply(this,arguments)})},{key:"openAITags",value:(r=_(g().m(function t(e,r){var n,i,a;return g().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"Generate 3-5 relevant tags for this content. Return only the tags separated by commas, like: learning, ai, research"},{role:"user",content:"Title: ".concat(r,"\n\nContent: ").concat(e.substring(0,2e3))}],max_tokens:50,temperature:.7})});case 1:return n=t.v,t.n=2,n.json();case 2:return i=t.v,a=i.choices[0].message.content.trim().split(",").map(function(t){return t.trim()}),t.a(2,a.slice(0,5))}},t,this)})),function(t,e){return r.apply(this,arguments)})},{key:"extractTopics",value:(e=_(g().m(function t(e){var r;return g().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.apiKey){t.n=1;break}return t.a(2,this.generateFallbackTopics(e));case 1:if(t.p=1,"openai"!==this.provider){t.n=3;break}return t.n=2,this.openAITopics(e);case 2:return t.a(2,t.v);case 3:t.n=5;break;case 4:return t.p=4,r=t.v,console.error("AI topic extraction error:",r),t.a(2,this.generateFallbackTopics(e));case 5:return t.a(2)}},t,this,[[1,4]])})),function(t){return e.apply(this,arguments)})},{key:"openAITopics",value:(t=_(g().m(function t(e){var r,n;return g().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"Extract 3-5 key topics or concepts from this content. Return only the topics separated by commas."},{role:"user",content:e.substring(0,2e3)}],max_tokens:60,temperature:.5})});case 1:return r=t.v,t.n=2,r.json();case 2:return n=t.v,t.a(2,n.choices[0].message.content.trim().split(",").map(function(t){return t.trim()}))}},t,this)})),function(e){return t.apply(this,arguments)})},{key:"generateFallbackSummary",value:function(t){return t.split(/[.!?]+/).filter(function(t){return t.trim().length>20}).slice(0,2).join(". ").substring(0,200)+"..."}},{key:"generateFallbackTags",value:function(t,e){var r=(e+" "+t).toLowerCase(),n=["the","a","an","and","or","but","in","on","at","to","for","of","with","by","from","is","was","are","were","been","be","have","has","had","do","does","did","will","would","could","should","may","might","can","this","that","these","those"],i=r.split(/\W+/).filter(function(t){return t.length>3&&!n.includes(t)&&!/^\d+$/.test(t)}),a={};return i.forEach(function(t){return a[t]=(a[t]||0)+1}),Object.entries(a).sort(function(t,e){return e[1]-t[1]}).slice(0,5).map(function(t){return m(t,1)[0]})}},{key:"generateFallbackTopics",value:function(t){return this.generateFallbackTags(t,"")}}]);var t,e,r,n,i,a,s}();new(function(){return N(function t(){E(this,t),this.db=new b,this.ai=new S,this.activeSessions=new Map,this.init()},[{key:"init",value:(m=_(g().m(function t(){var e=this;return g().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.init();case 1:chrome.runtime.onMessage.addListener(function(t,r,n){return e.handleMessage(t,r,n),!0}),chrome.tabs.onUpdated.addListener(function(t,r,n){"complete"===r.status&&e.handleTabLoad(t,n)}),chrome.tabs.onRemoved.addListener(function(t){e.handleTabClose(t)}),chrome.alarms.create("cleanup",{periodInMinutes:60}),chrome.alarms.onAlarm.addListener(function(t){"cleanup"===t.name&&e.performCleanup()}),console.log("🌌 EchoLens Background Service Worker initialized");case 2:return t.a(2)}},t,this)})),function(){return m.apply(this,arguments)})},{key:"handleMessage",value:(d=_(g().m(function t(e,r,n){var i,a,s,o,u,c,l,h,f,p;return g().w(function(t){for(;;)switch(t.p=t.n){case 0:i=e.type,a=e.data,s=e.url,t.p=1,f=i,t.n="CONTEXT_UPDATE"===f?2:"SAVE_HIGHLIGHT"===f?4:"GET_PREVIOUS_CONTEXT"===f?6:"PAGE_UNLOAD"===f?8:"GET_MEMORIES"===f?10:"SEARCH_MEMORIES"===f?12:"ADD_TAG"===f?14:"GET_STATS"===f?16:"EXPORT_DATA"===f?18:"IMPORT_DATA"===f?20:22;break;case 2:return t.n=3,this.handleContextUpdate(a,r.tab);case 3:return n({success:!0}),t.a(3,23);case 4:return t.n=5,this.saveHighlight(a);case 5:return n({success:!0}),t.a(3,23);case 6:return t.n=7,this.getPreviousContext(s);case 7:return o=t.v,n({context:o}),t.a(3,23);case 8:return t.n=9,this.handlePageUnload(a,r.tab);case 9:return n({success:!0}),t.a(3,23);case 10:return t.n=11,this.getMemories(a);case 11:return u=t.v,n({memories:u}),t.a(3,23);case 12:return t.n=13,this.searchMemories(a.query);case 13:return c=t.v,n({results:c}),t.a(3,23);case 14:return t.n=15,this.addTag(a.url,a.tag);case 15:return n({success:!0}),t.a(3,23);case 16:return t.n=17,this.getStats();case 17:return l=t.v,n({stats:l}),t.a(3,23);case 18:return t.n=19,this.exportData();case 19:return h=t.v,n({data:h}),t.a(3,23);case 20:return t.n=21,this.importData(a);case 21:return n({success:!0}),t.a(3,23);case 22:n({error:"Unknown message type"});case 23:t.n=25;break;case 24:t.p=24,p=t.v,console.error("Error handling message:",p),n({error:p.message});case 25:return t.a(2)}},t,this,[[1,24]])})),function(t,e,r){return d.apply(this,arguments)})},{key:"handleContextUpdate",value:(p=_(g().m(function t(e,r){var n,i,a,s;return g().w(function(t){for(;;)switch(t.n){case 0:if(n=e.url,i=e.title,e.content,!((a=e.timeSpent)<10)){t.n=1;break}return t.a(2);case 1:if((s=this.activeSessions.get(r.id))||(s={url:n,title:i,startTime:Date.now(),tabId:r.id},this.activeSessions.set(r.id,s)),s.lastUpdate=Date.now(),s.context=e,!(a>30)||s.aiProcessed){t.n=2;break}return s.aiProcessed=!0,t.n=2,this.processWithAI(e);case 2:return t.n=3,this.db.updateVisit(e);case 3:return t.a(2)}},t,this)})),function(t,e){return p.apply(this,arguments)})},{key:"processWithAI",value:(f=_(g().m(function t(e){var r,n,i,a;return g().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.ai.generateSummary(e.content);case 1:return r=t.v,t.n=2,this.ai.predictTags(e.content,e.title);case 2:return n=t.v,t.n=3,this.ai.extractTopics(e.content);case 3:return i=t.v,t.n=4,this.db.saveAIInsights(e.url,{summary:r,tags:n,topics:i,timestamp:Date.now()});case 4:console.log("✨ AI processing complete for:",e.url),t.n=6;break;case 5:t.p=5,a=t.v,console.error("AI processing error:",a);case 6:return t.a(2)}},t,this,[[0,5]])})),function(t){return f.apply(this,arguments)})},{key:"handleTabLoad",value:(h=_(g().m(function t(e,r){var n;return g().w(function(t){for(;;)switch(t.n){case 0:if(r.url&&!r.url.startsWith("chrome://")){t.n=1;break}return t.a(2);case 1:return t.n=2,this.db.getVisitHistory(r.url);case 2:(n=t.v)&&n.visit_count>0&&console.log("🔮 Returning user to: ".concat(r.url," (").concat(n.visit_count," previous visits)"));case 3:return t.a(2)}},t,this)})),function(t,e){return h.apply(this,arguments)})},{key:"handleTabClose",value:(l=_(g().m(function t(e){var r;return g().w(function(t){for(;;)switch(t.n){case 0:if(!(r=this.activeSessions.get(e))||!r.context){t.n=2;break}return t.n=1,this.db.updateVisit(r.context);case 1:this.activeSessions.delete(e);case 2:return t.a(2)}},t,this)})),function(t){return l.apply(this,arguments)})},{key:"handlePageUnload",value:(c=_(g().m(function t(e,r){return g().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.updateVisit(e);case 1:this.activeSessions.delete(r.id);case 2:return t.a(2)}},t,this)})),function(t,e){return c.apply(this,arguments)})},{key:"saveHighlight",value:(u=_(g().m(function t(e){return g().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.saveHighlight(e);case 1:return t.a(2)}},t,this)})),function(t){return u.apply(this,arguments)})},{key:"getPreviousContext",value:(o=_(g().m(function t(e){var r,n,i;return g().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.getVisitHistory(e);case 1:return r=t.v,t.n=2,this.db.getHighlights(e);case 2:return n=t.v,t.n=3,this.db.getAIInsights(e);case 3:if(i=t.v,r){t.n=4;break}return t.a(2,null);case 4:return t.a(2,{visits:r.visit_count||0,lastVisit:r.last_visit,totalTimeSpent:r.total_time_spent||0,highlights:n.slice(0,5),tags:(null==i?void 0:i.tags)||[],summary:null==i?void 0:i.summary})}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"getMemories",value:(s=_(g().m(function t(){var e,r=arguments;return g().w(function(t){for(;;)switch(t.n){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:{},t.n=1,this.db.getMemories(e);case 1:return t.a(2,t.v)}},t,this)})),function(){return s.apply(this,arguments)})},{key:"searchMemories",value:(a=_(g().m(function t(e){var r,n;return g().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.getMemories();case 1:return r=t.v,n=r.filter(function(t){var r=t.highlights.map(function(t){return t.text||""}).join(" ");return"".concat(t.title," ").concat(r).toLowerCase().includes(e.toLowerCase())}),t.a(2,n.sort(function(t,r){var n=t.title.toLowerCase().split(e.toLowerCase()).length;return r.title.toLowerCase().split(e.toLowerCase()).length-n}))}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"addTag",value:(i=_(g().m(function t(e,r){return g().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.addTag(e,r);case 1:return t.a(2)}},t,this)})),function(t,e){return i.apply(this,arguments)})},{key:"getStats",value:(n=_(g().m(function t(){return g().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.getStats();case 1:return t.a(2,t.v)}},t,this)})),function(){return n.apply(this,arguments)})},{key:"exportData",value:(r=_(g().m(function t(){return g().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.exportData();case 1:return t.a(2,t.v)}},t,this)})),function(){return r.apply(this,arguments)})},{key:"importData",value:(e=_(g().m(function t(e){return g().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.db.importData(e);case 1:return t.a(2,t.v)}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"performCleanup",value:(t=_(g().m(function t(){return g().w(function(t){for(;;)switch(t.n){case 0:return console.log("🧹 Performing cleanup..."),t.n=1,this.db.cleanup();case 1:return t.a(2)}},t,this)})),function(){return t.apply(this,arguments)})}]);var t,e,r,n,i,a,s,o,u,c,l,h,f,p,d,m}())})()})();